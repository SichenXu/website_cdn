(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[30],{"+JO1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("knqi"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){return s(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return l(e,t),n(e,[{key:"getControl",value:function(){return new BMap.ScaleControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset"]}}]),e}(o.default);e.default=h},"/flU":function(t,e,i){(function(t){(function(t,i){i(e)})(0,(function(e){"use strict";var i="2.0.62",n=function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)},r=function(t){var e=window.devicePixelRatio||1;t.canvas.width=t.canvas.width*e,t.canvas.height=t.canvas.height*e,t.canvas.style.width=t.canvas.width/e+"px",t.canvas.style.height=t.canvas.height/e+"px",t.scale(e,e)};function o(){this._subscribers={}}o.prototype.on=function(t,e){var i=this._subscribers[t];i||(i=[],this._subscribers[t]=i),i.push({callback:e})},o.prototype.off=function(t,e){var i=this._subscribers[t];if(i)for(var n=0;n<i.length;n++)i[n].callback==e&&(i.splice(n,1),n--)},o.prototype._trigger=function(t,e,i){if("*"==t)throw new Error("Cannot trigger event *");var n=[];t in this._subscribers&&(n=n.concat(this._subscribers[t])),"*"in this._subscribers&&(n=n.concat(this._subscribers["*"]));for(var r=0,o=n.length;r<o;r++){var a=n[r];a.callback&&a.callback(t,e,i||null)}};var a={municipalities:[{n:"\u5317\u4eac",g:"116.395645,39.929986|12"},{n:"\u4e0a\u6d77",g:"121.487899,31.249162|12"},{n:"\u5929\u6d25",g:"117.210813,39.14393|12"},{n:"\u91cd\u5e86",g:"106.530635,29.544606|12"}],provinces:[{n:"\u5b89\u5fbd",g:"117.216005,31.859252|8",cities:[{n:"\u5408\u80a5",g:"117.282699,31.866942|12"},{n:"\u5b89\u5e86",g:"117.058739,30.537898|13"},{n:"\u868c\u57e0",g:"117.35708,32.929499|13"},{n:"\u4eb3\u5dde",g:"115.787928,33.871211|13"},{n:"\u5de2\u6e56",g:"117.88049,31.608733|13"},{n:"\u6c60\u5dde",g:"117.494477,30.660019|14"},{n:"\u6ec1\u5dde",g:"118.32457,32.317351|13"},{n:"\u961c\u9633",g:"115.820932,32.901211|13"},{n:"\u6dee\u5317",g:"116.791447,33.960023|13"},{n:"\u6dee\u5357",g:"117.018639,32.642812|13"},{n:"\u9ec4\u5c71",g:"118.29357,29.734435|13"},{n:"\u516d\u5b89",g:"116.505253,31.755558|13"},{n:"\u9a6c\u978d\u5c71",g:"118.515882,31.688528|13"},{n:"\u5bbf\u5dde",g:"116.988692,33.636772|13"},{n:"\u94dc\u9675",g:"117.819429,30.94093|14"},{n:"\u829c\u6e56",g:"118.384108,31.36602|12"},{n:"\u5ba3\u57ce",g:"118.752096,30.951642|13"}]},{n:"\u798f\u5efa",g:"117.984943,26.050118|8",cities:[{n:"\u798f\u5dde",g:"119.330221,26.047125|12"},{n:"\u9f99\u5ca9",g:"117.017997,25.078685|13"},{n:"\u5357\u5e73",g:"118.181883,26.643626|13"},{n:"\u5b81\u5fb7",g:"119.542082,26.656527|14"},{n:"\u8386\u7530",g:"119.077731,25.44845|13"},{n:"\u6cc9\u5dde",g:"118.600362,24.901652|12"},{n:"\u4e09\u660e",g:"117.642194,26.270835|14"},{n:"\u53a6\u95e8",g:"118.103886,24.489231|12"},{n:"\u6f33\u5dde",g:"117.676205,24.517065|12"}]},{n:"\u7518\u8083",g:"102.457625,38.103267|6",cities:[{n:"\u5170\u5dde",g:"103.823305,36.064226|12"},{n:"\u767d\u94f6",g:"104.171241,36.546682|13"},{n:"\u5b9a\u897f",g:"104.626638,35.586056|13"},{n:"\u7518\u5357\u5dde",g:"102.917442,34.992211|14"},{n:"\u5609\u5cea\u5173",g:"98.281635,39.802397|13"},{n:"\u91d1\u660c",g:"102.208126,38.516072|13"},{n:"\u9152\u6cc9",g:"98.508415,39.741474|13"},{n:"\u4e34\u590f\u5dde",g:"103.215249,35.598514|13"},{n:"\u9647\u5357",g:"104.934573,33.39448|14"},{n:"\u5e73\u51c9",g:"106.688911,35.55011|13"},{n:"\u5e86\u9633",g:"107.644227,35.726801|13"},{n:"\u5929\u6c34",g:"105.736932,34.584319|13"},{n:"\u6b66\u5a01",g:"102.640147,37.933172|13"},{n:"\u5f20\u6396",g:"100.459892,38.93932|13"}]},{n:"\u5e7f\u4e1c",g:"113.394818,23.408004|8",cities:[{n:"\u5e7f\u5dde",g:"113.30765,23.120049|12"},{n:"\u6f6e\u5dde",g:"116.630076,23.661812|13"},{n:"\u4e1c\u839e",g:"113.763434,23.043024|12"},{n:"\u4f5b\u5c71",g:"113.134026,23.035095|13"},{n:"\u6cb3\u6e90",g:"114.713721,23.757251|12"},{n:"\u60e0\u5dde",g:"114.410658,23.11354|12"},{n:"\u6c5f\u95e8",g:"113.078125,22.575117|13"},{n:"\u63ed\u9633",g:"116.379501,23.547999|13"},{n:"\u8302\u540d",g:"110.931245,21.668226|13"},{n:"\u6885\u5dde",g:"116.126403,24.304571|13"},{n:"\u6e05\u8fdc",g:"113.040773,23.698469|13"},{n:"\u6c55\u5934",g:"116.72865,23.383908|13"},{n:"\u6c55\u5c3e",g:"115.372924,22.778731|14"},{n:"\u97f6\u5173",g:"113.594461,24.80296|13"},{n:"\u6df1\u5733",g:"114.025974,22.546054|12"},{n:"\u9633\u6c5f",g:"111.97701,21.871517|14"},{n:"\u4e91\u6d6e",g:"112.050946,22.937976|13"},{n:"\u6e5b\u6c5f",g:"110.365067,21.257463|13"},{n:"\u8087\u5e86",g:"112.479653,23.078663|13"},{n:"\u4e2d\u5c71",g:"113.42206,22.545178|12"},{n:"\u73e0\u6d77",g:"113.562447,22.256915|13"}]},{n:"\u5e7f\u897f",g:"108.924274,23.552255|7",cities:[{n:"\u5357\u5b81",g:"108.297234,22.806493|12"},{n:"\u767e\u8272",g:"106.631821,23.901512|13"},{n:"\u5317\u6d77",g:"109.122628,21.472718|13"},{n:"\u5d07\u5de6",g:"107.357322,22.415455|14"},{n:"\u9632\u57ce\u6e2f",g:"108.351791,21.617398|15"},{n:"\u6842\u6797",g:"110.26092,25.262901|12"},{n:"\u8d35\u6e2f",g:"109.613708,23.103373|13"},{n:"\u6cb3\u6c60",g:"108.069948,24.699521|14"},{n:"\u8d3a\u5dde",g:"111.552594,24.411054|14"},{n:"\u6765\u5bbe",g:"109.231817,23.741166|14"},{n:"\u67f3\u5dde",g:"109.422402,24.329053|12"},{n:"\u94a6\u5dde",g:"108.638798,21.97335|13"},{n:"\u68a7\u5dde",g:"111.305472,23.485395|13"},{n:"\u7389\u6797",g:"110.151676,22.643974|14"}]},{n:"\u8d35\u5dde",g:"106.734996,26.902826|8",cities:[{n:"\u8d35\u9633",g:"106.709177,26.629907|12"},{n:"\u5b89\u987a",g:"105.92827,26.228595|13"},{n:"\u6bd5\u8282\u5730\u533a",g:"105.300492,27.302612|14"},{n:"\u516d\u76d8\u6c34",g:"104.852087,26.591866|13"},{n:"\u94dc\u4ec1\u5730\u533a",g:"109.196161,27.726271|14"},{n:"\u9075\u4e49",g:"106.93126,27.699961|13"},{n:"\u9ed4\u897f\u5357\u5dde",g:"104.900558,25.095148|11"},{n:"\u9ed4\u4e1c\u5357\u5dde",g:"107.985353,26.583992|11"},{n:"\u9ed4\u5357\u5dde",g:"107.523205,26.264536|11"}]},{n:"\u6d77\u5357",g:"109.733755,19.180501|9",cities:[{n:"\u6d77\u53e3",g:"110.330802,20.022071|13"},{n:"\u767d\u6c99",g:"109.358586,19.216056|12"},{n:"\u4fdd\u4ead",g:"109.656113,18.597592|12"},{n:"\u660c\u6c5f",g:"109.0113,19.222483|12"},{n:"\u510b\u5dde",g:"109.413973,19.571153|13"},{n:"\u6f84\u8fc8",g:"109.996736,19.693135|13"},{n:"\u4e1c\u65b9",g:"108.85101,18.998161|13"},{n:"\u5b9a\u5b89",g:"110.32009,19.490991|13"},{n:"\u743c\u6d77",g:"110.414359,19.21483|13"},{n:"\u743c\u4e2d",g:"109.861849,19.039771|12"},{n:"\u4e50\u4e1c",g:"109.062698,18.658614|12"},{n:"\u4e34\u9ad8",g:"109.724101,19.805922|13"},{n:"\u9675\u6c34",g:"109.948661,18.575985|12"},{n:"\u4e09\u4e9a",g:"109.522771,18.257776|12"},{n:"\u5c6f\u660c",g:"110.063364,19.347749|13"},{n:"\u4e07\u5b81",g:"110.292505,18.839886|13"},{n:"\u6587\u660c",g:"110.780909,19.750947|13"},{n:"\u4e94\u6307\u5c71",g:"109.51775,18.831306|13"}]},{n:"\u6cb3\u5317",g:"115.661434,38.61384|7",cities:[{n:"\u77f3\u5bb6\u5e84",g:"114.522082,38.048958|12"},{n:"\u4fdd\u5b9a",g:"115.49481,38.886565|13"},{n:"\u6ca7\u5dde",g:"116.863806,38.297615|13"},{n:"\u627f\u5fb7",g:"117.933822,40.992521|14"},{n:"\u90af\u90f8",g:"114.482694,36.609308|13"},{n:"\u8861\u6c34",g:"115.686229,37.746929|13"},{n:"\u5eca\u574a",g:"116.703602,39.518611|13"},{n:"\u79e6\u7687\u5c9b",g:"119.604368,39.945462|12"},{n:"\u5510\u5c71",g:"118.183451,39.650531|13"},{n:"\u90a2\u53f0",g:"114.520487,37.069531|13"},{n:"\u5f20\u5bb6\u53e3",g:"114.893782,40.811188|13"}]},{n:"\u6cb3\u5357",g:"113.486804,34.157184|7",cities:[{n:"\u90d1\u5dde",g:"113.649644,34.75661|12"},{n:"\u5b89\u9633",g:"114.351807,36.110267|12"},{n:"\u9e64\u58c1",g:"114.29777,35.755426|13"},{n:"\u7126\u4f5c",g:"113.211836,35.234608|13"},{n:"\u5f00\u5c01",g:"114.351642,34.801854|13"},{n:"\u6d1b\u9633",g:"112.447525,34.657368|12"},{n:"\u6f2f\u6cb3",g:"114.046061,33.576279|13"},{n:"\u5357\u9633",g:"112.542842,33.01142|13"},{n:"\u5e73\u9876\u5c71",g:"113.300849,33.745301|13"},{n:"\u6fee\u9633",g:"115.026627,35.753298|12"},{n:"\u4e09\u95e8\u5ce1",g:"111.181262,34.78332|13"},{n:"\u5546\u4e18",g:"115.641886,34.438589|13"},{n:"\u65b0\u4e61",g:"113.91269,35.307258|13"},{n:"\u4fe1\u9633",g:"114.085491,32.128582|13"},{n:"\u8bb8\u660c",g:"113.835312,34.02674|13"},{n:"\u5468\u53e3",g:"114.654102,33.623741|13"},{n:"\u9a7b\u9a6c\u5e97",g:"114.049154,32.983158|13"}]},{n:"\u9ed1\u9f99\u6c5f",g:"128.047414,47.356592|6",cities:[{n:"\u54c8\u5c14\u6ee8",g:"126.657717,45.773225|12"},{n:"\u5927\u5e86",g:"125.02184,46.596709|12"},{n:"\u5927\u5174\u5b89\u5cad\u5730\u533a",g:"124.196104,51.991789|10"},{n:"\u9e64\u5c97",g:"130.292472,47.338666|13"},{n:"\u9ed1\u6cb3",g:"127.50083,50.25069|14"},{n:"\u9e21\u897f",g:"130.941767,45.32154|13"},{n:"\u4f73\u6728\u65af",g:"130.284735,46.81378|12"},{n:"\u7261\u4e39\u6c5f",g:"129.608035,44.588521|13"},{n:"\u4e03\u53f0\u6cb3",g:"131.019048,45.775005|14"},{n:"\u9f50\u9f50\u54c8\u5c14",g:"123.987289,47.3477|13"},{n:"\u53cc\u9e2d\u5c71",g:"131.171402,46.655102|13"},{n:"\u7ee5\u5316",g:"126.989095,46.646064|13"},{n:"\u4f0a\u6625",g:"128.910766,47.734685|14"}]},{n:"\u6e56\u5317",g:"112.410562,31.209316|8",cities:[{n:"\u6b66\u6c49",g:"114.3162,30.581084|12"},{n:"\u9102\u5dde",g:"114.895594,30.384439|14"},{n:"\u6069\u65bd",g:"109.517433,30.308978|14"},{n:"\u9ec4\u5188",g:"114.906618,30.446109|14"},{n:"\u9ec4\u77f3",g:"115.050683,30.216127|13"},{n:"\u8346\u95e8",g:"112.21733,31.042611|13"},{n:"\u8346\u5dde",g:"112.241866,30.332591|12"},{n:"\u6f5c\u6c5f",g:"112.768768,30.343116|13"},{n:"\u795e\u519c\u67b6\u6797\u533a",g:"110.487231,31.595768|13"},{n:"\u5341\u5830",g:"110.801229,32.636994|13"},{n:"\u968f\u5dde",g:"113.379358,31.717858|13"},{n:"\u5929\u95e8",g:"113.12623,30.649047|13"},{n:"\u4ed9\u6843",g:"113.387448,30.293966|13"},{n:"\u54b8\u5b81",g:"114.300061,29.880657|13"},{n:"\u8944\u9633",g:"112.176326,32.094934|12"},{n:"\u5b5d\u611f",g:"113.935734,30.927955|13"},{n:"\u5b9c\u660c",g:"111.310981,30.732758|13"}]},{n:"\u6e56\u5357",g:"111.720664,27.695864|7",cities:[{n:"\u957f\u6c99",g:"112.979353,28.213478|12"},{n:"\u5e38\u5fb7",g:"111.653718,29.012149|12"},{n:"\u90f4\u5dde",g:"113.037704,25.782264|13"},{n:"\u8861\u9633",g:"112.583819,26.898164|13"},{n:"\u6000\u5316",g:"109.986959,27.557483|13"},{n:"\u5a04\u5e95",g:"111.996396,27.741073|13"},{n:"\u90b5\u9633",g:"111.461525,27.236811|13"},{n:"\u6e58\u6f6d",g:"112.935556,27.835095|13"},{n:"\u6e58\u897f\u5dde",g:"109.745746,28.317951|14"},{n:"\u76ca\u9633",g:"112.366547,28.588088|13"},{n:"\u6c38\u5dde",g:"111.614648,26.435972|13"},{n:"\u5cb3\u9633",g:"113.146196,29.378007|13"},{n:"\u5f20\u5bb6\u754c",g:"110.48162,29.124889|13"},{n:"\u682a\u6d32",g:"113.131695,27.827433|13"}]},{n:"\u6c5f\u82cf",g:"119.368489,33.013797|8",cities:[{n:"\u5357\u4eac",g:"118.778074,32.057236|12"},{n:"\u5e38\u5dde",g:"119.981861,31.771397|12"},{n:"\u6dee\u5b89",g:"119.030186,33.606513|12"},{n:"\u8fde\u4e91\u6e2f",g:"119.173872,34.601549|12"},{n:"\u5357\u901a",g:"120.873801,32.014665|12"},{n:"\u82cf\u5dde",g:"120.619907,31.317987|12"},{n:"\u5bbf\u8fc1",g:"118.296893,33.95205|13"},{n:"\u6cf0\u5dde",g:"119.919606,32.476053|13"},{n:"\u65e0\u9521",g:"120.305456,31.570037|12"},{n:"\u5f90\u5dde",g:"117.188107,34.271553|12"},{n:"\u76d0\u57ce",g:"120.148872,33.379862|12"},{n:"\u626c\u5dde",g:"119.427778,32.408505|13"},{n:"\u9547\u6c5f",g:"119.455835,32.204409|13"}]},{n:"\u6c5f\u897f",g:"115.676082,27.757258|7",cities:[{n:"\u5357\u660c",g:"115.893528,28.689578|12"},{n:"\u629a\u5dde",g:"116.360919,27.954545|13"},{n:"\u8d63\u5dde",g:"114.935909,25.845296|13"},{n:"\u5409\u5b89",g:"114.992039,27.113848|13"},{n:"\u666f\u5fb7\u9547",g:"117.186523,29.303563|12"},{n:"\u4e5d\u6c5f",g:"115.999848,29.71964|13"},{n:"\u840d\u4e61",g:"113.859917,27.639544|13"},{n:"\u4e0a\u9976",g:"117.955464,28.457623|13"},{n:"\u65b0\u4f59",g:"114.947117,27.822322|13"},{n:"\u5b9c\u6625",g:"114.400039,27.81113|13"},{n:"\u9e70\u6f6d",g:"117.03545,28.24131|13"}]},{n:"\u5409\u6797",g:"126.262876,43.678846|7",cities:[{n:"\u957f\u6625",g:"125.313642,43.898338|12"},{n:"\u767d\u57ce",g:"122.840777,45.621086|13"},{n:"\u767d\u5c71",g:"126.435798,41.945859|13"},{n:"\u5409\u6797",g:"126.564544,43.871988|12"},{n:"\u8fbd\u6e90",g:"125.133686,42.923303|13"},{n:"\u56db\u5e73",g:"124.391382,43.175525|12"},{n:"\u677e\u539f",g:"124.832995,45.136049|13"},{n:"\u901a\u5316",g:"125.94265,41.736397|13"},{n:"\u5ef6\u8fb9",g:"129.485902,42.896414|13"}]},{n:"\u8fbd\u5b81",g:"122.753592,41.6216|8",cities:[{n:"\u6c88\u9633",g:"123.432791,41.808645|12"},{n:"\u978d\u5c71",g:"123.007763,41.118744|13"},{n:"\u672c\u6eaa",g:"123.778062,41.325838|12"},{n:"\u671d\u9633",g:"120.446163,41.571828|13"},{n:"\u5927\u8fde",g:"121.593478,38.94871|12"},{n:"\u4e39\u4e1c",g:"124.338543,40.129023|12"},{n:"\u629a\u987a",g:"123.92982,41.877304|12"},{n:"\u961c\u65b0",g:"121.660822,42.01925|14"},{n:"\u846b\u82a6\u5c9b",g:"120.860758,40.74303|13"},{n:"\u9526\u5dde",g:"121.147749,41.130879|13"},{n:"\u8fbd\u9633",g:"123.172451,41.273339|14"},{n:"\u76d8\u9526",g:"122.073228,41.141248|13"},{n:"\u94c1\u5cad",g:"123.85485,42.299757|13"},{n:"\u8425\u53e3",g:"122.233391,40.668651|13"}]},{n:"\u5185\u8499\u53e4",g:"114.415868,43.468238|5",cities:[{n:"\u547c\u548c\u6d69\u7279",g:"111.660351,40.828319|12"},{n:"\u963f\u62c9\u5584\u76df",g:"105.695683,38.843075|14"},{n:"\u5305\u5934",g:"109.846239,40.647119|12"},{n:"\u5df4\u5f66\u6dd6\u5c14",g:"107.423807,40.76918|12"},{n:"\u8d64\u5cf0",g:"118.930761,42.297112|12"},{n:"\u9102\u5c14\u591a\u65af",g:"109.993706,39.81649|12"},{n:"\u547c\u4f26\u8d1d\u5c14",g:"119.760822,49.201636|12"},{n:"\u901a\u8fbd",g:"122.260363,43.633756|12"},{n:"\u4e4c\u6d77",g:"106.831999,39.683177|13"},{n:"\u4e4c\u5170\u5bdf\u5e03",g:"113.112846,41.022363|12"},{n:"\u9521\u6797\u90ed\u52d2\u76df",g:"116.02734,43.939705|11"},{n:"\u5174\u5b89\u76df",g:"122.048167,46.083757|11"}]},{n:"\u5b81\u590f",g:"106.155481,37.321323|8",cities:[{n:"\u94f6\u5ddd",g:"106.206479,38.502621|12"},{n:"\u56fa\u539f",g:"106.285268,36.021523|13"},{n:"\u77f3\u5634\u5c71",g:"106.379337,39.020223|13"},{n:"\u5434\u5fe0",g:"106.208254,37.993561|14"},{n:"\u4e2d\u536b",g:"105.196754,37.521124|14"}]},{n:"\u9752\u6d77",g:"96.202544,35.499761|7",cities:[{n:"\u897f\u5b81",g:"101.767921,36.640739|12"},{n:"\u679c\u6d1b\u5dde",g:"100.223723,34.480485|11"},{n:"\u6d77\u4e1c\u5730\u533a",g:"102.085207,36.51761|11"},{n:"\u6d77\u5317\u5dde",g:"100.879802,36.960654|11"},{n:"\u6d77\u5357\u5dde",g:"100.624066,36.284364|11"},{n:"\u6d77\u897f\u5dde",g:"97.342625,37.373799|11"},{n:"\u9ec4\u5357\u5dde",g:"102.0076,35.522852|11"},{n:"\u7389\u6811\u5dde",g:"97.013316,33.00624|14"}]},{n:"\u5c71\u4e1c",g:"118.527663,36.09929|8",cities:[{n:"\u6d4e\u5357",g:"117.024967,36.682785|12"},{n:"\u6ee8\u5dde",g:"117.968292,37.405314|12"},{n:"\u4e1c\u8425",g:"118.583926,37.487121|12"},{n:"\u5fb7\u5dde",g:"116.328161,37.460826|12"},{n:"\u83cf\u6cfd",g:"115.46336,35.26244|13"},{n:"\u6d4e\u5b81",g:"116.600798,35.402122|13"},{n:"\u83b1\u829c",g:"117.684667,36.233654|13"},{n:"\u804a\u57ce",g:"115.986869,36.455829|12"},{n:"\u4e34\u6c82",g:"118.340768,35.072409|12"},{n:"\u9752\u5c9b",g:"120.384428,36.105215|12"},{n:"\u65e5\u7167",g:"119.50718,35.420225|12"},{n:"\u6cf0\u5b89",g:"117.089415,36.188078|13"},{n:"\u5a01\u6d77",g:"122.093958,37.528787|13"},{n:"\u6f4d\u574a",g:"119.142634,36.716115|12"},{n:"\u70df\u53f0",g:"121.309555,37.536562|12"},{n:"\u67a3\u5e84",g:"117.279305,34.807883|13"},{n:"\u6dc4\u535a",g:"118.059134,36.804685|12"}]},{n:"\u5c71\u897f",g:"112.515496,37.866566|7",cities:[{n:"\u592a\u539f",g:"112.550864,37.890277|12"},{n:"\u957f\u6cbb",g:"113.120292,36.201664|12"},{n:"\u5927\u540c",g:"113.290509,40.113744|12"},{n:"\u664b\u57ce",g:"112.867333,35.499834|13"},{n:"\u664b\u4e2d",g:"112.738514,37.693362|13"},{n:"\u4e34\u6c7e",g:"111.538788,36.099745|13"},{n:"\u5415\u6881",g:"111.143157,37.527316|14"},{n:"\u6714\u5dde",g:"112.479928,39.337672|13"},{n:"\u5ffb\u5dde",g:"112.727939,38.461031|12"},{n:"\u9633\u6cc9",g:"113.569238,37.869529|13"},{n:"\u8fd0\u57ce",g:"111.006854,35.038859|13"}]},{n:"\u9655\u897f",g:"109.503789,35.860026|7",cities:[{n:"\u897f\u5b89",g:"108.953098,34.2778|12"},{n:"\u5b89\u5eb7",g:"109.038045,32.70437|13"},{n:"\u5b9d\u9e21",g:"107.170645,34.364081|12"},{n:"\u6c49\u4e2d",g:"107.045478,33.081569|13"},{n:"\u5546\u6d1b",g:"109.934208,33.873907|13"},{n:"\u94dc\u5ddd",g:"108.968067,34.908368|13"},{n:"\u6e2d\u5357",g:"109.483933,34.502358|13"},{n:"\u54b8\u9633",g:"108.707509,34.345373|13"},{n:"\u5ef6\u5b89",g:"109.50051,36.60332|13"},{n:"\u6986\u6797",g:"109.745926,38.279439|12"}]},{n:"\u56db\u5ddd",g:"102.89916,30.367481|7",cities:[{n:"\u6210\u90fd",g:"104.067923,30.679943|12"},{n:"\u963f\u575d\u5dde",g:"102.228565,31.905763|15"},{n:"\u5df4\u4e2d",g:"106.757916,31.869189|14"},{n:"\u8fbe\u5dde",g:"107.494973,31.214199|14"},{n:"\u5fb7\u9633",g:"104.402398,31.13114|13"},{n:"\u7518\u5b5c\u5dde",g:"101.969232,30.055144|15"},{n:"\u5e7f\u5b89",g:"106.63572,30.463984|13"},{n:"\u5e7f\u5143",g:"105.819687,32.44104|13"},{n:"\u4e50\u5c71",g:"103.760824,29.600958|13"},{n:"\u51c9\u5c71\u5dde",g:"102.259591,27.892393|14"},{n:"\u6cf8\u5dde",g:"105.44397,28.89593|14"},{n:"\u5357\u5145",g:"106.105554,30.800965|13"},{n:"\u7709\u5c71",g:"103.84143,30.061115|13"},{n:"\u7ef5\u9633",g:"104.705519,31.504701|12"},{n:"\u5185\u6c5f",g:"105.073056,29.599462|13"},{n:"\u6500\u679d\u82b1",g:"101.722423,26.587571|14"},{n:"\u9042\u5b81",g:"105.564888,30.557491|12"},{n:"\u96c5\u5b89",g:"103.009356,29.999716|13"},{n:"\u5b9c\u5bbe",g:"104.633019,28.769675|13"},{n:"\u8d44\u9633",g:"104.63593,30.132191|13"},{n:"\u81ea\u8d21",g:"104.776071,29.359157|13"}]},{n:"\u897f\u85cf",g:"89.137982,31.367315|6",cities:[{n:"\u62c9\u8428",g:"91.111891,29.662557|13"},{n:"\u963f\u91cc\u5730\u533a",g:"81.107669,30.404557|11"},{n:"\u660c\u90fd\u5730\u533a",g:"97.185582,31.140576|15"},{n:"\u6797\u829d\u5730\u533a",g:"94.349985,29.666941|11"},{n:"\u90a3\u66f2\u5730\u533a",g:"92.067018,31.48068|14"},{n:"\u65e5\u5580\u5219\u5730\u533a",g:"88.891486,29.269023|14"},{n:"\u5c71\u5357\u5730\u533a",g:"91.750644,29.229027|11"}]},{n:"\u65b0\u7586",g:"85.614899,42.127001|6",cities:[{n:"\u4e4c\u9c81\u6728\u9f50",g:"87.564988,43.84038|12"},{n:"\u963f\u62c9\u5c14",g:"81.291737,40.61568|13"},{n:"\u963f\u514b\u82cf\u5730\u533a",g:"80.269846,41.171731|12"},{n:"\u963f\u52d2\u6cf0\u5730\u533a",g:"88.137915,47.839744|13"},{n:"\u5df4\u97f3\u90ed\u695e",g:"86.121688,41.771362|12"},{n:"\u535a\u5c14\u5854\u62c9\u5dde",g:"82.052436,44.913651|11"},{n:"\u660c\u5409\u5dde",g:"87.296038,44.007058|13"},{n:"\u54c8\u5bc6\u5730\u533a",g:"93.528355,42.858596|13"},{n:"\u548c\u7530\u5730\u533a",g:"79.930239,37.116774|13"},{n:"\u5580\u4ec0\u5730\u533a",g:"75.992973,39.470627|12"},{n:"\u514b\u62c9\u739b\u4f9d",g:"84.88118,45.594331|13"},{n:"\u514b\u5b5c\u52d2\u82cf\u5dde",g:"76.137564,39.750346|11"},{n:"\u77f3\u6cb3\u5b50",g:"86.041865,44.308259|13"},{n:"\u5854\u57ce\u5730\u533a",g:"82.974881,46.758684|12"},{n:"\u56fe\u6728\u8212\u514b",g:"79.198155,39.889223|13"},{n:"\u5410\u9c81\u756a\u5730\u533a",g:"89.181595,42.96047|13"},{n:"\u4e94\u5bb6\u6e20",g:"87.565449,44.368899|13"},{n:"\u4f0a\u7281\u5dde",g:"81.297854,43.922248|11"}]},{n:"\u4e91\u5357",g:"101.592952,24.864213|7",cities:[{n:"\u6606\u660e",g:"102.714601,25.049153|12"},{n:"\u4fdd\u5c71",g:"99.177996,25.120489|13"},{n:"\u695a\u96c4\u5dde",g:"101.529382,25.066356|13"},{n:"\u5927\u7406\u5dde",g:"100.223675,25.5969|14"},{n:"\u5fb7\u5b8f\u5dde",g:"98.589434,24.44124|14"},{n:"\u8fea\u5e86\u5dde",g:"99.713682,27.831029|14"},{n:"\u7ea2\u6cb3\u5dde",g:"103.384065,23.367718|11"},{n:"\u4e3d\u6c5f",g:"100.229628,26.875351|13"},{n:"\u4e34\u6ca7",g:"100.092613,23.887806|14"},{n:"\u6012\u6c5f\u5dde",g:"98.859932,25.860677|14"},{n:"\u666e\u6d31",g:"100.980058,22.788778|14"},{n:"\u66f2\u9756",g:"103.782539,25.520758|12"},{n:"\u662d\u901a",g:"103.725021,27.340633|13"},{n:"\u6587\u5c71",g:"104.089112,23.401781|14"},{n:"\u897f\u53cc\u7248\u7eb3",g:"100.803038,22.009433|13"},{n:"\u7389\u6eaa",g:"102.545068,24.370447|13"}]},{n:"\u6d59\u6c5f",g:"119.957202,29.159494|8",cities:[{n:"\u676d\u5dde",g:"120.219375,30.259244|12"},{n:"\u6e56\u5dde",g:"120.137243,30.877925|12"},{n:"\u5609\u5174",g:"120.760428,30.773992|13"},{n:"\u91d1\u534e",g:"119.652576,29.102899|12"},{n:"\u4e3d\u6c34",g:"119.929576,28.4563|13"},{n:"\u5b81\u6ce2",g:"121.579006,29.885259|12"},{n:"\u8862\u5dde",g:"118.875842,28.95691|12"},{n:"\u7ecd\u5174",g:"120.592467,30.002365|13"},{n:"\u53f0\u5dde",g:"121.440613,28.668283|13"},{n:"\u6e29\u5dde",g:"120.690635,28.002838|12"},{n:"\u821f\u5c71",g:"122.169872,30.03601|13"}]}],other:[{n:"\u9999\u6e2f",g:"114.186124,22.293586|11"},{n:"\u6fb3\u95e8",g:"113.557519,22.204118|13"},{n:"\u53f0\u6e7e",g:"120.961454,23.80406|8"}]};function s(t){var e=t.split("|");return e[0]=e[0].split(","),{lng:parseFloat(e[0][0]),lat:parseFloat(e[0][1])}}var u={getProvinceNameByCityName:function(t){for(var e=a.provinces,i=0;i<e.length;i++)for(var n=e[i].n,r=e[i].cities,o=0;o<r.length;o++)if(r[o].n==t)return n;return null},getCenterByCityName:function(t){t=t.replace("\u5e02","");for(var e=0;e<a.municipalities.length;e++)if(a.municipalities[e].n==t)return s(a.municipalities[e].g);for(e=0;e<a.other.length;e++)if(a.other[e].n==t)return s(a.other[e].g);var i=a.provinces;for(e=0;e<i.length;e++){if(i[e].n==t)return s(i[e].g);for(var n=i[e].cities,r=0;r<n.length;r++)if(n[r].n==t)return s(n[r].g)}return null}},l=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},h=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),f=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0},c=function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},p=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e},d=function(){function t(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)if(i.push(a.value),e&&i.length===e)break}catch(u){r=!0,o=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw o}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function v(t,e){o.bind(this)(),this._options=e||{},this._data=[],t&&this.add(t)}function g(t,e,i){var n=60*i+30,r=Math.PI/180*n;return[t.x+e*Math.cos(r),t.y+e*Math.sin(r)]}function m(t,e,i,n){for(var r=0;r<6;r++){var o=g({x:e,y:i},n,r);t.lineTo(o[0],o[1])}}v.prototype=Object.create(o.prototype),v.prototype.add=function(t,e){if(Array.isArray(t)){for(var i=0,n=t.length;i<n;i++)if(t[i]){if(t[i].time&&14==t[i].time.length&&"20"==t[i].time.substr(0,2)){var r=t[i].time;t[i].time=new Date(r.substr(0,4)+"-"+r.substr(4,2)+"-"+r.substr(6,2)+" "+r.substr(8,2)+":"+r.substr(10,2)+":"+r.substr(12,2)).getTime()}this._data.push(t[i])}}else{if(!(t instanceof Object))throw new Error("Unknown dataType");this._data.push(t)}this._dataCache=JSON.parse(JSON.stringify(this._data))},v.prototype.reset=function(){this._data=JSON.parse(JSON.stringify(this._dataCache))},v.prototype.get=function(t){t=t||{};new Date;var e=this._data;new Date;if(t.filter){for(var i=[],n=0;n<e.length;n++)t.filter(e[n])&&i.push(e[n]);e=i}return t.transferCoordinate&&(e=this.transferCoordinate(e,t.transferCoordinate,t.fromColumn,t.toColumn)),e},v.prototype.set=function(t){this._set(t),this._trigger("change")},v.prototype._set=function(t){this.clear(),this.add(t)},v.prototype.clear=function(t){this._data=[]},v.prototype.remove=function(t){},v.prototype.update=function(t,e){for(var i=this._data,n=0;n<i.length;n++)if(e){var r=!0;for(var o in e)i[n][o]!=e[o]&&(r=!1);r&&t&&t(i[n])}else t&&t(i[n]);this._dataCache=JSON.parse(JSON.stringify(this._data)),this._trigger("change")},v.prototype.transferCoordinate=function(t,e,i,n){n=n||"_coordinates",i=i||"coordinates";for(var r=0;r<t.length;r++){var o=t[r].geometry,a=o[i];switch(o.type){case"Point":o[n]=e(a);break;case"LineString":for(var s=[],u=0;u<a.length;u++)s.push(e(a[u]));o[n]=s;break;case"MultiLineString":case"Polygon":s=f(a);o[n]=s;break;case"MultiPolygon":s=[];for(var l=0;l<a.length;l++){var h=a[l];h=f(h);s.push(h)}o[n]=s;break}}function f(t){for(var i=[],n=0;n<t.length;n++){for(var r=t[n],o=[],a=0;a<r.length;a++)o.push(e(r[a]));i.push(o)}return i}return t},v.prototype.initGeometry=function(t){t?this._data.forEach((function(e){e.geometry=t(e)})):this._data.forEach((function(t){if(!t.geometry)if(t.lng&&t.lat)t.geometry={type:"Point",coordinates:[t.lng,t.lat]};else if(t.city){var e=u.getCenterByCityName(t.city);e&&(t.geometry={type:"Point",coordinates:[e.lng,e.lat]})}}))},v.prototype.getMax=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var i=parseFloat(e[0][t]),n=1;n<e.length;n++){var r=parseFloat(e[n][t]);r>i&&(i=r)}return i}},v.prototype.getSum=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var i=0,n=0;n<e.length;n++)e[n][t]&&(i+=parseFloat(e[n][t]));return i}},v.prototype.getMin=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var i=parseFloat(e[0][t]),n=1;n<e.length;n++){var r=parseFloat(e[n][t]);r<i&&(i=r)}return i}},v.prototype.getUnique=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var i={},n=1;n<e.length;n++)i[e[n][t]]=!0;e=[];for(var r in i)e.push(r);return e}};var y={drawDataSet:function(t,e,i){for(var n=e instanceof v?e.get():e,r=0,o=n.length;r<o;r++){var a=n[r];this.draw(t,a,i)}},draw:function(t,e,i){var n=e.geometry.type,r=e.geometry._coordinates||e.geometry.coordinates,o=e.symbol||i.symbol||"circle";switch(n){case"Point":var a=e._size||e.size||i._size||i.size||5;"circle"===o?("Point"===i.bigData&&t.moveTo(r[0],r[1]),t.arc(r[0],r[1],a,0,2*Math.PI)):"rect"===o?t.rect(r[0]-a/2,r[1]-a/2,a,a):"honeycomb"===o&&m(t,r[0],r[1],a);break;case"LineString":this.drawLineString(t,r);break;case"MultiLineString":for(var s=0;s<r.length;s++){var u=r[s];this.drawLineString(t,u)}break;case"Polygon":this.drawPolygon(t,r);break;case"MultiPolygon":for(s=0;s<r.length;s++){var l=r[s];if(this.drawPolygon(t,l),i.multiPolygonDraw){var h=i.multiPolygonDraw();if(h)return h}}break;default:console.error("type"+n+"is not support now!");break}},drawLineString:function(t,e){for(var i=0;i<e.length;i++){var n=e[i][0],r=e[i][1];0==i?t.moveTo(n,r):t.lineTo(n,r)}},drawPolygon:function(t,e){t.beginPath();for(var i=0;i<e.length;i++){var n=e[i];t.moveTo(n[0][0],n[0][1]);for(var r=1;r<n.length;r++)t.lineTo(n[r][0],n[r][1]);t.lineTo(n[0][0],n[0][1]),t.closePath()}}},x={draw:function(t,e,i){var n=e instanceof v?e.get():e;for(var r in t.save(),i)t[r]=i[r];if(i.bigData){t.save(),t.beginPath();for(var o=0,a=n.length;o<a;o++){var s=n[o];y.draw(t,s,i)}var u=i.bigData;"Point"==u||"Polygon"==u||"MultiPolygon"==u?(t.fill(),t.lineDash&&t.setLineDash(t.lineDash),s.lineDash&&t.setLineDash(s.lineDash),(s.strokeStyle||i.strokeStyle)&&i.lineWidth&&t.stroke()):"LineString"!=u&&"MultiLineString"!=u||t.stroke(),t.restore()}else for(o=0,a=n.length;o<a;o++){s=n[o];t.save(),(s.fillStyle||s._fillStyle)&&(t.fillStyle=s.fillStyle||s._fillStyle),(s.strokeStyle||s._strokeStyle)&&(t.strokeStyle=s.strokeStyle||s._strokeStyle),t.lineDash&&t.setLineDash(t.lineDash),s.lineDash&&t.setLineDash(s.lineDash);u=s.geometry.type;t.beginPath(),i.multiPolygonDraw=function(){t.fill(),(s.strokeStyle||i.strokeStyle)&&i.lineWidth&&t.stroke()},y.draw(t,s,i),"Point"==u||"Polygon"==u||"MultiPolygon"==u?(t.fill(),(s.strokeStyle||i.strokeStyle)&&i.lineWidth&&t.stroke()):"LineString"!=u&&"MultiLineString"!=u||((s.lineWidth||s._lineWidth)&&(t.lineWidth=s.lineWidth||s._lineWidth),t.stroke()),t.restore()}t.restore()}};function b(t,e){if("undefined"===typeof document);else{var i=document.createElement("canvas");t&&(i.width=t),e&&(i.height=e)}return i}function _(t){t=t||{},this.gradient=t.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=t.maxSize||35,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}_.prototype.setMax=function(t){this.max=t||100},_.prototype.setMin=function(t){this.min=t||0},_.prototype.setMaxSize=function(t){this.maxSize=t||35},_.prototype.setMinSize=function(t){this.minSize=t||0},_.prototype.initPalette=function(){var t=this.gradient,e=new b(256,1),i=this.paletteCtx=e.getContext("2d"),n=i.createLinearGradient(0,0,256,1);for(var r in t)n.addColorStop(parseFloat(r),t[r]);i.fillStyle=n,i.fillRect(0,0,256,1)},_.prototype.getColor=function(t){var e=this.getImageData(t);return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]/256+")"},_.prototype.getImageData=function(t){var e=this.paletteCtx.getImageData(0,0,256,1).data;if(void 0===t)return e;var i=this.max,n=this.min;t>i&&(t=i),t<n&&(t=n);var r=4*Math.floor((t-n)/(i-n)*255);return[e[r],e[r+1],e[r+2],e[r+3]]},_.prototype.getSize=function(t){var e=0,i=this.max,n=this.min,r=this.maxSize,o=this.minSize;return t>i&&(t=i),t<n&&(t=n),i>n?(e=o+(t-n)/(i-n)*(r-o),e):r},_.prototype.getLegend=function(t){var e=this.gradient,i=t.width||20,n=t.height||180,r=new b(i,n),o=r.getContext("2d"),a=o.createLinearGradient(0,n,0,0);for(var s in e)a.addColorStop(parseFloat(s),e[s]);return o.fillStyle=a,o.fillRect(0,0,i,n),r};var w="undefined"===typeof window?{}:window,A=w.devicePixelRatio||1;function T(t){var e=t/2,i=t+e,n=1e4,r=new b(2*i,2*i),o=r.getContext("2d");return o.shadowBlur=e,o.shadowColor="black",o.shadowOffsetX=o.shadowOffsetY=n,o.beginPath(),o.arc(i-n,i-n,t,0,2*Math.PI,!0),o.closePath(),o.fill(),r}function M(t,e,i){var n=S(i),r=E(i),o=n-r,a=i.range||null,s=0,u=1024;a&&2===a.length&&(s=(a[0]-r)/o*1024),a&&2===a.length&&(u=(a[1]-r)/o*1024);for(var l,h=i.maxOpacity||.8,f=i.minOpacity||0,c=(a=i.range,3),p=t.length;c<p;c+=4)l=4*t[c],t[c]/256>h&&(t[c]=256*h),t[c]/256<f&&(t[c]=256*f),l&&l>=s&&l<=u?(t[c-3]=e[l],t[c-2]=e[l+1],t[c-1]=e[l+2]):t[c]=0}function S(t){var e=t.max||100;return e}function E(t){var e=t.min||0;return e}function C(t,e,i){var n=S(i),r=E(i),o=i._size;void 0==o&&(o=i.size,void 0==o&&(o=13));var a=new _({gradient:i.gradient,max:n,min:r}),s=T(o),u=s.width/2,l=s.height/2,h=e,f={};for(var c in h.forEach((function(t,e){var i=void 0===t.count?1:t.count,r=Math.min(1,i/n).toFixed(2);f[r]=f[r]||[],f[r].push(t)})),f)if(!isNaN(c)){var p=f[c];t.beginPath(),i.withoutAlpha||(t.globalAlpha=c),t.strokeStyle=a.getColor(c*n),p.forEach((function(e,r){if(e.geometry){var o=e.geometry._coordinates||e.geometry.coordinates,a=e.geometry.type;if("Point"===a){var h=void 0===e.count?1:e.count;t.globalAlpha=h/n,t.drawImage(s,o[0]-u,o[1]-l)}else if("LineString"===a){h=void 0===e.count?1:e.count;t.globalAlpha=h/n,t.beginPath(),y.draw(t,e,i),t.stroke()}}}))}}function R(t,e,i){if(!(t.canvas.width<=0||t.canvas.height<=0)){var n=i.strength||.3;t.strokeStyle="rgba(0,0,0,"+n+")";var r=new b(t.canvas.width,t.canvas.height),o=r.getContext("2d");o.scale(A,A),i=i||{};var a=e instanceof v?e.get():e;t.save();var s=new _({gradient:i.gradient});if(C(o,a,i),!i.absolute){var u=o.getImageData(0,0,t.canvas.width,t.canvas.height);M(u.data,s.getImageData(),i),t.putImageData(u,0,0),t.restore()}s=null,r=null}}var k={draw:R},O={draw:function(t,e,i){t.save();var n=e instanceof v?e.get():e,r={},o=i._size||i.size||50,a=!("enableCluster"in i)||i.enableCluster,s=i.offset||{x:0,y:0},u=new _({min:i.min||0,max:i.max||100,gradient:i.gradient});if(a){for(var l=0;l<n.length;l++){c=n[l].geometry._coordinates||n[l].geometry.coordinates,p=Math.floor((c[0]-s.x)/o)+","+Math.floor((c[1]-s.y)/o);r[p]||(r[p]=0),r[p]+=~~(n[l].count||1)}for(var h in r)h=h.split(","),t.beginPath(),t.rect(h[0]*o+.5+s.x,h[1]*o+.5+s.y,o,o),t.fillStyle=u.getColor(r[h]),t.fill(),i.strokeStyle&&i.lineWidth&&t.stroke()}else{for(var f=0;f<n.length;f++){var c=n[f].geometry._coordinates||n[f].geometry.coordinates,p=c.join(",");r[p]=n[f].count||1}for(var d in r)d=d.split(","),t.beginPath(),t.rect(+d[0]-o/2,+d[1]-o/2,o,o),t.fillStyle=u.getColor(r[d]),t.fill(),i.strokeStyle&&i.lineWidth&&t.stroke()}if(i.label&&!1!==i.label.show)for(var p in t.fillStyle=i.label.fillStyle||"white",i.label.font&&(t.font=i.label.font),i.label.shadowColor&&(t.shadowColor=i.label.shadowColor),i.label.shadowBlur&&(t.shadowBlur=i.label.shadowBlur),r){p=p.split(",");var g=r[p],m=t.measureText(g).width;a?t.fillText(g,p[0]*o+.5+s.x+o/2-m/2,p[1]*o+.5+s.y+o/2+5):t.fillText(g,+p[0]-m/2,+p[1]+5)}t.restore()}};function D(t,e,i){var n=60*i+30,r=Math.PI/180*n;return[t.x+e*Math.cos(r),t.y+e*Math.sin(r)]}var B={draw:function(t,e,i){t.save();var n=e instanceof v?e.get():e;for(var r in i)t[r]=i[r];var o=i.offset||{x:10,y:10},a=i._size||i.size||40;a=a/2/Math.sin(Math.PI/3);for(var s=2*a*Math.sin(Math.PI/3),u=1.5*a,l={},h=0;h<n.length;h++){var f=n[h].geometry._coordinates||n[h].geometry.coordinates,c=(f[1]-o.y)/u,p=Math.round(c),d=(f[0]-o.x)/s-(1&p?.5:0),g=Math.round(d),m=c-p;if(3*Math.abs(m)>1){var y=d-g,x=g+(d<g?-1:1)/2,b=p+(c<p?-1:1),w=d-x,A=c-b;y*y+m*m>w*w+A*A&&(g=x+(1&p?1:-1)/2,p=b)}var T=g+"-"+p,M=l[T];M?M.push(n[h]):(M=l[T]=[n[h]],M.i=g,M.j=p,M.x=(g+(1&p?.5:0))*s,M.y=p*u)}var P=new _({max:i.max||100,maxSize:a,gradient:i.gradient});for(var r in l){var S=l[r];t.beginPath();for(var E=0;E<6;E++){var C=D({x:S.x+o.x,y:S.y+o.y},a,E);t.lineTo(C[0],C[1])}t.closePath();var L=0;for(h=0;h<S.length;h++)L+=S[h].count||1;S.count=L,t.fillStyle=P.getColor(L),t.fill(),i.strokeStyle&&i.lineWidth&&t.stroke()}if(i.label&&!1!==i.label.show)for(var r in t.fillStyle=i.label.fillStyle||"white",i.label.font&&(t.font=i.label.font),i.label.shadowColor&&(t.shadowColor=i.label.shadowColor),i.label.shadowBlur&&(t.shadowBlur=i.label.shadowBlur),l){S=l[r];var R=S.count;R=R<0?R.toFixed(2):~~R;var k=t.measureText(R).width;t.fillText(R,S.x+o.x-k/2,S.y+o.y+5)}t.restore()}};function z(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),n}function F(t,e,i){var n=z(t,e,t.VERTEX_SHADER),r=z(t,i,t.FRAGMENT_SHADER),o=t.createProgram();return t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),t.useProgram(o),o}function I(t){var e=document.createElement("canvas"),i=e.getContext("2d");return e.width=1,e.height=1,i.fillStyle=t,i.fillRect(0,0,1,1),i.getImageData(0,0,1,1).data}var U=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),N=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");function j(t,e,i){if(e){var n=F(t,U,N);t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),t.clear(t.COLOR_BUFFER_BIT);var r=t.canvas.width/2,o=t.canvas.height/2,a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a);var s=t.getAttribLocation(n,"a_Position");t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s);var u=t.getUniformLocation(n,"u_FragColor"),l=I(i.strokeStyle||"red");t.uniform4f(u,l[0]/255,l[1]/255,l[2]/255,l[3]/255),t.lineWidth(i.lineWidth||1);for(var h=0,f=e.length;h<f;h++){for(var c=e[h].geometry._coordinates,p=[],d=0;d<c.length;d++){var v=c[d],g=(v[0]-r)/r,m=(o-v[1])/o;p.push(g,m)}var y=new Float32Array(p);t.bufferData(t.ARRAY_BUFFER,y,t.STATIC_DRAW),t.drawArrays(t.LINE_STRIP,0,c.length)}}}var H={draw:j},W=["attribute vec4 a_Position;","attribute float a_PointSize;","void main() {","gl_Position = a_Position;","gl_PointSize = a_PointSize;","}"].join(""),Z=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");function Y(t,e,i){if(e){var n=F(t,W,Z),r=t.getAttribLocation(n,"a_Position"),o=t.getAttribLocation(n,"a_PointSize"),a=t.getUniformLocation(n,"u_FragColor");t.clear(t.COLOR_BUFFER_BIT);for(var s=t.canvas.width/2,u=t.canvas.height/2,l=[],h=0,f=0;f<e.length;f++){var c=e[f].geometry._coordinates,p=(c[0]-s)/s,d=(u-c[1])/u;p<-1||p>1||d<-1||d>1||(l.push(p,d),h++)}var v=new Float32Array(l),g=h,m=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,m),t.bufferData(t.ARRAY_BUFFER,v,t.STATIC_DRAW),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(r),t.vertexAttrib1f(o,i._size);var y=I(i.fillStyle||"red");t.uniform4f(a,y[0]/255,y[1]/255,y[2]/255,y[3]/255),t.drawArrays(t.POINTS,0,g)}}var X={draw:Y};function V(t,e,i){i=i||2;var n,r,o,a,s,u,l,h=e&&e.length,f=h?e[0]*i:t.length,c=G(t,0,f,i,!0),p=[];if(!c)return p;if(h&&(c=et(t,e,c,i)),t.length>80*i){n=o=t[0],r=a=t[1];for(var d=i;d<f;d+=i)s=t[d],u=t[d+1],s<n&&(n=s),u<r&&(r=u),s>o&&(o=s),u>a&&(a=u);l=Math.max(o-n,a-r)}return K(c,p,i,n,r,l),p}function G(t,e,i,n,r){var o,a;if(r===_t(t,e,i,n)>0)for(o=e;o<i;o+=n)a=yt(o,t[o],t[o+1],a);else for(o=i-n;o>=e;o-=n)a=yt(o,t[o],t[o+1],a);return a&&ct(a,a.next)&&(xt(a),a=a.next),a}function q(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!ct(n,n.next)&&0!==ft(n.prev,n,n.next))n=n.next;else{if(xt(n),n=e=n.prev,n===n.next)return null;i=!0}}while(i||n!==e);return e}function K(t,e,i,n,r,o,a){if(t){!a&&o&&ot(t,n,r,o);var s,u,l=t;while(t.prev!==t.next)if(s=t.prev,u=t.next,o?J(t,n,r,o):Q(t))e.push(s.i/i),e.push(t.i/i),e.push(u.i/i),xt(t),t=u.next,l=u.next;else if(t=u,t===l){a?1===a?(t=$(t,e,i),K(t,e,i,n,r,o,2)):2===a&&tt(t,e,i,n,r,o):K(q(t),e,i,n,r,o,1);break}}}function Q(t){var e=t.prev,i=t,n=t.next;if(ft(e,i,n)>=0)return!1;var r=t.next.next;while(r!==t.prev){if(lt(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&ft(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function J(t,e,i,n){var r=t.prev,o=t,a=t.next;if(ft(r,o,a)>=0)return!1;var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,u=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,l=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,h=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,f=st(s,u,e,i,n),c=st(l,h,e,i,n),p=t.nextZ;while(p&&p.z<=c){if(p!==t.prev&&p!==t.next&&lt(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&ft(p.prev,p,p.next)>=0)return!1;p=p.nextZ}p=t.prevZ;while(p&&p.z>=f){if(p!==t.prev&&p!==t.next&&lt(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&ft(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function $(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!ct(r,o)&&pt(r,n,n.next,o)&&vt(r,o)&&vt(o,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(o.i/i),xt(n),xt(n.next),n=t=o),n=n.next}while(n!==t);return n}function tt(t,e,i,n,r,o){var a=t;do{var s=a.next.next;while(s!==a.prev){if(a.i!==s.i&&ht(a,s)){var u=mt(a,s);return a=q(a,a.next),u=q(u,u.next),K(a,e,i,n,r,o),void K(u,e,i,n,r,o)}s=s.next}a=a.next}while(a!==t)}function et(t,e,i,n){var r,o,a,s,u,l=[];for(r=0,o=e.length;r<o;r++)a=e[r]*n,s=r<o-1?e[r+1]*n:t.length,u=G(t,a,s,n,!1),u===u.next&&(u.steiner=!0),l.push(ut(u));for(l.sort(it),r=0;r<l.length;r++)nt(l[r],i),i=q(i,i.next);return i}function it(t,e){return t.x-e.x}function nt(t,e){if(e=rt(t,e),e){var i=mt(e,t);q(i,i.next)}}function rt(t,e){var i,n=e,r=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>a){if(a=s,s===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===a)return i.prev;var u,l=i,h=i.x,f=i.y,c=1/0;n=i.next;while(n!==l)r>=n.x&&n.x>=h&&lt(o<f?r:a,o,h,f,o<f?a:r,o,n.x,n.y)&&(u=Math.abs(o-n.y)/(r-n.x),(u<c||u===c&&n.x>i.x)&&vt(n,t)&&(i=n,c=u)),n=n.next;return i}function ot(t,e,i,n){var r=t;do{null===r.z&&(r.z=st(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,at(r)}function at(t){var e,i,n,r,o,a,s,u,l=1;do{i=t,t=null,o=null,a=0;while(i){for(a++,n=i,s=0,e=0;e<l;e++)if(s++,n=n.nextZ,!n)break;u=l;while(s>0||u>0&&n)0===s?(r=n,n=n.nextZ,u--):0!==u&&n?i.z<=n.z?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,u--):(r=i,i=i.nextZ,s--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,l*=2}while(a>1);return t}function st(t,e,i,n,r){return t=32767*(t-i)/r,e=32767*(e-n)/r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function ut(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function lt(t,e,i,n,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(i-a)*(e-s)>=0&&(i-a)*(o-s)-(r-a)*(n-s)>=0}function ht(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!dt(t,e)&&vt(t,e)&&vt(e,t)&&gt(t,e)}function ft(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ct(t,e){return t.x===e.x&&t.y===e.y}function pt(t,e,i,n){return!!(ct(t,e)&&ct(i,n)||ct(t,n)&&ct(i,e))||ft(t,e,i)>0!==ft(t,e,n)>0&&ft(i,n,t)>0!==ft(i,n,e)>0}function dt(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&pt(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function vt(t,e){return ft(t.prev,t,t.next)<0?ft(t,e,t.next)>=0&&ft(t,t.prev,e)>=0:ft(t,e,t.prev)<0||ft(t,t.next,e)<0}function gt(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!==i.next.y>o&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}function mt(t,e){var i=new bt(t.i,t.x,t.y),n=new bt(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function yt(t,e,i,n){var r=new bt(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function xt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bt(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _t(t,e,i,n){for(var r=0,o=e,a=i-n;o<i;o+=n)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}V.deviation=function(t,e,i,n){var r=e&&e.length,o=r?e[0]*i:t.length,a=Math.abs(_t(t,0,o,i));if(r)for(var s=0,u=e.length;s<u;s++){var l=e[s]*i,h=s<u-1?e[s+1]*i:t.length;a-=Math.abs(_t(t,l,h,i))}var f=0;for(s=0;s<n.length;s+=3){var c=n[s]*i,p=n[s+1]*i,d=n[s+2]*i;f+=Math.abs((t[c]-t[d])*(t[p+1]-t[c+1])-(t[c]-t[p])*(t[d+1]-t[c+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},V.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)i.vertices.push(t[r][o][a]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i};var wt=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),At=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");function Tt(t,e,i){if(e){t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,t.canvas.width,t.canvas.height);var n=F(t,wt,At);t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE);var r=t.canvas.width/2,o=t.canvas.height/2;t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer());var a=t.getAttribLocation(n,"a_Position");t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a);var s=t.getUniformLocation(n,"u_FragColor"),u=I(i.fillStyle||"red");t.uniform4f(s,u[0]/255,u[1]/255,u[2]/255,u[3]/255),t.lineWidth(i.lineWidth||1);for(var l=[],h=[],f=65536,c=0,p=0,d=e.length;p<d;p++){var v=V.flatten(e[p].geometry._coordinates||e[p].geometry.coordinates),g=v.vertices;c=l.length/2;for(var m=0;m<g.length;m+=2)g[m]=(g[m]-r)/r,g[m+1]=(o-g[m+1])/o;(l.length+g.length)/2>f&&(t.bufferData(t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,h.length,t.UNSIGNED_SHORT,0),l.length=0,h.length=0,c=0);for(m=0;m<g.length;m++)l.push(g[m]);var y=V(g,v.holes,v.dimensions);for(m=0;m<y.length;m++)h.push(y[m]+c)}t.bufferData(t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,h.length,t.UNSIGNED_SHORT,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}var Mt={draw:Tt},Pt={draw:function(t,e,i){var n=e instanceof v?e.get():e;n.length>0&&("LineString"==n[0].geometry.type?H.draw(t,n,i):"Polygon"==n[0].geometry.type||"MultiPolygon"==n[0].geometry.type?Mt.draw(t,n,i):X.draw(t,n,i))}};function St(t,e){e=e||{};for(var i=[],n=0;n<t.length-1;n++){var r=Et(t[n],t[n+1],e.count);r&&r.length>0&&(i=i.concat(r))}return i}function Et(t,e,i){if(!t||!e)return null;var n,r,o,a,s,u,l=function(t){return 1-2*t+t*t},h=function(t){return 2*t-2*t*t},f=function(t){return t*t},c=[],p=(i=i||40,0),d=0;if("undefined"!=typeof e){var v=parseFloat(t.lat),g=parseFloat(e.lat),m=parseFloat(t.lng),y=parseFloat(e.lng);for(y>m&&parseFloat(y-m)>180&&m<0&&(m=parseFloat(360+m),y=parseFloat(360+y)),0,u=0,g==v?(n=0,r=m-y):y==m?(n=Math.PI/2,r=v-g):(n=Math.atan((g-v)/(y-m)),r=(g-v)/Math.sin(n)),0==u&&(u=n+Math.PI/5),o=r/2,s=o*Math.cos(u)+m,a=o*Math.sin(u)+v,p=0;p<i+1;p++){var x=m*l(d)+s*h(d)+y*f(d),b=v*l(d)+a*h(d)+g*f(d),_=t.lng,w=e.lng;c.push([_<0&&w>0?x-360:x,b]),d+=1/i}return c}"undefined"!=typeof c&&(c=[])}var Ct={getPoints:St},Lt=function(){var t={},e=[],i=[],n=[],r=.1,o=.1,a=1,s=2,u=6,l=70,h=.6666667,f=.6,c=1e-8;function p(t,e){return t.x*e.x+t.y*e.y}function d(e){return{x:t[e.target].x-t[e.source].x,y:t[e.target].y-t[e.source].y}}function v(e){return Math.sqrt(Math.pow(t[e.source].x-t[e.target].x,2)+Math.pow(t[e.source].y-t[e.target].y,2))}function g(t){return Math.sqrt(Math.pow(t.source.x-t.target.x,2)+Math.pow(t.source.y-t.target.y,2))}function m(e){var i=(t[e.source].x+t[e.target].x)/2,n=(t[e.source].y+t[e.target].y)/2;return{x:i,y:n}}function y(t){for(var e=0,i=1;i<n[t].length;i++){var r=x(n[t][i],n[t][i-1]);e+=r}return e}function x(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function b(t,e){var i=Math.sqrt((e.target.x-e.source.x)*(e.target.x-e.source.x)+(e.target.y-e.source.y)*(e.target.y-e.source.y)),n=((e.source.y-t.y)*(e.source.y-e.target.y)-(e.source.x-t.x)*(e.target.x-e.source.x))/(i*i);return{x:e.source.x+n*(e.target.x-e.source.x),y:e.source.y+n*(e.target.y-e.source.y)}}function _(){for(var i=0;i<e.length;i++)1==a?n[i]=[]:(n[i]=[],n[i].push(t[e[i].source]),n[i].push(t[e[i].target]))}function w(){for(var t=0;t<e.length;t++)i[t]=[]}function A(e){for(var i=[],n=0;n<e.length;n++)t[e[n].source].x!=t[e[n].target].x&&t[e[n].source].y!=t[e[n].target].y&&i.push(e[n]);return i}function T(t,e,i){var r=n[t][e-1],o=n[t][e+1],a=n[t][e],s=r.x-a.x+o.x-a.x,u=r.y-a.y+o.y-a.y;return s*=i,u*=i,{x:s,y:u}}function M(t,e,r){for(var o={x:0,y:0},a=i[t],s=0;s<a.length;s++){var u={x:n[a[s]][e].x-n[t][e].x,y:n[a[s]][e].y-n[t][e].y};if(Math.abs(u.x)>c||Math.abs(u.y)>c){var l=1/Math.pow(g({source:n[a[s]][e],target:n[t][e]}),1);o.x+=u.x*l,o.y+=u.y*l}}return o}function S(t,i,n){for(var o=r/(v(e[t])*(i+1)),a=[{x:0,y:0}],s=1;s<i+1;s++){var u={x:0,y:0},l=T(t,s,o),h=M(t,s,n);u.x=n*(l.x+h.x),u.y=n*(l.y+h.y),a.push(u)}return a.push({x:0,y:0}),a}function E(i){for(var r=0;r<e.length;r++)if(1==i)n[r].push(t[e[r].source]),n[r].push(m(e[r])),n[r].push(t[e[r].target]);else{var o=y(r),a=o/(i+1),s=a,u=[];u.push(t[e[r].source]);for(var l=1;l<n[r].length;l++){var h=x(n[r][l],n[r][l-1]);while(h>s){var f=s/h,c=n[r][l-1].x,p=n[r][l-1].y;c+=f*(n[r][l].x-n[r][l-1].x),p+=f*(n[r][l].y-n[r][l-1].y),u.push({x:c,y:p}),h-=s,s=a}s-=h}u.push(t[e[r].target]),n[r]=u}}function C(t,e){var i=Math.abs(p(d(t),d(e))/(v(t)*v(e)));return i}function L(t,e){var i=(v(t)+v(e))/2,n=2/(i/Math.min(v(t),v(e))+Math.max(v(t),v(e))/i);return n}function R(e,i){var n=(v(e)+v(i))/2,r={x:(t[e.source].x+t[e.target].x)/2,y:(t[e.source].y+t[e.target].y)/2},o={x:(t[i.source].x+t[i.target].x)/2,y:(t[i.source].y+t[i.target].y)/2},a=n/(n+x(r,o));return a}function k(e,i){var n=b(t[i.source],{source:t[e.source],target:t[e.target]}),r=b(t[i.target],{source:t[e.source],target:t[e.target]}),o={x:(n.x+r.x)/2,y:(n.y+r.y)/2},a={x:(t[e.source].x+t[e.target].x)/2,y:(t[e.source].y+t[e.target].y)/2},s=Math.max(0,1-2*x(a,o)/x(n,r));return s}function O(t,e){return Math.min(k(t,e),k(e,t))}function D(t,e){var i=C(t,e)*L(t,e)*R(t,e)*O(t,e);return i}function B(t,e){return D(t,e)>=f}function z(){for(var t=0;t<e.length-1;t++)for(var n=t+1;n<e.length;n++)t!=n&&B(e[t],e[n])&&(i[t].push(n),i[n].push(t))}var F=function(){var t=o,i=l,r=a;_(),w(),E(r),z();for(var s=0;s<u;s++){for(var f=0;f<i;f++){for(var c=[],p=0;p<e.length;p++)c[p]=S(p,r,t);for(var d=0;d<e.length;d++)for(var v=0;v<r+1;v++)n[d][v].x+=c[d][v].x,n[d][v].y+=c[d][v].y}t/=2,r*=2,i*=h,E(r)}return n};return F.nodes=function(e){return 0==arguments.length?t:(t=e,F)},F.edges=function(t){return 0==arguments.length?e:(e=A(t),F)},F.bundling_stiffness=function(t){return 0==arguments.length?r:(r=t,F)},F.step_size=function(t){return 0==arguments.length?o:(o=t,F)},F.cycles=function(t){return 0==arguments.length?u:(u=t,F)},F.iterations=function(t){return 0==arguments.length?l:(l=t,F)},F.iterations_rate=function(t){return 0==arguments.length?h:(h=t,F)},F.subdivision_points_seed=function(t){return 0==arguments.length?P:(P=t,F)},F.subdivision_rate=function(t){return 0==arguments.length?s:(s=t,F)},F.compatbility_threshold=function(t){return 0==arguments.length?compatbility_threshold:(f=t,F)},F};function Rt(t){this.splitList=t||{other:1}}function kt(t){this.splitList=t||[{start:0,value:"red"}]}Rt.prototype.get=function(t){var e=this.splitList,i=e["other"];for(var n in e)if(t==n){i=e[n];break}return i},Rt.prototype.generateByDataSet=function(t,e){var i=e||["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],n=t.get();this.splitList={};for(var r=0,o=0;o<n.length;o++)if(void 0===this.splitList[n[o].count]&&(this.splitList[n[o].count]=i[r],r++),r>=i.length-1)break;this.splitList["other"]=i[i.length-1]},Rt.prototype.getLegend=function(t){var e=this.splitList,i=document.createElement("div");i.style.cssText="background:#fff; padding: 5px; border: 1px solid #ccc;";var n="";for(var r in e)n+='<div style="line-height: 19px;" value="'+r+'"><span style="vertical-align: -2px; display: inline-block; width: 30px;height: 19px;background:'+e[r]+';"></span><span style="margin-left: 3px;">'+r+"<span></div>";return i.innerHTML=n,i},kt.prototype.get=function(t){for(var e=this.splitList,i=!1,n=0;n<e.length;n++)if((void 0===e[n].start||void 0!==e[n].start&&t>=e[n].start)&&(void 0===e[n].end||void 0!==e[n].end&&t<e[n].end)){i=e[n].value;break}return i},kt.prototype.generateByDataSet=function(t){var e=t.getMin("count"),i=t.getMax("count");this.generateByMinMax(e,i)},kt.prototype.generateByMinMax=function(t,e){var i=["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],n=Number((e-t)/7);e=Number(e);var r=Number(t);this.splitList=[];var o=0;while(r<e)this.splitList.push({start:r,end:r+n,value:i[o]}),o++,r+=n},kt.prototype.getLegend=function(t){this.splitList};var Ot=function(){function t(e,i,n){if(l(this,t),!e||!i)return console.warn("id \u548c type \u4e3a\u5fc5\u586b\u9879"),!1;if("baidu"==i){if(!BMap)return console.warn("\u8bf7\u5148\u5f15\u5165\u767e\u5ea6\u5730\u56feJS API"),!1}else console.warn("\u6682\u4e0d\u652f\u6301\u4f60\u7684\u5730\u56fe\u7c7b\u578b");this.type=i;var r=n&&n.center?n.center:[106.962497,38.208726],o=n&&n.zoom?n.zoom:5,a=this.map=new BMap.Map(e,{enableMapClick:!1});a.centerAndZoom(new BMap.Point(r[0],r[1]),o),a.enableScrollWheelZoom(!0),a.setMapStyle({style:"light"})}return h(t,[{key:"addLayer",value:function(t,e){if("baidu"==this.type)return new mapv.baiduMapLayer(this.map,dataSet,e)}},{key:"getMap",value:function(){return this.map}}]),t}();function Dt(t){this.options=t||{},this.paneName=this.options.paneName||"mapPane",this.context=this.options.context||"2d",this.zIndex=this.options.zIndex||0,this.mixBlendMode=this.options.mixBlendMode||null,this.enableMassClear=this.options.enableMassClear,this._map=t.map,this._lastDrawTime=null,this.show()}var Bt="undefined"===typeof window?{}:window,zt=Bt.BMap||Bt.BMapGL;zt&&(Dt.prototype=new zt.Overlay,Dt.prototype.initialize=function(t){this._map=t;var e=this.canvas=document.createElement("canvas");e.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";user-select:none;",e.style.mixBlendMode=this.mixBlendMode,this.adjustSize();var i=t.getPanes()[this.paneName];i||(i=t.getPanes().floatShadow),i.appendChild(e);var n=this;return t.addEventListener("resize",(function(){n.adjustSize(),n._draw()})),t.addEventListener("update",(function(){n._draw()})),this.options.updateImmediate&&setTimeout((function(){n._draw()}),100),this.canvas},Dt.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas,i=this.devicePixelRatio=Bt.devicePixelRatio||1;e.width=t.width*i,e.height=t.height*i,"2d"==this.context&&e.getContext(this.context).scale(i,i),e.style.width=t.width+"px",e.style.height=t.height+"px"},Dt.prototype.draw=function(){var t=this;this.options.updateImmediate?t._draw():(clearTimeout(t.timeoutID),t.timeoutID=setTimeout((function(){t._draw()}),15))},Dt.prototype._draw=function(){var t=this._map,e=t.getSize(),i=t.getCenter();if(i){var n=t.pointToOverlayPixel(i);this.canvas.style.left=n.x-e.width/2+"px",this.canvas.style.top=n.y-e.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this)}},Dt.prototype.getContainer=function(){return this.canvas},Dt.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},Dt.prototype.hide=function(){this.canvas.style.display="none"},Dt.prototype.setZIndex=function(t){this.zIndex=t,this.canvas.style.zIndex=this.zIndex},Dt.prototype.getZIndex=function(){return this.zIndex});var Ft=Ft||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},update:function(e,i){if(0===t.length)return!1;var n=0;e=void 0!==e?e:Ft.now();while(n<t.length)t[n].update(e)||i?n++:t.splice(n,1);return!0}}}();function It(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=360*Math.atan(n/i)/(2*Math.PI);return e[0]<t[0]&&(r+=180),r}"undefined"===typeof window&&"undefined"!==typeof t?Ft.now=function(){var e=t.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?Ft.now=window.performance.now.bind(window.performance):void 0!==Date.now?Ft.now=Date.now:Ft.now=function(){return(new Date).getTime()},Ft.Tween=function(t){var e,i=t,n={},r={},o={},a=1e3,s=0,u=!1,l=!1,h=!1,f=0,c=null,p=Ft.Easing.Linear.None,d=Ft.Interpolation.Linear,v=[],g=null,m=!1,y=null,x=null,b=null;this.to=function(t,e){return r=t,void 0!==e&&(a=e),this},this.start=function(t){for(var e in Ft.add(this),l=!0,m=!1,c=void 0!==t?t:Ft.now(),c+=f,r){if(r[e]instanceof Array){if(0===r[e].length)continue;r[e]=[i[e]].concat(r[e])}void 0!==i[e]&&(n[e]=i[e],n[e]instanceof Array===!1&&(n[e]*=1),o[e]=n[e]||0)}return this},this.stop=function(){return l?(Ft.remove(this),l=!1,null!==b&&b.call(i,i),this.stopChainedTweens(),this):this},this.end=function(){return this.update(c+a),this},this.stopChainedTweens=function(){for(var t=0,e=v.length;t<e;t++)v[t].stop()},this.delay=function(t){return f=t,this},this.repeat=function(t){return s=t,this},this.repeatDelay=function(t){return e=t,this},this.yoyo=function(t){return u=t,this},this.easing=function(t){return p=t,this},this.interpolation=function(t){return d=t,this},this.chain=function(){return v=arguments,this},this.onStart=function(t){return g=t,this},this.onUpdate=function(t){return y=t,this},this.onComplete=function(t){return x=t,this},this.onStop=function(t){return b=t,this},this.update=function(t){var l,b,_;if(t<c)return!0;for(l in!1===m&&(null!==g&&g.call(i,i),m=!0),b=(t-c)/a,b=b>1?1:b,_=p(b),r)if(void 0!==n[l]){var w=n[l]||0,A=r[l];A instanceof Array?i[l]=d(A,_):("string"===typeof A&&(A="+"===A.charAt(0)||"-"===A.charAt(0)?w+parseFloat(A):parseFloat(A)),"number"===typeof A&&(i[l]=w+(A-w)*_))}if(null!==y&&y.call(i,_),1===b){if(s>0){for(l in isFinite(s)&&s--,o){if("string"===typeof r[l]&&(o[l]=o[l]+parseFloat(r[l])),u){var T=o[l];o[l]=r[l],r[l]=T}n[l]=o[l]}return u&&(h=!h),c=void 0!==e?t+e:t+f,!0}null!==x&&x.call(i,i);for(var M=0,P=v.length;M<P;M++)v[M].start(c+a);return!1}return!0}},Ft.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-Ft.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*Ft.Easing.Bounce.In(2*t):.5*Ft.Easing.Bounce.Out(2*t-1)+.5}}},Ft.Interpolation={Linear:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n),o=Ft.Interpolation.Utils.Linear;return e<0?o(t[0],t[1],n):e>1?o(t[i],t[i-1],i-n):o(t[r],t[r+1>i?i:r+1],n-r)},Bezier:function(t,e){for(var i=0,n=t.length-1,r=Math.pow,o=Ft.Interpolation.Utils.Bernstein,a=0;a<=n;a++)i+=r(1-e,n-a)*r(e,a)*t[a]*o(n,a);return i},CatmullRom:function(t,e){var i=t.length-1,n=i*e,r=Math.floor(n),o=Ft.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(r=Math.floor(n=i*(1+e))),o(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],n-r)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(o(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):o(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],n-r)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=Ft.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i=1;if(t[e])return t[e];for(var n=e;n>1;n--)i*=n;return t[e]=i,i}}(),CatmullRom:function(t,e,i,n,r){var o=.5*(i-t),a=.5*(n-e),s=r*r,u=r*s;return(2*e-2*i+o+a)*u+(-3*e+3*i-2*o-a)*s+o*r+e}}};var Ut={},Nt={draw:function(t,e,i){var n="http://huiyan.baidu.com/github/tools/gis-drawing/static/images/direction.png";i.arrow&&i.arrow.url&&(n=i.arrow.url),Ut[n]||(Ut[n]=null);var r=Ut[n];if(!r){var o=Array.prototype.slice.call(arguments),a=new Image;return a.onload=function(){Ut[n]=a,Nt.draw.apply(null,o)},void(a.src=n)}var s=e instanceof v?e.get():e;for(var u in t.save(),i)t[u]=i[u];for(var l=[],h=null,f=0,c=s.length;f<c;f++){var p=s[f];t.save(),(p.fillStyle||p._fillStyle)&&(t.fillStyle=p.fillStyle||p._fillStyle),(p.strokeStyle||p._strokeStyle)&&(t.strokeStyle=p.strokeStyle||p._strokeStyle);var d=p.geometry.type;if(t.beginPath(),"LineString"===d)for(var g=p.geometry._coordinates||p.geometry.coordinates,m=void 0!==i.arrow.interval?i.arrow.interval:1,y=0;y<g.length;y+=m)if(g[y]&&g[y+1]){var x=g[y];if(h&&jt(x,h)<30)continue;t.save();var b=It(g[y],g[y+1]);t.translate(x[0],x[1]),t.rotate(b*Math.PI/180),t.drawImage(r,-r.width/2/2,-r.height/2/2,r.width/2,r.height/2),t.restore(),l.push(x),h=x}t.restore()}t.restore()}};function jt(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}var Ht={draw:function(t,e,i){var r=e instanceof v?e.get():e;t.save(),t.fillStyle=i.fillStyle||"rgba(0, 0, 0, 0.5)",t.fillRect(0,0,t.canvas.width,t.canvas.height),i.multiPolygonDraw=function(){t.save(),t.clip(),n(t),t.restore()};for(var o=0,a=r.length;o<a;o++)t.beginPath(),y.drawDataSet(t,[r[o]],i),t.save(),t.clip(),n(t),t.restore();t.restore()}},Wt={},Zt={},Yt={draw:function(t,e,i){t.save();for(var n=e instanceof v?e.get():e,r=0;r<n.length;r++){var o=n[r],a=o.geometry._coordinates||o.geometry.coordinates;if(t.beginPath(),o.properties&&o.properties.cluster){if(t.arc(a[0],a[1],o.size,0,2*Math.PI),t.fillStyle=o.fillStyle,t.fill(),i.label&&!1!==i.label.show){t.fillStyle=i.label.fillStyle||"white",i.label.font&&(t.font=i.label.font),i.label.shadowColor&&(t.shadowColor=i.label.shadowColor),i.label.shadowBlur&&(t.shadowBlur=i.label.shadowBlur);var s=o.properties.point_count,u=t.measureText(s).width;t.fillText(s,a[0]+.5-u/2,a[1]+.5+3)}}else this.drawIcon(o,i,t)}t.restore()},drawIcon:function(t,e,i){var n=t.geometry._coordinates||t.geometry.coordinates,r=d(n,2),o=r[0],a=r[1],s=Object.assign({},e.iconOptions,t.iconOptions),u=function(){i.beginPath(),i.arc(o,a,e.size||5,0,2*Math.PI),i.fillStyle=e.fillStyle||"red",i.fill()};if(s.url){var l=s.width,h=s.height,f=s.offset||{x:0,y:0};o=o-~~l/2+f.x,a=a-~~h/2+f.y;var c=window.encodeURIComponent(s.url),p=Wt[c];p?"error"===p?u():l&&h?i.drawImage(p,o,a,l,h):i.drawImage(p,o,a):(Zt[c]||(Zt[c]=[],Xt(c,(function(t,e){Zt[e]&&Zt[e].forEach((function(e){return e(t)})),Zt[e]=null,Wt[e]=t}),(function(t){Zt[t]&&Zt[t].forEach((function(e){return e("error",t)})),Zt[t]=null,Wt[t]="error",u()}))),Zt[c].push(function(t,e,n,r){return function(o){"error"===o?u():n&&r?i.drawImage(o,t,e,n,r):i.drawImage(o,t,e)}}(o,a,l,h)))}else u()}};function Xt(t,e,i){var n=new Image;n.onload=function(){e&&e(n,t)},n.onerror=function(){i&&i(t)},n.src=window.decodeURIComponent(t)}var Vt={draw:function(t,e,i){var n=e instanceof v?e.get():e;for(var r in t.save(),i)t[r]=i[r];var o=[],a=i._size||i.size;a?t.font="bold "+a+"px Arial":a=12;var s=i.textKey||"text";if(i.textAlign||(t.textAlign="center"),i.textBaseline||(t.textBaseline="middle"),i.avoid)for(var u=0,l=n.length;u<l;u++){var h=n[u].offset||i.offset||{x:0,y:0},f=n[u].geometry._coordinates||n[u].geometry.coordinates,c=f[0]+h.x,p=f[1]+h.y,d=n[u][s],g=t.measureText(d).width,m=c-g/2,y=p-a/2,x={sw:{x:m,y:y+a},ne:{x:m+g,y:y}};Gt(o,x)||(o.push(x),m+=g/2,y+=a/2,t.fillText(d,m,y))}else for(u=0,l=n.length;u<l;u++){h=n[u].offset||i.offset||{x:0,y:0},f=n[u].geometry._coordinates||n[u].geometry.coordinates,c=f[0]+h.x,p=f[1]+h.y,d=n[u][s];t.fillText(d,c,p)}t.restore()}};function Gt(t,e){for(var i=0;i<t.length;i++)if(qt(t[i],e))return!0;return!1}function qt(t,e){var i=Math.min(t.ne.x,e.ne.x),n=Math.min(t.sw.y,e.sw.y),r=Math.max(t.sw.x,e.sw.x),o=Math.max(t.ne.y,e.ne.y);return i>r&&n>o}var Kt={},Qt={},Jt={draw:function(t,e,i){for(var n=e instanceof v?e.get():e,r=function(){var e=n[o];if(e.geometry)if(s=e.icon||i.icon,"string"===typeof s){var r=window.encodeURIComponent(s),a=Kt[r];a?$t(a,i,t,e):(Qt[r]||(Qt[r]=[],te(r,(function(t,e){Qt[e]&&Qt[e].forEach((function(e){return e(t)})),Qt[e]=null,Kt[e]=t}),(function(t){Qt[t]&&Qt[t].forEach((function(t){return t("error")})),Qt[t]=null,Kt[t]="error"}))),Qt[r].push((function(n){$t(n,i,t,e)})))}else $t(s,i,t,e)},o=0,a=n.length;o<a;o++){var s;r()}}};function $t(t,e,i,n){i.save();var r=n.geometry._coordinates||n.geometry.coordinates,o=r[0],a=r[1],s=e.offset||{x:0,y:0},u=n.width||e._width||e.width,l=n.height||e._height||e.height;if(o=o-~~u/2+s.x,a=a-~~l/2+s.y,"string"===typeof t)return i.beginPath(),i.arc(o,a,e.size||5,0,2*Math.PI),i.fillStyle=e.fillStyle||"red",void i.fill();var h=n.deg||e.deg;h&&(i.translate(o,a),i.rotate(h*Math.PI/180),i.translate(-o,-a)),e.sx&&e.sy&&e.swidth&&e.sheight&&e.width&&e.height?i.drawImage(t,e.sx,e.sy,e.swidth,e.sheight,o,a,u,l):u&&l?i.drawImage(t,o,a,u,l):i.drawImage(t,o,a),i.restore()}function te(t,e,i){var n=new Image;n.onload=function(){e&&e(n,t)},n.onerror=function(){i&&i(t)},n.src=window.decodeURIComponent(t)}function ee(t,e,i,n,r,o){if(!(r-n<=i)){var a=n+r>>1;ie(t,e,a,n,r,o%2),ee(t,e,i,n,a-1,o+1),ee(t,e,i,a+1,r,o+1)}}function ie(t,e,i,n,r,o){while(r>n){if(r-n>600){var a=r-n+1,s=i-n+1,u=Math.log(a),l=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1),f=Math.max(n,Math.floor(i-s*l/a+h)),c=Math.min(r,Math.floor(i+(a-s)*l/a+h));ie(t,e,i,f,c,o)}var p=e[2*i+o],d=n,v=r;ne(t,e,n,i),e[2*r+o]>p&&ne(t,e,n,r);while(d<v){ne(t,e,d,v),d++,v--;while(e[2*d+o]<p)d++;while(e[2*v+o]>p)v--}e[2*n+o]===p?ne(t,e,n,v):(v++,ne(t,e,v,r)),v<=i&&(n=v+1),i<=v&&(r=v-1)}}function ne(t,e,i,n){re(t,i,n),re(e,2*i,2*n),re(e,2*i+1,2*n+1)}function re(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function oe(t,e,i,n,r,o,a){var s,u,l=[0,t.length-1,0],h=[];while(l.length){var f=l.pop(),c=l.pop(),p=l.pop();if(c-p<=a)for(var d=p;d<=c;d++)s=e[2*d],u=e[2*d+1],s>=i&&s<=r&&u>=n&&u<=o&&h.push(t[d]);else{var v=Math.floor((p+c)/2);s=e[2*v],u=e[2*v+1],s>=i&&s<=r&&u>=n&&u<=o&&h.push(t[v]);var g=(f+1)%2;(0===f?i<=s:n<=u)&&(l.push(p),l.push(v-1),l.push(g)),(0===f?r>=s:o>=u)&&(l.push(v+1),l.push(c),l.push(g))}}return h}function ae(t,e,i,n,r,o){var a=[0,t.length-1,0],s=[],u=r*r;while(a.length){var l=a.pop(),h=a.pop(),f=a.pop();if(h-f<=o)for(var c=f;c<=h;c++)se(e[2*c],e[2*c+1],i,n)<=u&&s.push(t[c]);else{var p=Math.floor((f+h)/2),d=e[2*p],v=e[2*p+1];se(d,v,i,n)<=u&&s.push(t[p]);var g=(l+1)%2;(0===l?i-r<=d:n-r<=v)&&(a.push(f),a.push(p-1),a.push(g)),(0===l?i+r>=d:n+r>=v)&&(a.push(p+1),a.push(h),a.push(g))}}return s}function se(t,e,i,n){var r=t-i,o=e-n;return r*r+o*o}var ue=function(t){return t[0]},le=function(t){return t[1]},he=function(t,e,i,n,r){void 0===e&&(e=ue),void 0===i&&(i=le),void 0===n&&(n=64),void 0===r&&(r=Float64Array),this.nodeSize=n,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new r(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=i(t[u]);ee(a,s,n,0,a.length-1,0)};he.prototype.range=function(t,e,i,n){return oe(this.ids,this.coords,t,e,i,n,this.nodeSize)},he.prototype.within=function(t,e,i){return ae(this.ids,this.coords,t,e,i,this.nodeSize)};var fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},ce=function(t){this.options=_e(Object.create(fe),t),this.trees=new Array(this.options.maxZoom+1)};function pe(t,e,i,n,r){return{x:t,y:e,zoom:1/0,id:i,parentId:-1,numPoints:n,properties:r}}function de(t,e){var i=t.geometry.coordinates,n=i[0],r=i[1];return{x:me(n),y:ye(r),zoom:1/0,index:e,parentId:-1}}function ve(t){return{type:"Feature",id:t.id,properties:ge(t),geometry:{type:"Point",coordinates:[xe(t.x),be(t.y)]}}}function ge(t){var e=t.numPoints,i=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return _e(_e({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function me(t){return t/360+.5}function ye(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function xe(t){return 360*(t-.5)}function be(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function _e(t,e){for(var i in e)t[i]=e[i];return t}function we(t){return t.x}function Ae(t){return t.y}function Te(t){requestAnimationFrame(Te),Ft.update(t)}ce.prototype.load=function(t){var e=this.options,i=(e.log,e.minZoom),n=e.maxZoom,r=e.nodeSize;t.length;this.points=t;for(var o=[],a=0;a<t.length;a++)t[a].geometry&&o.push(de(t[a],a));this.trees[n+1]=new he(o,we,Ae,r,Float32Array);for(var s=n;s>=i;s--){Date.now();o=this._cluster(o,s),this.trees[s]=new he(o,we,Ae,r,Float32Array)}return this},ce.prototype.getClusters=function(t,e){var i=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),r=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,r=180;else if(i>r){var a=this.getClusters([i,n,180,o],e),s=this.getClusters([-180,n,r,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=u.range(me(i),ye(o),me(r),ye(n)),h=[],f=0,c=l;f<c.length;f+=1){var p=c[f],d=u.points[p];h.push(d.numPoints?ve(d):this.points[d.index])}return h},ce.prototype.getChildren=function(t){var e=this._getOriginId(t),i=this._getOriginZoom(t),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);var o=r.points[e];if(!o)throw new Error(n);for(var a=this.options.radius/(this.options.extent*Math.pow(2,i-1)),s=r.within(o.x,o.y,a),u=[],l=0,h=s;l<h.length;l+=1){var f=h[l],c=r.points[f];c.parentId===t&&u.push(c.numPoints?ve(c):this.points[c.index])}if(0===u.length)throw new Error(n);return u},ce.prototype.getLeaves=function(t,e,i){e=e||10,i=i||0;var n=[];return this._appendLeaves(n,t,e,i,0),n},ce.prototype.getTile=function(t,e,i){var n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius,u=s/a,l=(i-u)/r,h=(i+1+u)/r,f={features:[]};return this._addTileFeatures(n.range((e-u)/r,l,(e+1+u)/r,h),n.points,e,i,r,f),0===e&&this._addTileFeatures(n.range(1-u/r,l,1,h),n.points,r,i,r,f),e===r-1&&this._addTileFeatures(n.range(0,l,u/r,h),n.points,-1,i,r,f),f.features.length?f:null},ce.prototype.getClusterExpansionZoom=function(t){var e=this._getOriginZoom(t)-1;while(e<=this.options.maxZoom){var i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e},ce.prototype._appendLeaves=function(t,e,i,n,r){for(var o=this.getChildren(e),a=0,s=o;a<s.length;a+=1){var u=s[a],l=u.properties;if(l&&l.cluster?r+l.point_count<=n?r+=l.point_count:r=this._appendLeaves(t,l.cluster_id,i,n,r):r<n?r++:t.push(u),t.length===i)break}return r},ce.prototype._addTileFeatures=function(t,e,i,n,r,o){for(var a=0,s=t;a<s.length;a+=1){var u=s[a],l=e[u],h=l.numPoints,f={type:1,geometry:[[Math.round(this.options.extent*(l.x*r-i)),Math.round(this.options.extent*(l.y*r-n))]],tags:h?ge(l):this.points[l.index].properties},c=void 0;h?c=l.id:this.options.generateId?c=l.index:this.points[l.index].id&&(c=this.points[l.index].id),void 0!==c&&(f.id=c),o.features.push(f)}},ce.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},ce.prototype._cluster=function(t,e){for(var i=[],n=this.options,r=n.radius,o=n.extent,a=n.reduce,s=n.minPoints,u=r/(o*Math.pow(2,e)),l=0;l<t.length;l++){var h=t[l];if(!(h.zoom<=e)){h.zoom=e;for(var f=this.trees[e+1],c=f.within(h.x,h.y,u),p=h.numPoints||1,d=p,v=0,g=c;v<g.length;v+=1){var m=g[v],y=f.points[m];y.zoom>e&&(d+=y.numPoints||1)}if(d>=s){for(var x=h.x*p,b=h.y*p,_=a&&p>1?this._map(h,!0):null,w=(l<<5)+(e+1)+this.points.length,A=0,T=c;A<T.length;A+=1){var M=T[A],P=f.points[M];if(!(P.zoom<=e)){P.zoom=e;var S=P.numPoints||1;x+=P.x*S,b+=P.y*S,P.parentId=w,a&&(_||(_=this._map(h,!0)),a(_,this._map(P)))}}h.parentId=w,i.push(pe(x/d,b/d,w,d,_))}else if(i.push(h),d>1)for(var E=0,C=c;E<C.length;E+=1){var L=C[E],R=f.points[L];R.zoom<=e||(R.zoom=e,i.push(R))}}}return i},ce.prototype._getOriginId=function(t){return t-this.points.length>>5},ce.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},ce.prototype._map=function(t,e){if(t.numPoints)return e?_e({},t.properties):t.properties;var i=this.points[t.index].properties,n=this.options.map(i);return e&&n===i?_e({},n):n},"undefined"!==typeof window&&requestAnimationFrame(Te);var Me=function(){function t(e,i,n){l(this,t),i instanceof v||(i=new v(i)),this.dataSet=i,this.map=e,"cluster"===n.draw&&this.refreshCluster(n)}return h(t,[{key:"refreshCluster",value:function(t){t=t||this.options,this.supercluster=new ce({maxZoom:t.maxZoom||19,radius:t.clusterRadius||100,minPoints:t.minPoints||2,extent:t.extent||512}),this.supercluster.load(this.dataSet.get()),this.supercluster.trees.forEach((function(t){var e=0,i=1/0;t.points.forEach((function(t){e=Math.max(t.numPoints||0,e),i=Math.min(t.numPoints||1/0,i)})),t.max=e,t.min=i})),this.clusterDataSet=new v}},{key:"getDefaultContextConfig",value:function(){return{globalAlpha:1,globalCompositeOperation:"source-over",imageSmoothingEnabled:!0,strokeStyle:"#000000",fillStyle:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDashOffset:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic"}}},{key:"initDataRange",value:function(t){var e=this;if(e.intensity=new _({maxSize:e.options.maxSize,minSize:e.options.minSize,gradient:e.options.gradient,max:e.options.max||this.dataSet.getMax("count")}),e.category=new Rt(e.options.splitList),e.choropleth=new kt(e.options.splitList),void 0===e.options.splitList&&e.category.generateByDataSet(this.dataSet,e.options.color),void 0===e.options.splitList){var i=e.options.min||this.dataSet.getMin("count"),n=e.options.max||this.dataSet.getMax("count");e.choropleth.generateByMinMax(i,n)}}},{key:"getLegend",value:function(t){this.options.draw;var e=this;return"intensity"==e.options.draw||"heatmap"==e.options.draw?this.intensity.getLegend(t):"category"==e.options.draw?this.category.getLegend(t):void 0}},{key:"processData",value:function(t){var e=this,i=e.options.draw;if("bubble"==i||"intensity"==i||"category"==i||"choropleth"==i||"simple"==i)for(var n=0;n<t.length;n++){var r=t[n];"bubble"==e.options.draw?t[n]._size=e.intensity.getSize(r.count):t[n]._size=void 0;var o="_fillStyle";"LineString"!==t[n].geometry.type&&"stroke"!==e.options.styleType||(o="_strokeStyle"),"intensity"==e.options.draw?t[n][o]=e.intensity.getColor(r.count):"category"==e.options.draw?t[n][o]=e.category.get(r.count):"choropleth"==e.options.draw&&(t[n][o]=e.choropleth.get(r.count))}}},{key:"isEnabledTime",value:function(){var t=this.options.animation,e=t&&!(!1===t.enabled);return e}},{key:"argCheck",value:function(t){"heatmap"==t.draw&&t.strokeStyle&&console.warn("[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]")}},{key:"drawContext",value:function(t,e,i,n){var r=this;switch(r.options.draw){case"heatmap":k.draw(t,e,r.options);break;case"grid":case"cluster":case"honeycomb":r.options.offset={x:n.x,y:n.y},"grid"===r.options.draw?O.draw(t,e,r.options):"cluster"===r.options.draw?Yt.draw(t,e,r.options):B.draw(t,e,r.options);break;case"text":Vt.draw(t,e,r.options);break;case"icon":Jt.draw(t,e,r.options);break;case"clip":Ht.draw(t,e,r.options);break;default:"webgl"==r.options.context?Pt.draw(r.canvasLayer.canvas.getContext("webgl"),e,r.options):x.draw(t,e,r.options)}r.options.arrow&&!1!==r.options.arrow.show&&Nt.draw(t,e,r.options)}},{key:"isPointInPath",value:function(t,e){var i;t=this.canvasLayer.canvas.getContext(this.context);i="cluster"===this.options.draw&&(!this.options.maxClusterZoom||this.options.maxClusterZoom>=this.getZoom())?this.clusterDataSet.get():this.dataSet.get();for(var n=0;n<i.length;n++){t.beginPath();var r=this.options,o=e.x*this.canvasLayer.devicePixelRatio,a=e.y*this.canvasLayer.devicePixelRatio;r.multiPolygonDraw=function(){if(t.isPointInPath(o,a))return i[n]},y.draw(t,i[n],r);var s=i[n].geometry&&i[n].geometry.type;if(s.indexOf("LineString")>-1){if(t.isPointInStroke&&t.isPointInStroke(o,a))return i[n]}else if(t.isPointInPath(o,a))return i[n]}}},{key:"getClusterPoints",value:function(t){var e=this;if("Feature"!==t.type)return[];var i=this.supercluster.getChildren(t.id);return i.map((function(t){return"Feature"===t.type?e.getClusterPoints(t):t})).flat()}},{key:"clickEvent",value:function(t,e){if(this.options.methods){var i=this.isPointInPath(this.getContext(),t);if(i){if("cluster"===this.options.draw){var n=this.getClusterPoints(i);i.children=n}this.options.methods.click(i,e)}else this.options.methods.click(null,e)}}},{key:"mousemoveEvent",value:function(t,e){if(this.options.methods){var i=this.isPointInPath(this.getContext(),t);if(i){if("cluster"===this.options.draw){var n=this.getClusterPoints(i);i.children=n}this.options.methods.mousemove(i,e)}else this.options.methods.mousemove(null,e)}}},{key:"tapEvent",value:function(t,e){if(this.options.methods){var i=this.isPointInPath(this.getContext(),t);if(i){if("cluster"===this.options.draw){var n=this.getClusterPoints(i);i.children=n}this.options.methods.tap(i,e)}else this.options.methods.tap(null,e)}}},{key:"update",value:function(t,e){var i=this,n=t.options,r=i.options;for(var o in n)r[o]=n[o];i.init(r),!1!==e&&i.draw()}},{key:"setOptions",value:function(t){var e=this;e.dataSet.reset(),e.init(t),e.draw()}},{key:"set",value:function(t){var e=this,i=this.getContext(),n=this.getDefaultContextConfig();for(var r in n)i[r]=n[r];e.init(t.options),e.draw()}},{key:"destroy",value:function(){this.unbindEvent(),this.hide()}},{key:"initAnimator",value:function(){var t=this,e=t.options.animation;if("time"==t.options.draw||t.isEnabledTime()){e.stepsRange||(e.stepsRange={start:this.dataSet.getMin("time")||0,end:this.dataSet.getMax("time")||0}),this.steps={step:e.stepsRange.start},t.animator=new Ft.Tween(this.steps).onUpdate((function(){t._canvasUpdate(this.step)})).repeat(1/0),this.addAnimatorEvent();var i=1e3*e.duration||5e3;t.animator.to({step:e.stepsRange.end},i),t.animator.start()}else t.animator&&t.animator.stop()}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this.animator.stop())}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator&&this.animator.start()}}]),t}(),Pe="undefined"===typeof window?{}:window,Se=Pe.BMap||Pe.BMapGL,Ee=function(t){function e(t,i,n){l(this,e);var r=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));r.map=t,r.options=n||{},r.dataSet=i;var o=new Dt({map:t,zIndex:r.options.zIndex,update:r._canvasUpdate.bind(r)});r.init(r.options),r.canvasLayer=o,r.transferToMercator();var a=r;return i.on("change",(function(){a.transferToMercator(),o.draw()})),r.ctx=o.canvas.getContext("2d"),r.start(),r}return c(e,t),h(e,[{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),e.options.max&&this.intensity.setMax(e.options.max),e.options.min&&this.intensity.setMin(e.options.min),this.initAnimator()}},{key:"transferToMercator",value:function(){var t,e=this.map,i=e.getMapType();if(t=i.getProjection?i.getProjection():{lngLatToPoint:function(t){var i=e.lnglatToMercator(t.lng,t.lat);return{x:i[0],y:i[1]}}},"bd09mc"!==this.options.coordType){var n=this.dataSet.get();n=this.dataSet.transferCoordinate(n,(function(e){var i=t.lngLatToPoint({lng:e[0],lat:e[1]});return[i.x,i.y]}),"coordinates","coordinates_mercator"),this.dataSet._set(n)}}},{key:"_canvasUpdate",value:function(){var t=this.ctx;if(t){var e,i,r,o=this.map;o.getMapType().getProjection?(e=o.getMapType().getProjection(),i=e.lngLatToPoint(o.getCenter())):(i={x:o.getCenter().lng,y:o.getCenter().lat},i.x>-180&&i.x<180&&(i=o.lnglatToMercator(i.x,i.y),i={x:i[0],y:i[1]}),e={lngLatToPoint:function(t){var e=o.lnglatToMercator(t.lng,t.lat);return{x:e[0],y:e[1]}}}),r=e.getZoomUnits?e.getZoomUnits(o.getZoom()):Math.pow(2,18-o.getZoom());var a=new Se.Pixel(i.x-o.getSize().width/2*r,i.y+o.getSize().height/2*r);n(t);var s={fromColumn:"bd09mc"==this.options.coordType?"coordinates":"coordinates_mercator",transferCoordinate:function(t){if(t){var e=(t[0]-a.x)/r,i=(a.y-t[1])/r;return[e,i]}}};this.data=this.dataSet.get(s),this.processData(this.data),this.drawAnimation()}}},{key:"drawAnimation",value:function(){var t=this.ctx,e=this.data;if(e){t.save(),t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, .1)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore(),t.save(),this.options.shadowColor&&(t.shadowColor=this.options.shadowColor),this.options.shadowBlur&&(t.shadowBlur=this.options.shadowBlur),this.options.globalAlpha&&(t.globalAlpha=this.options.globalAlpha),this.options.globalCompositeOperation&&(t.globalCompositeOperation=this.options.globalCompositeOperation);for(var i=this.options,n=0;n<e.length;n++)if("Point"===e[n].geometry.type){t.beginPath();var r=e[n].size||this.options.size,o=e[n].minSize||this.options.minSize||0;void 0===e[n]._size&&(e[n]._size=o),t.arc(e[n].geometry._coordinates[0],e[n].geometry._coordinates[1],e[n]._size,0,2*Math.PI,!0),t.closePath(),e[n]._size++,e[n]._size>r&&(e[n]._size=o),t.lineWidth=1,t.strokeStyle=e[n].strokeStyle||e[n]._strokeStyle||i.strokeStyle||"yellow",t.stroke();var a=e[n].fillStyle||e[n]._fillStyle||i.fillStyle;a&&(t.fillStyle=a,t.fill())}else if("LineString"===e[n].geometry.type){t.beginPath();var s=e[n].size||this.options.size||5;o=e[n].minSize||this.options.minSize||0;void 0===e[n]._index&&(e[n]._index=0);var u=e[n]._index;t.arc(e[n].geometry._coordinates[u][0],e[n].geometry._coordinates[u][1],s,0,2*Math.PI,!0),t.closePath(),e[n]._index++,e[n]._index>=e[n].geometry._coordinates.length&&(e[n]._index=0);var l=e[n].strokeStyle||i.strokeStyle;a=e[n].fillStyle||i.fillStyle||"yellow";t.fillStyle=a,t.fill(),l&&i.lineWidth&&(t.lineWidth=i.lineWidth||1,t.strokeStyle=l,t.stroke())}t.restore()}}},{key:"animate",value:function(){this.drawAnimation();var t=this.options.animateTime||100;this.timeout=setTimeout(this.animate.bind(this),t)}},{key:"start",value:function(){this.stop(),this.animate()}},{key:"stop",value:function(){clearTimeout(this.timeout)}},{key:"unbindEvent",value:function(){}},{key:"hide",value:function(){this.canvasLayer.hide(),this.stop()}},{key:"show",value:function(){this.start()}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"destroy",value:function(){this.stop(),this.unbindEvent(),this.clearData(),this.map.removeOverlay(this.canvasLayer),this.canvasLayer=null}}]),e}(Me),Ce="undefined"===typeof window?{}:window,Le=Ce.BMap||Ce.BMapGL,Re=function(t){function e(t,i,n){l(this,e);var r=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n)),o=r;n=n||{},r.clickEvent=r.clickEvent.bind(r),r.mousemoveEvent=r.mousemoveEvent.bind(r),r.tapEvent=r.tapEvent.bind(r),o.init(n),o.argCheck(n),o.transferToMercator();var a=r.canvasLayer=new Dt({map:t,context:r.context,updateImmediate:n.updateImmediate,paneName:n.paneName,mixBlendMode:n.mixBlendMode,enableMassClear:n.enableMassClear,zIndex:n.zIndex,update:function(){o._canvasUpdate()}});return i.on("change",(function(){o.transferToMercator(),"cluster"===n.draw&&o.refreshCluster(),a.draw()})),r}return c(e,t),h(e,[{key:"clickEvent",value:function(t){var i=t.pixel;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,i,t)}},{key:"mousemoveEvent",value:function(t){var i=t.pixel;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,i,t)}},{key:"tapEvent",value:function(t){var i=t.pixel;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"tapEvent",this).call(this,i,t)}},{key:"bindEvent",value:function(t){this.unbindEvent();var e=this.map,i=0,n=this;this.options.methods&&(this.options.methods.click&&(e.setDefaultCursor("default"),e.addEventListener("click",this.clickEvent)),this.options.methods.mousemove&&e.addEventListener("mousemove",this.mousemoveEvent),"ontouchend"in window.document&&this.options.methods.tap&&(e.addEventListener("touchstart",(function(t){i=new Date})),e.addEventListener("touchend",(function(t){new Date-i<300&&n.tapEvent(t)}))))}},{key:"unbindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.removeEventListener("click",this.clickEvent),this.options.methods.mousemove&&e.removeEventListener("mousemove",this.mousemoveEvent))}},{key:"transferToMercator",value:function(t){t||(t=this.dataSet);var e,i=this.map,n=i.getMapType();if(e=n.getProjection?n.getProjection():{lngLatToPoint:function(t){var e=i.lnglatToMercator(t.lng,t.lat);return{x:e[0],y:e[1]}}},"bd09mc"!==this.options.coordType){var r=t.get();r=t.transferCoordinate(r,(function(t){if(t[0]<-180||t[0]>180||t[1]<-90||t[1]>90)return t;var i=e.lngLatToPoint({lng:t[0],lat:t[1]});return[i.x,i.y]}),"coordinates","coordinates_mercator"),t._set(r)}}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e,i,r,o=this,a=this.options.animation,s=this.canvasLayer._map;s.getMapType().getProjection?(e=s.getMapType().getProjection(),i=e.lngLatToPoint(s.getCenter())):(i={x:s.getCenter().lng,y:s.getCenter().lat},i.x>-180&&i.x<180&&(i=s.lnglatToMercator(i.x,i.y),i={x:i[0],y:i[1]}),e={lngLatToPoint:function(t){var e=s.lnglatToMercator(t.lng,t.lat);return{x:e[0],y:e[1]}}}),r=e.getZoomUnits?e.getZoomUnits(s.getZoom()):Math.pow(2,18-s.getZoom());var u=new Le.Pixel(i.x-s.getSize().width/2*r,i.y+s.getSize().height/2*r),l=this.getContext();if(this.isEnabledTime()){if(void 0===t)return void n(l);"2d"==this.context&&(l.save(),l.globalCompositeOperation="destination-out",l.fillStyle="rgba(0, 0, 0, .1)",l.fillRect(0,0,l.canvas.width,l.canvas.height),l.restore())}else n(l);if("2d"==this.context)for(var h in this.options)l[h]=this.options[h];else l.clear(l.COLOR_BUFFER_BIT);if(!(this.options.minZoom&&s.getZoom()<this.options.minZoom||this.options.maxZoom&&s.getZoom()>this.options.maxZoom)){var f=1;"2d"!=this.context&&(f=this.canvasLayer.devicePixelRatio);var c,p={fromColumn:"bd09mc"==this.options.coordType?"coordinates":"coordinates_mercator",transferCoordinate:function(t){var e=(t[0]-u.x)/r*f,i=(u.y-t[1])/r*f;return[e,i]}};void 0!==t&&(p.filter=function(e){var i=a.trails||10;return!!(t&&e.time>t-i&&e.time<t)});var d=this.getZoom();if("cluster"===this.options.draw&&(!this.options.maxClusterZoom||this.options.maxClusterZoom>=d)){var v=this.map.getBounds(),g=v.getNorthEast(),m=v.getSouthWest(),y=this.supercluster.getClusters([m.lng,m.lat,g.lng,g.lat],d);this.pointCountMax=this.supercluster.trees[d].max,this.pointCountMin=this.supercluster.trees[d].min;var x={},b=null,w=null;this.pointCountMax===this.pointCountMin?(b=this.options.fillStyle,w=this.options.minSize||8):x=new _({min:this.pointCountMin,max:this.pointCountMax,minSize:this.options.minSize||8,maxSize:this.options.maxSize||30,gradient:this.options.gradient});for(var A=0;A<y.length;A++){var T=y[A];T.properties&&T.properties.cluster_id?(y[A].size=w||x.getSize(T.properties.point_count),y[A].fillStyle=b||x.getColor(T.properties.point_count)):y[A].size=o.options.size}this.clusterDataSet.set(y),this.transferToMercator(this.clusterDataSet),c=o.clusterDataSet.get(p)}else c=o.dataSet.get(p);this.processData(c);var M=s.pointToPixel(new Le.Point(0,0));"m"==o.options.unit?(o.options.size&&(o.options._size=o.options.size/r),o.options.width&&(o.options._width=o.options.width/r),o.options.height&&(o.options._height=o.options.height/r)):(o.options._size=o.options.size,o.options._height=o.options.height,o.options._width=o.options.width),this.drawContext(l,c,o.options,M),o.options.updateCallback&&o.options.updateCallback(t)}}}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),e.options.max&&this.intensity.setMax(e.options.max),e.options.min&&this.intensity.setMin(e.options.min),this.initAnimator(),this.bindEvent()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"addAnimatorEvent",value:function(){this.map.addEventListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addEventListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer),this.bindEvent()}},{key:"hide",value:function(){this.unbindEvent(),this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){this.canvasLayer&&this.canvasLayer.draw()}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"destroy",value:function(){this.unbindEvent(),this.clearData(),this.map.removeOverlay(this.canvasLayer),this.canvasLayer=null}}]),e}(Me);function ke(t){this.isAdded_=!1,this.isAnimated_=!1,this.paneName_=ke.DEFAULT_PANE_NAME_,this.updateHandler_=null,this.resizeHandler_=null,this.topLeft_=null,this.centerListener_=null,this.resizeListener_=null,this.needsResize_=!0,this.requestAnimationFrameId_=null;var e=document.createElement("canvas");function i(t,e){return function(){e.apply(t)}}e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.pointerEvents="none",this.canvas=e,this.canvasCssWidth_=300,this.canvasCssHeight_=150,this.resolutionScale_=1,this.repositionFunction_=i(this,this.repositionCanvas_),this.resizeFunction_=i(this,this.resize_),this.requestUpdateFunction_=i(this,this.update_),t&&this.setOptions(t)}var Oe="undefined"===typeof window?{}:window;Oe.google&&Oe.google.maps&&(ke.prototype=new google.maps.OverlayView,ke.DEFAULT_PANE_NAME_="overlayLayer",ke.CSS_TRANSFORM_=function(){for(var t=document.createElement("div"),e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],i=0;i<e.length;i++){var n=e[i];if(void 0!==t.style[n])return n}return e[0]}(),ke.prototype.requestAnimFrame_=Oe.requestAnimationFrame||Oe.webkitRequestAnimationFrame||Oe.mozRequestAnimationFrame||Oe.oRequestAnimationFrame||Oe.msRequestAnimationFrame||function(t){return Oe.setTimeout(t,1e3/60)},ke.prototype.cancelAnimFrame_=Oe.cancelAnimationFrame||Oe.webkitCancelAnimationFrame||Oe.mozCancelAnimationFrame||Oe.oCancelAnimationFrame||Oe.msCancelAnimationFrame||function(t){},ke.prototype.setOptions=function(t){void 0!==t.animate&&this.setAnimate(t.animate),void 0!==t.paneName&&this.setPaneName(t.paneName),void 0!==t.updateHandler&&this.setUpdateHandler(t.updateHandler),void 0!==t.resizeHandler&&this.setResizeHandler(t.resizeHandler),void 0!==t.resolutionScale&&this.setResolutionScale(t.resolutionScale),void 0!==t.map&&this.setMap(t.map)},ke.prototype.setAnimate=function(t){this.isAnimated_=!!t,this.isAnimated_&&this.scheduleUpdate()},ke.prototype.isAnimated=function(){return this.isAnimated_},ke.prototype.setPaneName=function(t){this.paneName_=t,this.setPane_()},ke.prototype.getPaneName=function(){return this.paneName_},ke.prototype.setPane_=function(){if(this.isAdded_){var t=this.getPanes();if(!t[this.paneName_])throw new Error('"'+this.paneName_+'" is not a valid MapPane name.');t[this.paneName_].appendChild(this.canvas)}},ke.prototype.setResizeHandler=function(t){this.resizeHandler_=t},ke.prototype.setResolutionScale=function(t){"number"===typeof t&&(this.resolutionScale_=t,this.resize_())},ke.prototype.setUpdateHandler=function(t){this.updateHandler_=t},ke.prototype.onAdd=function(){this.isAdded_||(this.isAdded_=!0,this.setPane_(),this.resizeListener_=google.maps.event.addListener(this.getMap(),"resize",this.resizeFunction_),this.centerListener_=google.maps.event.addListener(this.getMap(),"center_changed",this.repositionFunction_),this.resize_(),this.repositionCanvas_())},ke.prototype.onRemove=function(){this.isAdded_&&(this.isAdded_=!1,this.topLeft_=null,this.canvas.parentElement.removeChild(this.canvas),this.centerListener_&&(google.maps.event.removeListener(this.centerListener_),this.centerListener_=null),this.resizeListener_&&(google.maps.event.removeListener(this.resizeListener_),this.resizeListener_=null),this.requestAnimationFrameId_&&(this.cancelAnimFrame_.call(Oe,this.requestAnimationFrameId_),this.requestAnimationFrameId_=null))},ke.prototype.resize_=function(){if(this.isAdded_){var t=this.getMap(),e=t.getDiv().offsetWidth,i=t.getDiv().offsetHeight,n=e*this.resolutionScale_,r=i*this.resolutionScale_,o=this.canvas.width,a=this.canvas.height;o===n&&a===r||(this.canvas.width=n,this.canvas.height=r,this.needsResize_=!0,this.scheduleUpdate()),this.canvasCssWidth_===e&&this.canvasCssHeight_===i||(this.canvasCssWidth_=e,this.canvasCssHeight_=i,this.canvas.style.width=e+"px",this.canvas.style.height=i+"px")}},ke.prototype.draw=function(){this.repositionCanvas_()},ke.prototype.repositionCanvas_=function(){var t=this.getMap(),e=t.getBounds().getNorthEast().lat(),i=t.getCenter(),n=Math.pow(2,t.getZoom()),r=i.lng()-180*this.canvasCssWidth_/(256*n);this.topLeft_=new google.maps.LatLng(e,r);var o=this.getProjection(),a=o.fromLatLngToDivPixel(i),s=-Math.round(this.canvasCssWidth_/2-a.x),u=-Math.round(this.canvasCssHeight_/2-a.y);this.canvas.style[ke.CSS_TRANSFORM_]="translate("+s+"px,"+u+"px)",this.scheduleUpdate()},ke.prototype.update_=function(){this.requestAnimationFrameId_=null,this.isAdded_&&(this.isAnimated_&&this.scheduleUpdate(),this.needsResize_&&this.resizeHandler_&&(this.needsResize_=!1,this.resizeHandler_()),this.updateHandler_&&this.updateHandler_())},ke.prototype.getTopLeft=function(){return this.topLeft_},ke.prototype.scheduleUpdate=function(){this.isAdded_&&!this.requestAnimationFrameId_&&(this.requestAnimationFrameId_=this.requestAnimFrame_.call(Oe,this.requestUpdateFunction_))});var De=function(t){function e(t,i,n){l(this,e);var r=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n)),o=r;n=n||{},o.init(n),o.argCheck(n);var a={map:t,animate:!1,updateHandler:function(){o._canvasUpdate()},resolutionScale:resolutionScale};r.canvasLayer=new ke(a);return r.clickEvent=r.clickEvent.bind(r),r.mousemoveEvent=r.mousemoveEvent.bind(r),r.bindEvent(),r}return c(e,t),h(e,[{key:"clickEvent",value:function(t){var i=t.pixel;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,i,t)}},{key:"mousemoveEvent",value:function(t){var i=t.pixel;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,i,t)}},{key:"bindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&(e.setDefaultCursor("default"),e.addListener("click",this.clickEvent)),this.options.methods.mousemove&&e.addListener("mousemove",this.mousemoveEvent))}},{key:"unbindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.removeListener("click",this.clickEvent),this.options.methods.mousemove&&e.removeListener("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e=this,i=e.options.animation,r=this.getContext();if(e.isEnabledTime()){if(void 0===t)return void n(r);"2d"==this.context&&(r.save(),r.globalCompositeOperation="destination-out",r.fillStyle="rgba(0, 0, 0, .1)",r.fillRect(0,0,r.canvas.width,r.canvas.height),r.restore())}else n(r);if("2d"==this.context)for(var o in e.options)r[o]=e.options[o];else r.clear(r.COLOR_BUFFER_BIT);if(!(e.options.minZoom&&s.getZoom()<e.options.minZoom||e.options.maxZoom&&s.getZoom()>e.options.maxZoom)){var a=1;"2d"!=this.context&&(a=this.canvasLayer.devicePixelRatio);var s=this.map,u=s.getProjection(),l=(a=Math.pow(2,s.zoom)*resolutionScale,u.fromLatLngToPoint(this.canvasLayer.getTopLeft())),h={transferCoordinate:function(t){var e=new google.maps.LatLng(t[1],t[0]),i=u.fromLatLngToPoint(e),n={x:(i.x-l.x)*a,y:(i.y-l.y)*a};return[n.x,n.y]}};void 0!==t&&(h.filter=function(e){var n=i.trails||10;return!!(t&&e.time>t-n&&e.time<t)});var f=e.dataSet.get(h);this.processData(f);var c=new google.maps.LatLng(0,0),p=u.fromLatLngToPoint(c),d={x:(p.x-l.x)*a,y:(p.y-l.y)*a};"m"==e.options.unit&&e.options.size?e.options._size=e.options.size/zoomUnit:e.options._size=e.options.size,this.drawContext(r,new v(f),e.options,d),e.options.updateCallback&&e.options.updateCallback(t)}}}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){self.canvasLayer.draw()}}]),e}(Me),Be=void 0;if("undefined"!==typeof maptalks){Be=function(t){function e(t,i,n){l(this,e);var r=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.options_=n,r.dataSet=i,r._initBaseLayer(n),r}return c(e,t),h(e,[{key:"_initBaseLayer",value:function(t){var e=this,i=this.baseLayer=new Me(null,this.dataSet,t);e.init(t),i.argCheck(t)}},{key:"clickEvent",value:function(t){if(this.baseLayer){var e=t.containerPoint;this.baseLayer.clickEvent(e,t.domEvent)}}},{key:"mousemoveEvent",value:function(t){if(this.baseLayer){var e=t.containerPoint;this.baseLayer.mousemoveEvent(e,t.domEvent)}}},{key:"getEvents",value:function(){return{click:this.clickEvent,mousemove:this.mousemoveEvent}}},{key:"init",value:function(t){var e=this.baseLayer;e.options=t,e.initDataRange(t),e.context=e.options.context||"2d",e.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addListener("moveend",this.animatorMoveendEvent.bind(this))}}]),e}(maptalks.Layer);var ze=function(t){function e(){return l(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return c(e,t),h(e,[{key:"needToRedraw",value:function(){var t=this.layer.baseLayer;return!!t.isEnabledTime()||f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"needToRedraw",this).call(this)}},{key:"draw",value:function(){var t=this.layer.baseLayer;this.canvas&&t.isEnabledTime()&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this._update(this.gl||this.context,this._mapvFrameTime),delete this._mapvFrameTime,this.completeRender()}},{key:"drawOnInteracting",value:function(){this.draw(),this._shouldClear=!1}},{key:"onSkipDrawOnInteracting",value:function(){this._shouldClear=!0}},{key:"_canvasUpdate",value:function(t){this.setToRedraw(),this._mapvFrameTime=t}},{key:"_update",value:function(t,e){if(this.canvas){var i=this.layer.baseLayer,r=i.options.animation,o=this.getMap();if(i.isEnabledTime()){if(void 0===e)return void n(t);"2d"==i.context&&(t.save(),t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, .1)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore())}else n(t);if("2d"==i.context)for(var a in i.options)t[a]=i.options[a];else t.clear(t.COLOR_BUFFER_BIT);var s=1,u=new maptalks.Coordinate(0,0),l={fromColumn:"bd09mc"===i.options.coordType?"coordinates_mercator":"coordinates",transferCoordinate:function(t){u.x=t[0],u.y=t[1];var e=o.coordToContainerPoint(u)._multi(s).toArray();return e}};void 0!==e&&(l.filter=function(t){var i=r.trails||10;return!!(e&&t.time>e-i&&t.time<e)});var h=i.dataSet.get(l);i.processData(h),"m"==i.options.unit?(i.options.size&&(i.options._size=i.options.size/zoomUnit),i.options.width&&(i.options._width=i.options.width/zoomUnit),i.options.height&&(i.options._height=i.options.height/zoomUnit)):(i.options._size=i.options.size,i.options._height=i.options.height,i.options._width=i.options.width);var f=new maptalks.Point(0,0),c=o._pointToContainerPoint(f)._multi(s);i.drawContext(t,h,i.options,c),i.options.updateCallback&&i.options.updateCallback(e)}}},{key:"createCanvas",value:function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),i=t.getDevicePixelRatio?t.getDevicePixelRatio():maptalks.Browser.retina?2:1,n=i*e.width,r=i*e.height;this.canvas=maptalks.Canvas.createCanvas(n,r,t.CanvasClass);var o=this.layer.baseLayer.context;if("2d"===o)this.context=this.canvas.getContext("2d"),this.layer.options["globalCompositeOperation"]&&(this.context.globalCompositeOperation=this.layer.options["globalCompositeOperation"]),"heatmap"!==this.layer.baseLayer.options.draw&&1!==i&&this.context.scale(i,i);else{var a={alpha:!0,preserveDrawingBuffer:!0,antialias:!1};this.gl=this.canvas.getContext("webgl",a)}this.onCanvasCreate(),this._bindToMapv(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})}}},{key:"_bindToMapv",value:function(){var t=this.layer.baseLayer,e=this.getMap();this.devicePixelRatio=e.getDevicePixelRatio?e.getDevicePixelRatio():maptalks.Browser.retina?2:1,t.canvasLayer=this,t._canvasUpdate=this._canvasUpdate.bind(this),t.getContext=function(){var t=self.getRenderer();return t.gl||t.context}}}]),e}(maptalks.renderer.CanvasRenderer);Be.registerRenderer("canvas",ze)}var Fe,Ie=Be,Ue=function(t,e,i){if("undefined"!==typeof document){var n=document.createElement("canvas");return n.width=t,n.height=e,n}return new i(t,e)},Ne=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments[1],n=arguments[2];l(this,e);var r=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));return r.options=n,r.canvasLayer={canvas:null,devicePixelRatio:window.devicePixelRatio},r.layer_=null,r.initDataRange(n),r.initAnimator(),r.onEvents(),t.on("complete",(function(){this.init(t,n),this.argCheck(n)}),r),r}return c(e,t),h(e,[{key:"init",value:function(t,e){if(!t)throw new Error("not map object");this.map=t,this.context=this.options.context||"2d",this.getCanvasLayer()}},{key:"_canvasUpdate",value:function(t){this.render(this.canvasLayer.canvas,t)}},{key:"render",value:function(t,e){if(t){var i=this.map,r=t.getContext(this.context),o=this.options.animation;if(this.isEnabledTime()){if(void 0===e)return n(r),this;"2d"===this.context&&(r.save(),r.globalCompositeOperation="destination-out",r.fillStyle="rgba(0, 0, 0, .1)",r.fillRect(0,0,r.canvas.width,r.canvas.height),r.restore())}else n(r);if("2d"===this.context)for(var a in this.options)r[a]=this.options[a];else r.clear(r.COLOR_BUFFER_BIT);var s={transferCoordinate:function(t){var e=i.lngLatToContainer(new AMap.LngLat(t[0],t[1]));return[e["x"],e["y"]]}};void 0!==e&&(s.filter=function(t){var i=o.trails||10;return!!(e&&t.time>e-i&&t.time<e)});var u=this.dataSet.get(s);return this.processData(u),"m"===this.options.unit?(this.options.size&&(this.options._size=this.options.size/zoomUnit),this.options.width&&(this.options._width=this.options.width/zoomUnit),this.options.height&&(this.options._height=this.options.height/zoomUnit)):(this.options._size=this.options.size,this.options._height=this.options.height,this.options._width=this.options.width),this.drawContext(r,new v(u),this.options,{x:0,y:0}),this.options.updateCallback&&this.options.updateCallback(e),this}}},{key:"getCanvasLayer",value:function(){if(!this.canvasLayer.canvas&&!this.layer_){var t=this.canvasFunction(),e=this.map.getBounds();this.layer_=new AMap.CanvasLayer({canvas:t,bounds:this.options.bounds||e,zooms:this.options.zooms||[0,22]}),this.layer_.setMap(this.map),this.map.on("mapmove",this.canvasFunction,this),this.map.on("zoomchange",this.canvasFunction,this)}}},{key:"canvasFunction",value:function(){var t=[this.map.getSize().width,this.map.getSize().height],e=t[0],i=t[1];if(this.canvasLayer.canvas){this.canvasLayer.canvas.width=e,this.canvasLayer.canvas.height=i;var n=this.map.getBounds();this.layer_&&this.layer_.setBounds(this.options.bounds||n)}else this.canvasLayer.canvas=Ue(e,i);return this.render(this.canvasLayer.canvas),this.canvasLayer.canvas}},{key:"removeLayer",value:function(){this.map&&(this.unEvents(),this.map.removeLayer(this.layer_),delete this.map,delete this.layer_,delete this.canvasLayer.canvas)}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"clickEvent",value:function(t){var i=t.pixel;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,i,t)}},{key:"mousemoveEvent",value:function(t){var i=t.pixel;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,i,t)}},{key:"addAnimatorEvent",value:function(){this.map.on("movestart",this.animatorMovestartEvent,this),this.map.on("moveend",this.animatorMoveendEvent,this)}},{key:"onEvents",value:function(){var t=this.map;this.unEvents(),this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent,this),this.options.methods.mousemove&&t.on("mousemove",this.mousemoveEvent,this))}},{key:"unEvents",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent,this),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent,this))}}]),e}(Me),je=function(t,e){if("undefined"!==typeof document){var i=document.createElement("canvas");return i.width=t,i.height=e,i}},He=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments[1],n=arguments[2];l(this,e);var r=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));return r.options=n,r.canvasLayer={canvas:null,devicePixelRatio:window.devicePixelRatio},r.layer_=null,r.previousCursor_=void 0,r.init(t,n),r.argCheck(n),r}return c(e,t),h(e,[{key:"init",value:function(t,e){if(!(t&&t instanceof ol.Map))throw new Error("not map object");this.$Map=t,this.context=this.options.context||"2d",this.getCanvasLayer(),this.initDataRange(e),this.initAnimator(),this.onEvents()}},{key:"_canvasUpdate",value:function(t){this.render(this.canvasLayer.canvas,t)}},{key:"render",value:function(t,e){var i=this.$Map,r=t.getContext(this.context),o=this.options.animation,a=this.options.hasOwnProperty("projection")?this.options.projection:"EPSG:4326",s=this.$Map.getView().getProjection().getCode();if(this.isEnabledTime()){if(void 0===e)return n(r),this;"2d"===this.context&&(r.save(),r.globalCompositeOperation="destination-out",r.fillStyle="rgba(0, 0, 0, .1)",r.fillRect(0,0,r.canvas.width,r.canvas.height),r.restore())}else n(r);if("2d"===this.context)for(var u in this.options)r[u]=this.options[u];else r.clear(r.COLOR_BUFFER_BIT);var l={};l.transferCoordinate=a===s?function(t){return i.getPixelFromCoordinate(t)}:function(t){return i.getPixelFromCoordinate(ol.proj.transform(t,a,s))},void 0!==e&&(l.filter=function(t){var i=o.trails||10;return!!(e&&t.time>e-i&&t.time<e)});var h=this.dataSet.get(l);return this.processData(h),"m"===this.options.unit?(this.options.size&&(this.options._size=this.options.size/zoomUnit),this.options.width&&(this.options._width=this.options.width/zoomUnit),this.options.height&&(this.options._height=this.options.height/zoomUnit)):(this.options._size=this.options.size,this.options._height=this.options.height,this.options._width=this.options.width),this.drawContext(r,new v(h),this.options,{x:0,y:0}),this.options.updateCallback&&this.options.updateCallback(e),this}},{key:"getCanvasLayer",value:function(){if(!this.canvasLayer.canvas&&!this.layer_){var t=this.getMapExtent();this.layer_=new ol.layer.Image({layerName:this.options.layerName,minResolution:this.options.minResolution,maxResolution:this.options.maxResolution,zIndex:this.options.zIndex,extent:t,source:new ol.source.ImageCanvas({canvasFunction:this.canvasFunction.bind(this),projection:this.$Map.getView().getProjection().getCode(),ratio:this.options.hasOwnProperty("ratio")?this.options.ratio:1})}),this.$Map.addLayer(this.layer_),this.$Map.un("precompose",this.reRender,this),this.$Map.on("precompose",this.reRender,this)}}},{key:"reRender",value:function(){if(this.layer_){var t=this.getMapExtent();this.layer_.setExtent(t)}}},{key:"canvasFunction",value:function(t,e,i,n,r){return this.canvasLayer.canvas?(this.canvasLayer.canvas.width=n[0],this.canvasLayer.canvas.height=n[1]):this.canvasLayer.canvas=je(n[0],n[1]),this.render(this.canvasLayer.canvas),this.canvasLayer.canvas}},{key:"getMapExtent",value:function(){var t=this.$Map.getSize();return this.$Map.getView().calculateExtent(t)}},{key:"addTo",value:function(t){this.init(t,this.options)}},{key:"removeLayer",value:function(){this.$Map&&(this.unEvents(),this.$Map.un("precompose",this.reRender,this),this.$Map.removeLayer(this.layer_),delete this.$Map,delete this.layer_,delete this.canvasLayer.canvas)}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"clickEvent",value:function(t){var i=t.pixel;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,{x:i[0],y:i[1]},t)}},{key:"mousemoveEvent",value:function(t){var i=t.pixel;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,{x:i[0],y:i[1]},t)}},{key:"addAnimatorEvent",value:function(){this.$Map.on("movestart",this.animatorMovestartEvent,this),this.$Map.on("moveend",this.animatorMoveendEvent,this)}},{key:"onEvents",value:function(){var t=this.$Map;this.unEvents(),this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent,this),this.options.methods.mousemove&&t.on("pointermove",this.mousemoveEvent,this))}},{key:"unEvents",value:function(){var t=this.$Map;this.options.methods&&(this.options.methods.click&&t.un("click",this.clickEvent,this),this.options.methods.pointermove&&t.un("pointermove",this.mousemoveEvent,this))}},{key:"setDefaultCursor",value:function(t,e){if(this.$Map){var i=this.$Map.getTargetElement();e?i.style.cursor!==t&&(this.previousCursor_=i.style.cursor,i.style.cursor=t):void 0!==this.previousCursor_&&(i.style.cursor=this.previousCursor_,this.previousCursor_=void 0)}}},{key:"show",value:function(){this.$Map.addLayer(this.layer_)}},{key:"hide",value:function(){this.$Map.removeLayer(this.layer_)}}]),e}(Me),We=function(t){function e(t,i,n,r){l(this,e);var o=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));if(!Me)return p(o);var a=o;return r=r||{},a.init(r),a.argCheck(r),o.canvasLayer=i,o.clickEvent=o.clickEvent.bind(o),o.mousemoveEvent=o.mousemoveEvent.bind(o),o._moveStartEvent=o.moveStartEvent.bind(o),o._moveEndEvent=o.moveEndEvent.bind(o),o._zoomStartEvent=o.zoomStartEvent.bind(o),o.bindEvent(),o}return c(e,t),h(e,[{key:"clickEvent",value:function(t){var i=this.map.containerPointToLayerPoint([0,0]),n=this.devicePixelRatio=this.canvasLayer.devicePixelRatio=window.devicePixelRatio,r=t.layerPoint;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,L.point((r.x-i.x)/n,(r.y-i.y)/n),t)}},{key:"mousemoveEvent",value:function(t){var i=t.layerPoint;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,i,t)}},{key:"bindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent),this.options.methods.mousemove&&t.on("mousemove",this.mousemoveEvent)),this.map.on("movestart",this._moveStartEvent),this.map.on("moveend",this._moveEndEvent),this.map.on("zoomstart",this._zoomStartEvent)}},{key:"destroy",value:function(){this.unbindEvent(),this.clearData(),this.animator&&this.animator.stop(),this.animator=null,this.canvasLayer=null}},{key:"unbindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent)),this.map.off("movestart",this._moveStartEvent),this.map.off("moveend",this._moveEndEvent),this.map.off("zoomstart",this._zoomStartEvent)}},{key:"getContext",value:function(){return this.canvasLayer.getCanvas().getContext(this.context)}},{key:"addData",value:function(t,e){var i=t;t&&t.get&&(i=t.get()),this.dataSet.add(i),this.update({options:e})}},{key:"update",value:function(t){var i=t||{},n=i.data;n&&n.get&&(n=n.get()),void 0!=n&&this.dataSet.set(n),f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,{options:i.options})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!==typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e=this,i=e.options.animation,n=this.getContext(),r=this.map;if(e.isEnabledTime()){if(void 0===t)return void this.clear(n);"2d"===this.context&&(n.save(),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0, 0, 0, .1)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore())}else this.clear(n);if("2d"===this.context)for(var o in e.options)n[o]=e.options[o];else n.clear(n.COLOR_BUFFER_BIT);if(!(e.options.minZoom&&r.getZoom()<e.options.minZoom||e.options.maxZoom&&r.getZoom()>e.options.maxZoom)){var a=r.getBounds(),s=a.getEast()-a.getWest(),u=a.getNorth()-a.getSouth(),l=r.getSize(),h=s/l.x,f=u/l.y,c=this.canvasLayer.getTopLeft(),p=r.latLngToContainerPoint(c),d={transferCoordinate:function(t){var i;i="2d"===e.context?r.latLngToContainerPoint(L.latLng(t[1],t[0])):{x:(t[0]-c.lng)/h,y:(c.lat-t[1])/f};var n={x:i.x-p.x,y:i.y-p.y};return[n.x,n.y]}};void 0!==t&&(d.filter=function(e){var n=i.trails||10;return t&&e.time>t-n&&e.time<t});var v=e.dataSet.get(d);this.processData(v),e.options._size=e.options.size;var g=r.latLngToContainerPoint(L.latLng(0,0)),m={x:g.x-p.x,y:g.y-p.y};this.drawContext(n,v,e.options,m),e.options.updateCallback&&e.options.updateCallback(t)}}}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){}},{key:"moveStartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this._hide())}},{key:"moveEndEvent",value:function(){this.canvasLayer.draw(),this._show()}},{key:"zoomStartEvent",value:function(){this._hide()}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}},{key:"_hide",value:function(){this.canvasLayer.canvas.style.display="none"}},{key:"_show",value:function(){this.canvasLayer.canvas.style.display="block"}},{key:"draw",value:function(){this.canvasLayer.draw()}}]),e}(Me);if("undefined"!==typeof L){var Ze=L.Layer.extend({options:{attributionPrefix:null,attribution:""},initialize:function(t,e,i){i=i||{},this.dataSet=t||{},this.mapVOptions=e||{},this.render=this.render.bind(this),L.Util.setOptions(this,i),this.options.attributionPrefix&&(this.options.attribution=this.options.attributionPrefix+this.options.attribution),this.canvas=this._createCanvas(),L.stamp(this)},onAdd:function(t){this._map=t;var e=this.getPane(),i=this.container=L.DomUtil.create("div","leaflet-layer leaflet-zoom-animated",e);i.appendChild(this.canvas);var n=t.getSize();i.style.width=n.x+"px",i.style.height=n.y+"px",this.renderer=new We(t,this,this.dataSet,this.mapVOptions),this.draw(),this.fire("loaded")},onRemove:function(){L.DomUtil.remove(this.container),this.renderer.destroy()},addData:function(t,e){this.renderer.addData(t,e)},update:function(t){this.renderer.update(t)},getData:function(){return this.renderer&&(this.dataSet=this.renderer.getData()),this.dataSet},removeData:function(t){this.renderer&&this.renderer.removeData(t)},clearData:function(){this.renderer.clearData()},draw:function(){return this._reset()},setZIndex:function(t){this.canvas.style.zIndex=t},render:function(){this.renderer._canvasUpdate()},getCanvas:function(){return this.canvas},getContainer:function(){return this.container},getTopLeft:function(){var t,e=this._map;if(e){var i=e.getBounds();t=i.getNorthWest()}return t},_createCanvas:function(){var t=document.createElement("canvas");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.options.zIndex||600;var e="undefined"===typeof window?{}:window,i=this.devicePixelRatio=e.devicePixelRatio;return this.mapVOptions.context&&"2d"!==this.mapVOptions.context||t.getContext("2d").scale(i,i),t},_resize:function(){var t=this.canvas;if(t){var e=this._map,i=e.getSize();t.width=i.x,t.height=i.y,t.style.width=i.x+"px",t.style.height=i.y+"px";var n=e.getBounds(),r=e.latLngToLayerPoint(n.getNorthWest());L.DomUtil.setPosition(t,r)}},_reset:function(){this._resize(),this._render()},redraw:function(){this._resize(),this._render()},_render:function(){this.render()}});Fe=function(t,e,i){return new Ze(t,e,i)}}var Ye,Xe=Fe,Ve=function(t){function e(t,i,n,r){l(this,e);var o=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));return Me?(o.map=t,o.scene=t.scene,o.dataSet=i,n=n||{},o.init(n),o.argCheck(n),o.initDevicePixelRatio(),o.canvasLayer=r,o.stopAniamation=!1,o.animation=n.animation,o.clickEvent=o.clickEvent.bind(o),o.mousemoveEvent=o.mousemoveEvent.bind(o),o.bindEvent(),o):p(o)}return c(e,t),h(e,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"clickEvent",value:function(t){var i=t.point;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,i,t)}},{key:"mousemoveEvent",value:function(t){var i=t.point;f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,i,t)}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start)}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator}},{key:"bindEvent",value:function(){this.map,this.options.methods&&(this.options.methods.click,this.options.methods.mousemove)}},{key:"unbindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove&&t.off("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"_canvasUpdate",value:function(t){this.map;var e=this.scene;if(this.canvasLayer&&!this.stopAniamation){var i=this.options.animation,n=this.getContext();if(this.isEnabledTime()){if(void 0===t)return void this.clear(n);"2d"===this.context&&(n.save(),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0, 0, 0, .1)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore())}else this.clear(n);if("2d"===this.context)for(var r in this.options)n[r]=this.options[r];else n.clear(n.COLOR_BUFFER_BIT);var o={transferCoordinate:function(t){var i=Cesium.Cartesian3.fromDegrees(t[0],t[1]),n=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,i);return void 0==n?[-1,-1]:[n.x,n.y]}};void 0!==t&&(o.filter=function(e){var n=i.trails||10;return!!(t&&e.time>t-n&&e.time<t)});var a=this.dataSet.get(o);this.processData(a),"m"==this.options.unit&&this.options.size,this.options._size=this.options.size;var s=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,Cesium.Cartesian3.fromDegrees(0,0));this.drawContext(n,new v(a),this.options,s),this.options.updateCallback&&this.options.updateCallback(t)}}},{key:"updateData",value:function(t,i){var n=t;n&&n.get&&(n=n.get()),void 0!=n&&this.dataSet.set(n),f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,{options:i})}},{key:"addData",value:function(t,e){var i=t;t&&t.get&&(i=t.get()),this.dataSet.add(i),this.update({options:e})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get({filter:function(e){return null==t||"function"!=typeof t||!t(e)}});this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}}]),e}(Me);if("undefined"!==typeof Cesium){var Ge=0,qe=(Cesium,function(){function t(e,i,n,r){if(l(this,t),this.map=e,this.scene=e.scene,this.mapvBaseLayer=new Ve(e,i,n,this),this.mapVOptions=n,this.initDevicePixelRatio(),this.canvas=this._createCanvas(),this.render=this.render.bind(this),r)this.container=r;else{var o=e.container.querySelector(".cesium-viewer-cesiumWidgetContainer");this.container=o||e.container}this.addInnerContainer(),this.bindEvent(),this._reset()}return h(t,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"addInnerContainer",value:function(){this.container.appendChild(this.canvas)}},{key:"bindEvent",value:function(){var t=this;this.innerMoveStart=this.moveStartEvent.bind(this),this.innerMoveEnd=this.moveEndEvent.bind(this),this.scene.camera.moveStart.addEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.addEventListener(this.innerMoveEnd,this);var e=new Cesium.ScreenSpaceEventHandler(this.scene.canvas);e.setInputAction((function(e){t.innerMoveEnd()}),Cesium.ScreenSpaceEventType.LEFT_UP),e.setInputAction((function(e){t.innerMoveEnd()}),Cesium.ScreenSpaceEventType.MIDDLE_UP),this.handler=e}},{key:"unbindEvent",value:function(){this.scene.camera.moveStart.removeEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.removeEventListener(this.innerMoveEnd,this),this.scene.postRender.removeEventListener(this._reset,this),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"moveStartEvent",value:function(){this.mapvBaseLayer&&(this.mapvBaseLayer.animatorMovestartEvent(),this.scene.postRender.addEventListener(this._reset,this))}},{key:"moveEndEvent",value:function(){this.mapvBaseLayer&&(this.scene.postRender.removeEventListener(this._reset,this),this.mapvBaseLayer.animatorMoveendEvent(),this._reset())}},{key:"zoomStartEvent",value:function(){this._unvisiable()}},{key:"zoomEndEvent",value:function(){this._unvisiable()}},{key:"addData",value:function(t,e){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.addData(t,e)}},{key:"updateData",value:function(t,e){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.updateData(t,e)}},{key:"getData",value:function(){return this.mapvBaseLayer&&(this.dataSet=this.mapvBaseLayer.getData()),this.dataSet}},{key:"removeData",value:function(t){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer&&this.mapvBaseLayer.removeData(t)}},{key:"removeAllData",value:function(){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer.clearData()}},{key:"_visiable",value:function(){return this.canvas.style.display="block",this}},{key:"_unvisiable",value:function(){return this.canvas.style.display="none",this}},{key:"_createCanvas",value:function(){var t=document.createElement("canvas");t.id=this.mapVOptions.layerid||"mapv"+Ge++,t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.mapVOptions.zIndex||0,t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height;var e=this.devicePixelRatio;return"2d"==this.mapVOptions.context&&t.getContext(this.mapVOptions.context).scale(e,e),t}},{key:"_reset",value:function(){this.resizeCanvas(),this.fixPosition(),this.onResize(),this.render()}},{key:"draw",value:function(){this._reset()}},{key:"show",value:function(){this._visiable()}},{key:"hide",value:function(){this._unvisiable()}},{key:"destroy",value:function(){this.remove()}},{key:"remove",value:function(){void 0!=this.mapvBaseLayer&&(this.removeAllData(),this.mapvBaseLayer.clear(this.mapvBaseLayer.getContext()),this.mapvBaseLayer=void 0,this.canvas.parentElement.removeChild(this.canvas))}},{key:"update",value:function(t){void 0!=t&&this.updateData(t.data,t.options)}},{key:"resizeCanvas",value:function(){if(void 0!=this.canvas&&null!=this.canvas){var t=this.canvas;t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height}}},{key:"fixPosition",value:function(){}},{key:"onResize",value:function(){}},{key:"render",value:function(){void 0!=this.mapvBaseLayer&&this.mapvBaseLayer._canvasUpdate()}}]),t}());Ye=function(t,e,i,n){return new qe(t,e,i,n)}}var Ke=Ye,Qe={getDataSet:function(t){var e=[],i=t.features;if(i)for(var n=0;n<i.length;n++){var r=i[n],o=r.geometry,a=r.properties,s={};for(var u in a)s[u]=a[u];s.geometry=o,e.push(s)}return new v(e)}},Je={CSVToArray:function(t,e){e=e||",";var i=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),n=[[]],r=null;while(r=i.exec(t)){var o,a=r[1];a.length&&a!==e&&n.push([]),o=r[2]?r[2].replace(new RegExp('""',"g"),'"'):r[3],n[n.length-1].push(o)}return n},getDataSet:function(t,e){for(var i=this.CSVToArray(t,e||","),n=[],r=i[0],o=1;o<i.length-1;o++){for(var a=i[o],s={},u=0;u<a.length;u++){var l=a[u];"geometry"==r[u]&&(l=JSON.parse(l)),s[r[u]]=l}n.push(s)}return new v(n)}};e.version=i,e.canvasClear=n,e.canvasResolutionScale=r,e.canvasDrawSimple=x,e.canvasDrawHeatmap=k,e.canvasDrawGrid=O,e.canvasDrawHoneycomb=B,e.webglDrawSimple=Pt,e.webglDrawPoint=X,e.webglDrawLine=H,e.webglDrawPolygon=Mt,e.utilCityCenter=u,e.utilCurve=Ct,e.utilForceEdgeBundling=Lt,e.utilDataRangeIntensity=_,e.utilDataRangeCategory=Rt,e.utilDataRangeChoropleth=kt,e.Map=Ot,e.baiduMapCanvasLayer=Dt,e.baiduMapAnimationLayer=Ee,e.baiduMapLayer=Re,e.googleMapCanvasLayer=ke,e.googleMapLayer=De,e.MaptalksLayer=Ie,e.AMapLayer=Ne,e.OpenlayersLayer=He,e.leafletMapLayer=Xe,e.cesiumMapLayer=Ke,e.DataSet=v,e.geojson=Qe,e.csv=Je,Object.defineProperty(e,"__esModule",{value:!0})}))}).call(this,i("Q2Ig"))},"0v6a":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={"#ee5d5b":"0 0","#ff9625":"0 -10px","#6caeca":"0 -20px"},r={"#ee5d5b":"#BC3B3A","#ff9625":"#c57f1d","#6caeca":"#5188a5"};function o(t){t=t||{},this._point=t.point,this._text=t.name,this._index=t.index,this._numberDirection=t.numberDirection||"left",this._isShowNumber=void 0===t.isShowNumber||t.isShowNumber,this.color=t.color||"#ee5d5b"}o.prototype=new BMap.Overlay,o.prototype.changeColor=function(t){this._div&&(this._div.style.backgroundColor=t,this._div.style.borderColor=r[t],this._arrow.style.backgroundPosition=n[t])},o.prototype.initialize=function(t){this._map=t;var e=this._div=document.createElement("div");e.style.position="absolute",e.style.zIndex=BMap.Overlay.getZIndex(this._point.lat),e.style.backgroundColor=this.color,e.style.border="1px solid "+r[this.color],e.style.color="white",e.style.height="38px",e.style.boxSizing="border-box",e.style.padding="5px",e.style.whiteSpace="nowrap",e.style.MozUserSelect="none",e.style.fontSize="18px",e.style.border="1px solid #a67972",e.style.color="#494947",e.style.background="#fff",e.style.borderRadius="25px",e.style.paddingLeft="30px";var i=this._span=document.createElement("span");e.appendChild(i),i.appendChild(document.createTextNode(this._text));var o=this._arrow=document.createElement("div");o.style.backgroundPosition=n[this.color],o.style.position="absolute",o.style.width="11px",o.style.height="10px",o.style.top="26px",o.style.left="10px",o.style.overflow="hidden",e.appendChild(o);var a=this._number=document.createElement("div");return a.style.background=this.color||"#f15e5c",a.style.color="#fff",a.style.position="absolute",a.style.top="3px",a.style.position="absolute",a.style.textAlign="center",a.style.height="30px",a.style.width="30px",a.style.lineHeight="30px",a.style.borderRadius="30px",!1===this._isShowNumber&&(a.style.display="none"),this.renderDirection(),a.innerHTML=this._index,e.appendChild(a),t.getPanes().labelPane.appendChild(e),e},o.prototype.setNumberLeft=function(){this._numberDirection="left",this.renderDirection()},o.prototype.setNumberRight=function(){this._numberDirection="right",this.renderDirection()},o.prototype.renderDirection=function(){"left"==this._numberDirection?(this._isShowNumber?this._div.style.paddingLeft="38px":this._div.style.paddingLeft="8px",this._div.style.paddingRight="8px",this._number.style.left="5px",this._number.style.right="initial"):(this._div.style.paddingLeft="8px",this._isShowNumber?this._div.style.paddingRight="38px":this._div.style.paddingRight="8px",this._number.style.left="initial",this._number.style.right="5px")},o.prototype.hideNumber=function(){this._isShowNumber=!1,this._number.style.display="none",this.renderDirection()},o.prototype.setPosition=function(t){this._point=t,this.draw()},o.prototype.hideArrow=function(){this._arrow.style.display="none"},o.prototype.draw=function(){var t=this._map;this._span.innerHTML=this._text;var e=t.pointToOverlayPixel(this._point);this._div.style.left=e.x+5+"px",this._div.style.top=e.y-20+"px"},e.default=o},"1rYr":function(t,e,i){"use strict";function n(t,e,i){this.options=i||{},this._point=t,this.content=e}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype=new BMap.Overlay,n.prototype.initialize=function(t){this._map=t;var e=this._div=document.createElement("div");e.setAttribute("tag","customoverlay"),e.style.position="absolute";var i=this.options.zIndex||BMap.Overlay.getZIndex(this._point.lat);e.style.zIndex=i,e.addEventListener("touchstart",(function(t){t.stopPropagation(),console.log("touchstart")})),e.addEventListener("touchend",(function(t){t.stopPropagation(),console.log("touchend")})),"[object String]"==Object.prototype.toString.call(this.content)?e.innerHTML=this.content:e.appendChild(this.content);var n=this.options.pane||"labelPane";return t.getPanes()[n].appendChild(e),e},n.prototype.draw=function(){var t=this._map,e=t.pointToOverlayPixel(this._point),i=this.options.offset||new BMap.Size(0,0);this._div.style.left=e.x+i.width+"px",this._div.style.top=e.y+i.height+"px"},e.default=n},"3DSc":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("q1tI"),o=p(r),a=i("i8i4"),s=i("wjnM"),u=p(s),l=i("UhY/"),h=p(l),f=i("1rYr"),c=p(f);function p(t){return t&&t.__esModule?t:{default:t}}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function g(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}for(var m=window.Huiyan_Makers_IMG||"//huiyan.baidu.com/cms/react-bmap/markers_new2x_fbb9e99.png",y={simple_red:new BMap.Icon(m,new BMap.Size(21,33),{imageOffset:new BMap.Size(-227,-189),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)}),simple_blue:new BMap.Icon(m,new BMap.Size(21,33),{imageOffset:new BMap.Size(-227,-225),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)}),loc_red:new BMap.Icon(m,new BMap.Size(23,35),{imageOffset:new BMap.Size(-200,-189),anchor:new BMap.Size(11.5,35),imageSize:new BMap.Size(300,300)}),loc_blue:new BMap.Icon(m,new BMap.Size(23,35),{imageOffset:new BMap.Size(-200,-225),anchor:new BMap.Size(11.5,35),imageSize:new BMap.Size(300,300)}),start:new BMap.Icon(m,new BMap.Size(25,40),{imageOffset:new BMap.Size(-200,-139),anchor:new BMap.Size(12.5,40),imageSize:new BMap.Size(300,300)}),end:new BMap.Icon(m,new BMap.Size(25,40),{imageOffset:new BMap.Size(-225,-139),anchor:new BMap.Size(12.5,40),imageSize:new BMap.Size(300,300)}),location:new BMap.Icon(m,new BMap.Size(14,20),{imageOffset:new BMap.Size(-124,-233),anchor:new BMap.Size(7,20),imageSize:new BMap.Size(300,300)})},x=1;x<=10;x++)y["red"+x]=new BMap.Icon(m,new BMap.Size(21,33),{imageOffset:new BMap.Size(0-21*(x-1),0),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)});for(x=1;x<=10;x++)y["blue"+x]=new BMap.Icon(m,new BMap.Size(21,33),{imageOffset:new BMap.Size(0-21*(x-1),-66),anchor:new BMap.Size(10.5,33),imageSize:new BMap.Size(300,300)});var b=function(t){function e(t){d(this,e);var i=v(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return g(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.marker&&(this.props.map.removeOverlay(this.marker),this.marker=null)}},{key:"initialize",value:function(){var t=this.props.map,e=this.props.type;if("order_tip"!=e&&t){var i;this.destroy();var n=this.props.icon;if(i=n&&n instanceof BMap.Icon?n:n&&y[n]?y[n]:y.simple_red,"bd09mc"===this.props.coordType)var r=t.getMapType().getProjection(),s=r.pointToLngLat(new BMap.Pixel(this.props.position.lng,this.props.position.lat));else s=new BMap.Point(this.props.position.lng,this.props.position.lat);if("children"in this.props){this.contentDom=document.createElement("div");var u=this.props.children;(0,a.render)(o.default.createElement("div",null,u),this.contentDom),this.marker=new c.default(s,this.contentDom,{zIndex:this.props.zIndex,pane:this.props.pane,offset:this.props.offset}),t.addOverlay(this.marker)}else{var l=this.getOptions(this.options);l.icon=i,this.marker=new BMap.Marker(s,l),this.props.isTop&&this.marker.setTop(!0),this.bindEvent(this.marker,this.events),t.addOverlay(this.marker),this.bindToggleMeghods(this.marker,this.toggleMethods)}this.props.autoViewport&&t.setViewport([s],this.props.ViewportOptions)}}},{key:"render",value:function(){var t=this.props.type;return"order_tip"==t?o.default.createElement(h.default,this.props):null}},{key:"events",get:function(){return["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","infowindowclose","infowindowopen","dragstart","dragging","dragend","rightclick"]}},{key:"toggleMethods",get:function(){return{enableMassClear:["enableMassClear","disableMassClear"],enableDragging:["enableDragging","disableDragging"]}}},{key:"options",get:function(){return["offset","icon","enableMassClear","enableDragging","enableClicking","raiseOnDrag","draggingCursor","rotation","shadow","title"]}}],[{key:"defaultProps",get:function(){return{}}}]),e}(u.default);e.default=b},"4B5P":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("wjnM"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){s(this,e);var i=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return l(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.driving&&this.driving.clearResults(),this.driving=null}},{key:"initialize",value:function(){var t=this.props.map;if(t){this.destroy(),this.driving||(this.driving=new BMap.DrivingRoute(t,{renderOptions:{map:t,policy:this.props.policy||BMAP_DRIVING_POLICY_LEAST_TIME,autoViewport:void 0===this.props.autoViewport||this.props.autoViewport,viewportOptions:{zoomFactor:-1}}}));var e=this.props.start,i=this.props.end;e.lng&&e.lat&&(e=new BMap.Point(e.lng,e.lat)),i.lng&&i.lat&&(i=new BMap.Point(i.lng,i.lat)),this.driving.search(e,i)}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(o.default);e.default=h},"4K7L":function(t,e,i){(function(t){(function(t,i){i(e)})(0,(function(e){function i(t){this.options=t||{},this.paneName=this.options.paneName||"labelPane",this.zIndex=this.options.zIndex||1,this._map=t.map,this._lastDrawTime=null,this.show()}function n(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t["default"]:t}function r(t,e){return e={exports:{}},t(e,e.exports),e.exports}function o(t,e){return function(i){return e(t(i))}}function a(t){var e=function(e){return void 0===e||null===e?e:(1<arguments.length&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}function s(t){var e=function(e){if(void 0===e||null===e)return e;1<arguments.length&&(e=Array.prototype.slice.call(arguments));var i=t(e);if("object"===("undefined"===typeof i?"undefined":qn(i)))for(var n=i.length,r=0;r<n;r++)i[r]=Math.round(i[r]);return i};return"conversion"in t&&(e.conversion=t.conversion),e}function u(t,e){if(!(this instanceof u))return new u(t,e);if(e&&e in Jr&&(e=null),e&&!(e in Kr))throw Error("Unknown model: "+e);if("undefined"===typeof t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof u)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"===typeof t){if(e=Xr.get(t),null===e)throw Error("Unable to parse color from string: "+t);this.model=e.model;var i=Kr[this.model].channels;this.color=e.value.slice(0,i),this.valpha="number"===typeof e.value[i]?e.value[i]:1}else if(t.length)this.model=e||"rgb",i=Kr[this.model].channels,e=Qr.call(t,0,i),this.color=c(e,i),this.valpha="number"===typeof t[i]?t[i]:1;else if("number"===typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{if(this.valpha=1,e=si(t),"alpha"in t&&(e.splice(e.indexOf("alpha"),1),this.valpha="number"===typeof t.alpha?t.alpha:0),e=e.sort().join(""),!(e in $r))throw Error("Unable to parse color from object: "+Ir(t));this.model=$r[e],i=Kr[this.model].labels;var n=[];for(e=0;e<i.length;e++)n.push(t[i[e]]);this.color=c(n)}if(to[this.model])for(i=Kr[this.model].channels,e=0;e<i;e++)(t=to[this.model][e])&&(this.color[e]=t(this.color[e]));this.valpha=Math.max(0,Math.min(1,this.valpha)),Dr&&Dr(this)}function l(t){return function(e){return Number(e.toFixed(t))}}function h(t,e,i){return t=Array.isArray(t)?t:[t],t.forEach((function(t){(to[t]||(to[t]=[]))[e]=i})),t=t[0],function(n){if(arguments.length){i&&(n=i(n));var r=this[t]();return r.color[e]=n,r}return r=this[t]().color[e],i&&(r=i(r)),r}}function f(t){return function(e){return Math.max(0,Math.min(t,e))}}function c(t,e){for(var i=0;i<e;i++)"number"!==typeof t[i]&&(t[i]=0);return t}function p(t){return t*Math.PI/180}function d(t){return t/Math.PI*180}function v(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function g(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function m(t,e){return 1e-8>Math.abs(t-e)}function y(){}function x(t,e){for(var i in e)t[i]=e[i]}function b(t,e){this.lng=t,this.lat=e}function _(t,e){this.x=t,this.y=e}function w(t,e){var i=document.createElement("canvas");return t&&(i.width=t),e&&(i.height=e),i}function A(t){t=t||{},this.gradient=t.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=void 0===t.maxSize?35:t.maxSize,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}function T(t){this.options=t||{},this._initialize()}function M(t,e,i,n,r){var o=1-t,a=1-t;return o*o*o*e+3*a*a*t*i+3*(1-t)*t*t*n+t*t*t*r}function P(t){this.WORLD_SIZE_MC_HALF=20037726.372307256,this.WORLD_SIZE_MC=2*this.WORLD_SIZE_MC_HALF,this.options=t||{},this._initialize()}function S(t,e){return t&&e?Math.round(Math.sqrt(Math.pow(t.lng-e.lng,2)+Math.pow(t.lat-e.lat,2))):0}function E(t){return t=t.split("|"),t[0]=t[0].split(","),{lng:parseFloat(t[0][0]),lat:parseFloat(t[0][1])}}function C(t){for(var e=t.length;0<=--e;)t[e]=0}function L(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function R(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function k(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}function O(){this.strm=null,this.status=0,this.pending_buf=null,this.wrap=this.pending=this.pending_out=this.pending_buf_size=0,this.gzhead=null,this.gzindex=0,this.method=aa,this.last_flush=-1,this.w_mask=this.w_bits=this.w_size=0,this.window=null,this.window_size=0,this.head=this.prev=null,this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ua(this.dyn_ltree),ua(this.dyn_dtree),ua(this.bl_tree),this.bl_desc=this.d_desc=this.l_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ua(this.heap),this.heap_max=this.heap_len=0,this.depth=new Uint16Array(573),ua(this.depth),this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function D(t){t=this.options=Ma.assign({level:Ia,method:Na,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ua},t||{}),t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&16>t.windowBits&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new La,this.strm.avail_out=0;var e=Ta.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==za)throw Error(No[e]);if(t.header&&Ta.deflateSetHeader(this.strm,t.header),t.dictionary){if(t="string"===typeof t.dictionary?Ca.string2buf(t.dictionary):"[object ArrayBuffer]"===Ra.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,e=Ta.deflateSetDictionary(this.strm,t),e!==za)throw Error(No[e]);this._dict_set=!0}}function B(t,e){if(e=new D(e),e.push(t,!0),e.err)throw e.msg||No[e.err];return e.result}function z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.total=this.check=this.dmax=this.flags=0,this.head=null,this.wnext=this.whave=this.wsize=this.wbits=0,this.window=null,this.extra=this.offset=this.length=this.bits=this.hold=0,this.distcode=this.lencode=null,this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.distdyn=this.lendyn=null,this.was=this.back=this.sane=0}function F(t){var e=this.options=Ma.assign({chunkSize:65536,windowBits:15,to:""},t||{});if(e.raw&&0<=e.windowBits&&16>e.windowBits&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&16>e.windowBits)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&48>e.windowBits&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new La,this.strm.avail_out=0,t=cs.inflateInit2(this.strm,e.windowBits),t!==ms)throw Error(No[t]);if(this.header=new ps,cs.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"===typeof e.dictionary?e.dictionary=Ca.string2buf(e.dictionary):"[object ArrayBuffer]"===ds.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=cs.inflateSetDictionary(this.strm,e.dictionary),t!==ms)))throw Error(No[t])}function I(t,e){if(e=new F(e),e.push(t),e.err)throw e.msg||No[e.err];return e.result}function U(t){for(var e,i=["webgl2","experimental-webgl2","webgl","experimental-webgl"],n=0;n<i.length;n++)try{if(e=t.getContext(i[n],{alpha:!0,premultipliedAlpha:!1}))break}catch(r){}return e}function N(t,e,i){i=di({TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"REPEAT",TEXTURE_WRAP_T:"REPEAT"},i);var n=t.createTexture();for(var r in t.bindTexture(t.TEXTURE_2D,n),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),i)t.texParameteri(t.TEXTURE_2D,t[r],t[i[r]]);return t.bindTexture(t.TEXTURE_2D,null),n}function j(t,e,i,n){if("object"===("undefined"===typeof e?"undefined":qn(e)))e=N(t,e,n),i(e,null);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var e=g(r.width),o=g(r.height),a=document.createElement("canvas");a.width=e,a.height=o,a.getContext("2d").drawImage(r,0,0,e,o),r=a,e=N(t,r,n),i(e,r)},r.src=e}}function H(t,e,i){i=i||2;var n,r=e&&e.length,o=r?e[0]*i:t.length,a=W(t,0,o,i,!0),s=[];if(!a||a.next===a.prev)return s;if(r){var u,l=i;r=[];var h=0;for(u=e.length;h<u;h++){var f=e[h]*l,c=h<u-1?e[h+1]*l:t.length;f=W(t,f,c,l,!1),f===f.next&&(f.steiner=!0),r.push(K(f))}for(r.sort(V),h=0;h<r.length;h++)l=r[h],e=a,(e=G(l,e))&&(l=rt(e,l),Z(e,e.next),Z(l,l.next)),a=Z(a,a.next)}if(t.length>80*i){var p=n=t[0],d=r=t[1];for(l=i;l<o;l+=i)h=t[l],e=t[l+1],h<p&&(p=h),e<d&&(d=e),h>n&&(n=h),e>r&&(r=e);n=Math.max(n-p,r-d),n=0!==n?1/n:0}return Y(a,s,i,p,d,n),s}function W(t,e,i,n,r){if(r===0<ut(t,e,i,n))for(r=e;r<i;r+=n)var o=ot(r,t[r],t[r+1],o);else for(r=i-n;r>=e;r-=n)o=ot(r,t[r],t[r+1],o);return o&&$(o,o.next)&&(at(o),o=o.next),o}function Z(t,e){if(!t)return t;e||(e=t);do{var i=!1;if(t.steiner||!$(t,t.next)&&0!==J(t.prev,t,t.next))t=t.next;else{if(at(t),t=e=t.prev,t===t.next)break;i=!0}}while(i||t!==e);return e}function Y(t,e,i,n,r,o,a){if(t){if(!a&&o){var s=t,u=s;do{null===u.z&&(u.z=q(u.x,u.y,n,r,o)),u.prevZ=u.prev,u=u.nextZ=u.next}while(u!==s);u.prevZ.nextZ=null,u.prevZ=null,s=u;var l,h,f,c,p=1;do{u=s;var d=s=null;for(h=0;u;){h++;var v=u;for(l=f=0;l<p&&(f++,v=v.nextZ,v);l++);for(c=p;0<f||0<c&&v;)0!==f&&(0===c||!v||u.z<=v.z)?(l=u,u=u.nextZ,f--):(l=v,v=v.nextZ,c--),d?d.nextZ=l:s=l,l.prevZ=d,d=l;u=v}d.nextZ=null,p*=2}while(1<h)}for(s=t;t.prev!==t.next;){if(u=t.prev,v=t.next,o)d=X(t,n,r,o);else t:if(d=t,h=d.prev,f=d,p=d.next,0<=J(h,f,p))d=!1;else{for(l=d.next.next;l!==d.prev;){if(Q(h.x,h.y,f.x,f.y,p.x,p.y,l.x,l.y)&&0<=J(l.prev,l,l.next)){d=!1;break t}l=l.next}d=!0}if(d)e.push(u.i/i),e.push(t.i/i),e.push(v.i/i),at(t),s=t=v.next;else if(t=v,t===s){if(a){if(1===a){t=Z(t),a=e,s=i,u=t;do{v=u.prev,d=u.next.next,!$(v,d)&&tt(v,u,u.next,d)&&nt(v,d)&&nt(d,v)&&(a.push(v.i/s),a.push(u.i/s),a.push(d.i/s),at(u),at(u.next),u=t=d),u=u.next}while(u!==t);t=Z(u),Y(t,e,i,n,r,o,2)}else if(2===a)t:{a=t;do{for(s=a.next.next;s!==a.prev;){if(u=a.i!==s.i){if(u=a,v=s,d=u.next.i!==v.i&&u.prev.i!==v.i){e:{d=u;do{if(d.i!==u.i&&d.next.i!==u.i&&d.i!==v.i&&d.next.i!==v.i&&tt(d,d.next,u,v)){d=!0;break e}d=d.next}while(d!==u);d=!1}d=!d}if(d){if(d=nt(u,v)&&nt(v,u)){d=u,h=!1,f=(u.x+v.x)/2,p=(u.y+v.y)/2;do{d.y>p!==d.next.y>p&&d.next.y!==d.y&&f<(d.next.x-d.x)*(p-d.y)/(d.next.y-d.y)+d.x&&(h=!h),d=d.next}while(d!==u);d=h}d=d&&(J(u.prev,u,v.prev)||J(u,v.prev,v))||$(u,v)&&0<J(u.prev,u,u.next)&&0<J(v.prev,v,v.next)}u=d}if(u){t=rt(a,s),a=Z(a,a.next),t=Z(t,t.next),Y(a,e,i,n,r,o),Y(t,e,i,n,r,o);break t}s=s.next}a=a.next}while(a!==t)}}else Y(Z(t),e,i,n,r,o,1);break}}}}function X(t,e,i,n){var r=t.prev,o=t.next;if(0<=J(r,t,o))return!1;var a=r.x>t.x?r.x>o.x?r.x:o.x:t.x>o.x?t.x:o.x,s=r.y>t.y?r.y>o.y?r.y:o.y:t.y>o.y?t.y:o.y,u=q(r.x<t.x?r.x<o.x?r.x:o.x:t.x<o.x?t.x:o.x,r.y<t.y?r.y<o.y?r.y:o.y:t.y<o.y?t.y:o.y,e,i,n);for(e=q(a,s,e,i,n),i=t.prevZ,n=t.nextZ;i&&i.z>=u&&n&&n.z<=e;){if(i!==t.prev&&i!==t.next&&Q(r.x,r.y,t.x,t.y,o.x,o.y,i.x,i.y)&&0<=J(i.prev,i,i.next))return!1;if(i=i.prevZ,n!==t.prev&&n!==t.next&&Q(r.x,r.y,t.x,t.y,o.x,o.y,n.x,n.y)&&0<=J(n.prev,n,n.next))return!1;n=n.nextZ}for(;i&&i.z>=u;){if(i!==t.prev&&i!==t.next&&Q(r.x,r.y,t.x,t.y,o.x,o.y,i.x,i.y)&&0<=J(i.prev,i,i.next))return!1;i=i.prevZ}for(;n&&n.z<=e;){if(n!==t.prev&&n!==t.next&&Q(r.x,r.y,t.x,t.y,o.x,o.y,n.x,n.y)&&0<=J(n.prev,n,n.next))return!1;n=n.nextZ}return!0}function V(t,e){return t.x-e.x}function G(t,e){var i=e,n=t.x,r=t.y,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o){if(o=a,a===n){if(r===i.y)return i;if(r===i.next.y)return i.next}var s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===o)return s;e=s,a=s.x;var u=s.y,l=1/0;i=s;do{if(n>=i.x&&i.x>=a&&n!==i.x&&Q(r<u?n:o,r,a,u,r<u?o:n,r,i.x,i.y)){var h,f=Math.abs(r-i.y)/(n-i.x);if((h=nt(i,t))&&!(h=f<l)&&(h=f===l)&&!(h=i.x>s.x)&&(h=i.x===s.x)){h=s;var c=i;h=0>J(h.prev,h,c.prev)&&0>J(c.next,h,h.next)}h&&(s=i,l=f)}i=i.next}while(i!==e);return s}function q(t,e,i,n,r){return t=32767*(t-i)*r,e=32767*(e-n)*r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),1431655765&(t|t<<1)|(1431655765&(e|e<<1))<<1}function K(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Q(t,e,i,n,r,o,a,s){return 0<=(r-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(n-s)-(i-a)*(e-s)&&0<=(i-a)*(o-s)-(r-a)*(n-s)}function J(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function $(t,e){return t.x===e.x&&t.y===e.y}function tt(t,e,i,n){var r=it(J(t,e,i)),o=it(J(t,e,n)),a=it(J(i,n,t)),s=it(J(i,n,e));return!!(r!==o&&a!==s||0===r&&et(t,i,e)||0===o&&et(t,n,e)||0===a&&et(i,t,n)||0===s&&et(i,e,n))}function et(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function it(t){return 0<t?1:0>t?-1:0}function nt(t,e){return 0>J(t.prev,t,t.next)?0<=J(t,e,t.next)&&0<=J(t,t.prev,e):0>J(t,e,t.prev)||0>J(t,t.next,e)}function rt(t,e){var i=new st(t.i,t.x,t.y),n=new st(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function ot(t,e,i,n){return t=new st(t,e,i),n?(t.next=n.next,t.prev=n,n.next.prev=t,n.next=t):(t.prev=t,t.next=t),t}function at(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function st(t,e,i){this.i=t,this.x=e,this.y=i,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function ut(t,e,i,n){for(var r=0,o=i-n;e<i;e+=n)r+=(t[o]-t[e])*(t[e+1]+t[o+1]),o=e;return r}function lt(t){try{return gu.createObjectURL(new Blob([t],{type:"application/javascript"}))}catch(i){var e=new vu;return e.append(t),gu.createObjectURL(e.getBlob(type))}}function ht(t,e){this.shapeLayer=t,this.gl=e,this.initData()}function ft(t,e,i,n){var r=[];return n=n*Math.PI/180,r[0]=(t-i[0])*Math.cos(n)-(e-i[1])*Math.sin(n)+i[0],r[1]=(t-i[0])*Math.sin(n)+(e-i[1])*Math.cos(n)+i[1],r}function ct(){Du=!0;for(var t=0;64>t;++t)Ru[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t],ku["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;ku[45]=62,ku[95]=63}function pt(t,e,i){for(var n=[],r=e;r<i;r+=3)e=(t[r]<<16)+(t[r+1]<<8)+t[r+2],n.push(Ru[e>>18&63]+Ru[e>>12&63]+Ru[e>>6&63]+Ru[63&e]);return n.join("")}function dt(t){Du||ct();for(var e=t.length,i=e%3,n="",r=[],o=0,a=e-i;o<a;o+=16383)r.push(pt(t,o,o+16383>a?a:o+16383));return 1===i?(t=t[e-1],n+=Ru[t>>2],n+=Ru[t<<4&63],n+="=="):2===i&&(t=(t[e-2]<<8)+t[e-1],n+=Ru[t>>10],n+=Ru[t>>4&63],n+=Ru[t<<2&63],n+="="),r.push(n),r.join("")}function vt(t,e,i,n,r){var o=8*r-n-1,a=(1<<o)-1,s=a>>1,u=-7;r=i?r-1:0;var l=i?-1:1,h=t[e+r];for(r+=l,i=h&(1<<-u)-1,h>>=-u,u+=o;0<u;i=256*i+t[e+r],r+=l,u-=8);for(o=i&(1<<-u)-1,i>>=-u,u+=n;0<u;o=256*o+t[e+r],r+=l,u-=8);if(0===i)i=1-s;else{if(i===a)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,n),i-=s}return(h?-1:1)*o*Math.pow(2,i-n)}function gt(t,e,i,n,r,o){var a,s=8*o-r-1,u=(1<<s)-1,l=u>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0;o=n?0:o-1;var f=n?1:-1,c=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(e=isNaN(e)?1:0,n=u):(n=Math.floor(Math.log(e)/Math.LN2),1>e*(a=Math.pow(2,-n))&&(n--,a*=2),e=1<=n+l?e+h/a:e+h*Math.pow(2,1-l),2<=e*a&&(n++,a/=2),n+l>=u?(e=0,n=u):1<=n+l?(e=(e*a-1)*Math.pow(2,r),n+=l):(e=e*Math.pow(2,l-1)*Math.pow(2,r),n=0));8<=r;t[i+o]=255&e,o+=f,e/=256,r-=8);for(n=n<<r|e,s+=r;0<s;t[i+o]=255&n,o+=f,n/=256,s-=8);t[i+o-f]|=128*c}function mt(t,e){if((yt.TYPED_ARRAY_SUPPORT?2147483647:1073741823)<e)throw new RangeError("Invalid typed array length");return yt.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=yt.prototype):(null===t&&(t=new yt(e)),t.length=e),t}function yt(t,e,i){if(!(yt.TYPED_ARRAY_SUPPORT||this instanceof yt))return new yt(t,e,i);if("number"===typeof t){if("string"===typeof e)throw Error("If encoding is specified then the first argument must be a string");return _t(this,t)}return xt(this,t,e,i)}function xt(t,e,i,n){if("number"===typeof e)throw new TypeError('"value" argument must not be a number');if("undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer){if(e.byteLength,0>i||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");return e=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n),yt.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=yt.prototype):t=wt(t,e),t}if("string"===typeof e){if(n=t,t=i,"string"===typeof t&&""!==t||(t="utf8"),!yt.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');return i=0|Pt(e,t),n=mt(n,i),e=n.write(e,t),e!==i&&(n=n.slice(0,e)),n}return At(t,e)}function bt(t){if("number"!==typeof t)throw new TypeError('"size" argument must be a number');if(0>t)throw new RangeError('"size" argument must not be negative')}function _t(t,e){if(bt(e),t=mt(t,0>e?0:0|Tt(e)),!yt.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function wt(t,e){var i=0>e.length?0:0|Tt(e.length);t=mt(t,i);for(var n=0;n<i;n+=1)t[n]=255&e[n];return t}function At(t,e){if(Mt(e)){var i=0|Tt(e.length);return t=mt(t,i),0===t.length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!==typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return(i="number"!==typeof e.length)||(i=e.length,i=i!==i),i?mt(t,0):wt(t,e);if("Buffer"===e.type&&zu(e.data))return wt(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function Tt(t){if(t>=(yt.TYPED_ARRAY_SUPPORT?2147483647:1073741823))throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+(yt.TYPED_ARRAY_SUPPORT?2147483647:1073741823).toString(16)+" bytes");return 0|t}function Mt(t){return!(null==t||!t._isBuffer)}function Pt(t,e){if(Mt(t))return t.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!==typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return Ut(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return jt(t).length;default:if(n)return Ut(t).length;e=(""+e).toLowerCase(),n=!0}}function St(t,e,i){var n=!1;if((void 0===e||0>e)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),0>=i)return"";if(i>>>=0,e>>>=0,i<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":for(t=e,e=i,i=this.length,(!t||0>t)&&(t=0),(!e||0>e||e>i)&&(e=i),n="",i=t;i<e;++i)t=n,n=this[i],n=16>n?"0"+n.toString(16):n.toString(16),n=t+n;return n;case"utf8":case"utf-8":return Rt(this,e,i);case"ascii":for(t="",i=Math.min(this.length,i);e<i;++e)t+=String.fromCharCode(127&this[e]);return t;case"latin1":case"binary":for(t="",i=Math.min(this.length,i);e<i;++e)t+=String.fromCharCode(this[e]);return t;case"base64":return e=0===e&&i===this.length?dt(this):dt(this.slice(e,i)),e;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(e=this.slice(e,i),i="",t=0;t<e.length;t+=2)i+=String.fromCharCode(e[t]+256*e[t+1]);return i;default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function Et(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Ct(t,e,i,n,r){if(0===t.length)return-1;if("string"===typeof i?(n=i,i=0):2147483647<i?i=2147483647:-2147483648>i&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:t.length-1),0>i&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(0>i){if(!r)return-1;i=0}if("string"===typeof e&&(e=yt.from(e,n)),Mt(e))return 0===e.length?-1:Lt(t,e,i,n,r);if("number"===typeof e)return e&=255,yt.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):Lt(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function Lt(t,e,i,n,r){function o(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}var a=1,s=t.length,u=e.length;if(void 0!==n&&(n=String(n).toLowerCase(),"ucs2"===n||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(2>t.length||2>e.length)return-1;a=2,s/=2,u/=2,i/=2}if(r)for(n=-1;i<s;i++)if(o(t,i)===o(e,-1===n?0:i-n)){if(-1===n&&(n=i),i-n+1===u)return n*a}else-1!==n&&(i-=i-n),n=-1;else for(i+u>s&&(i=s-u);0<=i;i--){for(s=!0,n=0;n<u;n++)if(o(t,i+n)!==o(e,n)){s=!1;break}if(s)return i}return-1}function Rt(t,e,i){i=Math.min(t.length,i);for(var n=[];e<i;){var r=t[e],o=null,a=239<r?4:223<r?3:191<r?2:1;if(e+a<=i)switch(a){case 1:128>r&&(o=r);break;case 2:var s=t[e+1];128===(192&s)&&(r=(31&r)<<6|63&s,127<r&&(o=r));break;case 3:s=t[e+1];var u=t[e+2];128===(192&s)&&128===(192&u)&&(r=(15&r)<<12|(63&s)<<6|63&u,2047<r&&(55296>r||57343<r)&&(o=r));break;case 4:s=t[e+1],u=t[e+2];var l=t[e+3];128===(192&s)&&128===(192&u)&&128===(192&l)&&(r=(15&r)<<18|(63&s)<<12|(63&u)<<6|63&l,65535<r&&1114112>r&&(o=r))}null===o?(o=65533,a=1):65535<o&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),e+=a}if(t=n.length,t<=Fu)n=String.fromCharCode.apply(String,n);else{for(i="",e=0;e<t;)i+=String.fromCharCode.apply(String,n.slice(e,e+=Fu));n=i}return n}function kt(t,e,i){if(0!==t%1||0>t)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function Ot(t,e,i,n,r,o){if(!Mt(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<o)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function Dt(t,e,i,n){0>e&&(e=65535+e+1);for(var r=0,o=Math.min(t.length-i,2);r<o;++r)t[i+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function Bt(t,e,i,n){0>e&&(e=4294967295+e+1);for(var r=0,o=Math.min(t.length-i,4);r<o;++r)t[i+r]=e>>>8*(n?r:3-r)&255}function zt(t,e,i,n,r,o){if(i+n>t.length)throw new RangeError("Index out of range");if(0>i)throw new RangeError("Index out of range")}function Ft(t,e,i,n,r){return r||zt(t,e,i,4,34028234663852886e22,-34028234663852886e22),gt(t,e,i,n,23,4),i+4}function It(t,e,i,n,r){return r||zt(t,e,i,8,17976931348623157e292,-17976931348623157e292),gt(t,e,i,n,52,8),i+8}function Ut(t,e){e=e||1/0;for(var i,n=t.length,r=null,o=[],a=0;a<n;++a){if(i=t.charCodeAt(a),55295<i&&57344>i){if(!r){if(56319<i){-1<(e-=3)&&o.push(239,191,189);continue}if(a+1===n){-1<(e-=3)&&o.push(239,191,189);continue}r=i;continue}if(56320>i){-1<(e-=3)&&o.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&-1<(e-=3)&&o.push(239,191,189);if(r=null,128>i){if(0>--e)break;o.push(i)}else if(2048>i){if(0>(e-=2))break;o.push(i>>6|192,63&i|128)}else if(65536>i){if(0>(e-=3))break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(1114112>i))throw Error("Invalid code point");if(0>(e-=4))break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function Nt(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}function jt(t){if(t=(t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(Iu,""),2>t.length)t="";else for(;0!==t.length%4;)t+="=";Du||ct();var e=t.length;if(0<e%4)throw Error("Invalid string. Length must be a multiple of 4");var i="="===t[e-2]?2:"="===t[e-1]?1:0,n=new Ou(3*e/4-i),r=0<i?e-4:e,o=0;for(e=0;e<r;e+=4){var a=ku[t.charCodeAt(e)]<<18|ku[t.charCodeAt(e+1)]<<12|ku[t.charCodeAt(e+2)]<<6|ku[t.charCodeAt(e+3)];n[o++]=a>>16&255,n[o++]=a>>8&255,n[o++]=255&a}return 2===i?(a=ku[t.charCodeAt(e)]<<2|ku[t.charCodeAt(e+1)]>>4,n[o++]=255&a):1===i&&(a=ku[t.charCodeAt(e)]<<10|ku[t.charCodeAt(e+1)]<<4|ku[t.charCodeAt(e+2)]>>2,n[o++]=a>>8&255,n[o++]=255&a),n}function Ht(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}function Wt(t){return!!t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function Zt(t,e){var i=[];return t.forEach((function(t){i.push(e?-t:t,t)})),i}function Yt(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=[],n=0;n<t-1;n++){var r=2*(n+e);i.push(r,r+1,r+2),i.push(r+2,r+1,r+3)}return i}function Xt(t){return function(e,i,n){return e=i+t,i=n.length-1,n[0<i?0>e?0:e>i?i:e:e<i?i:0<e?0:e]}}function Vt(t){if(!t[0]||!t[0].length)return t;for(var e=t[0].length,i=[],n=0,r=0;r<t.length;r++)for(var o=0;o<e;o++)i[n++]=t[r][o];return i}function Gt(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=[],i=0,n=0;n<t.length;n++){var r=t[n];if(0<n){var o=t[n-1];i+=Math.sqrt(Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2))}e.push(i)}return{arr:e,total:i}}function qt(){var t=document.createElement("canvas");t.width=t.height=32;var e=t.getContext("2d");return{canvas:t,ctx:e}}function Kt(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).color,e=qt(),i=e.canvas;return e=e.ctx,e.save(),e.moveTo(0,0),e.lineTo(20,0),e.lineTo(32,16),e.lineTo(20,32),e.lineTo(0,32),e.lineTo(10,16),e.fillStyle=t||"#fff",e.fill(),e.restore(),i}function Qt(t,e){return au.set(t,-e[1],e[0])}function Jt(t,e,i){return au.sub(t,e,i),au.normalize(t,t),t}function $t(t){var e,i;this.promise=new t((function(t,n){if(void 0!==e||void 0!==i)throw TypeError("Bad Promise constructor");e=t,i=n})),this.resolve=He(e),this.reject=He(i)}function te(t){var e=0,i=0,n=!0,r=!1,o=void 0;try{for(var a,s=mr(t);!(n=(a=s.next()).done);n=!0){var u=a.value;e+=u.w*u.h,i=Math.max(i,u.w)}}catch(v){r=!0,o=v}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}t.sort((function(t,e){return e.h-t.h})),i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}],r=n=0,o=!0,s=!1,a=void 0;try{for(var l,h=mr(t);!(o=(l=h.next()).done);o=!0)for(var f=l.value,c=i.length-1;0<=c;c--){var p=i[c];if(!(f.w>p.w||f.h>p.h)){if(f.x=p.x,f.y=p.y,r=Math.max(r,f.y+f.h),n=Math.max(n,f.x+f.w),f.w===p.w&&f.h===p.h){var d=i.pop();c<i.length&&(i[c]=d)}else f.h===p.h?(p.x+=f.w,p.w-=f.w):(f.w!==p.w&&i.push({x:p.x+f.w,y:p.y,w:p.w-f.w,h:f.h}),p.y+=f.h,p.h-=f.h);break}}}catch(v){s=!0,a=v}finally{try{!o&&h.return&&h.return()}finally{if(s)throw a}}return{w:n,h:r,fill:e/(n*r)||0}}function ee(t,e,i){return i=Math.PI/180*(60*i+30),[t.x+e*Math.cos(i),t.y+e*Math.sin(i)]}function ie(t,e,i){for(var n={},r=[],o=t.length,a=e/2/Math.sin(Math.PI/3),s=1.5*a,u=1,l=0;l<o;++l){var h=t[l].geometry.coordinates;i&&(h=i(h));var f=+h[0],c=+h[1];if(!isNaN(f)&&!isNaN(c)){h=Math.round(c/=s);var p=Math.round(f=f/e-(1&h)/2),d=c-h;if(1<3*Math.abs(d)){var v=f-p,g=p+(f<p?-1:1)/2,m=h+(c<h?-1:1);f-=g,c-=m,v*v+d*d>f*f+c*c&&(p=g+(1&h?1:-1)/2,h=m)}d=p+"-"+h,(v=n[d])?(v.count+=t[l].count||1,u=Math.max(u,v.count)):(n[d]={center:{x:(p+(1&h)/2)*e,y:h*s},count:t[l].count||1},r.push(n[d]))}}return r.max=u,r.r=a,r}function ne(t,e,i,n){switch(n){case 5122:return new Int16Array(t,e,i);case 5123:return new Uint16Array(t,e,i);case 5124:return new Int32Array(t,e,i);case 5125:return new Uint32Array(t,e,i);case 5126:return new Float32Array(t,e,i);default:return null}}function re(t){return ne(t.bufferView.data,t.byteOffset,t.count*xf[t.type],t.componentType)}function oe(t){var e="",i=t.lastIndexOf("/");return-1!==i&&(e=t.substring(0,i+1)),e}function ae(t,e){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&"200"==i.status&&e(i.responseText,this)},i.send(null)}function se(t,e){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",t,!0),i.onreadystatechange=function(){if(4==i.readyState&&"200"==i.status){var t=i.response;t&&e&&e(t)}},i.send(null)}function ue(t,e,i){var n=new Image;n.crossOrigin="Anonymous",n.src=t,n.onload=function(){i(n,e)}}function le(t){function e(t,e){i.uniform1i(t,e.index),i.activeTexture(i.TEXTURE0+e.index),t=w.glTF.textures[e.index],i.bindTexture(i.TEXTURE_2D,t.texture),i.bindSampler(e.index,t.sampler?t.sampler.sampler:a)}var i=t.gl,n=0,r=[];t=i.canvas;var o=function(t,e,i){for(this.glTFScene=t,this.glTF=e,this.id=i,this.rootTransform=lu.create(),this.nodeMatrix=Array(e.nodes.length),t=0,e=this.nodeMatrix.length;t<e;t++)this.nodeMatrix[t]=lu.create()},a=i.createSampler();i.samplerParameteri(a,i.TEXTURE_MIN_FILTER,i.NEAREST_MIPMAP_LINEAR),i.samplerParameteri(a,i.TEXTURE_MAG_FILTER,i.LINEAR),i.samplerParameteri(a,i.TEXTURE_WRAP_S,i.REPEAT),i.samplerParameteri(a,i.TEXTURE_WRAP_T,i.REPEAT),i.bindVertexArray(null),i.bindVertexArray(null);var s={HAS_SKIN:1,SKIN_VEC8:2,HAS_BASECOLORMAP:4,HAS_NORMALMAP:8,HAS_METALROUGHNESSMAP:16,HAS_OCCLUSIONMAP:32,HAS_EMISSIVEMAP:64},u={},l=function(){this.flags=0,this.programObject=null};l.prototype.hasSkin=function(){return this.flags&s.HAS_SKIN},l.prototype.hasBaseColorMap=function(){return this.flags&s.HAS_BASECOLORMAP},l.prototype.hasNormalMap=function(){return this.flags&s.HAS_NORMALMAP},l.prototype.hasMetalRoughnessMap=function(){return this.flags&s.HAS_METALROUGHNESSMAP},l.prototype.hasOcclusionMap=function(){return this.flags&s.HAS_OCCLUSIONMAP},l.prototype.hasEmissiveMap=function(){return this.flags&s.HAS_EMISSIVEMAP},l.prototype.defineMacro=function(t){void 0!==s[t]&&(this.flags|=s[t])},l.prototype.compile=function(){var t=u[this.flags];if(t)this.programObject=t;else{var e=t="";this.flags&s.HAS_SKIN&&(t+="#define HAS_SKIN\n"),this.flags&s.SKIN_VEC8&&(t+="#define SKIN_VEC8\n"),this.flags&s.HAS_BASECOLORMAP&&(e+="#define HAS_BASECOLORMAP\n"),this.flags&s.HAS_NORMALMAP&&(e+="#define HAS_NORMALMAP\n"),this.flags&s.HAS_METALROUGHNESSMAP&&(e+="#define HAS_METALROUGHNESSMAP\n"),this.flags&s.HAS_OCCLUSIONMAP&&(e+="#define HAS_OCCLUSIONMAP\n"),this.flags&s.HAS_EMISSIVEMAP&&(e+="#define HAS_EMISSIVEMAP\n"),t=_f.createProgram(i,"#version 300 es\n"+t+"#define POSITION_LOCATION 0\n#define NORMAL_LOCATION 1\n#define TEXCOORD_0_LOCATION 2\n#define JOINTS_0_LOCATION 3\n#define JOINTS_1_LOCATION 5\n#define WEIGHTS_0_LOCATION 4\n#define WEIGHTS_1_LOCATION 6\n#define TANGENT_LOCATION 7\nprecision highp float;precision highp int;uniform mat4 u_MVP;uniform mat4 u_MV;uniform mat4 u_MVNormal;\n#ifdef HAS_SKIN\nuniform JointMatrix{mat4 matrix[65];}u_jointMatrix;\n#endif\nlayout(location=POSITION_LOCATION)in vec3 position;layout(location=NORMAL_LOCATION)in vec3 normal;layout(location=TEXCOORD_0_LOCATION)in vec2 uv;\n#ifdef HAS_SKIN\nlayout(location=JOINTS_0_LOCATION)in vec4 joint0;layout(location=WEIGHTS_0_LOCATION)in vec4 weight0;\n#ifdef SKIN_VEC8\nlayout(location=JOINTS_1_LOCATION)in vec4 joint1;layout(location=WEIGHTS_1_LOCATION)in vec4 weight1;\n#endif\n#endif\nout vec3 v_position;out vec3 v_normal;out vec2 v_uv;void main(){\n#ifdef HAS_SKIN\nmat4 skinMatrix=weight0.x*u_jointMatrix.matrix[int(joint0.x)]+weight0.y*u_jointMatrix.matrix[int(joint0.y)]+weight0.z*u_jointMatrix.matrix[int(joint0.z)]+weight0.w*u_jointMatrix.matrix[int(joint0.w)];\n#ifdef SKIN_VEC8\nskinMatrix+=weight1.x*u_jointMatrix.matrix[int(joint1.x)]+weight1.y*u_jointMatrix.matrix[int(joint1.y)]+weight1.z*u_jointMatrix.matrix[int(joint1.z)]+weight1.w*u_jointMatrix.matrix[int(joint1.w)];\n#endif\n#endif\nv_uv=uv;\n#ifdef HAS_SKIN\nv_normal=normalize((u_MVNormal*transpose(inverse(skinMatrix))*vec4(normal,0)).xyz);vec4 pos=u_MV*skinMatrix*vec4(position,1.0);gl_Position=u_MVP*skinMatrix*vec4(position,1.0);\n#else\nv_normal=normalize((u_MVNormal*vec4(normal,0)).xyz);vec4 pos=u_MV*vec4(position,1.0);gl_Position=u_MVP*vec4(position,1.0);\n#endif\nv_position=vec3(pos.xyz)/pos.w;}","#version 300 es\n"+e+"#define FRAG_COLOR_LOCATION 0\nprecision highp float;precision highp int;uniform sampler2D u_brdfLUT;uniform vec4 u_baseColorFactor;\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_baseColorTexture;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_normalTexture;uniform float u_normalTextureScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_emissiveTexture;uniform vec3 u_emissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\nuniform float u_metallicFactor;uniform float u_roughnessFactor;\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_occlusionTexture;uniform float u_occlusionStrength;\n#endif\nin vec3 v_position;in vec3 v_normal;in vec2 v_uv;layout(location=FRAG_COLOR_LOCATION)out vec4 frag_color;struct PBRInfo{float NdotL;float NdotV;float NdotH;float LdotH;float VdotH;float perceptualRoughness;float metalness;vec3 reflectance0;vec3 reflectance90;float alphaRoughness;vec3 diffuseColor;vec3 specularColor;};const float M_PI=3.141592653589793;const float c_MinRoughness=0.04;vec3 getNormal(){vec3 pos_dx=dFdx(v_position);vec3 pos_dy=dFdy(v_position);vec3 tex_dx=dFdx(vec3(v_uv,0.0));vec3 tex_dy=dFdy(vec3(v_uv,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=v_normal;t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));mat3 tbn=mat3(t,b,ng);\n#ifdef HAS_NORMALMAP\nvec3 n=texture(u_normalTexture,v_uv).rgb;n=normalize(tbn*((2.0*n-1.0)*vec3(u_normalTextureScale,u_normalTextureScale,1.0)));\n#else\nvec3 n=tbn[2].xyz;\n#endif\nreturn n;}vec3 getIBLContribution(PBRInfo pbrInputs,vec3 n,vec3 reflection){float mipCount=10.0;float lod=(pbrInputs.perceptualRoughness*mipCount);vec3 brdf=texture(u_brdfLUT,vec2(pbrInputs.NdotV,1.0-pbrInputs.perceptualRoughness)).rgb;vec3 diffuseLight=vec3(0.6,0.6,0.6);vec3 specularLight=vec3(0.6,0.6,0.6);vec3 diffuse=diffuseLight*pbrInputs.diffuseColor;vec3 specular=specularLight*(pbrInputs.specularColor*brdf.x+brdf.y);return diffuse+specular;}vec3 diffuse(PBRInfo pbrInputs){return pbrInputs.diffuseColor/M_PI;}vec3 specularReflection(PBRInfo pbrInputs){return pbrInputs.reflectance0+(pbrInputs.reflectance90-pbrInputs.reflectance0)*pow(clamp(1.0-pbrInputs.VdotH,0.0,1.0),5.0);}float geometricOcclusion(PBRInfo pbrInputs){float NdotL=pbrInputs.NdotL;float NdotV=pbrInputs.NdotV;float r=pbrInputs.alphaRoughness;float attenuationL=2.0*NdotL/(NdotL+sqrt(r*r+(1.0-r*r)*(NdotL*NdotL)));float attenuationV=2.0*NdotV/(NdotV+sqrt(r*r+(1.0-r*r)*(NdotV*NdotV)));return attenuationL*attenuationV;}float microfacetDistribution(PBRInfo pbrInputs){float roughnessSq=pbrInputs.alphaRoughness*pbrInputs.alphaRoughness;float f=(pbrInputs.NdotH*roughnessSq-pbrInputs.NdotH)*pbrInputs.NdotH+1.0;return roughnessSq/(M_PI*f*f);}void main(){float perceptualRoughness=u_roughnessFactor;float metallic=u_metallicFactor;\n#ifdef HAS_METALROUGHNESSMAP\nvec4 mrSample=texture(u_metallicRoughnessTexture,v_uv);perceptualRoughness=mrSample.g*perceptualRoughness;metallic=mrSample.b*metallic;\n#endif\nperceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;\n#ifdef HAS_BASECOLORMAP\nvec4 baseColor=texture(u_baseColorTexture,v_uv)*u_baseColorFactor;\n#else\nvec4 baseColor=u_baseColorFactor;\n#endif\nvec3 f0=vec3(0.04);vec3 diffuseColor=baseColor.rgb*(vec3(1.0)-f0);diffuseColor*=1.0-metallic;vec3 specularColor=mix(f0,baseColor.rgb,metallic);float reflectance=max(max(specularColor.r,specularColor.g),specularColor.b);float reflectance90=clamp(reflectance*25.0,0.0,1.0);vec3 specularEnvironmentR0=specularColor.rgb;vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;vec3 n=getNormal();vec3 v=normalize(-v_position);vec3 l=normalize(vec3(1.0,1.0,1.0));vec3 h=normalize(l+v);vec3 reflection=-normalize(reflect(v,n));float NdotL=clamp(dot(n,l),0.001,1.0);float NdotV=abs(dot(n,v))+0.001;float NdotH=clamp(dot(n,h),0.0,1.0);float LdotH=clamp(dot(l,h),0.0,1.0);float VdotH=clamp(dot(v,h),0.0,1.0);PBRInfo pbrInputs=PBRInfo(NdotL,NdotV,NdotH,LdotH,VdotH,perceptualRoughness,metallic,specularEnvironmentR0,specularEnvironmentR90,alphaRoughness,diffuseColor,specularColor);vec3 F=specularReflection(pbrInputs);float G=geometricOcclusion(pbrInputs);float D=microfacetDistribution(pbrInputs);vec3 diffuseContrib=(1.0-F)*diffuse(pbrInputs);vec3 specContrib=max(vec3(0.0),F*G*D/(4.0*NdotL*NdotV));vec3 color=NdotL*(diffuseContrib+specContrib);color+=getIBLContribution(pbrInputs,n,reflection);\n#ifdef HAS_OCCLUSIONMAP\nfloat ao=texture(u_occlusionTexture,v_uv).r;color=mix(color,color*ao,u_occlusionStrength);\n#endif\n#ifdef HAS_EMISSIVEMAP\nvec3 emissive=texture(u_emissiveTexture,v_uv).rgb*u_emissiveFactor;color+=emissive;\n#endif\nfrag_color=vec4(color,baseColor.a);}"),this.programObject={program:t,uniformLocations:{},uniformBlockIndices:{}},this.flags&s.HAS_SKIN&&(this.programObject.uniformBlockIndices.JointMatrix=i.getUniformBlockIndex(t,"JointMatrix")),e=this.programObject.uniformLocations,e.MVP=i.getUniformLocation(t,"u_MVP"),e.MVNormal=i.getUniformLocation(t,"u_MVNormal"),e.MV=i.getUniformLocation(t,"u_MV"),e.baseColorFactor=i.getUniformLocation(t,"u_baseColorFactor"),e.metallicFactor=i.getUniformLocation(t,"u_metallicFactor"),e.roughnessFactor=i.getUniformLocation(t,"u_roughnessFactor"),this.flags&s.HAS_BASECOLORMAP&&(e.baseColorTexture=i.getUniformLocation(t,"u_baseColorTexture")),this.flags&s.HAS_NORMALMAP&&(e.normalTexture=i.getUniformLocation(t,"u_normalTexture"),e.normalTextureScale=i.getUniformLocation(t,"u_normalTextureScale")),this.flags&s.HAS_METALROUGHNESSMAP&&(e.metallicRoughnessTexture=i.getUniformLocation(t,"u_metallicRoughnessTexture")),this.flags&s.HAS_OCCLUSIONMAP&&(e.occlusionTexture=i.getUniformLocation(t,"u_occlusionTexture"),e.occlusionStrength=i.getUniformLocation(t,"u_occlusionStrength")),this.flags&s.HAS_EMISSIVEMAP&&(e.emissiveTexture=i.getUniformLocation(t,"u_emissiveTexture"),e.emissiveFactor=i.getUniformLocation(t,"u_emissiveFactor")),i.useProgram(null),u[this.flags]=this.programObject}};var h=1,f=ou.create(),c=lu.create();uu.create();var p=[];i.enable(i.CULL_FACE),i.cullFace(i.BACK),i.frontFace(i.CCW);var d=!0;i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL);var v=v||{},g=null;ou.create();var m=lu.create();lu.perspective(m,.785,t.width/t.height,.01,100),lu.create();var y=lu.create(),x=lu.create(),b=lu.create();lu.create();var _,w,A,T=[1,1,1,1],M=v.drawPrimitive=function(t,n){if(A){x=y=A.matrix,lu.invert(b,y),lu.transpose(b,b),n=T;var r=t.shader,o=t.material;if(null!==o){var a=o.pbrMetallicRoughness;n=a.baseColorFactor,t.material.doubleSided===d&&((d=!t.material.doubleSided)?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE))}g!=t.shader.programObject&&(g=t.shader.programObject,i.useProgram(g.program)),o&&(r.hasBaseColorMap()&&e(g.uniformLocations.baseColorTexture,a.baseColorTexture),r.hasNormalMap()&&(e(g.uniformLocations.normalTexture,o.normalTexture),i.uniform1f(g.uniformLocations.normalTextureScale,o.normalTexture.scale)),r.hasMetalRoughnessMap()&&e(g.uniformLocations.metallicRoughnessTexture,a.metallicRoughnessTexture),i.uniform1f(g.uniformLocations.metallicFactor,a.metallicFactor),i.uniform1f(g.uniformLocations.roughnessFactor,a.roughnessFactor),r.hasOcclusionMap()&&(e(g.uniformLocations.occlusionTexture,o.occlusionTexture),i.uniform1f(g.uniformLocations.occlusionStrength,o.occlusionTexture.strength)),r.hasEmissiveMap()&&(e(g.uniformLocations.emissiveTexture,o.emissiveTexture),i.uniform3fv(g.uniformLocations.emissiveFactor,o.emissiveFactor))),r.hasSkin()&&i.uniformBlockBinding(g.program,g.uniformBlockIndices.JointMatrix,_),i.activeTexture(i.TEXTURE0+29),i.bindTexture(i.TEXTURE_2D,null),i.uniform4fv(g.uniformLocations.baseColorFactor,n),i.uniformMatrix4fv(g.uniformLocations.MV,!1,y),i.uniformMatrix4fv(g.uniformLocations.MVP,!1,x),i.uniformMatrix4fv(g.uniformLocations.MVNormal,!1,b),i.bindVertexArray(t.vertexArray),null!==t.indices?i.drawElements(t.mode,t.indicesLength,t.indicesComponentType,t.indicesOffset):i.drawArrays(t.mode,t.drawArraysOffset,t.drawArraysCount),i.bindVertexArray(null)}},P=lu.create(),S=lu.create(),E=v.drawNode=function(t,e,n,r){if(e=n[e],void 0!==r?lu.mul(e,r,t.matrix):lu.copy(e,t.matrix),null!==t.skin){var o=t.skin;_=o.uniformBlockID;var a=t.skin.joints;for(lu.invert(S,e),r=0,u=a.length;r<u;r++){var s=a[r];lu.mul(P,n[s.nodeID],o.inverseBindMatrix[r]),lu.mul(P,S,P),o.jointMatrixUnidormBufferData.set(P,16*r)}i.bindBuffer(i.UNIFORM_BUFFER,o.jointMatrixUniformBuffer),i.bufferSubData(i.UNIFORM_BUFFER,0,o.jointMatrixUnidormBufferData,0,o.jointMatrixUnidormBufferData.length)}var u;if(null!==t.mesh)for(o=t.mesh,r=0,u=o.primitives.length;r<u;r++)M(o.primitives[r],e);for(null!==t.skin&&i.bindBuffer(i.UNIFORM_BUFFER,null),r=0,u=t.children.length;r<u;r++)E(t.children[r],t.children[r].nodeID,n,e)},C=v.drawScene=function(t){var e=t.glTF;if(e.animations){var i,r=e.animations[n],o=0;for(i=r.samplers.length;o<i;o++)r.samplers[o].getValue(R);for(o=0,i=r.channels.length;o<i;o++){var a=r.channels[o],s=a.sampler,u=e.nodes[a.target.nodeID];switch(a.target.path){case"rotation":ru.copy(u.rotation,s.curValue);break;case"translation":ou.copy(u.translation,s.curValue);break;case"scale":ou.copy(u.scale,s.curValue)}u.updateMatrixFromTRS()}}for(r=0,e=t.glTFScene.nodes.length;r<e;r++)E(t.glTFScene.nodes[r],t.glTFScene.nodes[r].nodeID,t.nodeMatrix,t.rootTransform)},L=performance.now(),R=0;return{setupScene:function(t,e){function a(t,e){if(void 0!==t){var n=t.bufferView;return null===n.target?(i.bindBuffer(i.ARRAY_BUFFER,n.buffer),i.bufferData(i.ARRAY_BUFFER,n.data,i.STATIC_DRAW)):i.bindBuffer(n.target,n.buffer),t.prepareVertexAttrib(e,i),!0}return!1}var s,u;if(t.animations){var d=0;for(s=t.animations.length;d<s;d++)r.add(t.animations[d].name||d)}for(n=0,d=t.scenes[t.defaultScene],ou.fromValues(1.2*d.boundingBox.transform[0],0,0),ou.create(),e?e=p[e.id]=new o(d,t,e.id):(e=new o(d,t,p.length),p.push(e)),1===p.length&&(lu.identity(c),h=1/Math.max(d.boundingBox.transform[0],Math.max(d.boundingBox.transform[5],d.boundingBox.transform[10])),lu.getTranslation(f,d.boundingBox.transform),ou.scale(f,f,-1),f[0]+=-.5*d.boundingBox.transform[0],f[1]+=-.5*d.boundingBox.transform[5],f[2]+=-.5*d.boundingBox.transform[10],h*=.5,c[0]=h,c[5]=h,c[10]=h,lu.translate(c,c,f),ou.set(f,0,0,-1.5),h=1),d=0,s=t.bufferViews.length;d<s;d++){var v=t.bufferViews[d];v.createBuffer(i),v.bindData(i)}if(t.textures)for(d=0,s=t.textures.length;d<s;d++){var g=t.textures[d];g.createTexture(i)}if(t.samplers)for(d=0,s=t.samplers.length;d<s;d++)g=t.samplers[d],g.createSampler(i);if(t.skins)for(d=0,s=t.skins.length;d<s;d++)g=t.skins[d],g.jointMatrixUniformBuffer=i.createBuffer(),i.bindBufferBase(i.UNIFORM_BUFFER,g.uniformBlockID,g.jointMatrixUniformBuffer),i.bindBuffer(i.UNIFORM_BUFFER,g.jointMatrixUniformBuffer),i.bufferData(i.UNIFORM_BUFFER,g.jointMatrixUnidormBufferData,i.DYNAMIC_DRAW),i.bufferSubData(i.UNIFORM_BUFFER,0,g.jointMatrixUnidormBufferData),i.bindBuffer(i.UNIFORM_BUFFER,null);var m=0;for(u=t.meshes.length;m<u;m++)for(g=t.meshes[m],d=0,s=g.primitives.length;d<s;++d){var y=g.primitives[d];y.shader=new l,y.vertexArray=v=i.createVertexArray(),i.bindVertexArray(v),a(y.attributes.POSITION,0),a(y.attributes.NORMAL,1),a(y.attributes.TEXCOORD_0,2),a(y.attributes.JOINTS_0,3)&&a(y.attributes.WEIGHTS_0,4)&&y.shader.defineMacro("HAS_SKIN"),a(y.attributes.JOINTS_1,5)&&a(y.attributes.WEIGHTS_1,6)&&y.shader.defineMacro("SKIN_VEC8"),null!==y.indices&&(v=t.accessors[y.indices],v=v.bufferView,null===v.target?(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,v.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,v.data,i.STATIC_DRAW)):i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,v.buffer)),i.bindVertexArray(null),i.bindBuffer(i.ARRAY_BUFFER,null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),(v=y.material)&&(v.pbrMetallicRoughness.baseColorTexture&&y.shader.defineMacro("HAS_BASECOLORMAP"),v.pbrMetallicRoughness.metallicRoughnessTexture&&y.shader.defineMacro("HAS_METALROUGHNESSMAP"),v.normalTexture&&y.shader.defineMacro("HAS_NORMALMAP"),v.occlusionTexture&&y.shader.defineMacro("HAS_OCCLUSIONMAP"),v.emissiveTexture&&y.shader.defineMacro("HAS_EMISSIVEMAP")),y.shader.compile()}return e},render:v.render=function(t){var e;A=t,t=(new Date).getTime();var i=0;for(e=p.length;i<e;i++)w=p[i],C(p[i]);g=null,R=.001*(t-L)}}}function he(t){this.options=t=t||{},t.colors=t.colors||["rgba(0,192,73,0.99609375)","rgba(242,48,48,0.99609375)","rgba(255,159,25,0.99609375)"];var e=t.colors;this.drawTogether=!0,this.parseColors(e),this.tileSize=256,this.ratio=window.devicePixelRatio,this.cache={},t.getTileUrl&&(this.getTileUrl=t.getTileUrl),this._loadCount={}}function fe(t){var e=t/2,i=t+e,n=new w(2*i,2*i),r=n.getContext("2d");return r.shadowBlur=e,r.shadowColor="black",r.shadowOffsetX=r.shadowOffsetY=1e4,r.beginPath(),r.arc(i-1e4,i-1e4,t,0,2*Math.PI,!0),r.closePath(),r.fill(),n}var ce=window.BMapGL||window.BMap;ce&&ce.Overlay&&(i.prototype=new ce.Overlay),i.prototype.initialize=function(t){this._map=t;var e=this.canvas=document.createElement("canvas"),i=this.ctx=this.canvas.getContext("2d");e.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";",this.adjustSize(),this.adjustRatio(i),t.getContainer().appendChild(e);var n=this;return t.addEventListener("resize",(function(){n.adjustSize(),n._draw()})),this.canvas},i.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas;e.width=t.width,e.height=t.height,e.style.width=e.width+"px",e.style.height=e.height+"px"},i.prototype.adjustRatio=function(t){var e=(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1),i=t.canvas.width,n=t.canvas.height;t.canvas.width=i*e,t.canvas.height=n*e,t.canvas.style.width=i+"px",t.canvas.style.height=n+"px",t.scale(e,e)},i.prototype.draw=function(){this._draw.apply(this,arguments)},i.prototype._draw=function(){this.dispatchEvent("draw"),this.options.update&&this.options.update.apply(this,arguments)},i.prototype.getContainer=function(){return this.canvas},i.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},i.prototype.hide=function(){this.canvas.style.display="none"},i.prototype.setZIndex=function(t){this.canvas.style.zIndex=t},i.prototype.getZIndex=function(){return this.zIndex};"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof t||"undefined"!==typeof self&&self;var pe=r((function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}})),de=n(pe),ve=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},ge={}.hasOwnProperty,me=function(t,e){return ge.call(t,e)},ye={}.toString,xe=function(t){return ye.call(t).slice(8,-1)},be=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==xe(t)?t.split(""):Object(t)},_e=function(t){return be(ve(t))},we=Math.ceil,Ae=Math.floor,Te=function(t){return isNaN(t=+t)?0:(0<t?Ae:we)(t)},Me=Math.min,Pe=function(t){return 0<t?Me(Te(t),9007199254740991):0},Se=Math.max,Ee=Math.min,Ce=r((function(t){t=t.exports={version:"2.6.5"},"number"==typeof __e&&(__e=t)})),Le=r((function(t){t=t.exports="undefined"!=typeof window&&Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),"number"==typeof __g&&(__g=t)})),Re=r((function(t){var e=Le["__core-js_shared__"]||(Le["__core-js_shared__"]={});(t.exports=function(t,i){return e[t]||(e[t]=void 0!==i?i:{})})("versions",[]).push({version:Ce.version,mode:"pure",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})})),ke=0,Oe=Math.random(),De=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++ke+Oe).toString(36))},Be=Re("keys"),ze=function(t){return Be[t]||(Be[t]=De(t))},Fe=function(t){return function(e,i,n){e=_e(e);var r=Pe(e.length);if(n=Te(n),n=0>n?Se(n+r,0):Ee(n,r),t&&i!=i){for(;r>n;)if(i=e[n++],i!=i)return!0}else for(;r>n;n++)if((t||n in e)&&e[n]===i)return t||n||0;return!t&&-1}}(!1),Ie=ze("IE_PROTO"),Ue=function(t,e){t=_e(t);var i,n=0,r=[];for(i in t)i!=Ie&&me(t,i)&&r.push(i);for(;e.length>n;)me(t,i=e[n++])&&(~Fe(r,i)||r.push(i));return r},Ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),je=Object.keys||function(t){return Ue(t,Ne)},He=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},We=function(t,e,i){if(He(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)}}return function(){return t.apply(e,arguments)}},Ze=function(t){return"object"===typeof t?null!==t:"function"===typeof t},Ye=function(t){if(!Ze(t))throw TypeError(t+" is not an object!");return t},Xe=function(t){try{return!!t()}catch(e){return!0}},Ve=!Xe((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),Ge=Le.document,qe=Ze(Ge)&&Ze(Ge.createElement),Ke=!Ve&&!Xe((function(){return 7!=Object.defineProperty(qe?Ge.createElement("div"):{},"a",{get:function(){return 7}}).a})),Qe=function(t,e){if(!Ze(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!Ze(n=i.call(t))||"function"==typeof(i=t.valueOf)&&!Ze(n=i.call(t))||!e&&"function"==typeof(i=t.toString)&&!Ze(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")},Je=Object.defineProperty,$e={f:Ve?Object.defineProperty:function(t,e,i){if(Ye(t),e=Qe(e,!0),Ye(i),Ke)try{return Je(t,e,i)}catch(n){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},ti=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ei=Ve?function(t,e,i){return $e.f(t,e,ti(1,i))}:function(t,e,i){return t[e]=i,t},ii=function t(e,i,n){var r,o=e&t.F,a=e&t.G,s=e&t.S,u=e&t.P,l=e&t.B,h=e&t.W,f=a?Ce:Ce[i]||(Ce[i]={}),c=f.prototype;for(r in s=a?Le:s?Le[i]:(Le[i]||{}).prototype,a&&(n=i),n)if(i=!o&&s&&void 0!==s[r],!i||!me(f,r)){var p=i?s[r]:n[r];f[r]=a&&"function"!=typeof s[r]?n[r]:l&&i?We(p,Le):h&&s[r]==p?function(t){var e=function(e,i,n){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,i)}return new t(e,i,n)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(p):u&&"function"==typeof p?We(Function.call,p):p,u&&((f.virtual||(f.virtual={}))[r]=p,e&t.R&&c&&!c[r]&&ei(c,r,p))}};ii.F=1,ii.G=2,ii.S=4,ii.P=8,ii.B=16,ii.W=32,ii.U=64,ii.R=128;var ni=ii,ri=function(t,e){var i=(Ce.Object||{})[t]||Object[t],n={};n[t]=e(i),ni(ni.S+ni.F*Xe((function(){i(1)})),"Object",n)};ri("keys",(function(){return function(t){return je(Object(ve(t)))}}));var oi=Ce.Object.keys,ai=r((function(t){t.exports={default:oi,__esModule:!0}})),si=n(ai),ui=Object.getOwnPropertySymbols,li={}.propertyIsEnumerable,hi=Object.assign,fi=!hi||Xe((function(){var t={},e={},i=Symbol();return t[i]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=hi({},t)[i]||"abcdefghijklmnopqrst"!=Object.keys(hi({},e)).join("")}))?function(t,e){for(var i=Object(ve(t)),n=arguments.length,r=1,o=ui,a=li;n>r;)for(var s,u=be(arguments[r++]),l=o?je(u).concat(o(u)):je(u),h=l.length,f=0;h>f;)a.call(u,s=l[f++])&&(i[s]=u[s]);return i}:hi;ni(ni.S+ni.F,"Object",{assign:fi});var ci=Ce.Object.assign,pi=r((function(t){t.exports={default:ci,__esModule:!0}})),di=n(pi),vi=ze("IE_PROTO"),gi=Object.prototype,mi=Object.getPrototypeOf||function(t){return t=Object(ve(t)),me(t,vi)?t[vi]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?gi:null};ri("getPrototypeOf",(function(){return function(t){return mi(Object(ve(t)))}}));var yi=Ce.Object.getPrototypeOf,xi=r((function(t){t.exports={default:yi,__esModule:!0}})),bi=n(xi);ni(ni.S+ni.F*!Ve,"Object",{defineProperty:$e.f});var _i=Ce.Object,wi=function(t,e,i){return _i.defineProperty(t,e,i)},Ai=r((function(t){t.exports={default:wi,__esModule:!0}})),Ti=n(Ai),Mi=r((function(t,e){e.__esModule=!0;var i=Ai&&Ai.__esModule?Ai:{default:Ai};e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(t,r.key,r)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}()})),Pi=n(Mi),Si={},Ei=Ve?Object.defineProperties:function(t,e){Ye(t);for(var i,n=je(e),r=n.length,o=0;r>o;)$e.f(t,i=n[o++],e[i]);return t},Ci=Le.document,Li=Ci&&Ci.documentElement,Ri=ze("IE_PROTO"),ki=function(){},Oi=function(){var t=qe?Ge.createElement("iframe"):{},e=Ne.length;for(t.style.display="none",Li.appendChild(t),t.src="javascript:",t=t.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),Oi=t.F;e--;)delete Oi.prototype[Ne[e]];return Oi()},Di=Object.create||function(t,e){if(null!==t){ki.prototype=Ye(t);var i=new ki;ki.prototype=null,i[Ri]=t}else i=Oi();return void 0===e?i:Ei(i,e)},Bi=r((function(t){var e=Re("wks"),i=Le.Symbol,n="function"==typeof i;(t.exports=function(t){return e[t]||(e[t]=n&&i[t]||(n?i:De)("Symbol."+t))}).store=e})),zi=$e.f,Fi=Bi("toStringTag"),Ii=function(t,e,i){t&&!me(t=i?t:t.prototype,Fi)&&zi(t,Fi,{configurable:!0,value:e})},Ui={};ei(Ui,Bi("iterator"),(function(){return this}));var Ni=function(t,e,i){t.prototype=Di(Ui,{next:ti(1,i)}),Ii(t,e+" Iterator")},ji=Bi("iterator"),Hi=!([].keys&&"next"in[].keys()),Wi=function(){return this},Zi=function(t,e,i,n,r,o,a){Ni(i,e,n),n=function(t){return!Hi&&t in f?f[t]:function(){return new i(this,t)}};var s,u=e+" Iterator",l="values"==r,h=!1,f=t.prototype,c=f[ji]||f["@@iterator"]||r&&f[r],p=c||n(r),d=r?l?n("entries"):p:void 0,v="Array"==e&&f.entries||c;if(v&&(t=mi(v.call(new t)),t!==Object.prototype&&t.next&&Ii(t,u,!0)),l&&c&&"values"!==c.name&&(h=!0,p=function(){return c.call(this)}),a&&(Hi||h||!f[ji])&&ei(f,ji,p),Si[e]=p,Si[u]=Wi,r){var g={values:l?p:n("values"),keys:o?p:n("keys"),entries:d};if(a)for(s in g)s in f||ei(f,s,g[s]);else ni(ni.P+ni.F*(Hi||h),e,g)}return g},Yi=function(t){return function(e,i){e=String(ve(e)),i=Te(i);var n,r=e.length;if(0>i||i>=r)return t?"":void 0;var o=e.charCodeAt(i);return 55296>o||56319<o||i+1===r||56320>(n=e.charCodeAt(i+1))||57343<n?t?e.charAt(i):o:t?e.slice(i,i+2):n-56320+(o-55296<<10)+65536}}(!0);Zi(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t=this._t,e=this._i;return e>=t.length?{value:void 0,done:!0}:(t=Yi(t,e),this._i+=t.length,{value:t,done:!1})}));var Xi=function(t,e){return{value:e,done:!!t}};Zi(Array,"Array",(function(t,e){this._t=_e(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,Xi(1)):Xi(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])}),"values"),Si.Arguments=Si.Array;for(var Vi=Bi("toStringTag"),Gi="CSSRuleList CSSStyleDeclaration CSSValueList ClientRectList DOMRectList DOMStringList DOMTokenList DataTransferItemList FileList HTMLAllCollection HTMLCollection HTMLFormElement HTMLSelectElement MediaList MimeTypeArray NamedNodeMap NodeList PaintRequestList Plugin PluginArray SVGLengthList SVGNumberList SVGPathSegList SVGPointList SVGStringList SVGTransformList SourceBufferList StyleSheetList TextTrackCueList TextTrackList TouchList".split(" "),qi=0;qi<Gi.length;qi++){var Ki=Gi[qi],Qi=Le[Ki],Ji=Qi&&Qi.prototype;Ji&&!Ji[Vi]&&ei(Ji,Vi,Ki),Si[Ki]=Si.Array}var $i={f:Bi},tn=$i.f("iterator"),en=r((function(t){t.exports={default:tn,__esModule:!0}}));n(en);var nn=r((function(t){var e=De("meta"),i=$e.f,n=0,r=Object.isExtensible||function(){return!0},o=!Xe((function(){return r(Object.preventExtensions({}))})),a=function(t){i(t,e,{value:{i:"O"+ ++n,w:{}}})},s=t.exports={KEY:e,NEED:!1,fastKey:function(t,i){if(!Ze(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!me(t,e)){if(!r(t))return"F";if(!i)return"E";a(t)}return t[e].i},getWeak:function(t,i){if(!me(t,e)){if(!r(t))return!0;if(!i)return!1;a(t)}return t[e].w},onFreeze:function(t){return o&&s.NEED&&r(t)&&!me(t,e)&&a(t),t}}})),rn=$e.f,on=function(t){var e=Ce.Symbol||(Ce.Symbol={});"_"==t.charAt(0)||t in e||rn(e,t,{value:$i.f(t)})},an=Array.isArray||function(t){return"Array"==xe(t)},sn=Ne.concat("length","prototype"),un=Object.getOwnPropertyNames||function(t){return Ue(t,sn)},ln=un,hn={}.toString,fn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],cn=function(t){if(fn&&"[object Window]"==hn.call(t))try{var e=ln(t)}catch(i){e=fn.slice()}else e=ln(_e(t));return e},pn=Object.getOwnPropertyDescriptor,dn={f:Ve?pn:function(t,e){if(t=_e(t),e=Qe(e,!0),Ke)try{return pn(t,e)}catch(i){}if(me(t,e))return ti(!li.call(t,e),t[e])}},vn=nn.KEY,gn=dn.f,mn=$e.f,yn=cn,xn=Le.Symbol,bn=Le.JSON,_n=bn&&bn.stringify,wn=Bi("_hidden"),An=Bi("toPrimitive"),Tn={}.propertyIsEnumerable,Mn=Re("symbol-registry"),Pn=Re("symbols"),Sn=Re("op-symbols"),En=Object.prototype,Cn="function"==typeof xn,Ln=Le.QObject,Rn=!Ln||!Ln.prototype||!Ln.prototype.findChild,kn=Ve&&Xe((function(){return 7!=Di(mn({},"a",{get:function(){return mn(this,"a",{value:7}).a}})).a}))?function(t,e,i){var n=gn(En,e);n&&delete En[e],mn(t,e,i),n&&t!==En&&mn(En,e,n)}:mn,On=function(t){var e=Pn[t]=Di(xn.prototype);return e._k=t,e},Dn=Cn&&"symbol"==typeof xn.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof xn},Bn=function t(e,i,n){return e===En&&t(Sn,i,n),Ye(e),i=Qe(i,!0),Ye(n),me(Pn,i)?(n.enumerable?(me(e,wn)&&e[wn][i]&&(e[wn][i]=!1),n=Di(n,{enumerable:ti(0,!1)})):(me(e,wn)||mn(e,wn,ti(1,{})),e[wn][i]=!0),kn(e,i,n)):mn(e,i,n)},zn=function(t,e){Ye(t);var i,n=e=_e(e),r=je(n),o=ui;if(o){o=o(n);for(var a,s=li,u=0;o.length>u;)s.call(n,a=o[u++])&&r.push(a)}for(n=0,a=r.length;a>n;)Bn(t,i=r[n++],e[i]);return t},Fn=function(t){var e=Tn.call(this,t=Qe(t,!0));return!(this===En&&me(Pn,t)&&!me(Sn,t))&&(!(e||!me(this,t)||!me(Pn,t)||me(this,wn)&&this[wn][t])||e)},In=function(t,e){if(t=_e(t),e=Qe(e,!0),t!==En||!me(Pn,e)||me(Sn,e)){var i=gn(t,e);return!i||!me(Pn,e)||me(t,wn)&&t[wn][e]||(i.enumerable=!0),i}},Un=function(t){t=yn(_e(t));for(var e,i=[],n=0;t.length>n;)me(Pn,e=t[n++])||e==wn||e==vn||i.push(e);return i},Nn=function(t){var e=t===En;t=yn(e?Sn:_e(t));for(var i,n=[],r=0;t.length>r;)me(Pn,i=t[r++])&&(!e||me(En,i))&&n.push(Pn[i]);return n};Cn||(xn=function(){if(this instanceof xn)throw TypeError("Symbol is not a constructor!");var t=De(0<arguments.length?arguments[0]:void 0),e=function e(i){this===En&&e.call(Sn,i),me(this,wn)&&me(this[wn],t)&&(this[wn][t]=!1),kn(this,t,ti(1,i))};return Ve&&Rn&&kn(En,t,{configurable:!0,set:e}),On(t)},ei(xn.prototype,"toString",(function(){return this._k})),dn.f=In,$e.f=Bn,un=cn=Un,li=Fn,ui=Nn,$i.f=function(t){return On(Bi(t))}),ni(ni.G+ni.W+ni.F*!Cn,{Symbol:xn});for(var jn="hasInstance isConcatSpreadable iterator match replace search species split toPrimitive toStringTag unscopables".split(" "),Hn=0;jn.length>Hn;)Bi(jn[Hn++]);for(var Wn=je(Bi.store),Zn=0;Wn.length>Zn;)on(Wn[Zn++]);ni(ni.S+ni.F*!Cn,"Symbol",{for:function(t){return me(Mn,t+="")?Mn[t]:Mn[t]=xn(t)},keyFor:function(t){if(!Dn(t))throw TypeError(t+" is not a symbol!");for(var e in Mn)if(Mn[e]===t)return e},useSetter:function(){Rn=!0},useSimple:function(){Rn=!1}}),ni(ni.S+ni.F*!Cn,"Object",{create:function(t,e){return void 0===e?Di(t):zn(Di(t),e)},defineProperty:Bn,defineProperties:zn,getOwnPropertyDescriptor:In,getOwnPropertyNames:Un,getOwnPropertySymbols:Nn}),bn&&ni(ni.S+ni.F*(!Cn||Xe((function(){var t=xn();return"[null]"!=_n([t])||"{}"!=_n({a:t})||"{}"!=_n(Object(t))}))),"JSON",{stringify:function(t){for(var e,i=[t],n=1;arguments.length>n;)i.push(arguments[n++]);if(e=n=i[1],(Ze(n)||void 0!==t)&&!Dn(t))return an(n)||(n=function(t,i){if("function"==typeof e&&(i=e.call(this,t,i)),!Dn(i))return i}),i[1]=n,_n.apply(bn,i)}}),xn.prototype[An]||ei(xn.prototype,An,xn.prototype.valueOf),Ii(xn,"Symbol"),Ii(Math,"Math",!0),Ii(Le.JSON,"JSON",!0),on("asyncIterator"),on("observable");var Yn=Ce.Symbol,Xn=r((function(t){t.exports={default:Yn,__esModule:!0}})),Vn=n(Xn),Gn=r((function(t,e){e.__esModule=!0,t=en&&en.__esModule?en:{default:en};var i=Xn&&Xn.__esModule?Xn:{default:Xn},n="function"===typeof i.default&&"symbol"===typeof t.default?function(t){return typeof t}:function(t){return t&&"function"===typeof i.default&&t.constructor===i.default&&t!==i.default.prototype?"symbol":typeof t};e.default="function"===typeof i.default&&"symbol"===n(t.default)?function(t){return"undefined"===typeof t?"undefined":n(t)}:function(t){return t&&"function"===typeof i.default&&t.constructor===i.default&&t!==i.default.prototype?"symbol":"undefined"===typeof t?"undefined":n(t)}})),qn=n(Gn),Kn=r((function(t,e){e.__esModule=!0;var i=Gn&&Gn.__esModule?Gn:{default:Gn};e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==("undefined"===typeof e?"undefined":(0,i.default)(e))&&"function"!==typeof e?t:e}})),Qn=n(Kn),Jn=Object.setPrototypeOf||("__proto__"in{}?function(t,e,i){try{i=We(Function.call,dn.f(Object.prototype,"__proto__").set,2),i(t,[]),e=!(t instanceof Array)}catch(n){e=!0}return function(t,n){if(Ye(t),!Ze(n)&&null!==n)throw TypeError(n+": can't set as prototype!");return e?t.__proto__=n:i(t,n),t}}({},!1):void 0);ni(ni.S,"Object",{setPrototypeOf:Jn});var $n=Ce.Object.setPrototypeOf,tr=r((function(t){t.exports={default:$n,__esModule:!0}}));n(tr),ni(ni.S,"Object",{create:Di});var er=Ce.Object,ir=function(t,e){return er.create(t,e)},nr=r((function(t){t.exports={default:ir,__esModule:!0}})),rr=n(nr),or=r((function(t,e){function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var n=i(tr),r=i(nr),o=i(Gn);e.default=function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof e?"undefined":(0,o.default)(e)));t.prototype=(0,r.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(n.default?(0,n.default)(t,e):t.__proto__=e)}})),ar=n(or),sr=Bi("toStringTag"),ur="Arguments"==xe(function(){return arguments}()),lr=function(t){var e;if(void 0===t)var i="Undefined";else{if(null===t)var n="Null";else{t:{var r=t=Object(t);try{n=r[sr];break t}catch(o){}n=void 0}n="string"==typeof(i=n)?i:ur?xe(t):"Object"==(e=xe(t))&&"function"==typeof t.callee?"Arguments":e}i=n}return i},hr=Bi("iterator"),fr=Ce.isIterable=function(t){return t=Object(t),void 0!==t[hr]||"@@iterator"in t||Si.hasOwnProperty(lr(t))},cr=r((function(t){t.exports={default:fr,__esModule:!0}}));n(cr);var pr=Bi("iterator"),dr=Ce.getIteratorMethod=function(t){if(void 0!=t)return t[pr]||t["@@iterator"]||Si[lr(t)]},vr=Ce.getIterator=function(t){var e=dr(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return Ye(e.call(t))},gr=r((function(t){t.exports={default:vr,__esModule:!0}})),mr=n(gr),yr=r((function(t,e){e.__esModule=!0;var i=cr&&cr.__esModule?cr:{default:cr},n=gr&&gr.__esModule?gr:{default:gr};e.default=function(){return function(t,e){if(Array.isArray(t))return t;if((0,i.default)(Object(t))){var r=[],o=!0,a=!1,s=void 0;try{for(var u,l=(0,n.default)(t);!(o=(u=l.next()).done)&&(r.push(u.value),!e||r.length!==e);o=!0);}catch(h){a=!0,s=h}finally{try{!o&&l["return"]&&l["return"]()}finally{if(a)throw s}}return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()})),xr=n(yr),br=function(t,e,i,n){try{return n?e(Ye(i)[0],i[1]):e(i)}catch(r){throw e=t["return"],void 0!==e&&Ye(e.call(t)),r}},_r=Bi("iterator"),wr=Array.prototype,Ar=Bi("iterator"),Tr=!1;try{[7][Ar]()["return"]=function(){Tr=!0}}catch(Rf){}var Mr=function(t,e){if(!e&&!Tr)return!1;var i=!1;try{e=[7];var n=e[Ar]();n.next=function(){return{done:i=!0}},e[Ar]=function(){return n},t(e)}catch(r){}return i};ni(ni.S+ni.F*!Mr((function(t){})),"Array",{from:function(t){var e,i=Object(ve(t)),n="function"==typeof this?this:Array,r=arguments.length,o=1<r?arguments[1]:void 0,a=void 0!==o,s=0,u=dr(i);if(a&&(o=We(o,2<r?arguments[2]:void 0,2)),void 0!=u&&(n!=Array||void 0===u||Si.Array!==u&&wr[_r]!==u))for(i=u.call(i),n=new n;!(e=i.next()).done;s++)r=n,u=s,e=a?br(i,o,[e.value,s],!0):e.value,u in r?$e.f(r,u,ti(0,e)):r[u]=e;else for(r=Pe(i.length),n=new n(r);r>s;s++){u=n,e=s;var l=a?o(i[s],s):i[s];e in u?$e.f(u,e,ti(0,l)):u[e]=l}return n.length=s,n}});var Pr=Ce.Array.from,Sr=r((function(t){t.exports={default:Pr,__esModule:!0}})),Er=n(Sr),Cr=r((function(t,e){e.__esModule=!0;var i=Sr&&Sr.__esModule?Sr:{default:Sr};e.default=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return(0,i.default)(t)}})),Lr=n(Cr),Rr=nn.onFreeze;ri("freeze",(function(t){return function(e){return t&&Ze(e)?t(Rr(e)):e}}));var kr=Ce.Object.freeze,Or=r((function(t){t.exports={default:kr,__esModule:!0}})),Dr=n(Or),Br=Ce.JSON||(Ce.JSON={stringify:JSON.stringify}),zr=function(t){return Br.stringify.apply(Br,arguments)},Fr=r((function(t){t.exports={default:zr,__esModule:!0}})),Ir=n(Fr),Ur={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Nr=dn.f;ri("getOwnPropertyDescriptor",(function(){return function(t,e){return Nr(_e(t),e)}}));var jr=Ce.Object,Hr=function(t,e){return jr.getOwnPropertyDescriptor(t,e)},Wr=r((function(t){t.exports={default:Hr,__esModule:!0}})),Zr=n(Wr),Yr=r((function(t){var e=Array.prototype.concat,i=Array.prototype.slice,n=t.exports=function(t){for(var n=[],r=0,o=t.length;r<o;r++){var a=t[r],s=!(!(s=a)||"string"===typeof s)&&(s instanceof Array||Array.isArray(s)||0<=s.length&&(s.splice instanceof Function||Zr(s,s.length-1)&&"String"!==s.constructor.name));s?n=e.call(n,i.call(a)):n.push(a)}return n};n.wrap=function(t){return function(){return t(n(arguments))}}})),Xr=r((function(t){function e(t,e,i){return Math.min(Math.max(e,t),i)}function i(t){return t=t.toString(16).toUpperCase(),2>t.length?"0"+t:t}var n,r={};for(n in Ur)Ur.hasOwnProperty(n)&&(r[Ur[n]]=n);var o=t.exports={to:{},get:{}};o.get=function(t){switch(t.substring(0,3).toLowerCase()){case"hsl":t=o.get.hsl(t);var e="hsl";break;case"hwb":t=o.get.hwb(t),e="hwb";break;default:t=o.get.rgb(t),e="rgb"}return t?{model:e,value:t}:null},o.get.rgb=function(t){if(!t)return null;var i,n=/^#([a-f0-9]{3,4})$/i,r=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,o=/^rgba?\(\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,a=/(\D+)/,s=[0,0,0,1];if(i=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(n=i[2],i=i[1],t=0;3>t;t++)r=2*t,s[t]=parseInt(i.slice(r,r+2),16);n&&(s[3]=Math.round(parseInt(n,16)/255*100)/100)}else if(i=t.match(n)){for(i=i[1],n=i[3],t=0;3>t;t++)s[t]=parseInt(i[t]+i[t],16);n&&(s[3]=Math.round(parseInt(n+n,16)/255*100)/100)}else if(i=t.match(r)){for(t=0;3>t;t++)s[t]=parseInt(i[t+1],0);i[4]&&(s[3]=parseFloat(i[4]))}else{if(!(i=t.match(o)))return(i=t.match(a))?"transparent"===i[1]?[0,0,0,0]:(s=Ur[i[1]],s?(s[3]=1,s):null):null;for(t=0;3>t;t++)s[t]=Math.round(2.55*parseFloat(i[t+1]));i[4]&&(s[3]=parseFloat(i[4]))}for(t=0;3>t;t++)s[t]=e(s[t],0,255);return s[3]=e(s[3],0,1),s},o.get.hsl=function(t){if(!t)return null;var i=t.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(i){var n=parseFloat(i[4]);t=(parseFloat(i[1])+360)%360;var r=e(parseFloat(i[2]),0,100);return i=e(parseFloat(i[3]),0,100),n=e(isNaN(n)?1:n,0,1),[t,r,i,n]}return null},o.get.hwb=function(t){if(!t)return null;var i=t.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(i){var n=parseFloat(i[4]);t=(parseFloat(i[1])%360+360)%360;var r=e(parseFloat(i[2]),0,100);return i=e(parseFloat(i[3]),0,100),n=e(isNaN(n)?1:n,0,1),[t,r,i,n]}return null},o.to.hex=function(){var t=Yr(arguments);return"#"+i(t[0])+i(t[1])+i(t[2])+(1>t[3]?i(Math.round(255*t[3])):"")},o.to.rgb=function(){var t=Yr(arguments);return 4>t.length||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},o.to.rgb.percent=function(){var t=Yr(arguments),e=Math.round(t[0]/255*100),i=Math.round(t[1]/255*100),n=Math.round(t[2]/255*100);return 4>t.length||1===t[3]?"rgb("+e+"%, "+i+"%, "+n+"%)":"rgba("+e+"%, "+i+"%, "+n+"%, "+t[3]+")"},o.to.hsl=function(){var t=Yr(arguments);return 4>t.length||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},o.to.hwb=function(){var t=Yr(arguments),e="";return 4<=t.length&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},o.to.keyword=function(t){return r[t.slice(0,3)]}})),Vr=r((function(t){var e={};for(r in Ur)Ur.hasOwnProperty(r)&&(e[Ur[r]]=r);var i,n=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(i in n)if(n.hasOwnProperty(i)){if(!("channels"in n[i]))throw Error("missing channels property: "+i);if(!("labels"in n[i]))throw Error("missing channel labels property: "+i);if(n[i].labels.length!==n[i].channels)throw Error("channel and label counts mismatch: "+i);t=n[i].channels;var r=n[i].labels;delete n[i].channels,delete n[i].labels,Object.defineProperty(n[i],"channels",{value:t}),Object.defineProperty(n[i],"labels",{value:r})}n.rgb.hsl=function(t){var e=t[0]/255,i=t[1]/255,n=t[2]/255;t=Math.min(e,i,n);var r,o=Math.max(e,i,n),a=o-t;return o===t?r=0:e===o?r=(i-n)/a:i===o?r=2+(n-e)/a:n===o&&(r=4+(e-i)/a),r=Math.min(60*r,360),0>r&&(r+=360),e=(t+o)/2,[r,100*(o===t?0:.5>=e?a/(o+t):a/(2-o-t)),100*e]},n.rgb.hsv=function(t){var e,i=t[0]/255,n=t[1]/255,r=t[2]/255,o=Math.max(i,n,r),a=o-Math.min(i,n,r);if(0===a)var s=e=0;else{e=a/o,t=(o-i)/6/a+.5;var u=(o-n)/6/a+.5;a=(o-r)/6/a+.5,i===o?s=a-u:n===o?s=1/3+t-a:r===o&&(s=2/3+u-t),0>s?s+=1:1<s&&--s}return[360*s,100*e,100*o]},n.rgb.hwb=function(t){var e=t[0],i=t[1],r=t[2];t=n.rgb.hsl(t)[0];var o=1/255*Math.min(e,Math.min(i,r));return r=1-1/255*Math.max(e,Math.max(i,r)),[t,100*o,100*r]},n.rgb.cmyk=function(t){var e=t[0]/255,i=t[1]/255;t=t[2]/255;var n=Math.min(1-e,1-i,1-t);return[100*((1-e-n)/(1-n)||0),100*((1-i-n)/(1-n)||0),100*((1-t-n)/(1-n)||0),100*n]},n.rgb.keyword=function(t){var i,n=e[t];if(n)return n;for(i in n=1/0,Ur)if(Ur.hasOwnProperty(i)){var r=Ur[i];if(r=Math.pow(t[0]-r[0],2)+Math.pow(t[1]-r[1],2)+Math.pow(t[2]-r[2],2),r<n){n=r;var o=i}}return o},n.keyword.rgb=function(t){return Ur[t]},n.rgb.xyz=function(t){var e=t[0]/255,i=t[1]/255;return t=t[2]/255,e=.04045<e?Math.pow((e+.055)/1.055,2.4):e/12.92,i=.04045<i?Math.pow((i+.055)/1.055,2.4):i/12.92,t=.04045<t?Math.pow((t+.055)/1.055,2.4):t/12.92,[100*(.4124*e+.3576*i+.1805*t),100*(.2126*e+.7152*i+.0722*t),100*(.0193*e+.1192*i+.9505*t)]},n.rgb.lab=function(t){var e=n.rgb.xyz(t);t=e[0];var i=e[1];return e=e[2],t/=95.047,i/=100,e/=108.883,t=.008856<t?Math.pow(t,1/3):7.787*t+16/116,i=.008856<i?Math.pow(i,1/3):7.787*i+16/116,e=.008856<e?Math.pow(e,1/3):7.787*e+16/116,[116*i-16,500*(t-i),200*(i-e)]},n.hsl.rgb=function(t){var e=t[0]/360,i=t[1]/100;if(t=t[2]/100,0===i){var n=255*t;return[n,n,n]}i=.5>t?t*(1+i):t+i-t*i,t=2*t-i;for(var r=[0,0,0],o=0;3>o;o++)n=e+1/3*-(o-1),0>n&&n++,1<n&&n--,n=1>6*n?t+6*(i-t)*n:1>2*n?i:2>3*n?t+(i-t)*(2/3-n)*6:t,r[o]=255*n;return r},n.hsl.hsv=function(t){var e=t[0],i=t[1]/100;t=t[2]/100;var n=i,r=Math.max(t,.01);return t*=2,i*=1>=t?t:2-t,n*=1>=r?r:2-r,[e,100*(0===t?2*n/(r+n):2*i/(t+i)),(t+i)/2*100]},n.hsv.rgb=function(t){var e=t[0]/60,i=t[1]/100;t=t[2]/100;var n=Math.floor(e)%6,r=e-Math.floor(e);e=255*t*(1-i);var o=255*t*(1-i*r);switch(i=255*t*(1-i*(1-r)),t*=255,n){case 0:return[t,i,e];case 1:return[o,t,e];case 2:return[e,t,i];case 3:return[e,o,t];case 4:return[i,e,t];case 5:return[t,e,o]}},n.hsv.hsl=function(t){var e=t[0],i=t[1]/100;t=t[2]/100;var n=Math.max(t,.01),r=(2-i)*n;return n=i*n/(1>=r?r:2-r)||0,[e,100*n,(2-i)*t/2*100]},n.hwb.rgb=function(t){var e=t[0]/360,i=t[1]/100;t=t[2]/100;var n=i+t;switch(1<n&&(i/=n,t/=n),n=Math.floor(6*e),t=1-t,e=6*e-n,0!==(1&n)&&(e=1-e),e=i+e*(t-i),n){default:case 6:case 0:n=t;var r=e;break;case 1:n=e,r=t;break;case 2:n=i,r=t,i=e;break;case 3:n=i,r=e,i=t;break;case 4:n=e,r=i,i=t;break;case 5:n=t,r=i,i=e}return[255*n,255*r,255*i]},n.cmyk.rgb=function(t){var e=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-e)+e)),255*(1-Math.min(1,t[1]/100*(1-e)+e)),255*(1-Math.min(1,t[2]/100*(1-e)+e))]},n.xyz.rgb=function(t){var e=t[0]/100,i=t[1]/100,n=t[2]/100;t=3.2406*e+-1.5372*i+-.4986*n;var r=-.9689*e+1.8758*i+.0415*n;return e=.0557*e+-.204*i+1.057*n,t=.0031308<t?1.055*Math.pow(t,1/2.4)-.055:12.92*t,r=.0031308<r?1.055*Math.pow(r,1/2.4)-.055:12.92*r,e=.0031308<e?1.055*Math.pow(e,1/2.4)-.055:12.92*e,t=Math.min(Math.max(0,t),1),r=Math.min(Math.max(0,r),1),e=Math.min(Math.max(0,e),1),[255*t,255*r,255*e]},n.xyz.lab=function(t){var e=t[0],i=t[1];return t=t[2],e/=95.047,i/=100,t/=108.883,e=.008856<e?Math.pow(e,1/3):7.787*e+16/116,i=.008856<i?Math.pow(i,1/3):7.787*i+16/116,t=.008856<t?Math.pow(t,1/3):7.787*t+16/116,[116*i-16,500*(e-i),200*(i-t)]},n.lab.xyz=function(t){var e=t[1],i=t[2];t=(t[0]+16)/116,e=e/500+t,i=t-i/200;var n=Math.pow(t,3),r=Math.pow(e,3),o=Math.pow(i,3);return[95.047*(.008856<r?r:(e-16/116)/7.787),100*(.008856<n?n:(t-16/116)/7.787),108.883*(.008856<o?o:(i-16/116)/7.787)]},n.lab.lch=function(t){var e=t[0],i=t[1];t=t[2];var n=360*Math.atan2(t,i)/2/Math.PI;return 0>n&&(n+=360),[e,Math.sqrt(i*i+t*t),n]},n.lch.lab=function(t){var e=t[0],i=t[1];return t=t[2]/360*2*Math.PI,[e,i*Math.cos(t),i*Math.sin(t)]},n.rgb.ansi16=function(t){var e=t[0],i=t[1],r=t[2],o=1 in arguments?arguments[1]:n.rgb.hsv(t)[2];return o=Math.round(o/50),0===o?30:(e=30+(Math.round(r/255)<<2|Math.round(i/255)<<1|Math.round(e/255)),2===o&&(e+=60),e)},n.hsv.ansi16=function(t){return n.rgb.ansi16(n.hsv.rgb(t),t[2])},n.rgb.ansi256=function(t){var e=t[0],i=t[1];return t=t[2],e===i&&i===t?8>e?16:248<e?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(i/255*5)+Math.round(t/255*5)},n.ansi16.rgb=function(t){var e=t%10;return 0===e||7===e?(50<t&&(e+=3.5),e=e/10.5*255,[e,e,e]):(t=.5*(1+~~(50<t)),[(1&e)*t*255,(e>>1&1)*t*255,(e>>2&1)*t*255])},n.ansi256.rgb=function(t){if(232<=t){var e=10*(t-232)+8;return[e,e,e]}t-=16,e=Math.floor(t/36)/5*255;var i=Math.floor((t%=36)/6)/5*255;return[e,i,t%6/5*255]},n.rgb.hex=function(t){return t=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase(),"000000".substring(t.length)+t},n.hex.rgb=function(t){if(t=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i),!t)return[0,0,0];var e=t[0];return 3===t[0].length&&(e=e.split("").map((function(t){return t+t})).join("")),t=parseInt(e,16),[t>>16&255,t>>8&255,255&t]},n.rgb.hcg=function(t){var e=t[0]/255,i=t[1]/255;t=t[2]/255;var n=Math.max(Math.max(e,i),t),r=Math.min(Math.min(e,i),t),o=n-r;return[(0>=o?0:n===e?(i-t)/o%6:n===i?2+(t-e)/o:(e-i)/o+8)/6%1*360,100*o,100*(1>o?r/(1-o):0)]},n.hsl.hcg=function(t){var e=t[1]/100,i=t[2]/100,n=0;return e=.5>i?2*e*i:2*e*(1-i),1>e&&(n=(i-.5*e)/(1-e)),[t[0],100*e,100*n]},n.hsv.hcg=function(t){var e=t[2]/100,i=t[1]/100*e,n=0;return 1>i&&(n=(e-i)/(1-i)),[t[0],100*i,100*n]},n.hcg.rgb=function(t){var e=t[1]/100,i=t[2]/100;if(0===e)return[255*i,255*i,255*i];var n=[0,0,0];t=t[0]/360%1*6;var r=t%1,o=1-r;switch(Math.floor(t)){case 0:n[0]=1,n[1]=r,n[2]=0;break;case 1:n[0]=o,n[1]=1,n[2]=0;break;case 2:n[0]=0,n[1]=1,n[2]=r;break;case 3:n[0]=0,n[1]=o,n[2]=1;break;case 4:n[0]=r,n[1]=0,n[2]=1;break;default:n[0]=1,n[1]=0,n[2]=o}return i*=1-e,[255*(e*n[0]+i),255*(e*n[1]+i),255*(e*n[2]+i)]},n.hcg.hsv=function(t){var e=t[1]/100,i=e+t[2]/100*(1-e),n=0;return 0<i&&(n=e/i),[t[0],100*n,100*i]},n.hcg.hsl=function(t){var e=t[1]/100,i=t[2]/100*(1-e)+.5*e,n=0;return 0<i&&.5>i?n=e/(2*i):.5<=i&&1>i&&(n=e/(2*(1-i))),[t[0],100*n,100*i]},n.hcg.hwb=function(t){var e=t[1]/100,i=e+t[2]/100*(1-e);return[t[0],100*(i-e),100*(1-i)]},n.hwb.hcg=function(t){var e=1-t[2]/100,i=e-t[1]/100,n=0;return 1>i&&(n=(e-i)/(1-i)),[t[0],100*i,100*n]},n.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},n.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},n.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},n.gray.hsl=n.gray.hsv=function(t){return[0,0,t[0]]},n.gray.hwb=function(t){return[0,100,t[0]]},n.gray.cmyk=function(t){return[0,0,0,t[0]]},n.gray.lab=function(t){return[t[0],0,0]},n.gray.hex=function(t){return t=255&Math.round(t[0]/100*255),t=((t<<16)+(t<<8)+t).toString(16).toUpperCase(),"000000".substring(t.length)+t},n.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}})),Gr=function(t){for(var e={},i=si(Vr),n=i.length,r=0;r<n;r++)e[i[r]]={distance:-1,parent:null};for(i=[t],e[t].distance=0;i.length;){t=i.pop(),n=si(Vr[t]),r=n.length;for(var a=0;a<r;a++){var s=n[a],u=e[s];-1===u.distance&&(u.distance=e[t].distance+1,u.parent=t,i.unshift(s))}}for(i={},t=si(e),n=t.length,r=0;r<n;r++){var l=t[r];if(null!==e[l].parent){a=l,s=e,u=[s[l].parent,l];var h=Vr[s[l].parent][l];for(l=s[l].parent;s[l].parent;)u.unshift(s[l].parent),h=o(Vr[s[l].parent][l],h),l=s[l].parent;h.conversion=u,i[a]=h}}return i},qr={};si(Vr).forEach((function(t){qr[t]={},Object.defineProperty(qr[t],"channels",{value:Vr[t].channels}),Object.defineProperty(qr[t],"labels",{value:Vr[t].labels});var e=Gr(t);si(e).forEach((function(i){var n=e[i];qr[t][i]=s(n),qr[t][i].raw=a(n)}))}));var Kr=qr,Qr=[].slice,Jr=["keyword","gray","hex"],$r={};si(Kr).forEach((function(t){$r[Qr.call(Kr[t].labels).sort().join("")]=t}));var to={};u.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in Xr.to?this:this.rgb();return e=e.round("number"===typeof t?t:1),t=1===e.valpha?e.color:e.color.concat(this.valpha),Xr.to[e.model](t)},percentString:function(t){return t=this.rgb().round("number"===typeof t?t:1),t=1===t.valpha?t.color:t.color.concat(this.valpha),Xr.to.rgb.percent(t)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=Kr[this.model].channels,i=Kr[this.model].labels,n=0;n<e;n++)t[i[n]]=this.color[n];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new u(this.color.map(l(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new u(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:h("rgb",0,f(255)),green:h("rgb",1,f(255)),blue:h("rgb",2,f(255)),hue:h(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:h("hsl",1,f(100)),lightness:h("hsl",2,f(100)),saturationv:h("hsv",1,f(100)),value:h("hsv",2,f(100)),chroma:h("hcg",1,f(100)),gray:h("hcg",2,f(100)),white:h("hwb",1,f(100)),wblack:h("hwb",2,f(100)),cyan:h("cmyk",0,f(100)),magenta:h("cmyk",1,f(100)),yellow:h("cmyk",2,f(100)),black:h("cmyk",3,f(100)),x:h("xyz",0,f(100)),y:h("xyz",1,f(100)),z:h("xyz",2,f(100)),l:h("lab",0,f(100)),a:h("lab",1),b:h("lab",2),keyword:function(t){return arguments.length?new u(t):Kr[this.model].keyword(this.color)},hex:function(t){return arguments.length?new u(t):Xr.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],i=0;i<t.length;i++){var n=t[i]/255;e[i]=.03928>=n?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity();return t=t.luminosity(),e>t?(e+.05)/(t+.05):(t+.05)/(e+.05)},level:function(t){return t=this.contrast(t),7.1<=t?"AAA":4.5<=t?"AA":""},isDark:function(){var t=this.rgb().color;return 128>(299*t[0]+587*t[1]+114*t[2])/1e3},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;3>e;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color;return t=.3*t[0]+.59*t[1]+.11*t[2],u.rgb(t,t,t)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),i=e.color[0];return i=(i+t)%360,e.color[0]=0>i?360+i:i,e},mix:function(t,e){if(!t||!t.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+("undefined"===typeof t?"undefined":qn(t)));t=t.rgb();var i=this.rgb();e=void 0===e?.5:e;var n=2*e-1,r=t.alpha()-i.alpha();return n=((-1===n*r?n:(n+r)/(1+n*r))+1)/2,r=1-n,u.rgb(n*t.red()+r*i.red(),n*t.green()+r*i.green(),n*t.blue()+r*i.blue(),t.alpha()*e+i.alpha()*(1-e))}},si(Kr).forEach((function(t){if(-1===Jr.indexOf(t)){var e=Kr[t].channels;u.prototype[t]=function(){if(this.model===t)return new u(this);if(arguments.length)return new u(arguments,t);var i="number"===typeof arguments[e]?e:this.valpha,n=Kr[this.model][t].raw(this.color);return n=Array.isArray(n)?n:[n],new u(n.concat(i),t)},u[t]=function(i){return"number"===typeof i&&(i=c(Qr.call(arguments),e)),new u(i,t)}}})),x(b.prototype,{equals:function(t){return this.lat===t.lat&&this.lng===t.lng},clone:function(){return new b(this.lat,this.lng)},getLngSpan:function(t){return t=Math.abs(t-this.lng),180<t&&(t=360-t),t},sub:function(t){return new b(this.lat-t.lat,this.lng-t.lng)},toString:function(){return"Point"}}),x(y,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(t,e){if(!t||!e)return 0;if(t=this.convertMC2LL(t),!t)return 0;var i=this.toRadians(t.lng);if(t=this.toRadians(t.lat),e=this.convertMC2LL(e),!e)return 0;var n=this.toRadians(e.lng);return e=this.toRadians(e.lat),this.getDistance(i,n,t,e)},getDistanceByLL:function(t,e){if(!t||!e)return 0;t.lng=this.getLoop(t.lng,-180,180),t.lat=this.getRange(t.lat,-74,74),e.lng=this.getLoop(e.lng,-180,180),e.lat=this.getRange(e.lat,-74,74);var i=this.toRadians(t.lng),n=this.toRadians(t.lat);return t=this.toRadians(e.lng),e=this.toRadians(e.lat),this.getDistance(i,t,n,e)},convertMC2LL:function(t){if(null===t||void 0===t)return new b(0,0);if(180>t.lng&&-180<t.lng&&90>t.lat&&-90<t.lat)return t;for(var e=new b(Math.abs(t.lng),Math.abs(t.lat)),i=0;i<this.MCBAND.length;i++)if(e.lat>=this.MCBAND[i]){var n=this.MC2LL[i];break}return t=this.convertor(t,n),new b(t.lng.toFixed(6),t.lat.toFixed(6))},convertLL2MC:function(t){if(null===t||void 0===t)return new b(0,0);if(180<t.lng||-180>t.lng||90<t.lat||-90>t.lat)return t;t.lng=this.getLoop(t.lng,-180,180),t.lat=this.getRange(t.lat,-74,74);for(var e=new b(t.lng,t.lat),i=0;i<this.LLBAND.length;i++)if(e.lat>=this.LLBAND[i]){var n=this.LL2MC[i];break}if(!n)for(i=0;i<this.LLBAND.length;i++)if(e.lat<=-this.LLBAND[i]){n=this.LL2MC[i];break}return t=this.convertor(t,n),new b(Number(t.lng.toFixed(2)),Number(t.lat.toFixed(2)))},convertor:function(t,e){if(t&&e){var i=e[0]+e[1]*Math.abs(t.lng),n=Math.abs(t.lat)/e[9];return e=e[2]+e[3]*n+e[4]*n*n+e[5]*n*n*n+e[6]*n*n*n*n+e[7]*n*n*n*n*n+e[8]*n*n*n*n*n*n,i*=0>t.lng?-1:1,e*=0>t.lat?-1:1,new b(i,e)}},getDistance:function(t,e,i,n){return this.EARTHRADIUS*Math.acos(Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(e-t))},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,i){return null!=e&&(t=Math.max(t,e)),null!=i&&(t=Math.min(t,i)),t},getLoop:function(t,e,i){for(;t>i;)t-=i-e;for(;t<e;)t+=i-e;return t}}),x(y.prototype,{lngLatToMercator:function(t){return y.convertLL2MC(t)},lngLatToPoint:function(t){return t=y.convertLL2MC(t),new _(t.lng,t.lat)},mercatorToLngLat:function(t){return y.convertMC2LL(t)},pointToLngLat:function(t){return t=new b(t.x,t.y),y.convertMC2LL(t)},pointToPixel:function(t,e,i,n,r){if(t)return t=this.lngLatToMercator(t,r),e=this.getZoomUnits(e),new _(Math.round((t.lng-i.lng)/e+n.width/2),Math.round((i.lat-t.lat)/e+n.height/2))},pixelToPoint:function(t,e,i,n,r){if(t)return e=this.getZoomUnits(e),t=new b(i.lng+e*(t.x-n.width/2),i.lat-e*(t.y-n.height/2)),this.mercatorToLngLat(t,r)},getZoomUnits:function(t){return Math.pow(2,18-t)}}),A.prototype.setMax=function(t){this.max=t||100},A.prototype.setMin=function(t){this.min=t||0},A.prototype.setMaxSize=function(t){this.maxSize=t||35},A.prototype.setMinSize=function(t){this.minSize=t||0},A.prototype.initPalette=function(){var t=this.gradient,e=this.paletteCtx=new w(256,1).getContext("2d"),i=e.createLinearGradient(0,0,256,1);si(t).forEach((function(e){i.addColorStop(parseFloat(e),t[e])})),e.fillStyle=i,e.fillRect(0,0,256,1),e.imageData=e.getImageData(0,0,256,1).data},A.prototype.getColor=function(t){return t=this.getImageData(t),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]/256+")"},A.prototype.getImageData=function(t){var e=this.paletteCtx.imageData;if(void 0===t)return e;var i=this.max,n=this.min;return t>i&&(t=i),t<n&&(t=n),t=4*Math.floor((t-n)/(i-n)*255),[e[t],e[t+1],e[t+2],e[t+3]]},A.prototype.getSize=function(t){var e=this.max,i=this.min,n=this.maxSize,r=this.minSize;return t>e&&(t=e),t<i&&(t=i),r+(t-i)/(e-i)*(n-r)},T.prototype._initialize=function(){this.v0=this._normalizaCoord(this.options.start),this.v3=this._normalizaCoord(this.options.end),this.v1=this._getControlPoint(this.v0,this.v3,4),this.v2=this._getControlPoint(this.v3,this.v0,5),this.v0[2]||(this.v0[2]=0),this.v3[2]||(this.v3[2]=0)},T.prototype.setOptions=function(t){this.options=t||{},this._initialize()},T.prototype.getPoints=function(t){void 0===t&&(t=20);for(var e=[],i=0;i<=t;i++)e.push(this._getPoint(i/t));return e},T.prototype._normalizaCoord=function(t){return t?(t=y.convertLL2MC({lng:Number(t[0]),lat:Number(t[1])}),[t.lng,t.lat]):[]},T.prototype._getControlPoint=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return[].concat(Lr(this._getQuarter(t,e)),[this._getDistance(t,e)/i])},T.prototype._getQuarter=function(t,e){return[(3*t[0]+e[0])/4,(3*t[1]+e[1])/4]},T.prototype._getDistance=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},T.prototype._getPoint=function(t){var e=[],i=this.v0,n=this.v1,r=this.v2,o=this.v3;return e.push(M(t,i[0],n[0],r[0],o[0]),M(t,i[1],n[1],r[1],o[1]),M(t,i[2],n[2],r[2],o[2])),e},P.prototype._initialize=function(){this.points=this.options.points||this.options.point||[],this.greatCirclePoints=[];for(var t=[],e=0;e<this.points.length;e++){var i=this._normalizaCoord(this.points[e]);i&&t.push(i)}this.points=t},P.prototype.setOptions=function(t){this.options=t||{},this._initialize()},P.prototype.getPoints=function(){if(0===this.greatCirclePoints.length)for(var t=0;t<this.points.length-1;t++)this._calcGreatCirclePoints(this.points[t],this.points[t+1]);return this.greatCirclePoints},P.prototype._normalizaCoord=function(t){if(!t)return null;t instanceof Array&&(t={lng:Number(t[0]),lat:Number(t[1])});var e=y.convertLL2MC(t);return t=y.convertMC2LL(t),e.latLng=t,e},P.prototype._calcGreatCirclePoints=function(t,e){var i=t.latLng,n=e.latLng;if(!m(i.lng,n.lng)||!m(i.lat,n.lat)){var r=y.getDistance(p(i.lng),p(i.lat),p(n.lng),p(n.lat));if(!(25e4>r)){r=Math.round(r/15e4);var o=this._calcAngularDistance(i,n);this.greatCirclePoints.push([t.lng,t.lat]);for(var a=0;a<r;a++){var s=this._calcMiddlePoint(i,n,a/r,o);s=y.convertLL2MC(s);var u=S(s,t);30037726<u&&(s.lng=s.lng<t.lng?s.lng+this.WORLD_SIZE_MC:s.lng-this.WORLD_SIZE_MC),this.greatCirclePoints.push([s.lng,s.lat]),t=s}u=S(e,t),30037726<u&&(e.lng=e.lng<t.lng?e.lng+this.WORLD_SIZE_MC:e.lng-this.WORLD_SIZE_MC),this.greatCirclePoints.push([e.lng,e.lat])}}},P.prototype._calcAngularDistance=function(t,e){var i=p(t.lat),n=p(e.lat);return t=p(t.lng),e=p(e.lng),Math.acos(Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(Math.abs(e-t)))},P.prototype._calcMiddlePoint=function(t,e,i,n){var r=e.lat,o=t.lng;e=e.lng,t=p(t.lat),r=p(r),o=p(o);var a=p(e);return e=Math.sin((1-i)*n)/Math.sin(n),n=Math.sin(i*n)/Math.sin(n),i=e*Math.cos(t)*Math.cos(o)+n*Math.cos(r)*Math.cos(a),o=e*Math.cos(t)*Math.sin(o)+n*Math.cos(r)*Math.sin(a),t=Math.atan2(e*Math.sin(t)+n*Math.sin(r),Math.sqrt(Math.pow(i,2)+Math.pow(o,2))),new b(d(Math.atan2(o,i)),d(t))};var eo=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};de(this,t),this.options=e,this._initialize()}return Pi(t,[{key:"_initialize",value:function(){this.points=this.options.points}},{key:"_normalizaCoord",value:function(t){return t?(t instanceof Array&&(t={lng:Number(t[0]),lat:Number(t[1])}),y.convertLL2MC(t)):null}},{key:"setOptions",value:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this._initialize()}},{key:"getPoints",value:function(t){for(var e=[],i=this.points,n=0;n<i.length-1;n++){var r=this.getCurveByTwoPoints(this._normalizaCoord(i[n]),this._normalizaCoord(i[n+1]),t);r&&0<r.length&&(e=e.concat(r))}return e}},{key:"getCurveByTwoPoints",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:20;if(!t||!e)return null;var n=[],r=0;if(void 0!==("undefined"===typeof e?"undefined":qn(e))){var o=parseFloat(t.lat),a=parseFloat(e.lat),s=parseFloat(t.lng),u=parseFloat(e.lng);u>s&&180<parseFloat(u-s)&&0>s&&(s=parseFloat(360+s),u=parseFloat(360+u));var l=0;if(a===o)var h=0,f=s-u;else u===s?(h=Math.PI/2,f=o-a):(h=Math.atan((a-o)/(u-s)),f=(a-o)/Math.sin(h));for(0===l&&(l=h+Math.PI/5),f/=2,h=f*Math.cos(l)+s,l=f*Math.sin(l)+o,f=0;f<i+1;f++){var c=s*(1-2*r+r*r)+h*(2*r-2*r*r)+u*r*r,p=e.lng;n.push([0>t.lng&&0<p?c-360:c,o*(1-2*r+r*r)+l*(2*r-2*r*r)+a*r*r]),r+=1/i}return n}"undefined"===typeof n||qn(n)}}]),t}(),io=[{n:"\u5317\u4eac",g:"116.395645,39.929986|12"},{n:"\u4e0a\u6d77",g:"121.487899,31.249162|12"},{n:"\u5929\u6d25",g:"117.210813,39.14393|12"},{n:"\u91cd\u5e86",g:"106.530635,29.544606|12"}],no=[{n:"\u5b89\u5fbd",g:"117.216005,31.859252|8",cities:[{n:"\u5408\u80a5",g:"117.282699,31.866942|12"},{n:"\u5b89\u5e86",g:"117.058739,30.537898|13"},{n:"\u868c\u57e0",g:"117.35708,32.929499|13"},{n:"\u4eb3\u5dde",g:"115.787928,33.871211|13"},{n:"\u5de2\u6e56",g:"117.88049,31.608733|13"},{n:"\u6c60\u5dde",g:"117.494477,30.660019|14"},{n:"\u6ec1\u5dde",g:"118.32457,32.317351|13"},{n:"\u961c\u9633",g:"115.820932,32.901211|13"},{n:"\u6dee\u5317",g:"116.791447,33.960023|13"},{n:"\u6dee\u5357",g:"117.018639,32.642812|13"},{n:"\u9ec4\u5c71",g:"118.29357,29.734435|13"},{n:"\u516d\u5b89",g:"116.505253,31.755558|13"},{n:"\u9a6c\u978d\u5c71",g:"118.515882,31.688528|13"},{n:"\u5bbf\u5dde",g:"116.988692,33.636772|13"},{n:"\u94dc\u9675",g:"117.819429,30.94093|14"},{n:"\u829c\u6e56",g:"118.384108,31.36602|12"},{n:"\u5ba3\u57ce",g:"118.752096,30.951642|13"}]},{n:"\u798f\u5efa",g:"117.984943,26.050118|8",cities:[{n:"\u798f\u5dde",g:"119.330221,26.047125|12"},{n:"\u9f99\u5ca9",g:"117.017997,25.078685|13"},{n:"\u5357\u5e73",g:"118.181883,26.643626|13"},{n:"\u5b81\u5fb7",g:"119.542082,26.656527|14"},{n:"\u8386\u7530",g:"119.077731,25.44845|13"},{n:"\u6cc9\u5dde",g:"118.600362,24.901652|12"},{n:"\u4e09\u660e",g:"117.642194,26.270835|14"},{n:"\u53a6\u95e8",g:"118.103886,24.489231|12"},{n:"\u6f33\u5dde",g:"117.676205,24.517065|12"}]},{n:"\u7518\u8083",g:"102.457625,38.103267|6",cities:[{n:"\u5170\u5dde",g:"103.823305,36.064226|12"},{n:"\u767d\u94f6",g:"104.171241,36.546682|13"},{n:"\u5b9a\u897f",g:"104.626638,35.586056|13"},{n:"\u7518\u5357\u5dde",g:"102.917442,34.992211|14"},{n:"\u5609\u5cea\u5173",g:"98.281635,39.802397|13"},{n:"\u91d1\u660c",g:"102.208126,38.516072|13"},{n:"\u9152\u6cc9",g:"98.508415,39.741474|13"},{n:"\u4e34\u590f\u5dde",g:"103.215249,35.598514|13"},{n:"\u9647\u5357",g:"104.934573,33.39448|14"},{n:"\u5e73\u51c9",g:"106.688911,35.55011|13"},{n:"\u5e86\u9633",g:"107.644227,35.726801|13"},{n:"\u5929\u6c34",g:"105.736932,34.584319|13"},{n:"\u6b66\u5a01",g:"102.640147,37.933172|13"},{n:"\u5f20\u6396",g:"100.459892,38.93932|13"}]},{n:"\u5e7f\u4e1c",g:"113.394818,23.408004|8",cities:[{n:"\u5e7f\u5dde",g:"113.30765,23.120049|12"},{n:"\u6f6e\u5dde",g:"116.630076,23.661812|13"},{n:"\u4e1c\u839e",g:"113.763434,23.043024|12"},{n:"\u4f5b\u5c71",g:"113.134026,23.035095|13"},{n:"\u6cb3\u6e90",g:"114.713721,23.757251|12"},{n:"\u60e0\u5dde",g:"114.410658,23.11354|12"},{n:"\u6c5f\u95e8",g:"113.078125,22.575117|13"},{n:"\u63ed\u9633",g:"116.379501,23.547999|13"},{n:"\u8302\u540d",g:"110.931245,21.668226|13"},{n:"\u6885\u5dde",g:"116.126403,24.304571|13"},{n:"\u6e05\u8fdc",g:"113.040773,23.698469|13"},{n:"\u6c55\u5934",g:"116.72865,23.383908|13"},{n:"\u6c55\u5c3e",g:"115.372924,22.778731|14"},{n:"\u97f6\u5173",g:"113.594461,24.80296|13"},{n:"\u6df1\u5733",g:"114.025974,22.546054|12"},{n:"\u9633\u6c5f",g:"111.97701,21.871517|14"},{n:"\u4e91\u6d6e",g:"112.050946,22.937976|13"},{n:"\u6e5b\u6c5f",g:"110.365067,21.257463|13"},{n:"\u8087\u5e86",g:"112.479653,23.078663|13"},{n:"\u4e2d\u5c71",g:"113.42206,22.545178|12"},{n:"\u73e0\u6d77",g:"113.562447,22.256915|13"}]},{n:"\u5e7f\u897f",g:"108.924274,23.552255|7",cities:[{n:"\u5357\u5b81",g:"108.297234,22.806493|12"},{n:"\u767e\u8272",g:"106.631821,23.901512|13"},{n:"\u5317\u6d77",g:"109.122628,21.472718|13"},{n:"\u5d07\u5de6",g:"107.357322,22.415455|14"},{n:"\u9632\u57ce\u6e2f",g:"108.351791,21.617398|15"},{n:"\u6842\u6797",g:"110.26092,25.262901|12"},{n:"\u8d35\u6e2f",g:"109.613708,23.103373|13"},{n:"\u6cb3\u6c60",g:"108.069948,24.699521|14"},{n:"\u8d3a\u5dde",g:"111.552594,24.411054|14"},{n:"\u6765\u5bbe",g:"109.231817,23.741166|14"},{n:"\u67f3\u5dde",g:"109.422402,24.329053|12"},{n:"\u94a6\u5dde",g:"108.638798,21.97335|13"},{n:"\u68a7\u5dde",g:"111.305472,23.485395|13"},{n:"\u7389\u6797",g:"110.151676,22.643974|14"}]},{n:"\u8d35\u5dde",g:"106.734996,26.902826|8",cities:[{n:"\u8d35\u9633",g:"106.709177,26.629907|12"},{n:"\u5b89\u987a",g:"105.92827,26.228595|13"},{n:"\u6bd5\u8282\u5730\u533a",g:"105.300492,27.302612|14"},{n:"\u516d\u76d8\u6c34",g:"104.852087,26.591866|13"},{n:"\u94dc\u4ec1\u5730\u533a",g:"109.196161,27.726271|14"},{n:"\u9075\u4e49",g:"106.93126,27.699961|13"},{n:"\u9ed4\u897f\u5357\u5dde",g:"104.900558,25.095148|11"},{n:"\u9ed4\u4e1c\u5357\u5dde",g:"107.985353,26.583992|11"},{n:"\u9ed4\u5357\u5dde",g:"107.523205,26.264536|11"}]},{n:"\u6d77\u5357",g:"109.733755,19.180501|9",cities:[{n:"\u6d77\u53e3",g:"110.330802,20.022071|13"},{n:"\u767d\u6c99",g:"109.358586,19.216056|12"},{n:"\u4fdd\u4ead",g:"109.656113,18.597592|12"},{n:"\u660c\u6c5f",g:"109.0113,19.222483|12"},{n:"\u510b\u5dde",g:"109.413973,19.571153|13"},{n:"\u6f84\u8fc8",g:"109.996736,19.693135|13"},{n:"\u4e1c\u65b9",g:"108.85101,18.998161|13"},{n:"\u5b9a\u5b89",g:"110.32009,19.490991|13"},{n:"\u743c\u6d77",g:"110.414359,19.21483|13"},{n:"\u743c\u4e2d",g:"109.861849,19.039771|12"},{n:"\u4e50\u4e1c",g:"109.062698,18.658614|12"},{n:"\u4e34\u9ad8",g:"109.724101,19.805922|13"},{n:"\u9675\u6c34",g:"109.948661,18.575985|12"},{n:"\u4e09\u4e9a",g:"109.522771,18.257776|12"},{n:"\u5c6f\u660c",g:"110.063364,19.347749|13"},{n:"\u4e07\u5b81",g:"110.292505,18.839886|13"},{n:"\u6587\u660c",g:"110.780909,19.750947|13"},{n:"\u4e94\u6307\u5c71",g:"109.51775,18.831306|13"}]},{n:"\u6cb3\u5317",g:"115.661434,38.61384|7",cities:[{n:"\u77f3\u5bb6\u5e84",g:"114.522082,38.048958|12"},{n:"\u4fdd\u5b9a",g:"115.49481,38.886565|13"},{n:"\u6ca7\u5dde",g:"116.863806,38.297615|13"},{n:"\u627f\u5fb7",g:"117.933822,40.992521|14"},{n:"\u90af\u90f8",g:"114.482694,36.609308|13"},{n:"\u8861\u6c34",g:"115.686229,37.746929|13"},{n:"\u5eca\u574a",g:"116.703602,39.518611|13"},{n:"\u79e6\u7687\u5c9b",g:"119.604368,39.945462|12"},{n:"\u5510\u5c71",g:"118.183451,39.650531|13"},{n:"\u90a2\u53f0",g:"114.520487,37.069531|13"},{n:"\u5f20\u5bb6\u53e3",g:"114.893782,40.811188|13"}]},{n:"\u6cb3\u5357",g:"113.486804,34.157184|7",cities:[{n:"\u90d1\u5dde",g:"113.649644,34.75661|12"},{n:"\u5b89\u9633",g:"114.351807,36.110267|12"},{n:"\u9e64\u58c1",g:"114.29777,35.755426|13"},{n:"\u7126\u4f5c",g:"113.211836,35.234608|13"},{n:"\u5f00\u5c01",g:"114.351642,34.801854|13"},{n:"\u6d1b\u9633",g:"112.447525,34.657368|12"},{n:"\u6f2f\u6cb3",g:"114.046061,33.576279|13"},{n:"\u5357\u9633",g:"112.542842,33.01142|13"},{n:"\u5e73\u9876\u5c71",g:"113.300849,33.745301|13"},{n:"\u6fee\u9633",g:"115.026627,35.753298|12"},{n:"\u4e09\u95e8\u5ce1",g:"111.181262,34.78332|13"},{n:"\u5546\u4e18",g:"115.641886,34.438589|13"},{n:"\u65b0\u4e61",g:"113.91269,35.307258|13"},{n:"\u4fe1\u9633",g:"114.085491,32.128582|13"},{n:"\u8bb8\u660c",g:"113.835312,34.02674|13"},{n:"\u5468\u53e3",g:"114.654102,33.623741|13"},{n:"\u9a7b\u9a6c\u5e97",g:"114.049154,32.983158|13"}]},{n:"\u9ed1\u9f99\u6c5f",g:"128.047414,47.356592|6",cities:[{n:"\u54c8\u5c14\u6ee8",g:"126.657717,45.773225|12"},{n:"\u5927\u5e86",g:"125.02184,46.596709|12"},{n:"\u5927\u5174\u5b89\u5cad\u5730\u533a",g:"124.196104,51.991789|10"},{n:"\u9e64\u5c97",g:"130.292472,47.338666|13"},{n:"\u9ed1\u6cb3",g:"127.50083,50.25069|14"},{n:"\u9e21\u897f",g:"130.941767,45.32154|13"},{n:"\u4f73\u6728\u65af",g:"130.284735,46.81378|12"},{n:"\u7261\u4e39\u6c5f",g:"129.608035,44.588521|13"},{n:"\u4e03\u53f0\u6cb3",g:"131.019048,45.775005|14"},{n:"\u9f50\u9f50\u54c8\u5c14",g:"123.987289,47.3477|13"},{n:"\u53cc\u9e2d\u5c71",g:"131.171402,46.655102|13"},{n:"\u7ee5\u5316",g:"126.989095,46.646064|13"},{n:"\u4f0a\u6625",g:"128.910766,47.734685|14"}]},{n:"\u6e56\u5317",g:"112.410562,31.209316|8",cities:[{n:"\u6b66\u6c49",g:"114.3162,30.581084|12"},{n:"\u9102\u5dde",g:"114.895594,30.384439|14"},{n:"\u6069\u65bd",g:"109.517433,30.308978|14"},{n:"\u9ec4\u5188",g:"114.906618,30.446109|14"},{n:"\u9ec4\u77f3",g:"115.050683,30.216127|13"},{n:"\u8346\u95e8",g:"112.21733,31.042611|13"},{n:"\u8346\u5dde",g:"112.241866,30.332591|12"},{n:"\u6f5c\u6c5f",g:"112.768768,30.343116|13"},{n:"\u795e\u519c\u67b6\u6797\u533a",g:"110.487231,31.595768|13"},{n:"\u5341\u5830",g:"110.801229,32.636994|13"},{n:"\u968f\u5dde",g:"113.379358,31.717858|13"},{n:"\u5929\u95e8",g:"113.12623,30.649047|13"},{n:"\u4ed9\u6843",g:"113.387448,30.293966|13"},{n:"\u54b8\u5b81",g:"114.300061,29.880657|13"},{n:"\u8944\u9633",g:"112.176326,32.094934|12"},{n:"\u5b5d\u611f",g:"113.935734,30.927955|13"},{n:"\u5b9c\u660c",g:"111.310981,30.732758|13"}]},{n:"\u6e56\u5357",g:"111.720664,27.695864|7",cities:[{n:"\u957f\u6c99",g:"112.979353,28.213478|12"},{n:"\u5e38\u5fb7",g:"111.653718,29.012149|12"},{n:"\u90f4\u5dde",g:"113.037704,25.782264|13"},{n:"\u8861\u9633",g:"112.583819,26.898164|13"},{n:"\u6000\u5316",g:"109.986959,27.557483|13"},{n:"\u5a04\u5e95",g:"111.996396,27.741073|13"},{n:"\u90b5\u9633",g:"111.461525,27.236811|13"},{n:"\u6e58\u6f6d",g:"112.935556,27.835095|13"},{n:"\u6e58\u897f\u5dde",g:"109.745746,28.317951|14"},{n:"\u76ca\u9633",g:"112.366547,28.588088|13"},{n:"\u6c38\u5dde",g:"111.614648,26.435972|13"},{n:"\u5cb3\u9633",g:"113.146196,29.378007|13"},{n:"\u5f20\u5bb6\u754c",g:"110.48162,29.124889|13"},{n:"\u682a\u6d32",g:"113.131695,27.827433|13"}]},{n:"\u6c5f\u82cf",g:"119.368489,33.013797|8",cities:[{n:"\u5357\u4eac",g:"118.778074,32.057236|12"},{n:"\u5e38\u5dde",g:"119.981861,31.771397|12"},{n:"\u6dee\u5b89",g:"119.030186,33.606513|12"},{n:"\u8fde\u4e91\u6e2f",g:"119.173872,34.601549|12"},{n:"\u5357\u901a",g:"120.873801,32.014665|12"},{n:"\u82cf\u5dde",g:"120.619907,31.317987|12"},{n:"\u5bbf\u8fc1",g:"118.296893,33.95205|13"},{n:"\u6cf0\u5dde",g:"119.919606,32.476053|13"},{n:"\u65e0\u9521",g:"120.305456,31.570037|12"},{n:"\u5f90\u5dde",g:"117.188107,34.271553|12"},{n:"\u76d0\u57ce",g:"120.148872,33.379862|12"},{n:"\u626c\u5dde",g:"119.427778,32.408505|13"},{n:"\u9547\u6c5f",g:"119.455835,32.204409|13"}]},{n:"\u6c5f\u897f",g:"115.676082,27.757258|7",cities:[{n:"\u5357\u660c",g:"115.893528,28.689578|12"},{n:"\u629a\u5dde",g:"116.360919,27.954545|13"},{n:"\u8d63\u5dde",g:"114.935909,25.845296|13"},{n:"\u5409\u5b89",g:"114.992039,27.113848|13"},{n:"\u666f\u5fb7\u9547",g:"117.186523,29.303563|12"},{n:"\u4e5d\u6c5f",g:"115.999848,29.71964|13"},{n:"\u840d\u4e61",g:"113.859917,27.639544|13"},{n:"\u4e0a\u9976",g:"117.955464,28.457623|13"},{n:"\u65b0\u4f59",g:"114.947117,27.822322|13"},{n:"\u5b9c\u6625",g:"114.400039,27.81113|13"},{n:"\u9e70\u6f6d",g:"117.03545,28.24131|13"}]},{n:"\u5409\u6797",g:"126.262876,43.678846|7",cities:[{n:"\u957f\u6625",g:"125.313642,43.898338|12"},{n:"\u767d\u57ce",g:"122.840777,45.621086|13"},{n:"\u767d\u5c71",g:"126.435798,41.945859|13"},{n:"\u5409\u6797",g:"126.564544,43.871988|12"},{n:"\u8fbd\u6e90",g:"125.133686,42.923303|13"},{n:"\u56db\u5e73",g:"124.391382,43.175525|12"},{n:"\u677e\u539f",g:"124.832995,45.136049|13"},{n:"\u901a\u5316",g:"125.94265,41.736397|13"},{n:"\u5ef6\u8fb9",g:"129.485902,42.896414|13"}]},{n:"\u8fbd\u5b81",g:"122.753592,41.6216|8",cities:[{n:"\u6c88\u9633",g:"123.432791,41.808645|12"},{n:"\u978d\u5c71",g:"123.007763,41.118744|13"},{n:"\u672c\u6eaa",g:"123.778062,41.325838|12"},{n:"\u671d\u9633",g:"120.446163,41.571828|13"},{n:"\u5927\u8fde",g:"121.593478,38.94871|12"},{n:"\u4e39\u4e1c",g:"124.338543,40.129023|12"},{n:"\u629a\u987a",g:"123.92982,41.877304|12"},{n:"\u961c\u65b0",g:"121.660822,42.01925|14"},{n:"\u846b\u82a6\u5c9b",g:"120.860758,40.74303|13"},{n:"\u9526\u5dde",g:"121.147749,41.130879|13"},{n:"\u8fbd\u9633",g:"123.172451,41.273339|14"},{n:"\u76d8\u9526",g:"122.073228,41.141248|13"},{n:"\u94c1\u5cad",g:"123.85485,42.299757|13"},{n:"\u8425\u53e3",g:"122.233391,40.668651|13"}]},{n:"\u5185\u8499\u53e4",g:"114.415868,43.468238|5",cities:[{n:"\u547c\u548c\u6d69\u7279",g:"111.660351,40.828319|12"},{n:"\u963f\u62c9\u5584\u76df",g:"105.695683,38.843075|14"},{n:"\u5305\u5934",g:"109.846239,40.647119|12"},{n:"\u5df4\u5f66\u6dd6\u5c14",g:"107.423807,40.76918|12"},{n:"\u8d64\u5cf0",g:"118.930761,42.297112|12"},{n:"\u9102\u5c14\u591a\u65af",g:"109.993706,39.81649|12"},{n:"\u547c\u4f26\u8d1d\u5c14",g:"119.760822,49.201636|12"},{n:"\u901a\u8fbd",g:"122.260363,43.633756|12"},{n:"\u4e4c\u6d77",g:"106.831999,39.683177|13"},{n:"\u4e4c\u5170\u5bdf\u5e03",g:"113.112846,41.022363|12"},{n:"\u9521\u6797\u90ed\u52d2\u76df",g:"116.02734,43.939705|11"},{n:"\u5174\u5b89\u76df",g:"122.048167,46.083757|11"}]},{n:"\u5b81\u590f",g:"106.155481,37.321323|8",cities:[{n:"\u94f6\u5ddd",g:"106.206479,38.502621|12"},{n:"\u56fa\u539f",g:"106.285268,36.021523|13"},{n:"\u77f3\u5634\u5c71",g:"106.379337,39.020223|13"},{n:"\u5434\u5fe0",g:"106.208254,37.993561|14"},{n:"\u4e2d\u536b",g:"105.196754,37.521124|14"}]},{n:"\u9752\u6d77",g:"96.202544,35.499761|7",cities:[{n:"\u897f\u5b81",g:"101.767921,36.640739|12"},{n:"\u679c\u6d1b\u5dde",g:"100.223723,34.480485|11"},{n:"\u6d77\u4e1c\u5730\u533a",g:"102.085207,36.51761|11"},{n:"\u6d77\u5317\u5dde",g:"100.879802,36.960654|11"},{n:"\u6d77\u5357\u5dde",g:"100.624066,36.284364|11"},{n:"\u6d77\u897f\u5dde",g:"97.342625,37.373799|11"},{n:"\u9ec4\u5357\u5dde",g:"102.0076,35.522852|11"},{n:"\u7389\u6811\u5dde",g:"97.013316,33.00624|14"}]},{n:"\u5c71\u4e1c",g:"118.527663,36.09929|8",cities:[{n:"\u6d4e\u5357",g:"117.024967,36.682785|12"},{n:"\u6ee8\u5dde",g:"117.968292,37.405314|12"},{n:"\u4e1c\u8425",g:"118.583926,37.487121|12"},{n:"\u5fb7\u5dde",g:"116.328161,37.460826|12"},{n:"\u83cf\u6cfd",g:"115.46336,35.26244|13"},{n:"\u6d4e\u5b81",g:"116.600798,35.402122|13"},{n:"\u83b1\u829c",g:"117.684667,36.233654|13"},{n:"\u804a\u57ce",g:"115.986869,36.455829|12"},{n:"\u4e34\u6c82",g:"118.340768,35.072409|12"},{n:"\u9752\u5c9b",g:"120.384428,36.105215|12"},{n:"\u65e5\u7167",g:"119.50718,35.420225|12"},{n:"\u6cf0\u5b89",g:"117.089415,36.188078|13"},{n:"\u5a01\u6d77",g:"122.093958,37.528787|13"},{n:"\u6f4d\u574a",g:"119.142634,36.716115|12"},{n:"\u70df\u53f0",g:"121.309555,37.536562|12"},{n:"\u67a3\u5e84",g:"117.279305,34.807883|13"},{n:"\u6dc4\u535a",g:"118.059134,36.804685|12"}]},{n:"\u5c71\u897f",g:"112.515496,37.866566|7",cities:[{n:"\u592a\u539f",g:"112.550864,37.890277|12"},{n:"\u957f\u6cbb",g:"113.120292,36.201664|12"},{n:"\u5927\u540c",g:"113.290509,40.113744|12"},{n:"\u664b\u57ce",g:"112.867333,35.499834|13"},{n:"\u664b\u4e2d",g:"112.738514,37.693362|13"},{n:"\u4e34\u6c7e",g:"111.538788,36.099745|13"},{n:"\u5415\u6881",g:"111.143157,37.527316|14"},{n:"\u6714\u5dde",g:"112.479928,39.337672|13"},{n:"\u5ffb\u5dde",g:"112.727939,38.461031|12"},{n:"\u9633\u6cc9",g:"113.569238,37.869529|13"},{n:"\u8fd0\u57ce",g:"111.006854,35.038859|13"}]},{n:"\u9655\u897f",g:"109.503789,35.860026|7",cities:[{n:"\u897f\u5b89",g:"108.953098,34.2778|12"},{n:"\u5b89\u5eb7",g:"109.038045,32.70437|13"},{n:"\u5b9d\u9e21",g:"107.170645,34.364081|12"},{n:"\u6c49\u4e2d",g:"107.045478,33.081569|13"},{n:"\u5546\u6d1b",g:"109.934208,33.873907|13"},{n:"\u94dc\u5ddd",g:"108.968067,34.908368|13"},{n:"\u6e2d\u5357",g:"109.483933,34.502358|13"},{n:"\u54b8\u9633",g:"108.707509,34.345373|13"},{n:"\u5ef6\u5b89",g:"109.50051,36.60332|13"},{n:"\u6986\u6797",g:"109.745926,38.279439|12"}]},{n:"\u56db\u5ddd",g:"102.89916,30.367481|7",cities:[{n:"\u6210\u90fd",g:"104.067923,30.679943|12"},{n:"\u963f\u575d\u5dde",g:"102.228565,31.905763|15"},{n:"\u5df4\u4e2d",g:"106.757916,31.869189|14"},{n:"\u8fbe\u5dde",g:"107.494973,31.214199|14"},{n:"\u5fb7\u9633",g:"104.402398,31.13114|13"},{n:"\u7518\u5b5c\u5dde",g:"101.969232,30.055144|15"},{n:"\u5e7f\u5b89",g:"106.63572,30.463984|13"},{n:"\u5e7f\u5143",g:"105.819687,32.44104|13"},{n:"\u4e50\u5c71",g:"103.760824,29.600958|13"},{n:"\u51c9\u5c71\u5dde",g:"102.259591,27.892393|14"},{n:"\u6cf8\u5dde",g:"105.44397,28.89593|14"},{n:"\u5357\u5145",g:"106.105554,30.800965|13"},{n:"\u7709\u5c71",g:"103.84143,30.061115|13"},{n:"\u7ef5\u9633",g:"104.705519,31.504701|12"},{n:"\u5185\u6c5f",g:"105.073056,29.599462|13"},{n:"\u6500\u679d\u82b1",g:"101.722423,26.587571|14"},{n:"\u9042\u5b81",g:"105.564888,30.557491|12"},{n:"\u96c5\u5b89",g:"103.009356,29.999716|13"},{n:"\u5b9c\u5bbe",g:"104.633019,28.769675|13"},{n:"\u8d44\u9633",g:"104.63593,30.132191|13"},{n:"\u81ea\u8d21",g:"104.776071,29.359157|13"}]},{n:"\u897f\u85cf",g:"89.137982,31.367315|6",cities:[{n:"\u62c9\u8428",g:"91.111891,29.662557|13"},{n:"\u963f\u91cc\u5730\u533a",g:"81.107669,30.404557|11"},{n:"\u660c\u90fd\u5730\u533a",g:"97.185582,31.140576|15"},{n:"\u6797\u829d\u5730\u533a",g:"94.349985,29.666941|11"},{n:"\u90a3\u66f2\u5730\u533a",g:"92.067018,31.48068|14"},{n:"\u65e5\u5580\u5219\u5730\u533a",g:"88.891486,29.269023|14"},{n:"\u5c71\u5357\u5730\u533a",g:"91.750644,29.229027|11"}]},{n:"\u65b0\u7586",g:"85.614899,42.127001|6",cities:[{n:"\u4e4c\u9c81\u6728\u9f50",g:"87.564988,43.84038|12"},{n:"\u963f\u62c9\u5c14",g:"81.291737,40.61568|13"},{n:"\u963f\u514b\u82cf\u5730\u533a",g:"80.269846,41.171731|12"},{n:"\u963f\u52d2\u6cf0\u5730\u533a",g:"88.137915,47.839744|13"},{n:"\u5df4\u97f3\u90ed\u695e",g:"86.121688,41.771362|12"},{n:"\u535a\u5c14\u5854\u62c9\u5dde",g:"82.052436,44.913651|11"},{n:"\u660c\u5409\u5dde",g:"87.296038,44.007058|13"},{n:"\u54c8\u5bc6\u5730\u533a",g:"93.528355,42.858596|13"},{n:"\u548c\u7530\u5730\u533a",g:"79.930239,37.116774|13"},{n:"\u5580\u4ec0\u5730\u533a",g:"75.992973,39.470627|12"},{n:"\u514b\u62c9\u739b\u4f9d",g:"84.88118,45.594331|13"},{n:"\u514b\u5b5c\u52d2\u82cf\u5dde",g:"76.137564,39.750346|11"},{n:"\u77f3\u6cb3\u5b50",g:"86.041865,44.308259|13"},{n:"\u5854\u57ce\u5730\u533a",g:"82.974881,46.758684|12"},{n:"\u56fe\u6728\u8212\u514b",g:"79.198155,39.889223|13"},{n:"\u5410\u9c81\u756a\u5730\u533a",g:"89.181595,42.96047|13"},{n:"\u4e94\u5bb6\u6e20",g:"87.565449,44.368899|13"},{n:"\u4f0a\u7281\u5dde",g:"81.297854,43.922248|11"}]},{n:"\u4e91\u5357",g:"101.592952,24.864213|7",cities:[{n:"\u6606\u660e",g:"102.714601,25.049153|12"},{n:"\u4fdd\u5c71",g:"99.177996,25.120489|13"},{n:"\u695a\u96c4\u5dde",g:"101.529382,25.066356|13"},{n:"\u5927\u7406\u5dde",g:"100.223675,25.5969|14"},{n:"\u5fb7\u5b8f\u5dde",g:"98.589434,24.44124|14"},{n:"\u8fea\u5e86\u5dde",g:"99.713682,27.831029|14"},{n:"\u7ea2\u6cb3\u5dde",g:"103.384065,23.367718|11"},{n:"\u4e3d\u6c5f",g:"100.229628,26.875351|13"},{n:"\u4e34\u6ca7",g:"100.092613,23.887806|14"},{n:"\u6012\u6c5f\u5dde",g:"98.859932,25.860677|14"},{n:"\u666e\u6d31",g:"100.980058,22.788778|14"},{n:"\u66f2\u9756",g:"103.782539,25.520758|12"},{n:"\u662d\u901a",g:"103.725021,27.340633|13"},{n:"\u6587\u5c71",g:"104.089112,23.401781|14"},{n:"\u897f\u53cc\u7248\u7eb3",g:"100.803038,22.009433|13"},{n:"\u7389\u6eaa",g:"102.545068,24.370447|13"}]},{n:"\u6d59\u6c5f",g:"119.957202,29.159494|8",cities:[{n:"\u676d\u5dde",g:"120.219375,30.259244|12"},{n:"\u6e56\u5dde",g:"120.137243,30.877925|12"},{n:"\u5609\u5174",g:"120.760428,30.773992|13"},{n:"\u91d1\u534e",g:"119.652576,29.102899|12"},{n:"\u4e3d\u6c34",g:"119.929576,28.4563|13"},{n:"\u5b81\u6ce2",g:"121.579006,29.885259|12"},{n:"\u8862\u5dde",g:"118.875842,28.95691|12"},{n:"\u7ecd\u5174",g:"120.592467,30.002365|13"},{n:"\u53f0\u5dde",g:"121.440613,28.668283|13"},{n:"\u6e29\u5dde",g:"120.690635,28.002838|12"},{n:"\u821f\u5c71",g:"122.169872,30.03601|13"}]}],ro=[{n:"\u9999\u6e2f",g:"114.186124,22.293586|11"},{n:"\u6fb3\u95e8",g:"113.557519,22.204118|13"},{n:"\u53f0\u6e7e",g:"120.961454,23.80406|8"}],oo=void 0,ao=function(){if(void 0!==oo)return oo;var t=navigator.userAgent,e="Android;iPhone;SymbianOS;Windows Phone;iPad;iPod".split(";");oo=!1;for(var i=0;i<e.length;i++)if(0<t.indexOf(e[i])){oo=!0;break}return oo}(),so=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),uo=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),lo=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ho=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fo=Array(576);C(fo);var co=Array(60);C(co);var po=Array(512);C(po);var vo=Array(256);C(vo);var go=Array(29);C(go);var mo=Array(30);C(mo);var yo=void 0,xo=void 0,bo=void 0,_o=function(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},wo=function(t,e,i){t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,_o(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)},Ao=function(t,e,i){wo(t,i[2*e],i[2*e+1])},To=function(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(0<--e);return i>>>1},Mo=function(t,e,i){var n,r=Array(16),o=0;for(n=1;15>=n;n++)r[n]=o=o+i[n-1]<<1;for(i=0;i<=e;i++)o=t[2*i+1],0!==o&&(t[2*i]=To(r[o]++,o))},Po=function(t){var e;for(e=0;286>e;e++)t.dyn_ltree[2*e]=0;for(e=0;30>e;e++)t.dyn_dtree[2*e]=0;for(e=0;19>e;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},So=function(t){8<t.bi_valid?_o(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Eo=function(t,e,i,n){var r=2*e,o=2*i;return t[r]<t[o]||t[r]===t[o]&&n[e]<=n[i]},Co=function(t,e,i){for(var n=t.heap[i],r=i<<1;r<=t.heap_len;){if(r<t.heap_len&&Eo(e,t.heap[r+1],t.heap[r],t.depth)&&r++,Eo(e,n,t.heap[r],t.depth))break;t.heap[i]=t.heap[r],i=r,r<<=1}t.heap[i]=n},Lo=function(t,e,i){var n=0;if(0!==t.last_lit)do{var r=t.pending_buf[t.d_buf+2*n]<<8|t.pending_buf[t.d_buf+2*n+1],o=t.pending_buf[t.l_buf+n];if(n++,0===r)Ao(t,o,e);else{var a=vo[o];Ao(t,a+256+1,e);var s=so[a];0!==s&&(o-=go[a],wo(t,o,s)),r--,a=256>r?po[r]:po[256+(r>>>7)],Ao(t,a,i),s=uo[a],0!==s&&(r-=mo[a],wo(t,r,s))}}while(n<t.last_lit);Ao(t,256,e)},Ro=function(t,e){var i,n=e.dyn_tree,r=e.stat_desc.static_tree,o=e.stat_desc.has_stree,a=e.stat_desc.elems,s=-1;for(t.heap_len=0,t.heap_max=573,i=0;i<a;i++)0!==n[2*i]?(t.heap[++t.heap_len]=s=i,t.depth[i]=0):n[2*i+1]=0;for(;2>t.heap_len;){var u=t.heap[++t.heap_len]=2>s?++s:0;n[2*u]=1,t.depth[u]=0,t.opt_len--,o&&(t.static_len-=r[2*u+1])}for(e.max_code=s,i=t.heap_len>>1;1<=i;i--)Co(t,n,i);u=a;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Co(t,n,1),r=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=r,n[2*u]=n[2*i]+n[2*r],t.depth[u]=(t.depth[i]>=t.depth[r]?t.depth[i]:t.depth[r])+1,n[2*i+1]=n[2*r+1]=u,t.heap[1]=u++,Co(t,n,1)}while(2<=t.heap_len);t.heap[--t.heap_max]=t.heap[1],i=e.dyn_tree,u=e.max_code,r=e.stat_desc.static_tree,o=e.stat_desc.has_stree,a=e.stat_desc.extra_bits;var l,h=e.stat_desc.extra_base,f=e.stat_desc.max_length,c=0;for(l=0;15>=l;l++)t.bl_count[l]=0;for(i[2*t.heap[t.heap_max]+1]=0,e=t.heap_max+1;573>e;e++){var p=t.heap[e];if(l=i[2*i[2*p+1]+1]+1,l>f&&(l=f,c++),i[2*p+1]=l,!(p>u)){t.bl_count[l]++;var d=0;p>=h&&(d=a[p-h]);var v=i[2*p];t.opt_len+=v*(l+d),o&&(t.static_len+=v*(r[2*p+1]+d))}}if(0!==c){do{for(l=f-1;0===t.bl_count[l];)l--;t.bl_count[l]--,t.bl_count[l+1]+=2,t.bl_count[f]--,c-=2}while(0<c);for(l=f;0!==l;l--)for(p=t.bl_count[l];0!==p;)r=t.heap[--e],r>u||(i[2*r+1]!==l&&(t.opt_len+=(l-i[2*r+1])*i[2*r],i[2*r+1]=l),p--)}Mo(n,s,t.bl_count)},ko=function(t,e,i){var n,r=-1,o=e[1],a=0,s=7,u=4;for(0===o&&(s=138,u=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++){var l=o;o=e[2*(n+1)+1],++a<s&&l===o||(a<u?t.bl_tree[2*l]+=a:0!==l?(l!==r&&t.bl_tree[2*l]++,t.bl_tree[32]++):10>=a?t.bl_tree[34]++:t.bl_tree[36]++,a=0,r=l,0===o?(s=138,u=3):l===o?(s=6,u=3):(s=7,u=4))}},Oo=function(t,e,i){var n,r=-1,o=e[1],a=0,s=7,u=4;for(0===o&&(s=138,u=3),n=0;n<=i;n++){var l=o;if(o=e[2*(n+1)+1],!(++a<s&&l===o)){if(a<u)do{Ao(t,l,t.bl_tree)}while(0!==--a);else 0!==l?(l!==r&&(Ao(t,l,t.bl_tree),a--),Ao(t,16,t.bl_tree),wo(t,a-3,2)):10>=a?(Ao(t,17,t.bl_tree),wo(t,a-3,3)):(Ao(t,18,t.bl_tree),wo(t,a-11,7));a=0,r=l,0===o?(s=138,u=3):l===o?(s=6,u=3):(s=7,u=4)}}},Do=function(t){var e,i=4093624447;for(e=0;31>=e;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;256>e;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0},Bo=!1,zo=function(t,e,i,n){wo(t,n?1:0,3),So(t),_o(t,i),_o(t,~i),t.pending_buf.set(t.window.subarray(e,e+i),t.pending),t.pending+=i},Fo=function(t,e,i,n){var r,o=65535&t|0;for(t=t>>>16&65535|0;0!==i;){r=2e3<i?2e3:i,i-=r;do{o=o+e[n++]|0,t=t+o|0}while(--r);o%=65521,t%=65521}return o|t<<16|0},Io=new Uint32Array(function(){for(var t,e=[],i=0;256>i;i++){t=i;for(var n=0;8>n;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}()),Uo=function(t,e,i,n){for(i=n+i,t^=-1;n<i;n++)t=t>>>8^Io[255&(t^e[n])];return-1^t},No={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},jo={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Ho=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(vo[i]+256+1)]++,t.dyn_dtree[2*(256>e?po[e]:po[256+(e>>>7)])]++),t.last_lit===t.lit_bufsize-1},Wo=jo.Z_NO_FLUSH,Zo=jo.Z_PARTIAL_FLUSH,Yo=jo.Z_FULL_FLUSH,Xo=jo.Z_FINISH,Vo=jo.Z_BLOCK,Go=jo.Z_OK,qo=jo.Z_STREAM_END,Ko=jo.Z_STREAM_ERROR,Qo=jo.Z_DATA_ERROR,Jo=jo.Z_BUF_ERROR,$o=jo.Z_DEFAULT_COMPRESSION,ta=jo.Z_FILTERED,ea=jo.Z_HUFFMAN_ONLY,ia=jo.Z_RLE,na=jo.Z_FIXED,ra=jo.Z_DEFAULT_STRATEGY,oa=jo.Z_UNKNOWN,aa=jo.Z_DEFLATED,sa=function(t,e){return t.msg=No[e],e},ua=function(t){for(var e=t.length;0<=--e;)t[e]=0},la=function(t,e,i){return(e<<t.hash_shift^i)&t.hash_mask},ha=function(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+i),t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))},fa=function(t,e){var i=0<=t.block_start?t.block_start:-1,n=t.strstart-t.block_start,r=0;if(0<t.level){for(2===t.strm.data_type&&(t.strm.data_type=Do(t)),Ro(t,t.l_desc),Ro(t,t.d_desc),ko(t,t.dyn_ltree,t.l_desc.max_code),ko(t,t.dyn_dtree,t.d_desc.max_code),Ro(t,t.bl_desc),r=18;3<=r&&0===t.bl_tree[2*ho[r]+1];r--);t.opt_len+=3*(r+1)+14;var o=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3;a<=o&&(o=a)}else o=a=n+5;if(n+4<=o&&-1!==i)zo(t,i,n,e);else if(4===t.strategy||a===o)wo(t,2+(e?1:0),3),Lo(t,fo,co);else{for(wo(t,4+(e?1:0),3),i=t.l_desc.max_code+1,n=t.d_desc.max_code+1,r+=1,wo(t,i-257,5),wo(t,n-1,5),wo(t,r-4,4),o=0;o<r;o++)wo(t,t.bl_tree[2*ho[o]+1],3);Oo(t,t.dyn_ltree,i-1),Oo(t,t.dyn_dtree,n-1),Lo(t,t.dyn_ltree,t.dyn_dtree)}Po(t),e&&So(t),t.block_start=t.strstart,ha(t.strm)},ca=function(t,e){t.pending_buf[t.pending++]=e},pa=function(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},da=function(t,e){var i=t.max_chain_length,n=t.strstart,r=t.prev_length,o=t.nice_match,a=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,s=t.window,u=t.w_mask,l=t.prev,h=t.strstart+258,f=s[n+r-1],c=s[n+r];t.prev_length>=t.good_match&&(i>>=2),o>t.lookahead&&(o=t.lookahead);do{var p=e;if(s[p+r]===c&&s[p+r-1]===f&&s[p]===s[n]&&s[++p]===s[n+1]){for(n+=2,p++;s[++n]===s[++p]&&s[++n]===s[++p]&&s[++n]===s[++p]&&s[++n]===s[++p]&&s[++n]===s[++p]&&s[++n]===s[++p]&&s[++n]===s[++p]&&s[++n]===s[++p]&&n<h;);if(p=258-(h-n),n=h-258,p>r){if(t.match_start=e,r=p,p>=o)break;f=s[n+r-1],c=s[n+r]}}}while((e=l[e&u])>a&&0!==--i);return r<=t.lookahead?r:t.lookahead},va=function(t){var e,i=t.w_size;do{var n=t.window_size-t.lookahead-t.strstart;if(t.strstart>=i+(i-262)){t.window.set(t.window.subarray(i,i+i),0),t.match_start-=i,t.strstart-=i,t.block_start-=i;var r=e=t.hash_size;do{var o=t.head[--r];t.head[r]=o>=i?o-i:0}while(--e);r=e=i;do{o=t.prev[--r],t.prev[r]=o>=i?o-i:0}while(--e);n+=i}if(0===t.strm.avail_in)break;r=t.strm,e=t.window,o=t.strstart+t.lookahead;var a=r.avail_in;if(a>n&&(a=n),0===a?e=0:(r.avail_in-=a,e.set(r.input.subarray(r.next_in,r.next_in+a),o),1===r.state.wrap?r.adler=Fo(r.adler,e,a,o):2===r.state.wrap&&(r.adler=Uo(r.adler,e,a,o)),r.next_in+=a,r.total_in+=a,e=a),t.lookahead+=e,3<=t.lookahead+t.insert)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=la(t,t.ins_h,t.window[n+1]);t.insert&&(t.ins_h=la(t,t.ins_h,t.window[n+3-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(3>t.lookahead+t.insert)););}while(262>t.lookahead&&0!==t.strm.avail_in)},ga=function(t,e){for(var i;;){if(262>t.lookahead){if(va(t),262>t.lookahead&&e===Wo)return 1;if(0===t.lookahead)break}if(i=0,3<=t.lookahead&&(t.ins_h=la(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-262&&(t.match_length=da(t,i)),3<=t.match_length)if(i=Ho(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&3<=t.lookahead){t.match_length--;do{t.strstart++,t.ins_h=la(t,t.ins_h,t.window[t.strstart+3-1]),t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=la(t,t.ins_h,t.window[t.strstart+1]);else i=Ho(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(fa(t,!1),0===t.strm.avail_out))return 1}return t.insert=2>t.strstart?t.strstart:2,e===Xo?(fa(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(fa(t,!1),0===t.strm.avail_out)?1:2},ma=function(t,e){for(var i,n;;){if(262>t.lookahead){if(va(t),262>t.lookahead&&e===Wo)return 1;if(0===t.lookahead)break}if(i=0,3<=t.lookahead&&(t.ins_h=la(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-262&&(t.match_length=da(t,i),5>=t.match_length&&(t.strategy===ta||3===t.match_length&&4096<t.strstart-t.match_start)&&(t.match_length=2)),3<=t.prev_length&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-3,i=Ho(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=la(t,t.ins_h,t.window[t.strstart+3-1]),t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(fa(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((i=Ho(t,0,t.window[t.strstart-1]))&&fa(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(Ho(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=2>t.strstart?t.strstart:2,e===Xo?(fa(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(fa(t,!1),0===t.strm.avail_out)?1:2},ya=function(t,e){for(var i,n,r,o=t.window;;){if(258>=t.lookahead){if(va(t),258>=t.lookahead&&e===Wo)return 1;if(0===t.lookahead)break}if(t.match_length=0,3<=t.lookahead&&0<t.strstart&&(n=t.strstart-1,i=o[n],i===o[++n]&&i===o[++n]&&i===o[++n])){for(r=t.strstart+258;i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&n<r;);t.match_length=258-(r-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(3<=t.match_length?(i=Ho(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=Ho(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(fa(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Xo?(fa(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(fa(t,!1),0===t.strm.avail_out)?1:2},xa=function(t,e){for(var i;;){if(0===t.lookahead&&(va(t),0===t.lookahead)){if(e===Wo)return 1;break}if(t.match_length=0,i=Ho(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(fa(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Xo?(fa(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(fa(t,!1),0===t.strm.avail_out)?1:2},ba=[new k(0,0,0,0,(function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(1>=t.lookahead){if(va(t),0===t.lookahead&&e===Wo)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,fa(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(fa(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Xo?(fa(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&fa(t,!1),1)})),new k(4,4,8,4,ga),new k(4,5,16,8,ga),new k(4,6,32,32,ga),new k(4,4,16,16,ma),new k(8,16,32,32,ma),new k(8,16,128,128,ma),new k(8,32,128,256,ma),new k(32,128,258,1024,ma),new k(32,258,258,4096,ma)],_a=function(t){if(!t||!t.state)return sa(t,Ko);t.total_in=t.total_out=0,t.data_type=oa;var e=t.state;if(e.pending=0,e.pending_out=0,0>e.wrap&&(e.wrap=-e.wrap),e.status=e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=Wo,!Bo){var i,n,r;for(t=Array(16),r=n=0;28>r;r++)for(go[r]=n,i=0;i<1<<so[r];i++)vo[n++]=r;for(vo[n-1]=r,r=n=0;16>r;r++)for(mo[r]=n,i=0;i<1<<uo[r];i++)po[n++]=r;for(n>>=7;30>r;r++)for(mo[r]=n<<7,i=0;i<1<<uo[r]-7;i++)po[256+n++]=r;for(i=0;15>=i;i++)t[i]=0;for(i=0;143>=i;)fo[2*i+1]=8,i++,t[8]++;for(;255>=i;)fo[2*i+1]=9,i++,t[9]++;for(;279>=i;)fo[2*i+1]=7,i++,t[7]++;for(;287>=i;)fo[2*i+1]=8,i++,t[8]++;for(Mo(fo,287,t),i=0;30>i;i++)co[2*i+1]=5,co[2*i]=To(i,5);yo=new L(fo,so,257,286,15),xo=new L(co,uo,0,30,15),bo=new L([],lo,0,19,7),Bo=!0}return e.l_desc=new R(e.dyn_ltree,yo),e.d_desc=new R(e.dyn_dtree,xo),e.bl_desc=new R(e.bl_tree,bo),e.bi_buf=0,e.bi_valid=0,Po(e),Go},wa=function(t){var e=_a(t);return e===Go&&(t=t.state,t.window_size=2*t.w_size,ua(t.head),t.max_lazy_match=ba[t.level].max_lazy,t.good_match=ba[t.level].good_length,t.nice_match=ba[t.level].nice_length,t.max_chain_length=ba[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),e},Aa=function(t,e,i,n,r,o){if(!t)return Ko;var a=1;if(e===$o&&(e=6),0>n?(a=0,n=-n):15<n&&(a=2,n-=16),1>r||9<r||i!==aa||8>n||15<n||0>e||9<e||0>o||o>na)return sa(t,Ko);8===n&&(n=9);var s=new O;return t.state=s,s.strm=t,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=e,s.strategy=o,s.method=i,wa(t)},Ta={deflateInit:function(t,e){return Aa(t,e,aa,15,8,ra)},deflateInit2:Aa,deflateReset:wa,deflateResetKeep:_a,deflateSetHeader:function(t,e){return t&&t.state&&2===t.state.wrap?(t.state.gzhead=e,Go):Ko},deflate:function(t,e){if(!t||!t.state||e>Vo||0>e)return t?sa(t,Ko):Ko;var i=t.state;if(!t.output||!t.input&&0!==t.avail_in||666===i.status&&e!==Xo)return sa(t,0===t.avail_out?Jo:Ko);i.strm=t;var n=i.last_flush;if(i.last_flush=e,42===i.status)if(2===i.wrap)t.adler=0,ca(i,31),ca(i,139),ca(i,8),i.gzhead?(ca(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),ca(i,255&i.gzhead.time),ca(i,i.gzhead.time>>8&255),ca(i,i.gzhead.time>>16&255),ca(i,i.gzhead.time>>24&255),ca(i,9===i.level?2:i.strategy>=ea||2>i.level?4:0),ca(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(ca(i,255&i.gzhead.extra.length),ca(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=Uo(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(ca(i,0),ca(i,0),ca(i,0),ca(i,0),ca(i,0),ca(i,9===i.level?2:i.strategy>=ea||2>i.level?4:0),ca(i,3),i.status=113);else{var r=aa+(i.w_bits-8<<4)<<8;r|=(i.strategy>=ea||2>i.level?0:6>i.level?1:6===i.level?2:3)<<6,0!==i.strstart&&(r|=32),i.status=113,pa(i,r+(31-r%31)),0!==i.strstart&&(pa(i,t.adler>>>16),pa(i,65535&t.adler)),t.adler=1}if(69===i.status)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>r&&(t.adler=Uo(t.adler,i.pending_buf,i.pending-r,r)),ha(t),r=i.pending,i.pending!==i.pending_buf_size));)ca(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(t.adler=Uo(t.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=Uo(t.adler,i.pending_buf,i.pending-r,r)),ha(t),r=i.pending,i.pending===i.pending_buf_size)){var o=1;break}o=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,ca(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>r&&(t.adler=Uo(t.adler,i.pending_buf,i.pending-r,r)),0===o&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(t.adler=Uo(t.adler,i.pending_buf,i.pending-r,r)),ha(t),r=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,ca(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>r&&(t.adler=Uo(t.adler,i.pending_buf,i.pending-r,r)),0===o&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ha(t),i.pending+2<=i.pending_buf_size&&(ca(i,255&t.adler),ca(i,t.adler>>8&255),t.adler=0,i.status=113)):i.status=113),0!==i.pending){if(ha(t),0===t.avail_out)return i.last_flush=-1,Go}else if(0===t.avail_in&&(e<<1)-(4<e?9:0)<=(n<<1)-(4<n?9:0)&&e!==Xo)return sa(t,Jo);if(666===i.status&&0!==t.avail_in)return sa(t,Jo);if(0!==t.avail_in||0!==i.lookahead||e!==Wo&&666!==i.status){if(n=i.strategy===ea?xa(i,e):i.strategy===ia?ya(i,e):ba[i.level].func(i,e),3!==n&&4!==n||(i.status=666),1===n||3===n)return 0===t.avail_out&&(i.last_flush=-1),Go;if(2===n&&(e===Zo?(wo(i,2,3),Ao(i,256,fo),16===i.bi_valid?(_o(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):8<=i.bi_valid&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)):e!==Vo&&(zo(i,0,0,!1),e===Yo&&(ua(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ha(t),0===t.avail_out))return i.last_flush=-1,Go}return e!==Xo?Go:0>=i.wrap?qo:(2===i.wrap?(ca(i,255&t.adler),ca(i,t.adler>>8&255),ca(i,t.adler>>16&255),ca(i,t.adler>>24&255),ca(i,255&t.total_in),ca(i,t.total_in>>8&255),ca(i,t.total_in>>16&255),ca(i,t.total_in>>24&255)):(pa(i,t.adler>>>16),pa(i,65535&t.adler)),ha(t),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?Go:qo)},deflateEnd:function(t){if(!t||!t.state)return Ko;var e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&103!==e&&113!==e&&666!==e?sa(t,Ko):(t.state=null,113===e?sa(t,Qo):Go)},deflateSetDictionary:function(t,e){var i=e.length;if(!t||!t.state)return Ko;var n=t.state,r=n.wrap;if(2===r||1===r&&42!==n.status||n.lookahead)return Ko;if(1===r&&(t.adler=Fo(t.adler,e,i,0)),n.wrap=0,i>=n.w_size){0===r&&(ua(n.head),n.strstart=0,n.block_start=0,n.insert=0);var o=new Uint8Array(n.w_size);o.set(e.subarray(i-n.w_size,i),0),e=o,i=n.w_size}o=t.avail_in;var a=t.next_in,s=t.input;for(t.avail_in=i,t.next_in=0,t.input=e,va(n);3<=n.lookahead;){e=n.strstart,i=n.lookahead-2;do{n.ins_h=la(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--i);n.strstart=e,n.lookahead=2,va(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=a,t.input=s,t.avail_in=o,n.wrap=r,Go},deflateInfo:"pako deflate (from Nodeca project)"},Ma={assign:function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!==("undefined"===typeof i?"undefined":qn(i)))throw new TypeError(i+"must be non-object");for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}return t},flattenChunks:function(t){for(var e=0,i=0,n=t.length;i<n;i++)e+=t[i].length;e=new Uint8Array(e),n=i=0;for(var r=t.length;i<r;i++){var o=t[i];e.set(o,n),n+=o.length}return e}},Pa=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Rf){Pa=!1}for(var Sa=new Uint8Array(256),Ea=0;256>Ea;Ea++)Sa[Ea]=252<=Ea?6:248<=Ea?5:240<=Ea?4:224<=Ea?3:192<=Ea?2:1;Sa[254]=Sa[254]=1;var Ca={string2buf:function(t){var e,i,n=t.length,r=0;for(e=0;e<n;e++){var o=t.charCodeAt(e);if(55296===(64512&o)&&e+1<n){var a=t.charCodeAt(e+1);56320===(64512&a)&&(o=65536+(o-55296<<10)+(a-56320),e++)}r+=128>o?1:2048>o?2:65536>o?3:4}var s=new Uint8Array(r);for(e=i=0;i<r;e++)o=t.charCodeAt(e),55296===(64512&o)&&e+1<n&&(a=t.charCodeAt(e+1),56320===(64512&a)&&(o=65536+(o-55296<<10)+(a-56320),e++)),128>o?s[i++]=o:(2048>o?s[i++]=192|o>>>6:(65536>o?s[i++]=224|o>>>12:(s[i++]=240|o>>>18,s[i++]=128|o>>>12&63),s[i++]=128|o>>>6&63),s[i++]=128|63&o);return s},buf2string:function(t,e){var i,n,r=e||t.length;for(e=Array(2*r),i=n=0;i<r;){var o=t[i++];if(128>o)e[n++]=o;else{var a=Sa[o];if(4<a)e[n++]=65533,i+=a-1;else{for(o&=2===a?31:3===a?15:7;1<a&&i<r;)o=o<<6|63&t[i++],a--;1<a?e[n++]=65533:65536>o?e[n++]=o:(o-=65536,e[n++]=55296|o>>10&1023,e[n++]=56320|1023&o)}}}if(t=n,65534>t&&e.subarray&&Pa)e=String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));else{for(i="",n=0;n<t;n++)i+=String.fromCharCode(e[n]);e=i}return e},utf8border:function(t,e){e=e||t.length,e>t.length&&(e=t.length);for(var i=e-1;0<=i&&128===(192&t[i]);)i--;return 0>i||0===i?e:i+Sa[t[i]]>e?i:e}},La=function(){this.input=null,this.total_in=this.avail_in=this.next_in=0,this.output=null,this.total_out=this.avail_out=this.next_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Ra=Object.prototype.toString,ka=jo.Z_NO_FLUSH,Oa=jo.Z_SYNC_FLUSH,Da=jo.Z_FULL_FLUSH,Ba=jo.Z_FINISH,za=jo.Z_OK,Fa=jo.Z_STREAM_END,Ia=jo.Z_DEFAULT_COMPRESSION,Ua=jo.Z_DEFAULT_STRATEGY,Na=jo.Z_DEFLATED;D.prototype.push=function(t,e){var i=this.strm,n=this.options.chunkSize;if(this.ended)return!1;for(e=e===~~e?e:!0===e?Ba:ka,"string"===typeof t?i.input=Ca.string2buf(t):"[object ArrayBuffer]"===Ra.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),(e===Oa||e===Da)&&6>=i.avail_out)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(t=Ta.deflate(i,e),t===Fa)return 0<i.next_out&&this.onData(i.output.subarray(0,i.next_out)),t=Ta.deflateEnd(this.strm),this.onEnd(t),this.ended=!0,t===za;if(0===i.avail_out)this.onData(i.output);else if(0<e&&0<i.next_out)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}return!0},D.prototype.onData=function(t){this.chunks.push(t)},D.prototype.onEnd=function(t){t===za&&(this.result=Ma.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var ja=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ha=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Wa=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Za=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Ya=function(t,e,i,n,r,o,a,s){var u,l,h,f,c,p,d,v=s.bits,g=0,m=new Uint16Array(16),y=new Uint16Array(16),x=0;for(u=0;15>=u;u++)m[u]=0;for(l=0;l<n;l++)m[e[i+l]]++;var b=v;for(h=15;1<=h&&0===m[h];h--);if(b>h&&(b=h),0===h)return r[o++]=20971520,r[o++]=20971520,s.bits=1,0;for(v=1;v<h&&0===m[v];v++);for(b<v&&(b=v),u=f=1;15>=u;u++)if(f<<=1,f-=m[u],0>f)return-1;if(0<f&&(0===t||1!==h))return-1;for(y[1]=0,u=1;15>u;u++)y[u+1]=y[u]+m[u];for(l=0;l<n;l++)0!==e[i+l]&&(a[y[e[i+l]]++]=l);if(0===t)var _=d=a,w=19;else 1===t?(_=ja,g-=257,d=Ha,x-=257,w=256):(_=Wa,d=Za,w=-1);l=c=0,u=v;var A=o;n=b,y=0;var T=-1,M=1<<b,P=M-1;if(1===t&&852<M||2===t&&592<M)return 1;for(;;){var S=u-y;if(a[l]<w)var E=0,C=a[l];else a[l]>w?(E=d[x+a[l]],C=_[g+a[l]]):(E=96,C=0);f=1<<u-y,v=p=1<<n;do{p-=f,r[A+(c>>y)+p]=S<<24|E<<16|C|0}while(0!==p);for(f=1<<u-1;c&f;)f>>=1;if(0!==f?(c&=f-1,c+=f):c=0,l++,0===--m[u]){if(u===h)break;u=e[i+a[l]]}if(u>b&&(c&P)!==T){for(0===y&&(y=b),A+=v,n=u-y,f=1<<n;n+y<h;){if(f-=m[n+y],0>=f)break;n++,f<<=1}if(M+=1<<n,1===t&&852<M||2===t&&592<M)return 1;T=c&P,r[T]=b<<24|n<<16|A-o|0}}return 0!==c&&(r[A+c]=u-y<<24|4194304),s.bits=b,0},Xa=jo.Z_FINISH,Va=jo.Z_BLOCK,Ga=jo.Z_TREES,qa=jo.Z_OK,Ka=jo.Z_STREAM_END,Qa=jo.Z_NEED_DICT,Ja=jo.Z_STREAM_ERROR,$a=jo.Z_DATA_ERROR,ts=jo.Z_MEM_ERROR,es=jo.Z_BUF_ERROR,is=jo.Z_DEFLATED,ns=function(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)},rs=function(t){if(!t||!t.state)return Ja;var e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,qa},os=function(t){if(!t||!t.state)return Ja;var e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,rs(t)},as=function(t,e){if(!t||!t.state)return Ja;var i=t.state;if(0>e){var n=0;e=-e}else n=1+(e>>4),48>e&&(e&=15);return e&&(8>e||15<e)?Ja:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,os(t))},ss=function(t,e){if(!t)return Ja;var i=new z;return t.state=i,i.window=null,e=as(t,e),e!==qa&&(t.state=null),e},us=!0,ls=void 0,hs=void 0,fs=function(t,e,i,n){var r=t.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(e.subarray(i-r.wsize,i),0),r.wnext=0,r.whave=r.wsize):(t=r.wsize-r.wnext,t>n&&(t=n),r.window.set(e.subarray(i-n,i-n+t),r.wnext),(n-=t)?(r.window.set(e.subarray(i-n,i),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=t,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=t))),0},cs={inflateReset:os,inflateReset2:as,inflateResetKeep:rs,inflateInit:function(t){return ss(t,15)},inflateInit2:ss,inflate:function(t,e){var i=new Uint8Array(4),n=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return Ja;var r=t.state;12===r.mode&&(r.mode=13);var o=t.next_out,a=t.output,s=t.avail_out,u=t.next_in,l=t.input,h=t.avail_in,f=r.hold,c=r.bits,p=h,d=s,v=qa;t:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;16>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(2&r.wrap&&35615===f){r.check=0,i[0]=255&f,i[1]=f>>>8&255,r.check=Uo(r.check,i,2,0),c=f=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&f)<<8)+(f>>8))%31){t.msg="incorrect header check",r.mode=30;break}if((15&f)!==is){t.msg="unknown compression method",r.mode=30;break}f>>>=4,c-=4;var g=8+(15&f);if(0===r.wbits)r.wbits=g;else if(g>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<r.wbits,t.adler=r.check=1,r.mode=512&f?10:12,c=f=0;break;case 2:for(;16>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(r.flags=f,(255&r.flags)!==is){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=f>>8&1),512&r.flags&&(i[0]=255&f,i[1]=f>>>8&255,r.check=Uo(r.check,i,2,0)),c=f=0,r.mode=3;case 3:for(;32>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}r.head&&(r.head.time=f),512&r.flags&&(i[0]=255&f,i[1]=f>>>8&255,i[2]=f>>>16&255,i[3]=f>>>24&255,r.check=Uo(r.check,i,4,0)),c=f=0,r.mode=4;case 4:for(;16>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}r.head&&(r.head.xflags=255&f,r.head.os=f>>8),512&r.flags&&(i[0]=255&f,i[1]=f>>>8&255,r.check=Uo(r.check,i,2,0)),c=f=0,r.mode=5;case 5:if(1024&r.flags){for(;16>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}r.length=f,r.head&&(r.head.extra_len=f),512&r.flags&&(i[0]=255&f,i[1]=f>>>8&255,r.check=Uo(r.check,i,2,0)),c=f=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags){var m=r.length;if(m>h&&(m=h),m&&(r.head&&(g=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(l.subarray(u,u+m),g)),512&r.flags&&(r.check=Uo(r.check,l,m,u)),h-=m,u+=m,r.length-=m),r.length)break t}r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===h)break t;m=0;do{g=l[u+m++],r.head&&g&&65536>r.length&&(r.head.name+=String.fromCharCode(g))}while(g&&m<h);if(512&r.flags&&(r.check=Uo(r.check,l,m,u)),h-=m,u+=m,g)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===h)break t;m=0;do{g=l[u+m++],r.head&&g&&65536>r.length&&(r.head.comment+=String.fromCharCode(g))}while(g&&m<h);if(512&r.flags&&(r.check=Uo(r.check,l,m,u)),h-=m,u+=m,g)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;16>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(f!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}c=f=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;32>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}t.adler=r.check=ns(f),c=f=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=o,t.avail_out=s,t.next_in=u,t.avail_in=h,r.hold=f,r.bits=c,Qa;t.adler=r.check=1,r.mode=12;case 12:if(e===Va||e===Ga)break t;case 13:if(r.last){f>>>=7&c,c-=7&c,r.mode=27;break}for(;3>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}switch(r.last=1&f,f>>>=1,--c,3&f){case 0:r.mode=14;break;case 1:if(m=r,us){for(ls=new Int32Array(512),hs=new Int32Array(32),g=0;144>g;)m.lens[g++]=8;for(;256>g;)m.lens[g++]=9;for(;280>g;)m.lens[g++]=7;for(;288>g;)m.lens[g++]=8;for(Ya(1,m.lens,0,288,ls,0,m.work,{bits:9}),g=0;32>g;)m.lens[g++]=5;Ya(2,m.lens,0,32,hs,0,m.work,{bits:5}),us=!1}if(m.lencode=ls,m.lenbits=9,m.distcode=hs,m.distbits=5,r.mode=20,e===Ga){f>>>=2,c-=2;break t}break;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}f>>>=2,c-=2;break;case 14:for(f>>>=7&c,c-=7&c;32>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if((65535&f)!==(f>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&f,c=f=0,r.mode=15,e===Ga)break t;case 15:r.mode=16;case 16:if(m=r.length){if(m>h&&(m=h),m>s&&(m=s),0===m)break t;a.set(l.subarray(u,u+m),o),h-=m,u+=m,s-=m,o+=m,r.length-=m;break}r.mode=12;break;case 17:for(;14>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(r.nlen=257+(31&f),f>>>=5,c-=5,r.ndist=1+(31&f),f>>>=5,c-=5,r.ncode=4+(15&f),f>>>=4,c-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;3>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}r.lens[n[r.have++]]=7&f,f>>>=3,c-=3}for(;19>r.have;)r.lens[n[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,m={bits:r.lenbits},v=Ya(0,r.lens,0,19,r.lencode,0,r.work,m),r.lenbits=m.bits,v){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;;){var y=r.lencode[f&(1<<r.lenbits)-1];if(m=y>>>24,y&=65535,m<=c)break;if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(16>y)f>>>=m,c-=m,r.lens[r.have++]=y;else{if(16===y){for(g=m+2;c<g;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(f>>>=m,c-=m,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}g=r.lens[r.have-1],m=3+(3&f),f>>>=2,c-=2}else if(17===y){for(g=m+3;c<g;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}f>>>=m,c-=m,g=0,m=3+(7&f),f>>>=3,c-=3}else{for(g=m+7;c<g;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}f>>>=m,c-=m,g=0,m=11+(127&f),f>>>=7,c-=7}if(r.have+m>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;m--;)r.lens[r.have++]=g}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,m={bits:r.lenbits},v=Ya(1,r.lens,0,r.nlen,r.lencode,0,r.work,m),r.lenbits=m.bits,v){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,m={bits:r.distbits},v=Ya(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,m),r.distbits=m.bits,v){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,e===Ga)break t;case 20:r.mode=21;case 21:if(6<=h&&258<=s){t.next_out=o,t.avail_out=s,t.next_in=u,t.avail_in=h,r.hold=f,r.bits=c,l=t;var x=l.state;a=l.next_in;var b=l.input;u=a+(l.avail_in-5),o=l.next_out;var _=l.output;h=o-(d-l.avail_out),s=o+(l.avail_out-257),f=x.dmax,c=x.wsize,m=x.whave,g=x.wnext;var w=x.window,A=x.hold,T=x.bits;y=x.lencode;var M=x.distcode,P=(1<<x.lenbits)-1,S=(1<<x.distbits)-1;e:do{15>T&&(A+=b[a++]<<T,T+=8,A+=b[a++]<<T,T+=8);var E=y[A&P];i:for(;;){var C=E>>>24;if(A>>>=C,T-=C,C=E>>>16&255,0===C)_[o++]=65535&E;else{if(!(16&C)){if(0===(64&C)){E=y[(65535&E)+(A&(1<<C)-1)];continue i}32&C?x.mode=12:(l.msg="invalid literal/length code",x.mode=30);break e}var L=65535&E;(C&=15)&&(T<C&&(A+=b[a++]<<T,T+=8),L+=A&(1<<C)-1,A>>>=C,T-=C),15>T&&(A+=b[a++]<<T,T+=8,A+=b[a++]<<T,T+=8),E=M[A&S];n:for(;;){if(C=E>>>24,A>>>=C,T-=C,C=E>>>16&255,!(16&C)){if(0===(64&C)){E=M[(65535&E)+(A&(1<<C)-1)];continue n}l.msg="invalid distance code",x.mode=30;break e}if(E&=65535,C&=15,T<C&&(A+=b[a++]<<T,T+=8,T<C&&(A+=b[a++]<<T,T+=8)),E+=A&(1<<C)-1,E>f){l.msg="invalid distance too far back",x.mode=30;break e}if(A>>>=C,T-=C,C=o-h,E>C){if(C=E-C,C>m&&x.sane){l.msg="invalid distance too far back",x.mode=30;break e}var R=0,k=w;if(0===g){if(R+=c-C,C<L){L-=C;do{_[o++]=w[R++]}while(--C);R=o-E,k=_}}else if(g<C){if(R+=c+g-C,C-=g,C<L){L-=C;do{_[o++]=w[R++]}while(--C);if(R=0,g<L){C=g,L-=C;do{_[o++]=w[R++]}while(--C);R=o-E,k=_}}}else if(R+=g-C,C<L){L-=C;do{_[o++]=w[R++]}while(--C);R=o-E,k=_}for(;2<L;)_[o++]=k[R++],_[o++]=k[R++],_[o++]=k[R++],L-=3;L&&(_[o++]=k[R++],1<L&&(_[o++]=k[R++]))}else{R=o-E;do{_[o++]=_[R++],_[o++]=_[R++],_[o++]=_[R++],L-=3}while(2<L);L&&(_[o++]=_[R++],1<L&&(_[o++]=_[R++]))}break}}break}}while(a<u&&o<s);L=T>>3,a-=L,T-=L<<3,l.next_in=a,l.next_out=o,l.avail_in=a<u?u-a+5:5-(a-u),l.avail_out=o<s?s-o+257:257-(o-s),x.hold=A&(1<<T)-1,x.bits=T,o=t.next_out,a=t.output,s=t.avail_out,u=t.next_in,l=t.input,h=t.avail_in,f=r.hold,c=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;;){if(y=r.lencode[f&(1<<r.lenbits)-1],m=y>>>24,g=y>>>16&255,y&=65535,m<=c)break;if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(g&&0===(240&g)){for(w=m,A=g,T=y;;){if(y=r.lencode[T+((f&(1<<w+A)-1)>>w)],m=y>>>24,g=y>>>16&255,y&=65535,w+m<=c)break;if(0===h)break t;h--,f+=l[u++]<<c,c+=8}f>>>=w,c-=w,r.back+=w}if(f>>>=m,c-=m,r.back+=m,r.length=y,0===g){r.mode=26;break}if(32&g){r.back=-1,r.mode=12;break}if(64&g){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&g,r.mode=22;case 22:if(r.extra){for(g=r.extra;c<g;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}r.length+=f&(1<<r.extra)-1,f>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;;){if(y=r.distcode[f&(1<<r.distbits)-1],m=y>>>24,g=y>>>16&255,y&=65535,m<=c)break;if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(0===(240&g)){for(w=m,A=g,T=y;;){if(y=r.distcode[T+((f&(1<<w+A)-1)>>w)],m=y>>>24,g=y>>>16&255,y&=65535,w+m<=c)break;if(0===h)break t;h--,f+=l[u++]<<c,c+=8}f>>>=w,c-=w,r.back+=w}if(f>>>=m,c-=m,r.back+=m,64&g){t.msg="invalid distance code",r.mode=30;break}r.offset=y,r.extra=15&g,r.mode=24;case 24:if(r.extra){for(g=r.extra;c<g;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}r.offset+=f&(1<<r.extra)-1,f>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===s)break t;if(m=d-s,r.offset>m){if(m=r.offset-m,m>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}m>r.wnext?(m-=r.wnext,g=r.wsize-m):g=r.wnext-m,m>r.length&&(m=r.length),w=r.window}else w=a,g=o-r.offset,m=r.length;m>s&&(m=s),s-=m,r.length-=m;do{a[o++]=w[g++]}while(--m);0===r.length&&(r.mode=21);break;case 26:if(0===s)break t;a[o++]=r.length,s--,r.mode=21;break;case 27:if(r.wrap){for(;32>c;){if(0===h)break t;h--,f|=l[u++]<<c,c+=8}if(d-=s,t.total_out+=d,r.total+=d,d&&(t.adler=r.check=r.flags?Uo(r.check,a,d,o-d):Fo(r.check,a,d,o-d)),d=s,(r.flags?f:ns(f))!==r.check){t.msg="incorrect data check",r.mode=30;break}c=f=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;32>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(f!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}c=f=0}r.mode=29;case 29:v=Ka;break t;case 30:v=$a;break t;case 31:return ts;default:return Ja}return t.next_out=o,t.avail_out=s,t.next_in=u,t.avail_in=h,r.hold=f,r.bits=c,(r.wsize||d!==t.avail_out&&30>r.mode&&(27>r.mode||e!==Xa))&&fs(t,t.output,t.next_out,d-t.avail_out),p-=t.avail_in,d-=t.avail_out,t.total_in+=p,t.total_out+=d,r.total+=d,r.wrap&&d&&(t.adler=r.check=r.flags?Uo(r.check,a,d,t.next_out-d):Fo(r.check,a,d,t.next_out-d)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===p&&0===d||e===Xa)&&v===qa&&(v=es),v},inflateEnd:function(t){if(!t||!t.state)return Ja;var e=t.state;return e.window&&(e.window=null),t.state=null,qa},inflateGetHeader:function(t,e){return t&&t.state?(t=t.state,0===(2&t.wrap)?Ja:(t.head=e,e.done=!1,qa)):Ja},inflateSetDictionary:function(t,e){var i=e.length;if(!t||!t.state)return Ja;var n=t.state;if(0!==n.wrap&&11!==n.mode)return Ja;if(11===n.mode){var r=Fo(1,e,i,0);if(r!==n.check)return $a}return fs(t,e,i,i)?(n.mode=31,ts):(n.havedict=1,qa)},inflateInfo:"pako inflate (from Nodeca project)"},ps=function(){this.os=this.xflags=this.time=this.text=0,this.extra=null,this.extra_len=0,this.comment=this.name="",this.hcrc=0,this.done=!1},ds=Object.prototype.toString,vs=jo.Z_NO_FLUSH,gs=jo.Z_FINISH,ms=jo.Z_OK,ys=jo.Z_STREAM_END,xs=jo.Z_NEED_DICT,bs=jo.Z_STREAM_ERROR,_s=jo.Z_DATA_ERROR,ws=jo.Z_MEM_ERROR;F.prototype.push=function(t,e){var i=this.strm,n=this.options.chunkSize,r=this.options.dictionary;if(this.ended)return!1;var o=e===~~e?e:!0===e?gs:vs;for("[object ArrayBuffer]"===ds.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),e=cs.inflate(i,o),e===xs&&r&&(e=cs.inflateSetDictionary(i,r),e===ms?e=cs.inflate(i,o):e===_s&&(e=xs));0<i.avail_in&&e===ys&&0<i.state.wrap&&0!==t[i.next_in];)cs.inflateReset(i),e=cs.inflate(i,o);switch(e){case bs:case _s:case xs:case ws:return this.onEnd(e),this.ended=!0,!1}var a=i.avail_out;if(i.next_out&&(0===i.avail_out||e===ys))if("string"===this.options.to){var s=Ca.utf8border(i.output,i.next_out),u=i.next_out-s,l=Ca.buf2string(i.output,s);i.next_out=u,i.avail_out=n-u,u&&i.output.set(i.output.subarray(s,s+u),0),this.onData(l)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(e!==ms||0!==a){if(e===ys){e=cs.inflateEnd(this.strm),this.onEnd(e),this.ended=!0;break}if(0===i.avail_in)break}}return!0},F.prototype.onData=function(t){this.chunks.push(t)},F.prototype.onEnd=function(t){t===ms&&(this.result="string"===this.options.to?this.chunks.join(""):Ma.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var As={Deflate:D,deflate:B,deflateRaw:function(t,e){return e=e||{},e.raw=!0,B(t,e)},gzip:function(t,e){return e=e||{},e.gzip=!0,B(t,e)},Inflate:F,inflate:I,inflateRaw:function(t,e){return e=e||{},e.raw=!0,I(t,e)},ungzip:I,constants:jo},Ts=function(){function t(e){de(this,t),this._visible=!0,this.options=this.getCommonDefaultOptions(),this.options=di(this.options,this.getDefaultOptions()),this.autoUpdate=!1,this.options=di(this.options,e),this.options.data&&(this.data=this.options.data,delete this.options.data)}return Pi(t,[{key:"getCommonDefaultOptions",value:function(){return{}}},{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){}},{key:"destroy",value:function(){this.onDestroy&&this.onDestroy()}},{key:"show",value:function(){this._visible=!0}},{key:"hide",value:function(){this._visible=!1}},{key:"render",value:function(){}},{key:"setData",value:function(t,e){e=e||{},this.data=t,this.onDataChanged&&this.onDataChanged(this.getData()),this.onChanged&&this.onChanged(this.getOptions(),this.getData(),e),!1!==e.autoRender&&this.webglLayer&&this.webglLayer.render()}},{key:"getData",value:function(){return this.data||[]}},{key:"setOptions",value:function(t){t=t||{};var e=di({},this.getOptions());di(this.options,t),this.onOptionsChanged&&this.onOptionsChanged(this.getOptions(),e),this.onChanged&&this.onChanged(this.getOptions(),this.getData()),t.data?(this.setData(t.data),delete t.data):this.webglLayer&&this.webglLayer.render()}},{key:"getOptions",value:function(){return this.options||{}}},{key:"onOptionsChanged",value:function(t,e){}},{key:"onDataChanged",value:function(t){}},{key:"onChanged",value:function(t,e){}},{key:"onDestroy",value:function(){}},{key:"lnglatToMercator",value:function(t,e){}},{key:"setWebglLayer",value:function(t){this.webglLayer=t}},{key:"getWebglLayer",value:function(){return this.webglLayer}},{key:"isRequestAnimation",value:function(){return this.autoUpdate}}]),t}(),Ms=function(){function t(e,i,n){de(this,t),this.options=i,this.gl=e,n&&(this.map=n.map),n=this.getVertexShader(i.vertexShader);var r=this.getFragmentShader(i.fragmentShader);i=e.createShader(e.VERTEX_SHADER),e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?(n=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?(r=e.createProgram(),e.attachShader(r,i),e.attachShader(r,n),e.deleteShader(i),e.deleteShader(n),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)?i=r:(i="Shader program failed to link.  The error log is:"+e.getProgramInfoLog(r),console.error(i),i=-1)):(i="Fragment shader failed to compile.  The error log is:"+e.getShaderInfoLog(n),console.error(i),i=-1)):(i="Vertex shader failed to compile.  The error log is:"+e.getShaderInfoLog(i),console.error(i),i=-1),i=this.program=i,n={},r=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES);for(var o=0;o<r;o++){var a=e.getActiveAttrib(i,o);n[a.name]=e.getAttribLocation(i,a.name)}o={},a={};for(var s=e.getProgramParameter(i,e.ACTIVE_UNIFORMS),u=0;u<s;u++){var l=e.getActiveUniform(i,u);o[l.name]=e.getUniformLocation(i,l.name),a[l.name]=l.type}this.parameter=e={attributes:n,numAttributes:r,uniformsType:a,uniforms:o},this.attributes=e.attributes,this.uniforms=e.uniforms,this.parameter=e}return Pi(t,[{key:"getVertexShader",value:function(t){var e="";return this.map&&"cesium"===this.map.type&&(e="#define LOG_DEPTH\n"),e+="#ifdef LOG_DEPTH\nuniform float currentFrustumX;varying float v_depthFromNearPlusOne;\n#endif\nuniform vec2 MAPV_resolution;\n#if defined(PICK)\nuniform bool uIsPickRender;attribute vec3 aPickColor;uniform vec3 uPickedColor;varying vec4 vPickColor;uniform bool uEnablePicked;bool mapvIsPicked(){return uEnablePicked&&aPickColor==uPickedColor;}\n#endif\nvoid afterMain(){\n#if defined(LOG_DEPTH)\nv_depthFromNearPlusOne=(gl_Position.w-currentFrustumX)+1.0;gl_Position.z=clamp(gl_Position.z/gl_Position.w,-1.0,1.0)*gl_Position.w;\n#endif\n#if defined(PICK)\nvPickColor=vec4(aPickColor,0.0);if(mapvIsPicked()){vPickColor.a=1.0;}\n#endif\n}",t=this.getDefines()+e+t,t=t.replace("void main","void originMain"),t+"void main() {originMain(); afterMain();}"}},{key:"getFragmentShader",value:function(t){var e="";return this.map&&"cesium"===this.map.type&&(e="#define LOG_DEPTH\n"),e+="#if defined(LOG_DEPTH)\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;uniform vec2 MAPV_resolution;uniform bool uIsPickRender;\n#if defined(PICK)\nvarying vec4 vPickColor;bool mapvIsPicked(){return vPickColor.a==1.0;}\n#endif\n#if defined(LOG_DEPTH)\nuniform float oneOverLog2FarDepthFromNearPlusOne;uniform float farDepthFromNearPlusOne;varying float v_depthFromNearPlusOne;void writeLogDepth(float depth){if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}gl_FragDepthEXT=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;}\n#endif\nvoid afterMain(){\n#if defined(PICK)\nif(uIsPickRender){gl_FragColor=vec4(vPickColor.rgb,1.0);return;}\n#endif\n#if defined(LOG_DEPTH)\nwriteLogDepth(v_depthFromNearPlusOne);\n#endif\n}",t=this.getDefines()+e+t,t=t.replace("void main","void originMain"),t+"void main() {originMain(); afterMain();}"}},{key:"getDefines",value:function(){var t="",e=this.options.defines;if(e)for(var i=0;i<e.length;i++)t+="#define "+e[i]+"\n";return t}},{key:"use",value:function(t,e){this.gl=t,t.useProgram(this.program),this.map&&"cesium"===this.map.type&&this.setUniforms({currentFrustumX:this.map.map.scene.camera.frustum.near,oneOverLog2FarDepthFromNearPlusOne:this.map.map.scene.context.uniformState.oneOverLog2FarDepthFromNearPlusOne,farDepthFromNearPlusOne:this.map.map.scene.context.uniformState.farDepthFromNearPlusOne}),this.uniforms.MAPV_resolution&&this.setUniforms({MAPV_resolution:[t.canvas.width,t.canvas.height]})}},{key:"setUniform",value:function(t,e){var i=this.gl,n=this.uniforms[t];if(n)switch(this.parameter.uniformsType[t]){case i.FLOAT:i.uniform1f(n,e);break;case i.FLOAT_VEC2:i.uniform2f(n,e[0],e[1]);break;case i.FLOAT_VEC3:i.uniform3f(n,e[0],e[1],e[2]);break;case i.FLOAT_VEC4:i.uniform4f(n,e[0],e[1],e[2],e[3]);break;case i.SAMPLER_2D:case i.SAMPLER_CUBE:i.activeTexture(i["TEXTURE"+this.textureIndex]),i.uniform1i(n,this.textureIndex),i.bindTexture(i.TEXTURE_2D,e),this.textureIndex++;break;case i.INT:case i.BOOL:i.uniform1i(n,e);break;case i.INT_VEC2:case i.BOOL_VEC2:i.uniform2i(n,e[0],e[1]);break;case i.INT_VEC3:case i.BOOL_VEC3:i.uniform3i(n,e[0],e[1],e[2]);break;case i.INT_VEC4:case i.BOOL_VEC4:i.uniform4i(n,e[0],e[1],e[2],e[3]);break;case i.FLOAT_MAT2:i.uniformMatrix2fv(n,!1,e);break;case i.FLOAT_MAT3:i.uniformMatrix3fv(n,!1,e);break;case i.FLOAT_MAT4:i.uniformMatrix4fv(n,!1,e);break;default:console.error("Unrecognized uniform type: "+t)}else console.warn("Unrecognized uniform type: "+t)}},{key:"setUniforms",value:function(t){for(var e in this.textureIndex=0,t)this.setUniform(e,t[e])}}]),t}(),Ps=function(t,e,i,n){var r=i?i.call(n,t,e):void 0;if(void 0!==r)return!!r;if(t===e)return!0;if("object"!==("undefined"===typeof t?"undefined":qn(t))||!t||"object"!==("undefined"===typeof e?"undefined":qn(e))||!e)return!1;var o=si(t),a=si(e);if(o.length!==a.length)return!1;a=Object.prototype.hasOwnProperty.bind(e);for(var s=0;s<o.length;s++){if(r=o[s],!a(r))return!1;var u=t[r],l=e[r];if(r=i?i.call(n,u,l,r):void 0,!1===r||void 0===r&&u!==l)return!1}return!0},Ss=function(){function t(e){de(this,t),this.options=e,this.gl=e.gl,this.savedState=[],this.currentState=this.getDefaultState()}return Pi(t,[{key:"setDefaultState",value:function(){this.setState()}},{key:"getDefaultState",value:function(){var t=this.gl;return{blend:!1,blendEquation:t.FUNC_ADD,blendFunc:[t.ONE,t.ZERO],depthMask:!0,depthTest:!0,depthFunc:t.LEQUAL,polygonOffset:[0,0],cullFace:!1,stencilTest:!1}}},{key:"getRealState",value:function(){var t=this.gl;return{blend:t.getParameter(t.BLEND),blendEquation:t.getParameter(t.BLEND_EQUATION),depthMask:t.getParameter(t.DEPTH_WRITEMASK),depthTest:t.getParameter(t.DEPTH_TEST),depthFunc:t.getParameter(t.DEPTH_FUNC),polygonOffset:[t.getParameter(t.POLYGON_OFFSET_FACTOR),t.getParameter(t.POLYGON_OFFSET_UNITS)],cullFace:t.getParameter(t.CULL_FACE),stencilTest:t.getParameter(t.STENCIL_TEST)}}},{key:"getCurrentState",value:function(){return this.currentState}},{key:"save",value:function(){this.savedState.push(this.getCurrentState())}},{key:"restore",value:function(){var t=this.savedState.pop();this.setState(t,{force:!0})}},{key:"setState",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};t=di(this.getDefaultState(),t),this.setBlend(t,e),this.setDepth(t,e),this.setCullFace(t,e),this.setPolygonOffset(t,e),this.setStencil(t,e),this.currentState=t}},{key:"setBlend",value:function(t,e){var i=this.gl,n=this.getCurrentState();!(e=e.force)&&Ps(t.blend,n.blend)||(t.blend?i.enable(i.BLEND):i.disable(i.BLEND)),!e&&Ps(t.blendEquation,n.blendEquation)||i.blendEquation(t.blendEquation),!e&&Ps(t.blendFunc,n.blendFunc)||i.blendFunc(t.blendFunc[0],t.blendFunc[1])}},{key:"setDepth",value:function(t,e){var i=this.gl,n=this.getCurrentState();!(e=e.force)&&Ps(t.depthTest,n.depthTest)||(t.depthTest?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST)),!e&&Ps(t.depthMask,n.depthMask)||(t.depthMask?i.depthMask(!0):i.depthMask(!1)),!e&&Ps(t.depthFunc,n.depthFunc)||i.depthFunc(t.depthFunc)}},{key:"setPolygonOffset",value:function(t,e){var i=this.gl,n=this.getCurrentState();!e.force&&Ps(t.polygonOffset,n.polygonOffset)||(0!==t.polygonOffset[0]&&0!==t.polygonOffset[1]?i.enable(i.POLYGON_OFFSET_FILL):i.disable(i.POLYGON_OFFSET_FILL),i.polygonOffset(t.polygonOffset[0],t.polygonOffset[1]))}},{key:"setCullFace",value:function(t,e){var i=this.gl,n=this.getCurrentState();!e.force&&Ps(t.cullFace,n.cullFace)||(t.cullFace?(i.enable(i.CULL_FACE),i.cullFace(i.BACK)):i.disable(i.CULL_FACE))}},{key:"setStencil",value:function(t,e){var i=this.gl,n=this.getCurrentState();!e.force&&Ps(t.stencilTest,n.stencilTest)||(t.stencilTest?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST))}}]),t}(),Es=function(){function t(e){de(this,t),this.options=e,this.gl=e.gl,this.buffer=this.gl.createBuffer(),e.data&&this.updateData(e.data)}return Pi(t,[{key:"updateData",value:function(t){var e=this.options,i=this.gl;this.bind(),i.bufferData(i[e.target],t,i[e.usage])}},{key:"bind",value:function(t){t=t||this.gl,t.bindBuffer(t[this.options.target],this.buffer)}},{key:"unBind",value:function(t){t=t||this.gl,t.bindBuffer(t[this.options.target],null)}},{key:"destroy",value:function(){this.buffer=null}}]),t}(),Cs={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FLOAT:4},Ls=function(){function t(e){for(de(this,t),this.options=e,this.attributes=e.attributes,this.gl=e.gl,this.program=e.program,e=this.stride=0;e<this.attributes.length;e++)this.stride+=Cs[this.attributes[e].type]*this.attributes[e].size}return Pi(t,[{key:"setVertexAttribPointers",value:function(){for(var t=this.gl,e=this.program,i=0;i<this.attributes.length;i++){var n=this.attributes[i],r=e.attributes[n.name];void 0!==r&&(n.buffer.bind(t),t.vertexAttribPointer(r,n.size,t[n.type],n.normalize||!1,void 0!==n.stride?n.stride:this.stride,n.offset),t.enableVertexAttribArray(r))}}},{key:"bind",value:function(){this.setVertexAttribPointers()}},{key:"destroy",value:function(){}}]),t}(),Rs=function t(e,i,n){de(this,t),i=i||e.canvas.width,n=n||e.canvas.height;var r=e.createFramebuffer(),o=e.createTexture();e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,i,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r.texture=o;var a=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,a),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i,n),r.depthBuffer=a,e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,a),i=e.checkFramebufferStatus(e.FRAMEBUFFER),e.FRAMEBUFFER_COMPLETE===i&&(e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),this.framebuffer=r)},ks=function(){function t(e){de(this,t),this.options={},di(this.options,e),this.vertex=[-1,1,0,-1,-1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0],this.sampleCoord=[0,1,0,0,1,1,1,1,0,0,1,0]}return Pi(t,[{key:"getOptions",value:function(){return this.options}},{key:"onResize",value:function(t){}},{key:"render",value:function(t){var e=t.gl;t=t.texture;var i=this.programSample;e.useProgram(i.program);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);var r=[-1,-1,0,-1,1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.STATIC_DRAW),e.enableVertexAttribArray(i.attributes.aPos),e.vertexAttribPointer(i.attributes.aPos,3,e.FLOAT,!1,0,0),n=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,1,0,0,1,0]),e.STATIC_DRAW),e.enableVertexAttribArray(i.attributes.aTextureCoord),e.vertexAttribPointer(i.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(i.uniforms.uSampler,0),e.drawArrays(e.TRIANGLES,0,r.length/3)}}]),t}(),Os=function(t){function e(t){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t))}return ar(e,t),Pi(e,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new Ms(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(void){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;vec4 fxaa_2_0(sampler2D tex,vec2 fragCoord,vec2 resolution,vec2 v_rgbNW,vec2 v_rgbNE,vec2 v_rgbSW,vec2 v_rgbSE,vec2 v_rgbM){vec4 color;mediump vec2 inverseVP=vec2(1.0/resolution.x,1.0/resolution.y);vec3 rgbNW=texture2D(tex,v_rgbNW).xyz;vec3 rgbNE=texture2D(tex,v_rgbNE).xyz;vec3 rgbSW=texture2D(tex,v_rgbSW).xyz;vec3 rgbSE=texture2D(tex,v_rgbSE).xyz;vec4 texColor=texture2D(tex,v_rgbM);vec3 rgbM=texColor.xyz;vec3 luma=vec3(0.299,0.587,0.114);float lumaNW=dot(rgbNW,luma);float lumaNE=dot(rgbNE,luma);float lumaSW=dot(rgbSW,luma);float lumaSE=dot(rgbSE,luma);float lumaM=dot(rgbM,luma);float lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));float lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));mediump vec2 dir;dir.x=-((lumaNW+lumaNE)-(lumaSW+lumaSE));dir.y=((lumaNW+lumaSW)-(lumaNE+lumaSE));float dirReduce=max((lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*1.0/8.0),1.0/128.0);float rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);dir=min(vec2(8.0,8.0),max(vec2(-8.0,-8.0),dir*rcpDirMin))*inverseVP;vec3 rgbA=0.5*(texture2D(tex,fragCoord*inverseVP+dir*(1.0/3.0-0.5)).xyz+texture2D(tex,fragCoord*inverseVP+dir*(2.0/3.0-0.5)).xyz);vec3 rgbB=rgbA*0.5+0.25*(texture2D(tex,fragCoord*inverseVP+dir*-0.5).xyz+texture2D(tex,fragCoord*inverseVP+dir*0.5).xyz);float lumaB=dot(rgbB,luma);if((lumaB<lumaMin)||(lumaB>lumaMax)){color=vec4(rgbA,texColor.a);}else{color=vec4(rgbB,texColor.a);}return color;}void texcoords_3_1(vec2 fragCoord,vec2 resolution,out vec2 v_rgbNW,out vec2 v_rgbNE,out vec2 v_rgbSW,out vec2 v_rgbSE,out vec2 v_rgbM){vec2 inverseVP=1.0/resolution.xy;v_rgbNW=(fragCoord+vec2(-1.0,-1.0))*inverseVP;v_rgbNE=(fragCoord+vec2(1.0,-1.0))*inverseVP;v_rgbSW=(fragCoord+vec2(-1.0,1.0))*inverseVP;v_rgbSE=(fragCoord+vec2(1.0,1.0))*inverseVP;v_rgbM=vec2(fragCoord*inverseVP);}vec4 apply_1_2(sampler2D tex,vec2 fragCoord,vec2 resolution){mediump vec2 v_rgbNW;mediump vec2 v_rgbNE;mediump vec2 v_rgbSW;mediump vec2 v_rgbSE;mediump vec2 v_rgbM;texcoords_3_1(fragCoord,resolution,v_rgbNW,v_rgbNE,v_rgbSW,v_rgbSE,v_rgbM);return fxaa_2_0(tex,fragCoord,resolution,v_rgbNW,v_rgbNE,v_rgbSW,v_rgbSE,v_rgbM);}void main(void){vec2 fragCoord=vTextureCoord*canvasSize;gl_FragColor=apply_1_2(uSampler,fragCoord,canvasSize);}"})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture,this.getOptions(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var i=this.getProgram(e);e.useProgram(i.program);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(i.attributes.aPos),e.vertexAttribPointer(i.attributes.aPos,3,e.FLOAT,!1,0,0),n=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(i.attributes.aTextureCoord),e.vertexAttribPointer(i.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(i.uniforms.uSampler,1),e.uniform2fv(i.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(ks),Ds=function(t){function e(t){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t))}return ar(e,t),Pi(e,[{key:"getProgram",value:function(t){if(this.program1||(this.program1=new Ms(t,{vertexShader:"attribute vec3 position;attribute vec2 uv;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];void SMAAEdgeDetectionVS(vec2 texcoord){vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-1.0,0.0,0.0,1.0);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(1.0,0.0,0.0,-1.0);vOffset[2]=texcoord.xyxy+resolution.xyxy*vec4(-2.0,0.0,0.0,2.0);}void main(){vUv=uv;SMAAEdgeDetectionVS(vUv);gl_Position=vec4(position,1.0);}",fragmentShader:"precision highp float;\n#define SMAA_THRESHOLD 0.1\nuniform sampler2D tDiffuse;varying vec2 vUv;varying vec4 vOffset[3];vec4 SMAAColorEdgeDetectionPS(vec2 texcoord,vec4 offset[3],sampler2D colorTex){vec2 threshold=vec2(SMAA_THRESHOLD,SMAA_THRESHOLD);vec4 delta;vec3 C=texture2D(colorTex,texcoord).rgb;vec3 Cleft=texture2D(colorTex,offset[0].xy).rgb;vec3 t=abs(C-Cleft);delta.x=max(max(t.r,t.g),t.b);vec3 Ctop=texture2D(colorTex,offset[0].zw).rgb;t=abs(C-Ctop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0,1.0))==0.0)discard;vec3 Cright=texture2D(colorTex,offset[1].xy).rgb;t=abs(C-Cright);delta.z=max(max(t.r,t.g),t.b);vec3 Cbottom=texture2D(colorTex,offset[1].zw).rgb;t=abs(C-Cbottom);delta.w=max(max(t.r,t.g),t.b);float maxDelta=max(max(max(delta.x,delta.y),delta.z),delta.w);vec3 Cleftleft=texture2D(colorTex,offset[2].xy).rgb;t=abs(C-Cleftleft);delta.z=max(max(t.r,t.g),t.b);vec3 Ctoptop=texture2D(colorTex,offset[2].zw).rgb;t=abs(C-Ctoptop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(max(maxDelta,delta.z),delta.w);edges.xy*=step(0.5*maxDelta,delta.xy);return vec4(edges,0.0,0.0);}void main(){gl_FragColor=SMAAColorEdgeDetectionPS(vUv,vOffset,tDiffuse);}"})),this.program2||(this.program2=new Ms(t,{vertexShader:"precision highp float;\n#define SMAA_MAX_SEARCH_STEPS 8\n#define SMAA_AREATEX_MAX_DISTANCE 16\n#define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )\n#define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )\nattribute vec3 position;attribute vec2 uv;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixcoord;void SMAABlendingWeightCalculationVS(vec2 texcoord){vPixcoord=texcoord/resolution;vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-0.25,0.125,1.25,0.125);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(-0.125,0.25,-0.125,-1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*resolution.xxyy*float(SMAA_MAX_SEARCH_STEPS);}void main(){vUv=uv;SMAABlendingWeightCalculationVS(vUv);gl_Position=vec4(position,1.0);}",fragmentShader:"precision highp float;\n#define SMAA_MAX_SEARCH_STEPS 8\n#define SMAA_AREATEX_MAX_DISTANCE 16\n#define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )\n#define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )\n#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )\nuniform sampler2D tDiffuse;uniform sampler2D tArea;uniform sampler2D tSearch;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixcoord;vec2 round(vec2 x){return sign(x)*floor(abs(x)+0.5);}float SMAASearchLength(sampler2D searchTex,vec2 e,float bias,float scale){e.r=bias+e.r*scale;return 255.0*texture2D(searchTex,e,0.0).r;}float SMAASearchXLeft(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){/***@PSEUDO_GATHER4*This texcoord has been offset by(-0.25,-0.125)in the vertex shader to*sample between edge,thus fetching four edges in a row.*Sampling with different offsets in each direction allows to disambiguate*which edges are active from the four fetched ones.*/vec2 e=vec2(0.0,1.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord-=vec2(2.0,0.0)*resolution;if(!(texcoord.x>end&&e.g>0.8281&&e.r==0.0))break;}texcoord.x+=0.25*resolution.x;texcoord.x+=resolution.x;texcoord.x+=2.0*resolution.x;texcoord.x-=resolution.x*SMAASearchLength(searchTex,e,0.0,0.5);return texcoord.x;}float SMAASearchXRight(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord+=vec2(2.0,0.0)*resolution;if(!(texcoord.x<end&&e.g>0.8281&&e.r==0.0))break;}texcoord.x-=0.25*resolution.x;texcoord.x-=resolution.x;texcoord.x-=2.0*resolution.x;texcoord.x+=resolution.x*SMAASearchLength(searchTex,e,0.5,0.5);return texcoord.x;}float SMAASearchYUp(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord+=vec2(0.0,2.0)*resolution;if(!(texcoord.y>end&&e.r>0.8281&&e.g==0.0))break;}texcoord.y-=0.25*resolution.y;texcoord.y-=resolution.y;texcoord.y-=2.0*resolution.y;texcoord.y+=resolution.y*SMAASearchLength(searchTex,e.gr,0.0,0.5);return texcoord.y;}float SMAASearchYDown(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord-=vec2(0.0,2.0)*resolution;if(!(texcoord.y<end&&e.r>0.8281&&e.g==0.0))break;}texcoord.y+=0.25*resolution.y;texcoord.y+=resolution.y;texcoord.y+=2.0*resolution.y;texcoord.y-=resolution.y*SMAASearchLength(searchTex,e.gr,0.5,0.5);return texcoord.y;}vec2 SMAAArea(sampler2D areaTex,vec2 dist,float e1,float e2,float offset){vec2 texcoord=float(SMAA_AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texcoord=SMAA_AREATEX_PIXEL_SIZE*texcoord+(0.5*SMAA_AREATEX_PIXEL_SIZE);texcoord.y+=SMAA_AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTex,texcoord,0.0).rg;}vec4 SMAABlendingWeightCalculationPS(vec2 texcoord,vec2 pixcoord,vec4 offset[3],sampler2D edgesTex,sampler2D areaTex,sampler2D searchTex,ivec4 subsampleIndices){vec4 weights=vec4(0.0,0.0,0.0,0.0);vec2 e=texture2D(edgesTex,texcoord).rg;if(e.g>0.0){vec2 d;vec2 coords;coords.x=SMAASearchXLeft(edgesTex,searchTex,offset[0].xy,offset[2].x);coords.y=offset[1].y;d.x=coords.x;float e1=texture2D(edgesTex,coords,0.0).r;coords.x=SMAASearchXRight(edgesTex,searchTex,offset[0].zw,offset[2].y);d.y=coords.x;d=d/resolution.x-pixcoord.x;vec2 sqrt_d=sqrt(abs(d));coords.y-=1.0*resolution.y;float e2=SMAASampleLevelZeroOffset(edgesTex,coords,ivec2(1,0)).r;weights.rg=SMAAArea(areaTex,sqrt_d,e1,e2,float(subsampleIndices.y));}if(e.r>0.0){vec2 d;vec2 coords;coords.y=SMAASearchYUp(edgesTex,searchTex,offset[1].xy,offset[2].z);coords.x=offset[0].x;d.x=coords.y;float e1=texture2D(edgesTex,coords,0.0).g;coords.y=SMAASearchYDown(edgesTex,searchTex,offset[1].zw,offset[2].w);d.y=coords.y;d=d/resolution.y-pixcoord.y;vec2 sqrt_d=sqrt(abs(d));coords.y-=1.0*resolution.y;float e2=SMAASampleLevelZeroOffset(edgesTex,coords,ivec2(0,1)).g;weights.ba=SMAAArea(areaTex,sqrt_d,e1,e2,float(subsampleIndices.x));}return weights;}void main(){gl_FragColor=SMAABlendingWeightCalculationPS(vUv,vPixcoord,vOffset,tDiffuse,tArea,tSearch,ivec4(0.0));}"})),this.program3||(this.program3=new Ms(t,{vertexShader:"precision highp float;uniform vec2 resolution;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;varying vec4 vOffset[2];void SMAANeighborhoodBlendingVS(vec2 texcoord){vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-1.0,0.0,0.0,1.0);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(1.0,0.0,0.0,-1.0);}void main(){vUv=uv;SMAANeighborhoodBlendingVS(vUv);gl_Position=vec4(position,1.0);}",fragmentShader:"precision highp float;uniform sampler2D tDiffuse;uniform sampler2D tColor;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[2];vec4 SMAANeighborhoodBlendingPS(vec2 texcoord,vec4 offset[2],sampler2D colorTex,sampler2D blendTex){vec4 a;a.xz=texture2D(blendTex,texcoord).xz;a.y=texture2D(blendTex,offset[1].zw).g;a.w=texture2D(blendTex,offset[1].xy).a;if(dot(a,vec4(1.0,1.0,1.0,1.0))<1e-5){return texture2D(colorTex,texcoord,0.0);}else{vec2 offset;offset.x=a.a>a.b ? a.a :-a.b;offset.y=a.g>a.r ?-a.g : a.r;if(abs(offset.x)>abs(offset.y)){offset.y=0.0;}else{offset.x=0.0;}vec4 C=texture2D(colorTex,texcoord,0.0);texcoord+=sign(offset)*resolution;vec4 Cop=texture2D(colorTex,texcoord,0.0);float s=abs(offset.x)>abs(offset.y)? abs(offset.x): abs(offset.y);C.xyz=pow(C.xyz,vec3(2.2));Cop.xyz=pow(Cop.xyz,vec3(2.2));vec4 mixed=mix(C,Cop,s);mixed.xyz=pow(mixed.xyz,vec3(1.0/2.2));return mixed;}}void main(){gl_FragColor=SMAANeighborhoodBlendingPS(vUv,vOffset,tColor,tDiffuse);}"})),!this.vertexBuffer||!this.sampleBuffer){this.vertexBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord));var e=[{stride:12,name:"position",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"uv",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}];this.vertexArray1=new Ls({gl:t,program:this.program1,attributes:e}),this.vertexArray2=new Ls({gl:t,program:this.program2,attributes:e}),this.vertexArray3=new Ls({gl:t,program:this.program3,attributes:e})}return{program1:this.program1,program2:this.program2,program3:this.program3}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new Rs(t),this.bloomBuffer=new Rs(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new Rs(t)),this.bloomBuffer||(this.bloomBuffer=new Rs(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,i=t.texture;t=t.fbo,this.getOptions(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var n=this.getProgram(e),r=n.program1,o=n.program2;n=n.program3;var a=this.getExtraFbo(e),s=a.collectBrightBuffer;a=a.bloomBuffer;var u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.position),e.vertexAttribPointer(r.attributes.position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.position),e.vertexAttribPointer(o.attributes.position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n.attributes.position),e.vertexAttribPointer(n.attributes.position,3,e.FLOAT,!1,0,0),u=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.uv),e.vertexAttribPointer(r.attributes.uv,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.uv),e.vertexAttribPointer(o.attributes.uv,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n.attributes.uv),e.vertexAttribPointer(n.attributes.uv,2,e.FLOAT,!1,0,0),e.useProgram(r.program),e.bindFramebuffer(e.FRAMEBUFFER,s),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,i),e.uniform1i(r.uniforms.tDiffuse,2),e.uniform2fv(r.uniforms.resolution,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,a),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,s.texture),e.uniform1i(o.uniforms.uSampler,2),e.uniform2fv(o.uniforms.resolution,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(n.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,i),e.uniform1i(n.uniforms.tDiffuse,2),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,a.texture),e.uniform1i(n.uniforms.tColor,3),e.uniform2fv(n.uniforms.resolution,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}},{key:"getAreaTexture",value:function(){return"data:image/png;base64,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"}},{key:"getSearchTexture",value:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAIAAADiVupLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFZJREFUeNrs00EKgAAIRNEZ739mTQoiwmhRi4L/FiKiu9ERISkzbXdTVV3H4WhfOG6ehl1rNR7qDSF8hwkVcJXt+3A//I0Nv0GoCBUAAAAAAMA/LAIMAB+Dcg2OE2zsAAAAAElFTkSuQmCC"}}]),e}(ks),Bs=function(t){function e(t){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t))}return ar(e,t),Pi(e,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new Ms(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){float fStep=1.0/512.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;gl_FragColor=blurSample;}"}),this.vertexBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord)),this.vertexArray=new Ls({gl:t,program:this.programSample,attributes:[{stride:12,name:"aPos",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"aTextureCoord",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}]})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture,e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var i=this.getProgram(e);i.use(e),this.vertexArray.bind(),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(i.uniforms.uSampler,1),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3)}}]),e}(ks),zs=function(t){function e(t){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t))}return ar(e,t),Pi(e,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new Ms(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-(1.0-threshold)/5.0));float brightness=dot(color.rgb,vec3(0.2126,0.7152,0.0722));if(brightness>threshold){color=lightColor;}else{color=vec4(0.0);}gl_FragColor=color;}"})),this.programBloom||(this.programBloom=new Ms(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new Ms(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord);vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new Rs(t),this.bloomBuffer=new Rs(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new Rs(t)),this.bloomBuffer||(this.bloomBuffer=new Rs(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,i=t.texture;t=t.fbo;var n=this.getOptions();e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var r=this.getProgram(e),o=r.programBright,a=r.programBloom;r=r.programResult;var s=this.getExtraFbo(e),u=s.collectBrightBuffer;s=s.bloomBuffer;var l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(o.attributes.aPos),e.vertexAttribPointer(o.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r.attributes.aPos),e.vertexAttribPointer(r.attributes.aPos,3,e.FLOAT,!1,0,0),l=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(o.attributes.aTextureCoord),e.vertexAttribPointer(o.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a.attributes.aTextureCoord),e.vertexAttribPointer(a.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r.attributes.aTextureCoord),e.vertexAttribPointer(r.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i),e.uniform1i(o.uniforms.uSampler,1),e.uniform1f(o.uniforms.threshold,n.threshold||0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,s),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(a.uniforms.uSampler,1),e.uniform1i(a.uniforms.isVertical,!0),e.uniform1f(a.uniforms.blurSize,n.blurSize||2),e.uniform1f(a.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(a.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,s.texture),e.uniform1i(a.uniforms.uSampler,1),e.uniform1i(a.uniforms.isVertical,!1),e.uniform1f(a.uniforms.blurSize,n.blurSize||2),e.uniform1f(a.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(a.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(r.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i),e.uniform1i(r.uniforms.originalTexture,1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(r.uniforms.bloomTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(ks),Fs=function(t){function e(t){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t))}return ar(e,t),Pi(e,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new Ms(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-threshold));gl_FragColor=lightColor;}"})),this.programBloom||(this.programBloom=new Ms(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new Ms(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;uniform float toneScale;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord)*toneScale;vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new Rs(t),this.bloomBuffer=new Rs(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new Rs(t)),this.bloomBuffer||(this.bloomBuffer=new Rs(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,i=t.texture;t=t.fbo;var n=this.getOptions(),r="clarity"in n?n.clarity:1;r=Math.max(0,r),r=Math.min(1,r),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var o=this.getProgram(e),a=o.programBright,s=o.programBloom;o=o.programResult;var u=this.getExtraFbo(e),l=u.collectBrightBuffer;u=u.bloomBuffer;var h=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.attributes.aPos),e.vertexAttribPointer(s.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.aPos),e.vertexAttribPointer(o.attributes.aPos,3,e.FLOAT,!1,0,0),h=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aTextureCoord),e.vertexAttribPointer(a.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.attributes.aTextureCoord),e.vertexAttribPointer(s.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.aTextureCoord),e.vertexAttribPointer(o.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i),e.uniform1i(a.uniforms.uSampler,1),e.uniform1f(a.uniforms.threshold,n.threshold||0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(s.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,l.texture),e.uniform1i(s.uniforms.uSampler,1),e.uniform1i(s.uniforms.isVertical,!0),e.uniform1f(s.uniforms.blurSize,n.blurSize||2),e.uniform1f(s.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(s.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(s.program),e.bindFramebuffer(e.FRAMEBUFFER,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(s.uniforms.uSampler,1),e.uniform1i(s.uniforms.isVertical,!1),e.uniform1f(s.uniforms.blurSize,n.blurSize||2),e.uniform1f(s.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(s.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i),e.uniform1i(o.uniforms.originalTexture,1),e.uniform1f(o.uniforms.toneScale,r),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,l.texture),e.uniform1i(o.uniforms.bloomTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(ks),Is=function(t){function e(t){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t))}return ar(e,t),Pi(e,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new Ms(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;void main(){float fStep=1.0/312.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;float desX=abs((gl_FragCoord.x-canvasSize.x/2.0)/(canvasSize.x/2.0));float desY=abs((gl_FragCoord.y-canvasSize.y/2.0)/(canvasSize.y/2.0));float factor=max(desX,desY);gl_FragColor=(sample22*(1.0-factor)+blurSample*factor);}"})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture;var i=this.getProgram(e);e.useProgram(i.program);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(i.attributes.aPos),e.vertexAttribPointer(i.attributes.aPos,3,e.FLOAT,!1,0,0),n=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(i.attributes.aTextureCoord),e.vertexAttribPointer(i.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(i.uniforms.uSampler,1),e.uniform2fv(i.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3)}}]),e}(ks),Us=function(){function t(e){de(this,t),this.gl=e,this.effects=[],this.initFbo()}return Pi(t,[{key:"addEffect",value:function(t){this.effects.push(t)}},{key:"removeEffect",value:function(t){}},{key:"setEffects",value:function(t){this.effects=t}},{key:"onResize",value:function(){this.initFbo();var t=this.gl,e=this.effects;if(e&&1<e.length)for(var i=1;i<e.length;i++){var n=e[i];n.onResize&&n.onResize(t)}}},{key:"initFbo",value:function(){var t=this.gl;t&&(this.fbo=[new Rs(t),new Rs(t)])}},{key:"destroy",value:function(){this.effects=[],this.fbo=[],this.gl=null}},{key:"render",value:function(){var t=this.gl,e=this.effects;if(e&&0<e.length)for(var i={},n=0;n<e.length;n++){var r=this.fbo[n%2].framebuffer;n===e.length-1&&(r=null),t.bindFramebuffer(t.FRAMEBUFFER,r);var o=[0,0,0,0];t.clearColor(o[0],o[1],o[2],o[3]),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e[n].render({isPickRender:!1,gl:t,texture:i.texture,fbo:r}),i=r}}}]),t}(),Ns=function(t){function e(t){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.pickedColor=[-1,-1,-1],t}return ar(e,t),Pi(e,[{key:"getCommonDefaultOptions",value:function(){return{zIndex:0,zoomThreshold:[0,30],repeat:!1,enablePicked:!1,autoSelect:!1,selectedIndex:-1,selectedColor:"rgba(20, 20, 200, 1.0)"}}},{key:"commonInitialize",value:function(t){var e=this.getOptions();this.gl=t,e.enablePicked&&(this.pickBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}))}},{key:"getCommonAttributes",value:function(){var t=[];return this.getOptions().enablePicked&&t.push({name:"aPickColor",buffer:this.pickBuffer,size:3,type:"FLOAT",stride:12,offset:0}),t}},{key:"getProperty",value:function(t,e,i){return"[object Function]"===Object.prototype.toString.call(e)?e(i):(e=i[t]||e,"properties"in i&&t in i.properties&&(e=i.properties[t]),e)}},{key:"normizedColor",value:function(t){var e=t;return t instanceof Array||(e=u(t).unitArray()),void 0===e[3]&&(e[3]=1),e}},{key:"normizedPoint",value:function(t){var e=this.getPointOffset();if(!t||!t[0]||!t[1])return[e[0],e[1],0];var i=Number(t[0]),n=Number(t[1]);-180<=i&&180>=i&&-90<=n&&90>=n&&(n=this.webglLayer.map.lnglatToMercator(i,n),i=n[0],n=n[1]);var r=Number(t[2])||0;return this.webglLayer&&"cesium"===this.webglLayer.options.mapType&&window.Cesium?(i=this.convertLngLat([i,n]),r=window.Cesium.Cartesian3.fromDegrees(i[0],i[1],r),i=r.x,n=r.y,r=r.z):this.webglLayer&&"bmapgl"===this.webglLayer.options.mapType&&"B_EARTH_MAP"===this.webglLayer.map.map.mapType&&(i=this.convertLngLat([i,n]),r=this.webglLayer.map.map.getEarth().scene.fromLatLngToXYZ({lng:i[0],lat:i[1]}),i=r.x,n=r.y,r=r.z),3<t.length?[i-e[0],n-e[1],r].concat(Lr(t.slice(3))):[i-e[0],n-e[1],r]}},{key:"convertLngLat",value:function(t){return[t[0]/20037508.34*180,180/Math.PI*(2*Math.atan(Math.exp(t[1]/20037508.34*180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){var t=[0,0],e=this.getOptions();return this.webglLayer&&this.webglLayer.options.pointOffset?t=this.webglLayer.options.pointOffset:e.pointOffset&&(t=e.pointOffset),t}},{key:"indexToRgb",value:function(t){t++;var e=Math.floor(t/65536);t-=65536*e;var i=Math.floor(t/256);return[t-256*i,i,e]}},{key:"rgbToIndex",value:function(t){return t[0]+256*t[1]+65536*t[2]-1}},{key:"getCommonUniforms",value:function(t){t=t.isPickRender;var e=this.getOptions(),i={};if(e.enablePicked){var n=0<=e.selectedIndex?e.selectedIndex:-1;n=e.autoSelect?this.pickedColor:this.indexToRgb(n),i=di(i,{uSelectedColor:this.normizedColor(e.selectedColor),uEnablePicked:e.enablePicked,uPickedColor:n.map((function(t){return t/255})),uIsPickRender:!!t})}return i}},{key:"pick",value:function(t,e){var i=this.gl;this.webglLayer.saveFramebuffer(),this.webglLayer.bindFramebuffer(this.webglLayer.pickFBO),this.webglLayer.clear(),this.render({gl:i,isPickRender:!0,matrix:this.webglLayer.matrix,projectionMatrix:this.webglLayer.projectionMatrix,viewMatrix:this.webglLayer.viewMatrix,orthoMatrix:this.webglLayer.orthoMatrix});var n=new Uint8Array(4);return i.readPixels(t*window.devicePixelRatio,i.canvas.height-e*window.devicePixelRatio,1,1,i.RGBA,i.UNSIGNED_BYTE,n),t=this.rgbToIndex(n),e=this.getData(),this.pickedColor=[n[0],n[1],n[2]],this.webglLayer.restoreFramebuffer(),{dataIndex:t,dataItem:e[t]}}},{key:"setGLState",value:function(t){this.webglLayer.stateManager.setState(t)}},{key:"addMultipleCoords",value:function(t,e,i){if(!this.options.repeat||!this.webglLayer||"bmapgl"!==this.webglLayer.options.mapType||"B_EARTH_MAP"===this.webglLayer.map.map.mapType)return[t];var n=this.webglLayer.map.map;e=e||n.getZoom();var r=i?n.worldSize(e):40075452.74461451;if(e=function(t){return[[t[0]-r,t[1],t[2]||0],[t[0]+r,t[1],t[2]||0]]},t instanceof Array&&!(t[0]instanceof Array))return e=e(t),e=xr(e,2),[t,e[0],e[1]];if(t instanceof Array&&t[0]instanceof Array&&!(t[0][0]instanceof Array)){i=[],n=[];for(var o=0;o<t.length;o++){var a=e(t[o]);a=xr(a,2);var s=a[1];i.push(a[0]),n.push(s)}return[t,i,n]}for(i=[],n=[],o=0;o<t.length;o++){a=[],s=[];for(var u=0;u<t[o].length;u++){var l=e(t[o][u]);l=xr(l,2);var h=l[1];a.push(l[0]),s.push(h)}i.push(a),n.push(s)}return[t,i,n]}}]),e}(Ts),js=function(t){function e(t){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.bufferData=[],t.initializeTime=new Date,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{size:10,unit:"px",color:"blue",antialias:!0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new Ms(this.gl,{vertexShader:"attribute vec3 aPos;attribute float aSize;attribute float aIndex;attribute vec4 aColor;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;float x=aPos.x;float y=aPos.y;float z=aPos.z*uZoomUnits;vSize=aSize*uZoomUnits;if(aIndex==1.0){x+=vSize;y-=vSize;}else if(aIndex==2.0){x-=vSize;y+=vSize;}else if(aIndex==3.0){x+=vSize;y+=vSize;}else{x-=vSize;y-=vSize;}vPosition=vec4(aPos.xyz,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float lineWidth;uniform float uAntiAliasing;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>vSize){discard;}vec4 color=vColor;if(uAntiAliasing==1.0&&d>0.9*vSize&&d<=vSize){color.a*=1.0-smoothstep(0.9*vSize,vSize,d);}gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:36,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:36,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:12},{stride:36,name:"aIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:16},{stride:36,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:20}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&e&&(this.uniforms={},this.data=e,this.processData(),t.enablePicked&&this.parsePickData(e))}},{key:"processData",value:function(){var t=this,e=[],i=[];this.data.forEach((function(n,r){var o=n.color||t.options.color,a=n.size||t.options.size;o=t.normizedColor(o),n=t.normizedPoint(n.geometry.coordinates);for(var s=0;4>s;s++)e.push(n[0],n[1],n[2]||0,a,s),e.push(o[0],o[1],o[2],o[3]);o=4*r,0<r&&i.push(o-1,o),i.push(o,o+1,o+2,o+3)})),this.bufferData=e,this.indexData=i,this.buffer.updateData(new Float32Array(e)),this.indexBuffer.updateData(new Uint32Array(i))}},{key:"parsePickData",value:function(t){var e=[];if(this.getOptions().enablePicked){for(var i=0;i<t.length;i++){var n=this.indexToRgb(i);e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255)}this.pickBuffer.updateData(new Float32Array(e))}}},{key:"render",value:function(t){var e=this.program,i=t.gl,n=t.matrix;this.setGLState({blend:!0,blendEquation:i.FUNC_ADD,blendFunc:[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA]}),e.use(i),this.vertexArray.bind(),this.indexBuffer.bind();var r=this.map.getZoomUnits();di(this.uniforms,this.getCommonUniforms(t),{uZoomUnits:"px"===this.options.unit?r:1,uMatrix:n,uAntiAliasing:this.options.antialias?1:0}),e.setUniforms(this.uniforms),i.drawElements(i.TRIANGLE_STRIP,this.indexData.length,i.UNSIGNED_INT,0)}}]),e}(Ns),Hs={wave:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}vec4 color=vColor;float R=vRadius;float center=vSize;float time=vStartTime+uTime;float alpha=sin((R-d)/R*trail*2.0*3.14+time/duration);if(d<=center){if(uAntiAliasing==1.0&&d>0.9*center&&d<=center){if(alpha>=0.5){color.a=0.9;}else{color.a=1.0-smoothstep(0.9*center,center,d);}}}else{if(alpha>=0.5){color.a=0.9;if(uAntiAliasing==1.0){if(alpha>=0.5&&alpha<=0.6){color.a*=smoothstep(0.0,0.1,alpha-0.5);}if(d>=0.98*R&&d<=R){color.a*=1.0-smoothstep(0.98,1.0,d/R);}}}else{color.a=0.0;}}gl_FragColor=color;}",bubble:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}float time=vStartTime+uTime;float range=mod(time,(duration+trail));float percent=0.0;if(range<=duration){percent=range/duration;}else{percent=1.0;}float center=vSize;float R=vRadius;float r=R*percent;vec4 color=vColor;if(d<=center){if(uAntiAliasing==1.0&&d>0.9*center&&d<=center){color.a=1.0-smoothstep(0.9*center,center,d);}}else{if(d<r){color.a=smoothstep(0.1,0.9,pow(d/r,2.0)*0.9);if(uAntiAliasing==1.0&&d>=0.9*r&&d<=r){color.a*=1.0-smoothstep(0.9,1.0,d/r);}if(range>duration){color.a*=1.0-(range-duration)/trail;}}else{color.a=0.0;}}gl_FragColor=color;}",breath:"varying vec4 vPosition;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}vec4 color=vColor;if(uAntiAliasing==1.0&&d>0.9*vRadius&&d<=vRadius){color.a=1.0-smoothstep(0.9*vRadius,vRadius,d);}float time=vStartTime+uTime;float range=mod(time,(duration+trail));float percent=0.0;if(range<=duration){percent=range/duration;}else{percent=1.0;}color.a*=abs(1.0-percent*2.0)+0.2;gl_FragColor=color;}"},Ws=function(t){function e(t){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.autoUpdate=!0,t.bufferData=[],t.initializeTime=new Date,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,type:"bubble",size:10,duration:1,trail:1,unit:"px",random:!0,color:"blue",antialias:!0,radius:function(t){return 2*t}}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Ms(this.gl,{vertexShader:"attribute vec3 aPos;attribute float aSize;attribute float aIndex;attribute vec4 aColor;attribute float aStartTime;attribute float aRadius;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vWidth;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vStartTime=aStartTime;vSize=aSize*uZoomUnits;vRadius=aRadius*uZoomUnits;float x=aPos.x;float y=aPos.y;float z=aPos.z*uZoomUnits;float R=vRadius;if(aIndex==1.0){x+=R;y-=R;}else if(aIndex==2.0){x-=R;y+=R;}else if(aIndex==3.0){x+=R;y+=R;}else{x-=R;y-=R;}vPosition=vec4(aPos.xy,z,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:Hs[this.options.type]||"bubble",defines:this.options.enablePicked?["PICK"]:[]},this),this.buffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var e=[{stride:44,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:44,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:12},{stride:44,name:"aIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:16},{stride:44,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:20},{stride:44,name:"aRadius",buffer:this.buffer,size:1,type:"FLOAT",offset:36},{stride:44,name:"aStartTime",buffer:this.buffer,size:1,type:"FLOAT",offset:40}];e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&e&&(this.uniforms={duration:t.duration,trail:t.trail},this.data=e,this.processData(),t.enablePicked&&this.parsePickData(e))}},{key:"processData",value:function(){var t=this,e=[],i=[];this.data.forEach((function(n,r){var o=n.size||t.options.size,a=n.radius||t.options.radius||1.618*o;"function"===typeof a&&(a=a(o));var s=n.color||t.options.color;s=t.normizedColor(s),n=t.normizedPoint(n.geometry.coordinates);for(var u=t.options.random?Math.random()*t.data.length*9999:0,l=0;4>l;l++)e.push(n[0],n[1],n[2]||0,o,l),e.push(s[0],s[1],s[2],s[3]),e.push(a),e.push(u);o=4*r,0<r&&i.push(o-1,o),i.push(o,o+1,o+2,o+3)})),this.bufferData=e,this.indexData=i,this.buffer.updateData(new Float32Array(e)),this.indexBuffer.updateData(new Uint32Array(i))}},{key:"parsePickData",value:function(t){var e=[];if(this.getOptions().enablePicked){for(var i=0;i<t.length;i++){var n=this.indexToRgb(i);e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255)}this.pickBuffer.updateData(new Float32Array(e))}}},{key:"render",value:function(t){var e=this.getOptions(),i=this.program,n=t.gl,r=t.matrix;i.use(n);var o=this.map.getZoomUnits();di(this.uniforms,this.getCommonUniforms(t),{uTime:(new Date-this.initializeTime)/1e3,uZoomUnits:"m"===e.unit?1:o,uMatrix:r,uAntiAliasing:e.antialias?1:0}),i.setUniforms(this.uniforms),this.setGLState({blend:!0,blendEquation:n.FUNC_ADD,blendFunc:[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA],depthTest:e.depthTest,depthMask:e.depthWrite}),0<this.indexData.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),n.drawElements(n.TRIANGLE_STRIP,this.indexData.length,n.UNSIGNED_INT,0))}}]),e}(Ns),Zs=si(Hs),Ys=r((function(t,e){e.__esModule=!0;var i=xi&&xi.__esModule?xi:{default:xi},n=Wr&&Wr.__esModule?Wr:{default:Wr};e.default=function t(e,r,o){null===e&&(e=Function.prototype);var a=(0,n.default)(e,r);return void 0!==a?"value"in a?a.value:(r=a.get,void 0===r?void 0:r.call(o)):(e=(0,i.default)(e),null!==e?t(e,r,o):void 0)}})),Xs=n(Ys),Vs=r((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=function(t){e.ARRAY_TYPE=n=t},e.toRadian=function(t){return t*r},e.equals=function(t,e){return Math.abs(t-e)<=i*Math.max(1,Math.abs(t),Math.abs(e))},e.RANDOM=e.ARRAY_TYPE=e.EPSILON=void 0;var i=1e-6;e.EPSILON=i;var n="undefined"!==typeof Float32Array?Float32Array:Array;e.ARRAY_TYPE=n,e.RANDOM=Math.random;var r=Math.PI/180}));n(Vs);var Gs=r((function(t,e){function i(t,e,i){var n=e[0],r=e[1],o=e[2];e=e[3];var a=i[0],s=i[1],u=i[2];return i=i[3],t[0]=n*a+o*s,t[1]=r*a+e*s,t[2]=n*u+o*i,t[3]=r*u+e*i,t}function n(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},e.fromValues=function(t,e,i,n){var o=new r.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=i,o[3]=n,o},e.set=function(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t},e.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},e.invert=function(t,e){var i=e[0],n=e[1],r=e[2];e=e[3];var o=i*e-r*n;return o?(o=1/o,t[0]=e*o,t[1]=-n*o,t[2]=-r*o,t[3]=i*o,t):null},e.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},e.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},e.multiply=i,e.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2];e=e[3];var a=Math.sin(i);return i=Math.cos(i),t[0]=n*i+o*a,t[1]=r*i+e*a,t[2]=n*-a+o*i,t[3]=r*-a+e*i,t},e.scale=function(t,e,i){var n=e[1],r=e[2],o=e[3],a=i[0];return i=i[1],t[0]=e[0]*a,t[1]=n*a,t[2]=r*i,t[3]=o*i,t},e.fromRotation=function(t,e){var i=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=i,t[2]=-i,t[3]=e,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},e.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},e.LDU=function(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},e.subtract=n,e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var i=t[0],n=t[1],o=t[2];t=t[3];var a=e[0],s=e[1],u=e[2];return e=e[3],Math.abs(i-a)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-u)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},e.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},e.sub=e.mul=void 0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Ti&&Zr?Zr(t,i):{};n.get||n.set?Ti(e,i,n):e[i]=t[i]}return e.default=t,e}(Vs);e.mul=i,e.sub=n}));n(Gs);var qs=r((function(t,e){function i(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4];e=e[5];var u=i[0],l=i[1],h=i[2],f=i[3],c=i[4];return i=i[5],t[0]=n*u+o*l,t[1]=r*u+a*l,t[2]=n*h+o*f,t[3]=r*h+a*f,t[4]=n*c+o*i+s,t[5]=r*c+a*i+e,t}function n(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new r.ARRAY_TYPE(6);return r.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new r.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},e.fromValues=function(t,e,i,n,o,a){var s=new r.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s[4]=o,s[5]=a,s},e.set=function(t,e,i,n,r,o,a){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=a,t},e.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4];e=e[5];var s=i*o-n*r;return s?(s=1/s,t[0]=o*s,t[1]=-n*s,t[2]=-r*s,t[3]=i*s,t[4]=(r*e-o*a)*s,t[5]=(n*a-i*e)*s,t):null},e.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},e.multiply=i,e.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4];e=e[5];var u=Math.sin(i);return i=Math.cos(i),t[0]=n*i+o*u,t[1]=r*i+a*u,t[2]=n*-u+o*i,t[3]=r*-u+a*i,t[4]=s,t[5]=e,t},e.scale=function(t,e,i){var n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=i[0];return i=i[1],t[0]=e[0]*u,t[1]=n*u,t[2]=r*i,t[3]=o*i,t[4]=a,t[5]=s,t},e.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4];e=e[5];var u=i[0];return i=i[1],t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=n*u+o*i+s,t[5]=r*u+a*i+e,t},e.fromRotation=function(t,e){var i=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=i,t[2]=-i,t[3]=e,t[4]=0,t[5]=0,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},e.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},e.subtract=n,e.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},e.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},e.equals=function(t,e){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4];t=t[5];var u=e[0],l=e[1],h=e[2],f=e[3],c=e[4];return e=e[5],Math.abs(i-u)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-l)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-h)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-f)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-c)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Ti&&Zr?Zr(t,i):{};n.get||n.set?Ti(e,i,n):e[i]=t[i]}return e.default=t,e}(Vs);e.mul=i,e.sub=n}));n(qs);var Ks=r((function(t,e){function i(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var f=i[0],c=i[1],p=i[2],d=i[3],v=i[4],g=i[5],m=i[6],y=i[7];return i=i[8],t[0]=f*n+c*a+p*l,t[1]=f*r+c*s+p*h,t[2]=f*o+c*u+p*e,t[3]=d*n+v*a+g*l,t[4]=d*r+v*s+g*h,t[5]=d*o+v*u+g*e,t[6]=m*n+y*a+i*l,t[7]=m*r+y*s+i*h,t[8]=m*o+y*u+i*e,t}function n(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new r.ARRAY_TYPE(9);return r.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},e.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},e.clone=function(t){var e=new r.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromValues=function(t,e,i,n,o,a,s,u,l){var h=new r.ARRAY_TYPE(9);return h[0]=t,h[1]=e,h[2]=i,h[3]=n,h[4]=o,h[5]=a,h[6]=s,h[7]=u,h[8]=l,h},e.set=function(t,e,i,n,r,o,a,s,u,l){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},e.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7];e=e[8];var h=e*a-s*l,f=-e*o+s*u,c=l*o-a*u,p=i*h+n*f+r*c;return p?(p=1/p,t[0]=h*p,t[1]=(-e*n+r*l)*p,t[2]=(s*n-r*a)*p,t[3]=f*p,t[4]=(e*i-r*u)*p,t[5]=(-s*i+r*o)*p,t[6]=c*p,t[7]=(-l*i+n*u)*p,t[8]=(a*i-n*o)*p,t):null},e.adjoint=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7];return e=e[8],t[0]=a*e-s*l,t[1]=r*l-n*e,t[2]=n*s-r*a,t[3]=s*u-o*e,t[4]=i*e-r*u,t[5]=r*o-i*s,t[6]=o*l-a*u,t[7]=n*u-i*l,t[8]=i*a-n*o,t},e.determinant=function(t){var e=t[3],i=t[4],n=t[5],r=t[6],o=t[7],a=t[8];return t[0]*(a*i-n*o)+t[1]*(-a*e+n*r)+t[2]*(o*e-i*r)},e.multiply=i,e.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var f=i[0];return i=i[1],t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=f*n+i*a+l,t[7]=f*r+i*s+h,t[8]=f*o+i*u+e,t},e.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var f=Math.sin(i);return i=Math.cos(i),t[0]=i*n+f*a,t[1]=i*r+f*s,t[2]=i*o+f*u,t[3]=i*a-f*n,t[4]=i*s-f*r,t[5]=i*u-f*o,t[6]=l,t[7]=h,t[8]=e,t},e.scale=function(t,e,i){var n=i[0];return i=i[1],t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},e.fromRotation=function(t,e){var i=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=i,t[2]=0,t[3]=-i,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},e.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2];e=e[3];var o=i+i,a=n+n,s=r+r;i*=o;var u=n*o;n*=a;var l=r*o,h=r*a;return r*=s,o*=e,a*=e,e*=s,t[0]=1-n-r,t[3]=u-e,t[6]=l+a,t[1]=u+e,t[4]=1-i-r,t[7]=h-o,t[2]=l-a,t[5]=h+o,t[8]=1-i-n,t},e.normalFromMat4=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],f=e[9],c=e[10],p=e[11],d=e[12],v=e[13],g=e[14];e=e[15];var m=i*s-n*a,y=i*u-r*a,x=i*l-o*a,b=n*u-r*s,_=n*l-o*s,w=r*l-o*u,A=h*v-f*d,T=h*g-c*d;h=h*e-p*d;var M=f*g-c*v;return f=f*e-p*v,c=c*e-p*g,p=m*c-y*f+x*M+b*h-_*T+w*A,p?(p=1/p,t[0]=(s*c-u*f+l*M)*p,t[1]=(u*h-a*c-l*T)*p,t[2]=(a*f-s*h+l*A)*p,t[3]=(r*f-n*c-o*M)*p,t[4]=(i*c-r*h+o*T)*p,t[5]=(n*h-i*f-o*A)*p,t[6]=(v*w-g*_+e*b)*p,t[7]=(g*x-d*w-e*y)*p,t[8]=(d*_-v*x+e*m)*p,t):null},e.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},e.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},e.subtract=n,e.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},e.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},e.equals=function(t,e){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],h=t[7];t=t[8];var f=e[0],c=e[1],p=e[2],d=e[3],v=e[4],g=e[5],m=e[6],y=e[7];return e=e[8],Math.abs(i-f)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-c)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-p)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-d)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-v)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-g)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(l-m)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-y)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Ti&&Zr?Zr(t,i):{};n.get||n.set?Ti(e,i,n):e[i]=t[i]}return e.default=t,e}(Vs);e.mul=i,e.sub=n}));n(Ks);var Qs=r((function(t,e){function i(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function n(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7],f=e[8],c=e[9],p=e[10],d=e[11],v=e[12],g=e[13],m=e[14];e=e[15];var y=i[0],x=i[1],b=i[2],_=i[3];return t[0]=y*n+x*s+b*f+_*v,t[1]=y*r+x*u+b*c+_*g,t[2]=y*o+x*l+b*p+_*m,t[3]=y*a+x*h+b*d+_*e,y=i[4],x=i[5],b=i[6],_=i[7],t[4]=y*n+x*s+b*f+_*v,t[5]=y*r+x*u+b*c+_*g,t[6]=y*o+x*l+b*p+_*m,t[7]=y*a+x*h+b*d+_*e,y=i[8],x=i[9],b=i[10],_=i[11],t[8]=y*n+x*s+b*f+_*v,t[9]=y*r+x*u+b*c+_*g,t[10]=y*o+x*l+b*p+_*m,t[11]=y*a+x*h+b*d+_*e,y=i[12],x=i[13],b=i[14],_=i[15],t[12]=y*n+x*s+b*f+_*v,t[13]=y*r+x*u+b*c+_*g,t[14]=y*o+x*l+b*p+_*m,t[15]=y*a+x*h+b*d+_*e,t}function r(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=n+n,u=r+r,l=o+o;e=n*s;var h=n*u;n*=l;var f=r*u;return r*=l,o*=l,s*=a,u*=a,a*=l,t[0]=1-(f+o),t[1]=h+a,t[2]=n-u,t[3]=0,t[4]=h-a,t[5]=1-(e+o),t[6]=r+s,t[7]=0,t[8]=n+u,t[9]=r-s,t[10]=1-(e+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function o(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new a.ARRAY_TYPE(16);return a.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},e.clone=function(t){var e=new a.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.fromValues=function(t,e,i,n,r,o,s,u,l,h,f,c,p,d,v,g){var m=new a.ARRAY_TYPE(16);return m[0]=t,m[1]=e,m[2]=i,m[3]=n,m[4]=r,m[5]=o,m[6]=s,m[7]=u,m[8]=l,m[9]=h,m[10]=f,m[11]=c,m[12]=p,m[13]=d,m[14]=v,m[15]=g,m},e.set=function(t,e,i,n,r,o,a,s,u,l,h,f,c,p,d,v,g){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=h,t[10]=f,t[11]=c,t[12]=p,t[13]=d,t[14]=v,t[15]=g,t},e.identity=i,e.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],r=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=r,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},e.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],f=e[9],c=e[10],p=e[11],d=e[12],v=e[13],g=e[14];e=e[15];var m=i*s-n*a,y=i*u-r*a,x=i*l-o*a,b=n*u-r*s,_=n*l-o*s,w=r*l-o*u,A=h*v-f*d,T=h*g-c*d,M=h*e-p*d,P=f*g-c*v,S=f*e-p*v,E=c*e-p*g,C=m*E-y*S+x*P+b*M-_*T+w*A;return C?(C=1/C,t[0]=(s*E-u*S+l*P)*C,t[1]=(r*S-n*E-o*P)*C,t[2]=(v*w-g*_+e*b)*C,t[3]=(c*_-f*w-p*b)*C,t[4]=(u*M-a*E-l*T)*C,t[5]=(i*E-r*M+o*T)*C,t[6]=(g*x-d*w-e*y)*C,t[7]=(h*w-c*x+p*y)*C,t[8]=(a*S-s*M+l*A)*C,t[9]=(n*M-i*S-o*A)*C,t[10]=(d*_-v*x+e*m)*C,t[11]=(f*x-h*_-p*m)*C,t[12]=(s*T-a*P-u*A)*C,t[13]=(i*P-n*T+r*A)*C,t[14]=(v*y-d*b-g*m)*C,t[15]=(h*b-f*y+c*m)*C,t):null},e.adjoint=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],f=e[9],c=e[10],p=e[11],d=e[12],v=e[13],g=e[14];return e=e[15],t[0]=s*(c*e-p*g)-f*(u*e-l*g)+v*(u*p-l*c),t[1]=-(n*(c*e-p*g)-f*(r*e-o*g)+v*(r*p-o*c)),t[2]=n*(u*e-l*g)-s*(r*e-o*g)+v*(r*l-o*u),t[3]=-(n*(u*p-l*c)-s*(r*p-o*c)+f*(r*l-o*u)),t[4]=-(a*(c*e-p*g)-h*(u*e-l*g)+d*(u*p-l*c)),t[5]=i*(c*e-p*g)-h*(r*e-o*g)+d*(r*p-o*c),t[6]=-(i*(u*e-l*g)-a*(r*e-o*g)+d*(r*l-o*u)),t[7]=i*(u*p-l*c)-a*(r*p-o*c)+h*(r*l-o*u),t[8]=a*(f*e-p*v)-h*(s*e-l*v)+d*(s*p-l*f),t[9]=-(i*(f*e-p*v)-h*(n*e-o*v)+d*(n*p-o*f)),t[10]=i*(s*e-l*v)-a*(n*e-o*v)+d*(n*l-o*s),t[11]=-(i*(s*p-l*f)-a*(n*p-o*f)+h*(n*l-o*s)),t[12]=-(a*(f*g-c*v)-h*(s*g-u*v)+d*(s*c-u*f)),t[13]=i*(f*g-c*v)-h*(n*g-r*v)+d*(n*c-r*f),t[14]=-(i*(s*g-u*v)-a*(n*g-r*v)+d*(n*u-r*s)),t[15]=i*(s*c-u*f)-a*(n*c-r*f)+h*(n*u-r*s),t},e.determinant=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],h=t[9],f=t[10],c=t[11],p=t[12],d=t[13],v=t[14];return t=t[15],(e*a-i*o)*(f*t-c*v)-(e*s-n*o)*(h*t-c*d)+(e*u-r*o)*(h*v-f*d)+(i*s-n*a)*(l*t-c*p)-(i*u-r*a)*(l*v-f*p)+(n*u-r*s)*(l*d-h*p)},e.multiply=n,e.translate=function(t,e,i){var n=i[0],r=i[1];if(i=i[2],e===t)t[12]=e[0]*n+e[4]*r+e[8]*i+e[12],t[13]=e[1]*n+e[5]*r+e[9]*i+e[13],t[14]=e[2]*n+e[6]*r+e[10]*i+e[14],t[15]=e[3]*n+e[7]*r+e[11]*i+e[15];else{var o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],h=e[5],f=e[6],c=e[7],p=e[8],d=e[9],v=e[10],g=e[11];t[0]=o,t[1]=a,t[2]=s,t[3]=u,t[4]=l,t[5]=h,t[6]=f,t[7]=c,t[8]=p,t[9]=d,t[10]=v,t[11]=g,t[12]=o*n+l*r+p*i+e[12],t[13]=a*n+h*r+d*i+e[13],t[14]=s*n+f*r+v*i+e[14],t[15]=u*n+c*r+g*i+e[15]}return t},e.scale=function(t,e,i){var n=i[0],r=i[1];return i=i[2],t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.rotate=function(t,e,i,n){var r=n[0],o=n[1];n=n[2];var s=Math.sqrt(r*r+o*o+n*n);if(s<a.EPSILON)return null;s=1/s,r*=s,o*=s,n*=s;var u=Math.sin(i),l=Math.cos(i),h=1-l;i=e[0],s=e[1];var f=e[2],c=e[3],p=e[4],d=e[5],v=e[6],g=e[7],m=e[8],y=e[9],x=e[10],b=e[11],_=r*r*h+l,w=o*r*h+n*u,A=n*r*h-o*u,T=r*o*h-n*u,M=o*o*h+l,P=n*o*h+r*u,S=r*n*h+o*u;return r=o*n*h-r*u,o=n*n*h+l,t[0]=i*_+p*w+m*A,t[1]=s*_+d*w+y*A,t[2]=f*_+v*w+x*A,t[3]=c*_+g*w+b*A,t[4]=i*T+p*M+m*P,t[5]=s*T+d*M+y*P,t[6]=f*T+v*M+x*P,t[7]=c*T+g*M+b*P,t[8]=i*S+p*r+m*o,t[9]=s*S+d*r+y*o,t[10]=f*S+v*r+x*o,t[11]=c*S+g*r+b*o,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},e.rotateX=function(t,e,i){var n=Math.sin(i);i=Math.cos(i);var r=e[4],o=e[5],a=e[6],s=e[7],u=e[8],l=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*i+u*n,t[5]=o*i+l*n,t[6]=a*i+h*n,t[7]=s*i+f*n,t[8]=u*i-r*n,t[9]=l*i-o*n,t[10]=h*i-a*n,t[11]=f*i-s*n,t},e.rotateY=function(t,e,i){var n=Math.sin(i);i=Math.cos(i);var r=e[0],o=e[1],a=e[2],s=e[3],u=e[8],l=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*i-u*n,t[1]=o*i-l*n,t[2]=a*i-h*n,t[3]=s*i-f*n,t[8]=r*n+u*i,t[9]=o*n+l*i,t[10]=a*n+h*i,t[11]=s*n+f*i,t},e.rotateZ=function(t,e,i){var n=Math.sin(i);i=Math.cos(i);var r=e[0],o=e[1],a=e[2],s=e[3],u=e[4],l=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*i+u*n,t[1]=o*i+l*n,t[2]=a*i+h*n,t[3]=s*i+f*n,t[4]=u*i-r*n,t[5]=l*i-o*n,t[6]=h*i-a*n,t[7]=f*i-s*n,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotation=function(t,e,i){var n=i[0],r=i[1];i=i[2];var o=Math.sqrt(n*n+r*r+i*i);if(o<a.EPSILON)return null;o=1/o,n*=o,r*=o,i*=o,o=Math.sin(e),e=Math.cos(e);var s=1-e;return t[0]=n*n*s+e,t[1]=r*n*s+i*o,t[2]=i*n*s-r*o,t[3]=0,t[4]=n*r*s-i*o,t[5]=r*r*s+e,t[6]=i*r*s+n*o,t[7]=0,t[8]=n*i*s+r*o,t[9]=r*i*s-n*o,t[10]=i*i*s+e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromXRotation=function(t,e){var i=Math.sin(e);return e=Math.cos(e),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromYRotation=function(t,e){var i=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromZRotation=function(t,e){var i=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotationTranslation=r,e.fromQuat2=function(t,e){var i=new a.ARRAY_TYPE(3),n=-e[0],o=-e[1],s=-e[2],u=e[3],l=e[4],h=e[5],f=e[6],c=e[7],p=n*n+o*o+s*s+u*u;return 0<p?(i[0]=2*(l*u+c*n+h*s-f*o)/p,i[1]=2*(h*u+c*o+f*n-l*s)/p,i[2]=2*(f*u+c*s+l*o-h*n)/p):(i[0]=2*(l*u+c*n+h*s-f*o),i[1]=2*(h*u+c*o+f*n-l*s),i[2]=2*(f*u+c*s+l*o-h*n)),r(t,e,i),t},e.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},e.getScaling=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[4],a=e[5],s=e[6],u=e[8],l=e[9];return e=e[10],t[0]=Math.sqrt(i*i+n*n+r*r),t[1]=Math.sqrt(o*o+a*a+s*s),t[2]=Math.sqrt(u*u+l*l+e*e),t},e.getRotation=function(t,e){var i=e[0]+e[5]+e[10];return 0<i?(i=2*Math.sqrt(i+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t},e.fromRotationTranslationScale=function(t,e,i,n){var r=e[0],o=e[1],a=e[2],s=e[3],u=r+r,l=o+o,h=a+a;e=r*u;var f=r*l;r*=h;var c=o*l;o*=h,a*=h,u*=s,l*=s,s*=h,h=n[0];var p=n[1];return n=n[2],t[0]=(1-(c+a))*h,t[1]=(f+s)*h,t[2]=(r-l)*h,t[3]=0,t[4]=(f-s)*p,t[5]=(1-(e+a))*p,t[6]=(o+u)*p,t[7]=0,t[8]=(r+l)*n,t[9]=(o-u)*n,t[10]=(1-(e+c))*n,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},e.fromRotationTranslationScaleOrigin=function(t,e,i,n,r){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,h=a+a,f=s+s;e=o*l;var c=o*h,p=o*f;o=a*h,a*=f;var d=s*f;s=u*l,h*=u;var v=u*f,g=n[0],m=n[1];f=n[2],n=r[0],u=r[1],r=r[2],l=(1-(o+d))*g;var y=(c+v)*g;return g*=p-h,c=(c-v)*m,d=(1-(e+d))*m,m*=a+s,p=(p+h)*f,a=(a-s)*f,e=(1-(e+o))*f,t[0]=l,t[1]=y,t[2]=g,t[3]=0,t[4]=c,t[5]=d,t[6]=m,t[7]=0,t[8]=p,t[9]=a,t[10]=e,t[11]=0,t[12]=i[0]+n-(l*n+c*u+p*r),t[13]=i[1]+u-(y*n+d*u+a*r),t[14]=i[2]+r-(g*n+m*u+e*r),t[15]=1,t},e.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2];e=e[3];var o=i+i,a=n+n,s=r+r;i*=o;var u=n*o;n*=a;var l=r*o,h=r*a;return r*=s,o*=e,a*=e,e*=s,t[0]=1-n-r,t[1]=u+e,t[2]=l-a,t[3]=0,t[4]=u-e,t[5]=1-i-r,t[6]=h+o,t[7]=0,t[8]=l+a,t[9]=h-o,t[10]=1-i-n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.frustum=function(t,e,i,n,r,o,a){var s=1/(i-e),u=1/(r-n),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(i+e)*s,t[9]=(r+n)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t},e.perspective=function(t,e,i,n,r){return e=1/Math.tan(e/2),t[0]=e/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&1/0!==r?(i=1/(n-r),t[10]=(r+n)*i,t[14]=2*r*n*i):(t[10]=-1,t[14]=-2*n),t},e.perspectiveFromFieldOfView=function(t,e,i,n){var r=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180);e=Math.tan(e.rightDegrees*Math.PI/180);var s=2/(a+e),u=2/(r+o);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(a-e)*s*.5,t[9]=(r-o)*u*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t},e.ortho=function(t,e,i,n,r,o,a){var s=1/(e-i),u=1/(n-r),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*s,t[13]=(r+n)*u,t[14]=(a+o)*l,t[15]=1,t},e.lookAt=function(t,e,n,r){var o=e[0],s=e[1];e=e[2];var u=r[0],l=r[1],h=r[2],f=n[0];r=n[1];var c=n[2];if(Math.abs(o-f)<a.EPSILON&&Math.abs(s-r)<a.EPSILON&&Math.abs(e-c)<a.EPSILON)return i(t);n=o-f,r=s-r,f=e-c;var p=1/Math.sqrt(n*n+r*r+f*f);n*=p,r*=p,f*=p,c=l*f-h*r,h=h*n-u*f,u=u*r-l*n,(p=Math.sqrt(c*c+h*h+u*u))?(p=1/p,c*=p,h*=p,u*=p):u=h=c=0,l=r*u-f*h;var d=f*c-n*u,v=n*h-r*c;return(p=Math.sqrt(l*l+d*d+v*v))?(p=1/p,l*=p,d*=p,v*=p):v=d=l=0,t[0]=c,t[1]=l,t[2]=n,t[3]=0,t[4]=h,t[5]=d,t[6]=r,t[7]=0,t[8]=u,t[9]=v,t[10]=f,t[11]=0,t[12]=-(c*o+h*s+u*e),t[13]=-(l*o+d*s+v*e),t[14]=-(n*o+r*s+f*e),t[15]=1,t},e.targetTo=function(t,e,i,n){var r=e[0],o=e[1];e=e[2];var a=n[0],s=n[1],u=n[2];n=r-i[0];var l=o-i[1];i=e-i[2];var h=n*n+l*l+i*i;0<h&&(h=1/Math.sqrt(h),n*=h,l*=h,i*=h);var f=s*i-u*l;return u=u*n-a*i,a=a*l-s*n,h=f*f+u*u+a*a,0<h&&(h=1/Math.sqrt(h),f*=h,u*=h,a*=h),t[0]=f,t[1]=u,t[2]=a,t[3]=0,t[4]=l*a-i*u,t[5]=i*f-n*a,t[6]=n*u-l*f,t[7]=0,t[8]=n,t[9]=l,t[10]=i,t[11]=0,t[12]=r,t[13]=o,t[14]=e,t[15]=1,t},e.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},e.subtract=o,e.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},e.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t[9]=e[9]+i[9]*n,t[10]=e[10]+i[10]*n,t[11]=e[11]+i[11]*n,t[12]=e[12]+i[12]*n,t[13]=e[13]+i[13]*n,t[14]=e[14]+i[14]*n,t[15]=e[15]+i[15]*n,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},e.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],u=t[5],l=t[6],h=t[7],f=t[8],c=t[9],p=t[10],d=t[11],v=t[12],g=t[13],m=t[14];t=t[15];var y=e[0],x=e[1],b=e[2],_=e[3],w=e[4],A=e[5],T=e[6],M=e[7],P=e[8],S=e[9],E=e[10],C=e[11],L=e[12],R=e[13],k=e[14];return e=e[15],Math.abs(i-y)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-x)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(r-b)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(o-_)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(s-w)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-A)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-T)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(h-M)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(f-P)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(c-S)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(p-E)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(d-C)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(v-L)<=a.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(g-R)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(m-k)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(t-e)<=a.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Ti&&Zr?Zr(t,i):{};n.get||n.set?Ti(e,i,n):e[i]=t[i]}return e.default=t,e}(Vs);e.mul=n,e.sub=o}));n(Qs);var Js=r((function(t,e){function i(){var t=new p.ARRAY_TYPE(3);return p.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function n(t){var e=t[0],i=t[1];return t=t[2],Math.sqrt(e*e+i*i+t*t)}function r(t,e,i){var n=new p.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n}function o(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function a(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function s(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function u(t,e){var i=e[0]-t[0],n=e[1]-t[1];return t=e[2]-t[2],Math.sqrt(i*i+n*n+t*t)}function l(t,e){var i=e[0]-t[0],n=e[1]-t[1];return t=e[2]-t[2],i*i+n*n+t*t}function h(t){var e=t[0],i=t[1];return t=t[2],e*e+i*i+t*t}function f(t,e){var i=e[0],n=e[1],r=e[2];return i=i*i+n*n+r*r,0<i&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function c(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Object.defineProperty(e,"__esModule",{value:!0}),e.create=i,e.clone=function(t){var e=new p.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.length=n,e.fromValues=r,e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},e.subtract=o,e.multiply=a,e.divide=s,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},e.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},e.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},e.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},e.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},e.distance=u,e.squaredDistance=l,e.squaredLength=h,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},e.normalize=f,e.dot=c,e.cross=function(t,e,i){var n=e[0],r=e[1];e=e[2];var o=i[0],a=i[1];return i=i[2],t[0]=r*i-e*a,t[1]=e*o-n*i,t[2]=n*a-r*o,t},e.lerp=function(t,e,i,n){var r=e[0],o=e[1];return e=e[2],t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t[2]=e+n*(i[2]-e),t},e.hermite=function(t,e,i,n,r,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1);return o=a*(3-2*o),t[0]=e[0]*s+i[0]*u+n[0]*l+r[0]*o,t[1]=e[1]*s+i[1]*u+n[1]*l+r[1]*o,t[2]=e[2]*s+i[2]*u+n[2]*l+r[2]*o,t},e.bezier=function(t,e,i,n,r,o){var a=1-o,s=a*a,u=o*o,l=s*a;return s*=3*o,a*=3*u,o*=u,t[0]=e[0]*l+i[0]*s+n[0]*a+r[0]*o,t[1]=e[1]*l+i[1]*s+n[1]*a+r[1]*o,t[2]=e[2]*l+i[2]*s+n[2]*a+r[2]*o,t},e.random=function(t,e){e=e||1;var i=2*p.RANDOM()*Math.PI,n=2*p.RANDOM()-1,r=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*r,t[1]=Math.sin(i)*r,t[2]=n*e,t},e.transformMat4=function(t,e,i){var n=e[0],r=e[1];e=e[2];var o=i[3]*n+i[7]*r+i[11]*e+i[15];return o=o||1,t[0]=(i[0]*n+i[4]*r+i[8]*e+i[12])/o,t[1]=(i[1]*n+i[5]*r+i[9]*e+i[13])/o,t[2]=(i[2]*n+i[6]*r+i[10]*e+i[14])/o,t},e.transformMat3=function(t,e,i){var n=e[0],r=e[1];return e=e[2],t[0]=n*i[0]+r*i[3]+e*i[6],t[1]=n*i[1]+r*i[4]+e*i[7],t[2]=n*i[2]+r*i[5]+e*i[8],t},e.transformQuat=function(t,e,i){var n=i[0],r=i[1],o=i[2],a=e[0],s=e[1];e=e[2];var u=r*e-o*s,l=o*a-n*e,h=n*s-r*a;return i=2*i[3],t[0]=a+u*i+2*(r*h-o*l),t[1]=s+l*i+2*(o*u-n*h),t[2]=e+h*i+2*(n*l-r*u),t},e.rotateX=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},e.rotateY=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},e.rotateZ=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},e.angle=function(t,e){return t=r(t[0],t[1],t[2]),e=r(e[0],e[1],e[2]),f(t,t),f(e,e),e=c(t,e),1<e?0:-1>e?Math.PI:Math.acos(e)},e.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},e.equals=function(t,e){var i=t[0],n=t[1];t=t[2];var r=e[0],o=e[1];return e=e[2],Math.abs(i-r)<=p.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-o)<=p.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(t-e)<=p.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0;var p=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Ti&&Zr?Zr(t,i):{};n.get||n.set?Ti(e,i,n):e[i]=t[i]}return e.default=t,e}(Vs);e.sub=o,e.mul=a,e.div=s,e.dist=u,e.sqrDist=l,e.len=n,e.sqrLen=h,t=function(){var t=i();return function(e,i,n,r,o,a){for(i||(i=3),n||(n=0),r=r?Math.min(r*i+n,e.length):e.length;n<r;n+=i)t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],o(t,t,a),e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2];return e}}(),e.forEach=t}));n(Js);var $s=r((function(t,e){function i(){var t=new h.ARRAY_TYPE(4);return h.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function n(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function r(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function o(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function a(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return t=e[3]-t[3],Math.sqrt(i*i+n*n+r*r+t*t)}function s(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return t=e[3]-t[3],i*i+n*n+r*r+t*t}function u(t){var e=t[0],i=t[1],n=t[2];return t=t[3],Math.sqrt(e*e+i*i+n*n+t*t)}function l(t){var e=t[0],i=t[1],n=t[2];return t=t[3],e*e+i*i+n*n+t*t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=i,e.clone=function(t){var e=new h.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.fromValues=function(t,e,i,n){var r=new h.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.set=function(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},e.subtract=n,e.multiply=r,e.divide=o,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},e.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},e.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},e.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},e.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},e.distance=a,e.squaredDistance=s,e.length=u,e.squaredLength=l,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},e.normalize=function(t,e){var i=e[0],n=e[1],r=e[2];e=e[3];var o=i*i+n*n+r*r+e*e;return 0<o&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=n*o,t[2]=r*o,t[3]=e*o,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},e.cross=function(t,e,i,n){var r=i[0]*n[1]-i[1]*n[0],o=i[0]*n[2]-i[2]*n[0],a=i[0]*n[3]-i[3]*n[0],s=i[1]*n[2]-i[2]*n[1],u=i[1]*n[3]-i[3]*n[1];i=i[2]*n[3]-i[3]*n[2],n=e[0];var l=e[1],h=e[2];return e=e[3],t[0]=l*i-h*u+e*s,t[1]=-n*i+h*a-e*o,t[2]=n*u-l*a+e*r,t[3]=-n*s+l*o-h*r,t},e.lerp=function(t,e,i,n){var r=e[0],o=e[1],a=e[2];return e=e[3],t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t[2]=a+n*(i[2]-a),t[3]=e+n*(i[3]-e),t},e.random=function(t,e){e=e||1;do{var i=2*h.RANDOM()-1,n=2*h.RANDOM()-1,r=i*i+n*n}while(1<=r);do{var o=2*h.RANDOM()-1,a=2*h.RANDOM()-1,s=o*o+a*a}while(1<=s);return r=Math.sqrt((1-r)/s),t[0]=e*i,t[1]=e*n,t[2]=e*o*r,t[3]=e*a*r,t},e.transformMat4=function(t,e,i){var n=e[0],r=e[1],o=e[2];return e=e[3],t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*e,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*e,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*e,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*e,t},e.transformQuat=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=i[0],s=i[1],u=i[2];i=i[3];var l=i*n+s*o-u*r,h=i*r+u*n-a*o,f=i*o+a*r-s*n;return n=-a*n-s*r-u*o,t[0]=l*i+n*-a+h*-u-f*-s,t[1]=h*i+n*-s+f*-a-l*-u,t[2]=f*i+n*-u+l*-s-h*-a,t[3]=e[3],t},e.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},e.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var i=t[0],n=t[1],r=t[2];t=t[3];var o=e[0],a=e[1],s=e[2];return e=e[3],Math.abs(i-o)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(t-e)<=h.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0;var h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Ti&&Zr?Zr(t,i):{};n.get||n.set?Ti(e,i,n):e[i]=t[i]}return e.default=t,e}(Vs);e.sub=n,e.mul=r,e.div=o,e.dist=a,e.sqrDist=s,e.len=u,e.sqrLen=l,t=function(){var t=i();return function(e,i,n,r,o,a){for(i||(i=4),n||(n=0),r=r?Math.min(r*i+n,e.length):e.length;n<r;n+=i)t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t[3]=e[n+3],o(t,t,a),e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=t[3];return e}}(),e.forEach=t}));n($s);var tu=r((function(t,e){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Ti&&Zr?Zr(t,i):{};n.get||n.set?Ti(e,i,n):e[i]=t[i]}return e.default=t,e}function n(){var t=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function r(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function o(t,e,i){var n=e[0],r=e[1],o=e[2];e=e[3];var a=i[0],s=i[1],u=i[2];return i=i[3],t[0]=n*i+e*a+r*u-o*s,t[1]=r*i+e*s+o*a-n*u,t[2]=o*i+e*u+n*s-r*a,t[3]=e*i-n*a-r*s-o*u,t}function a(t,e,i,n){var r=e[0],o=e[1],a=e[2];e=e[3];var s=i[0],l=i[1],h=i[2];i=i[3];var f=r*s+o*l+a*h+e*i;if(0>f&&(f=-f,s=-s,l=-l,h=-h,i=-i),1-f>u.EPSILON){var c=Math.acos(f),p=Math.sin(c);f=Math.sin((1-n)*c)/p,n=Math.sin(n*c)/p}else f=1-n;return t[0]=f*r+n*s,t[1]=f*o+n*l,t[2]=f*a+n*h,t[3]=f*e+n*i,t}function s(t,e){var i=e[0]+e[4]+e[8];if(0<i)i=Math.sqrt(i+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var r=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*r+r]-e[3*o+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*r+o]-e[3*o+r])*i,t[r]=(e[3*r+n]+e[3*n+r])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=n,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},e.setAxisAngle=r,e.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),n=Math.sin(i/2);return n>u.EPSILON?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),i},e.multiply=o,e.rotateX=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2];e=e[3];var a=Math.sin(i);return i=Math.cos(i),t[0]=n*i+e*a,t[1]=r*i+o*a,t[2]=o*i-r*a,t[3]=e*i-n*a,t},e.rotateY=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2];e=e[3];var a=Math.sin(i);return i=Math.cos(i),t[0]=n*i-o*a,t[1]=r*i+e*a,t[2]=o*i+n*a,t[3]=e*i-r*a,t},e.rotateZ=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2];e=e[3];var a=Math.sin(i);return i=Math.cos(i),t[0]=n*i+r*a,t[1]=r*i-n*a,t[2]=o*i+e*a,t[3]=e*i-o*a,t},e.calculateW=function(t,e){var i=e[0],n=e[1];return e=e[2],t[0]=i,t[1]=n,t[2]=e,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-e*e)),t},e.slerp=a,e.random=function(t){var e=u.RANDOM(),i=u.RANDOM(),n=u.RANDOM(),r=Math.sqrt(1-e);return e=Math.sqrt(e),t[0]=r*Math.sin(2*Math.PI*i),t[1]=r*Math.cos(2*Math.PI*i),t[2]=e*Math.sin(2*Math.PI*n),t[3]=e*Math.cos(2*Math.PI*n),t},e.invert=function(t,e){var i=e[0],n=e[1],r=e[2];e=e[3];var o=i*i+n*n+r*r+e*e;return o=o?1/o:0,t[0]=-i*o,t[1]=-n*o,t[2]=-r*o,t[3]=e*o,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},e.fromMat3=s,e.fromEuler=function(t,e,i,n){var r=.5*Math.PI/180;e*=r,i*=r,n*=r,r=Math.sin(e),e=Math.cos(e);var o=Math.sin(i);i=Math.cos(i);var a=Math.sin(n);return n=Math.cos(n),t[0]=r*i*n-e*o*a,t[1]=e*o*n+r*i*a,t[2]=e*i*a-r*o*n,t[3]=e*i*n+r*o*a,t},e.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.setAxes=e.sqlerp=e.rotationTo=e.equals=e.exactEquals=e.normalize=e.sqrLen=e.squaredLength=e.len=e.length=e.lerp=e.dot=e.scale=e.mul=e.add=e.set=e.copy=e.fromValues=e.clone=void 0;var u=i(Vs),l=i(Ks),h=i(Js);t=i($s),e.clone=t.clone,e.fromValues=t.fromValues,e.copy=t.copy,e.set=t.set,e.add=t.add,e.mul=o,e.scale=t.scale,e.dot=t.dot,e.lerp=t.lerp;var f=t.length;e.length=f,e.len=f,f=t.squaredLength,e.squaredLength=f,e.sqrLen=f;var c=t.normalize;e.normalize=c,e.exactEquals=t.exactEquals,e.equals=t.equals,t=function(){var t=h.create(),e=h.fromValues(1,0,0),i=h.fromValues(0,1,0);return function(n,o,a){var s=h.dot(o,a);return-.999999>s?(h.cross(t,e,o),1e-6>h.len(t)&&h.cross(t,i,o),h.normalize(t,t),r(n,t,Math.PI),n):.999999<s?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(h.cross(t,o,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+s,c(n,n))}}(),e.rotationTo=t,t=function(){var t=n(),e=n();return function(i,n,r,o,s,u){return a(t,n,s,u),a(e,r,o,u),a(i,t,e,2*u*(1-u)),i}}(),e.sqlerp=t,t=function(){var t=l.create();return function(e,i,n,r){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],c(e,s(e,t))}}(),e.setAxes=t}));n(tu);var eu=r((function(t,e){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Ti&&Zr?Zr(t,i):{};n.get||n.set?Ti(e,i,n):e[i]=t[i]}return e.default=t,e}function n(t,e,i){var n=.5*i[0],r=.5*i[1];i=.5*i[2];var o=e[0],a=e[1],s=e[2];return e=e[3],t[0]=o,t[1]=a,t[2]=s,t[3]=e,t[4]=n*e+r*s-i*a,t[5]=r*e+i*o-n*s,t[6]=i*e+n*a-r*o,t[7]=-n*o-r*a-i*s,t}function r(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function o(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=i[4],u=i[5],l=i[6],h=i[7],f=e[4],c=e[5],p=e[6];e=e[7];var d=i[0],v=i[1],g=i[2];return i=i[3],t[0]=n*i+a*d+r*g-o*v,t[1]=r*i+a*v+o*d-n*g,t[2]=o*i+a*g+n*v-r*d,t[3]=a*i-n*d-r*v-o*g,t[4]=n*h+a*s+r*l-o*u+f*i+e*d+c*g-p*v,t[5]=r*h+a*u+o*s-n*l+c*i+e*v+p*d-f*g,t[6]=o*h+a*l+n*u-r*s+p*i+e*g+f*v-c*d,t[7]=a*h-n*s-r*u-o*l+e*i-f*d-c*v-p*g,t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new a.ARRAY_TYPE(8);return a.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},e.clone=function(t){var e=new a.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},e.fromValues=function(t,e,i,n,r,o,s,u){var l=new a.ARRAY_TYPE(8);return l[0]=t,l[1]=e,l[2]=i,l[3]=n,l[4]=r,l[5]=o,l[6]=s,l[7]=u,l},e.fromRotationTranslationValues=function(t,e,i,n,r,o,s){var u=new a.ARRAY_TYPE(8);return u[0]=t,u[1]=e,u[2]=i,u[3]=n,r*=.5,o*=.5,s*=.5,u[4]=r*n+o*i-s*e,u[5]=o*n+s*t-r*i,u[6]=s*n+r*e-o*t,u[7]=-r*t-o*e-s*i,u},e.fromRotationTranslation=n,e.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},e.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.fromMat4=function(t,e){var i=s.create();u.getRotation(i,e);var r=new a.ARRAY_TYPE(3);return u.getTranslation(r,e),n(t,i,r),t},e.copy=r,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.set=function(t,e,i,n,r,o,a,s,u){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t},e.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},e.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},e.getTranslation=function(t,e){var i=e[4],n=e[5],r=e[6],o=e[7],a=-e[0],s=-e[1],u=-e[2];return e=e[3],t[0]=2*(i*e+o*a+n*u-r*s),t[1]=2*(n*e+o*s+r*a-i*u),t[2]=2*(r*e+o*u+i*s-n*a),t},e.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=.5*i[0],u=.5*i[1];i=.5*i[2];var l=e[4],h=e[5],f=e[6];return e=e[7],t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=a*s+r*i-o*u+l,t[5]=a*u+o*s-n*i+h,t[6]=a*i+n*u-r*s+f,t[7]=-n*s-r*u-o*i+e,t},e.rotateX=function(t,e,i){var n=-e[0],r=-e[1],o=-e[2],a=e[3],u=e[4],l=e[5],h=e[6],f=e[7],c=u*a+f*n+l*o-h*r,p=l*a+f*r+h*n-u*o,d=h*a+f*o+u*r-l*n;return u=f*a-u*n-l*r-h*o,s.rotateX(t,e,i),n=t[0],r=t[1],o=t[2],a=t[3],t[4]=c*a+u*n+p*o-d*r,t[5]=p*a+u*r+d*n-c*o,t[6]=d*a+u*o+c*r-p*n,t[7]=u*a-c*n-p*r-d*o,t},e.rotateY=function(t,e,i){var n=-e[0],r=-e[1],o=-e[2],a=e[3],u=e[4],l=e[5],h=e[6],f=e[7],c=u*a+f*n+l*o-h*r,p=l*a+f*r+h*n-u*o,d=h*a+f*o+u*r-l*n;return u=f*a-u*n-l*r-h*o,s.rotateY(t,e,i),n=t[0],r=t[1],o=t[2],a=t[3],t[4]=c*a+u*n+p*o-d*r,t[5]=p*a+u*r+d*n-c*o,t[6]=d*a+u*o+c*r-p*n,t[7]=u*a-c*n-p*r-d*o,t},e.rotateZ=function(t,e,i){var n=-e[0],r=-e[1],o=-e[2],a=e[3],u=e[4],l=e[5],h=e[6],f=e[7],c=u*a+f*n+l*o-h*r,p=l*a+f*r+h*n-u*o,d=h*a+f*o+u*r-l*n;return u=f*a-u*n-l*r-h*o,s.rotateZ(t,e,i),n=t[0],r=t[1],o=t[2],a=t[3],t[4]=c*a+u*n+p*o-d*r,t[5]=p*a+u*r+d*n-c*o,t[6]=d*a+u*o+c*r-p*n,t[7]=u*a-c*n-p*r-d*o,t},e.rotateByQuatAppend=function(t,e,i){var n=i[0],r=i[1],o=i[2];i=i[3];var a=e[0],s=e[1],u=e[2],l=e[3];return t[0]=a*i+l*n+s*o-u*r,t[1]=s*i+l*r+u*n-a*o,t[2]=u*i+l*o+a*r-s*n,t[3]=l*i-a*n-s*r-u*o,a=e[4],s=e[5],u=e[6],l=e[7],t[4]=a*i+l*n+s*o-u*r,t[5]=s*i+l*r+u*n-a*o,t[6]=u*i+l*o+a*r-s*n,t[7]=l*i-a*n-s*r-u*o,t},e.rotateByQuatPrepend=function(t,e,i){var n=e[0],r=e[1],o=e[2];e=e[3];var a=i[0],s=i[1],u=i[2],l=i[3];return t[0]=n*l+e*a+r*u-o*s,t[1]=r*l+e*s+o*a-n*u,t[2]=o*l+e*u+n*s-r*a,t[3]=e*l-n*a-r*s-o*u,a=i[4],s=i[5],u=i[6],l=i[7],t[4]=n*l+e*a+r*u-o*s,t[5]=r*l+e*s+o*a-n*u,t[6]=o*l+e*u+n*s-r*a,t[7]=e*l-n*a-r*s-o*u,t},e.rotateAroundAxis=function(t,e,i,n){if(Math.abs(n)<a.EPSILON)return r(t,e);var o=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);n*=.5;var s=Math.sin(n),u=s*i[0]/o,l=s*i[1]/o;i=s*i[2]/o,n=Math.cos(n),o=e[0],s=e[1];var h=e[2],f=e[3];return t[0]=o*n+f*u+s*i-h*l,t[1]=s*n+f*l+h*u-o*i,t[2]=h*n+f*i+o*l-s*u,t[3]=f*n-o*u-s*l-h*i,o=e[4],s=e[5],h=e[6],e=e[7],t[4]=o*n+e*u+s*i-h*l,t[5]=s*n+e*l+h*u-o*i,t[6]=h*n+e*i+o*l-s*u,t[7]=e*n-o*u-s*l-h*i,t},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},e.multiply=o,e.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},e.lerp=function(t,e,i,n){var r=1-n;return 0>l(e,i)&&(n=-n),t[0]=e[0]*r+i[0]*n,t[1]=e[1]*r+i[1]*n,t[2]=e[2]*r+i[2]*n,t[3]=e[3]*r+i[3]*n,t[4]=e[4]*r+i[4]*n,t[5]=e[5]*r+i[5]*n,t[6]=e[6]*r+i[6]*n,t[7]=e[7]*r+i[7]*n,t},e.invert=function(t,e){var i=h(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},e.normalize=function(t,e){var i=h(e);if(0<i){i=Math.sqrt(i);var n=e[0]/i,r=e[1]/i,o=e[2]/i,a=e[3]/i,s=e[4],u=e[5],l=e[6];e=e[7];var f=n*s+r*u+o*l+a*e;t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=(s-n*f)/i,t[5]=(u-r*f)/i,t[6]=(l-o*f)/i,t[7]=(e-a*f)/i}return t},e.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},e.equals=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],u=t[5],l=t[6];t=t[7];var h=e[0],f=e[1],c=e[2],p=e[3],d=e[4],v=e[5],g=e[6];return e=e[7],Math.abs(i-h)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-f)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-c)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(o-p)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-d)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(u-v)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(l-g)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(t-e)<=a.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sqrLen=e.squaredLength=e.len=e.length=e.dot=e.mul=e.setReal=e.getReal=void 0;var a=i(Vs),s=i(tu),u=i(Qs);e.getReal=s.copy,e.setReal=s.copy,e.mul=o;var l=s.dot;e.dot=l,t=s.length,e.length=t,e.len=t;var h=s.squaredLength;e.squaredLength=h,e.sqrLen=h}));n(eu);var iu=r((function(t,e){function i(){var t=new h.ARRAY_TYPE(2);return h.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function n(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function r(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function o(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function a(t,e){var i=e[0]-t[0];return t=e[1]-t[1],Math.sqrt(i*i+t*t)}function s(t,e){var i=e[0]-t[0];return t=e[1]-t[1],i*i+t*t}function u(t){var e=t[0];return t=t[1],Math.sqrt(e*e+t*t)}function l(t){var e=t[0];return t=t[1],e*e+t*t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=i,e.clone=function(t){var e=new h.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var i=new h.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,i){return t[0]=e,t[1]=i,t},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},e.subtract=n,e.multiply=r,e.divide=o,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},e.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},e.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},e.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},e.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},e.distance=a,e.squaredDistance=s,e.length=u,e.squaredLength=l,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},e.normalize=function(t,e){var i=e[0],n=e[1];return i=i*i+n*n,0<i&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,i){return e=e[0]*i[1]-e[1]*i[0],t[0]=t[1]=0,t[2]=e,t},e.lerp=function(t,e,i,n){var r=e[0];return e=e[1],t[0]=r+n*(i[0]-r),t[1]=e+n*(i[1]-e),t},e.random=function(t,e){e=e||1;var i=2*h.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},e.transformMat2=function(t,e,i){var n=e[0];return e=e[1],t[0]=i[0]*n+i[2]*e,t[1]=i[1]*n+i[3]*e,t},e.transformMat2d=function(t,e,i){var n=e[0];return e=e[1],t[0]=i[0]*n+i[2]*e+i[4],t[1]=i[1]*n+i[3]*e+i[5],t},e.transformMat3=function(t,e,i){var n=e[0];return e=e[1],t[0]=i[0]*n+i[3]*e+i[6],t[1]=i[1]*n+i[4]*e+i[7],t},e.transformMat4=function(t,e,i){var n=e[0];return e=e[1],t[0]=i[0]*n+i[4]*e+i[12],t[1]=i[1]*n+i[5]*e+i[13],t},e.rotate=function(t,e,i,n){var r=e[0]-i[0];e=e[1]-i[1];var o=Math.sin(n);return n=Math.cos(n),t[0]=r*n-e*o+i[0],t[1]=r*o+e*n+i[1],t},e.angle=function(t,e){var i=t[0];t=t[1];var n=e[0];e=e[1];var r=i*i+t*t;0<r&&(r=1/Math.sqrt(r));var o=n*n+e*e;return 0<o&&(o=1/Math.sqrt(o)),i=(i*n+t*e)*r*o,1<i?0:-1>i?Math.PI:Math.acos(i)},e.zero=function(t){return t[0]=0,t[1]=0,t},e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},e.equals=function(t,e){var i=t[0];t=t[1];var n=e[0];return e=e[1],Math.abs(i-n)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(t-e)<=h.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.sqrDist=e.dist=e.div=e.mul=e.sub=e.len=void 0;var h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Ti&&Zr?Zr(t,i):{};n.get||n.set?Ti(e,i,n):e[i]=t[i]}return e.default=t,e}(Vs);e.len=u,e.sub=n,e.mul=r,e.div=o,e.dist=a,e.sqrDist=s,e.sqrLen=l,t=function(){var t=i();return function(e,i,n,r,o,a){for(i||(i=2),n||(n=0),r=r?Math.min(r*i+n,e.length):e.length;n<r;n+=i)t[0]=e[n],t[1]=e[n+1],o(t,t,a),e[n]=t[0],e[n+1]=t[1];return e}}(),e.forEach=t}));n(iu);var nu=r((function(t,e){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=Ti&&Zr?Zr(t,i):{};n.get||n.set?Ti(e,i,n):e[i]=t[i]}return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.vec4=e.vec3=e.vec2=e.quat2=e.quat=e.mat4=e.mat3=e.mat2d=e.mat2=e.glMatrix=void 0,t=i(Vs),e.glMatrix=t,t=i(Gs),e.mat2=t,t=i(qs),e.mat2d=t,t=i(Ks),e.mat3=t,t=i(Qs),e.mat4=t,t=i(tu),e.quat=t,t=i(eu),e.quat2=t,t=i(iu),e.vec2=t,t=i(Js),e.vec3=t,t=i($s),e.vec4=t}));n(nu);var ru=nu.vec4,ou=nu.vec3,au=nu.vec2,su=nu.quat2,uu=nu.quat,lu=nu.mat4,hu=nu.mat3,fu=nu.mat2d,cu=nu.mat2,pu=nu.glMatrix;H.deviation=function(t,e,i,n){var r=e&&e.length,o=Math.abs(ut(t,0,r?e[0]*i:t.length,i));if(r){r=0;for(var a=e.length;r<a;r++)o-=Math.abs(ut(t,e[r]*i,r<a-1?e[r+1]*i:t.length,i))}for(r=e=0;r<n.length;r+=3){a=n[r]*i;var s=n[r+1]*i,u=n[r+2]*i;e+=Math.abs((t[a]-t[u])*(t[s+1]-t[a+1])-(t[a]-t[s])*(t[u+1]-t[a+1]))}return 0===o&&0===e?0:Math.abs((e-o)/o)},H.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)i.vertices.push(t[r][o][a]);0<r&&(n+=t[r-1].length,i.holes.push(n))}return i},H.default=H;var du="undefined"===typeof Vn?"__target":Vn(),vu=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,gu=window.URL||window.webkitURL,mu=window.Worker;if(mu){var yu=lt("self.onmessage = function () {}"),xu=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");var bu=new mu(yu);bu.postMessage(xu,[xu.buffer])}catch(kf){mu=null}finally{gu.revokeObjectURL(yu),bu&&bu.terminate()}}var _u=new function(t,e){return function(i){var n=this;if(!e)return new mu(t);if(mu&&!i)return i=(""+e).replace(/^function.+?{/,"").slice(0,-1),i=lt(i),this[du]=new mu(i),gu.revokeObjectURL(i),this[du];var r={postMessage:function(t){n.onmessage&&setTimeout((function(){return n.onmessage({data:t,target:r})}))}};e.call(r),this.postMessage=function(t){setTimeout((function(){return r.onmessage({data:t,target:n})}))},this.isThisThread=!0}}("./worker.js",(function(t,e){})),wu={window:1,windowAnimation:2,gradual:3,ripple:4,water:6},Au=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t._isShow=!0,i=t.getOptions(),("windowAnimation"===i.style||"ripple"===i.style||0<i.riseTime)&&(t.autoUpdate=!0),t.selectedColor=[-1,-1,-1],t.textureCache={},t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(50, 50, 230, 1.0)",opacity:.8,height:0,isTextureFull:!1,topColor:"rgba(76, 76, 76, 0.8)",textureRotate:0,textureScale:1,useLight:!0,riseTime:0,polygonOffset:[1,1]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.dataMgr=new ht(this,this.gl),this.texture=null,this.isUseTexture=!1;var i=[];e.enablePicked&&i.push("PICK"),e.texture&&i.push("USE_TEXTURE"),this.program=new Ms(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;attribute vec4 a_pos;attribute vec3 a_normal;attribute vec4 a_color;attribute vec4 a_pre_color;attribute float a_height;attribute float a_pre_height;\n#if defined(USE_TEXTURE)\nattribute vec2 a_texture_coord;\n#endif\nuniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform mat4 u_normal_matrix;uniform vec3 u_side_light_dir;uniform bool u_use_lighting;uniform bool u_use_texture;uniform vec3 u_ripple_center;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform float dataTime;uniform float riseTime;uniform vec2 uMapCenter;uniform float uMapZoom;varying float v_height;varying vec4 v_color;varying vec3 v_position;varying vec2 v_texture_coord;const vec3 point_color=vec3(0.06,0.06,0.06);const vec3 light_color=vec3(0.53,0.53,0.53);const vec3 light_color_2=vec3(0.4,0.4,0.4);const vec3 uAmbientColor=vec3(0.8,0.8,0.8);const vec3 uLightingDirection=vec3(0.0,1.0,1.0);const vec3 uDirectionalColor=vec3(1.0,1.0,1.0);float getTransitionValue(float pre_value,float to_value,float dataTime,float riseTime){float result=0.0;if(pre_value==to_value){result=to_value;}else{if(riseTime>0.0&&dataTime<riseTime){result=(pre_value+(to_value-pre_value)*(dataTime/riseTime));}else{result=to_value;}}return result;}void main(){vec4 pos=a_pos;pos.z=pos.z+pos.w*getTransitionValue(a_pre_height,a_height,dataTime,riseTime);v_position=pos.xyz;v_height=a_height;\n#if defined(USE_TEXTURE)\nif(u_use_texture){v_texture_coord=a_texture_coord;}\n#endif\nvec4 position=u_proj_matrix*u_mv_matrix*vec4(pos.xyz,1.0);gl_Position=position;vec4 icolor=a_color;\n#if defined(PICK)\nif(mapvIsPicked()){icolor=uSelectedColor;}\n#endif\nif(u_use_lighting){vec3 N=normalize(vec3(u_normal_matrix*vec4(a_normal,1.0)));vec4 point_dir=u_mv_matrix*vec4(0,1,0,0);vec3 L_point=normalize(point_dir.xyz);float lambert_point=max(0.0,dot(N,-L_point));vec4 light_dir=u_mv_matrix*vec4(u_side_light_dir,0);vec3 L=normalize(light_dir.xyz);float lambert=max(0.0,dot(N,-L));if(pos.z<5.0){float deepGradientColor=(5.0-pos.z)/8.0;lambert=lambert-deepGradientColor;}vec4 light_dir_2=u_mv_matrix*vec4(0,0,-1,0);vec3 L2=normalize(light_dir_2.xyz);float lambert_2=max(0.0,dot(N,-L2));if(a_pre_color.r==a_color.r&&a_pre_color.g==a_color.g&&a_pre_color.b==a_color.b){}else{if(riseTime>0.0&&dataTime<riseTime){icolor.r=a_pre_color.r+(a_color.r-a_pre_color.r)*(dataTime/riseTime);icolor.g=a_pre_color.g+(a_color.g-a_pre_color.g)*(dataTime/riseTime);icolor.b=a_pre_color.b+(a_color.b-a_pre_color.b)*(dataTime/riseTime);}}v_color.rgb=icolor.rgb+icolor.rgb*light_color*lambert+icolor.rgb*light_color_2*lambert_2+icolor.rgb*point_color*lambert_point;v_color.a=icolor.a;if(u_use_texture){mat3 normalMatrix=mat3(u_normal_matrix);vec3 transformedNormal=normalMatrix*a_normal;vec3 dir=uLightingDirection;dir=vec3(normalMatrix*vec3(0.0,-1.0,2.0));float directionalLightWeighting=max(dot(normalize(transformedNormal),normalize(dir)),0.0);vec4 vLightWeighting;vLightWeighting=vec4(uAmbientColor+uDirectionalColor*directionalLightWeighting,1.0);v_color=vLightWeighting;}}else{v_color=icolor;}}",fragmentShader:"precision highp float;varying vec4 v_color;varying vec3 v_position;varying float v_height;varying vec2 v_texture_coord;uniform vec3 u_ripple_center;uniform vec4 top_color;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform sampler2D u_sampler;uniform bool u_use_lighting;uniform bool u_use_texture;void main(){vec4 color=vec4(v_color);vec4 textureColor=vec4(1.0,1.0,1.0,1.0);if(u_use_texture){if(style==6.0){float x=v_texture_coord.s;float y=v_texture_coord.t;vec2 cPos=-1.0+2.0*gl_FragCoord.xy/MAPV_resolution;float cLength=length(cPos);vec2 uv=gl_FragCoord.xy/MAPV_resolution+(cPos/cLength)*cos(cLength*12.0-time/1000.0*4.0)*0.03;textureColor=texture2D(u_sampler,uv/2.0+vec2(x,y));}else{textureColor=texture2D(u_sampler,vec2(v_texture_coord.s,v_texture_coord.t));}if(u_use_lighting){color=vec4(textureColor*v_color*1.1);}else{color=textureColor;}}if(style==1.0||style==2.0){float t=time/1000.0;float diffDistance=5.0;float modX=mod(v_position.x,diffDistance*2.0);float modZ=mod(v_position.z,diffDistance*2.0);if(modX<diffDistance&&modZ<diffDistance&&v_position.z<v_height){color*=1.05;if(time>0.0&&style==2.0){float iX=ceil(v_position.x/diffDistance);float iZ=ceil(v_position.z/diffDistance);float timeDistance=8.0;t+=tan(sin(iZ));color*=(1.0+mod(t,timeDistance)/timeDistance);}}color.a=alpha;}else if(style==5.0){float t=time/1000.0;float diffDistance=10.0;float modZ=mod(v_position.z-t*40.0,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.5);if(v_position.z/v_height<0.3){color.r+=0.2;color.g+=0.2;color.b+=0.2;}if(modZ<diffDistance*2.0-4.0){discard;}}else if(style==3.0){float diffDistance=10.0;float modX=mod(v_position.x,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.3);}else if(style==4.0){float dis=distance(u_ripple_center,v_position);float rSize=400.0;if(v_position.z>=v_height){color=top_color;}if(dis>u_radius-rSize&&dis<u_radius+rSize){color*=(1.0-abs(dis-u_radius)/rSize)*2.0+1.0;}}else if(style==6.0){}gl_FragColor=color;}",defines:i},this),this.vertexBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.heightBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.textureBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),i=[{name:"a_pos",buffer:this.vertexBuffer,stride:28,size:4,type:"FLOAT",offset:0},{name:"a_normal",buffer:this.vertexBuffer,size:3,stride:28,type:"FLOAT",offset:16},{name:"a_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:0},{name:"a_pre_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:16},{name:"a_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:0},{name:"a_pre_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:4}],e.texture&&i.push({name:"a_texture_coord",buffer:this.textureBuffer,size:2,stride:8,type:"FLOAT",offset:0}),i=i.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:i}),this.initializeTime=new Date,this.normalMatrix=lu.create()}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.dataMgr=this.options=this.data=this.indexBuffer=this.textureBuffer=this.heightBuffer=this.colorBuffer=this.vertexBuffer=this.program=this.vertexArray=null}},{key:"onChanged",value:function(t,e){var i=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){i.loadTexture((function(){i.dataMgr.parseData(e),i.dataTime=new Date,i.webglLayer.render()}))}),0))}},{key:"render",value:function(t){var e=t.gl,i=t.projectionMatrix,n=t.viewMatrix;if(this._isShow){var r=this.getData();if(r&&!(0>=r.length)){r=this.getOptions();var o=this.program;if(o.use(e),!r.texture||this.texture){var a=0;r.style&&wu[r.style]&&(a=wu[r.style]);var s=[e.ONE,e.ZERO];if(r.blend&&(s=[e.ONE,e.ONE]),0!==r.height&&"gradual"!==r.style||(s=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]),this.setGLState({cullFace:!1,blend:!0,blendEquation:e.FUNC_ADD,blendFunc:s,polygonOffset:r.polygonOffset,depthMask:"gradual"!==r.style}),s=this.normizedColor(r.topColor),"ripple"===r.style&&r.rippleLayer&&r.rippleLayer.data&&r.rippleLayer.data[0]){var u=this.normizedPoint(r.rippleLayer.data[0].geometry.coordinates);o.setUniforms({u_ripple_center:[u[0],u[1],0],u_radius:r.rippleLayer.options.size*r.rippleLayer.currentScale})}u=ou.fromValues(0,-1,2),r.lightDir&&(u=ou.fromValues(r.lightDir[0],r.lightDir[1],r.lightDir[2]));var l=this.normalMatrix;lu.invert(l,n),lu.transpose(l,l),o.setUniforms(di(this.getCommonUniforms(t),{u_normal_matrix:l,u_sampler:this.texture,u_proj_matrix:i,u_mv_matrix:n,style:a,top_color:s,u_use_lighting:r.useLight,u_use_texture:this.isUseTexture,alpha:void 0===r.opacity?.8:parseFloat(r.opacity),time:new Date-this.initializeTime,dataTime:new Date-this.dataTime,riseTime:r.riseTime,u_side_light_dir:u})),t=this.dataMgr.getData(),0<t.vertex.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),e.drawElements(e.TRIANGLES,t.index.length,e.UNSIGNED_INT,0))}}}else this.webglLayer.clear()}},{key:"loadTexture",value:function(t){var e=this,i=this.getOptions();i.texture?(this.isUseTexture=!0,j(this.gl,i.texture,(function(i,n){e.image=n,e.texture=i,t&&t(),e.webglLayer.render()}))):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),e}(Ns);ht.prototype.initData=function(){this.outBuilding3d={pickColorVertex:[],vertex:[],texture:[],color:[],height:[],index:[]}},ht.prototype.getData=function(){return this.outBuilding3d},ht.prototype.initWorker=function(){this.worker=new _u,this.worker.onmessage=function(t){}},ht.prototype.parseData=function(t){var e=this;this.initData();for(var i=this.shapeLayer.getOptions(),n=0;n<t.length;n++){var r=t[n],o=r.height||i.height;"properties"in r&&"height"in r.properties&&(o=r.properties.height),o*=1;var a=r.color||i.color;"properties"in r&&"color"in r.properties&&(a=r.properties.color),"properties"in r&&"fillColor"in r.properties&&(a=r.properties.fillColor),"[object Function]"===Object.prototype.toString.call(a)&&(a=a(r)),a=this.shapeLayer.normizedColor(a);var s=this.shapeLayer.getProperty("angle",i.textureRotate,r),u=void 0;i.enablePicked&&(u=this.shapeLayer.indexToRgb(n));var l=void 0,h=void 0;if(i.riseTime&&(h=r.preColor,"properties"in r&&"preColor"in r.properties&&(h=r.properties.preColor),l=r.preHeight,"properties"in r&&"preHeight"in r.properties&&(l=r.properties.preHeight),void 0===l&&(l=0)),r.geometry.coordinates)if("MultiPolygon"===r.geometry.type){var f=r.geometry.coordinates;r=[];for(var c=0;c<f.length;c++)r.push(f[c].map((function(t){return t.map((function(t){return e.shapeLayer.normizedPoint(t)}))})));for(f=0;f<r.length;f++){c=[];var p=[],d=H.flatten(r[f]),v=d.vertices;d=d.holes;for(var g=0;g<v.length;g+=3)c.push(v[g+0],v[g+1]),p.push(v[g+2]);this.parseBuilding3d(this.outBuilding3d,c,p,l,o,h,a,u,s,d)}}else{for(f=[],c=0;c<r.geometry.coordinates.length;c++)f.push(r.geometry.coordinates[c].map((function(t){return e.shapeLayer.normizedPoint(t)})));for(f=H.flatten(f),r=f.vertices,f=f.holes,c=[],p=[],v=0;v<r.length;v+=3)c.push(r[v+0],r[v+1]),p.push(r[v+2]);this.parseBuilding3d(this.outBuilding3d,c,p,l,o,h,a,u,s,f)}}this.shapeLayer.vertexBuffer.updateData(new Float32Array(this.outBuilding3d.vertex)),this.shapeLayer.colorBuffer.updateData(new Float32Array(this.outBuilding3d.color)),this.shapeLayer.heightBuffer.updateData(new Float32Array(this.outBuilding3d.height)),this.shapeLayer.textureBuffer.updateData(new Float32Array(this.outBuilding3d.texture)),this.shapeLayer.indexBuffer.updateData(new Uint32Array(this.outBuilding3d.index)),i.enablePicked&&this.shapeLayer.pickBuffer.updateData(new Float32Array(this.outBuilding3d.pickColorVertex))},ht.prototype.getBounds=function(t,e){for(var i=t[0],n=t[1],r=t[0],o=t[1],a=0;a<t.length;a+=2)i=Math.min(t[a],i),n=Math.min(t[a+1],n),r=Math.max(t[a],r),o=Math.max(t[a+1],o);if(a=[(r-i)/2+i,(o-n)/2+n],0===e||!e)return{minX:i,minY:n,maxX:r,maxY:o,width:r-i,height:o-n,center:a};for(i=t.slice(0),n=0;n<i.length;n+=2)r=ft(t[n],t[n+1],a,e),i[n]=r[0],i[n+1]=r[1];return this.getBounds(i,0)},ht.prototype.parseBuilding3d=function(t,e,i,n,r,o,a,s,u,l){void 0===n&&(n=r);var h=this.shapeLayer.options,f=t.vertex,c=t.texture,p=t.color,d=t.height,v=t.pickColorVertex;t=t.index,void 0===o&&(o=a);var g=0,m=0;if(this.shapeLayer.image&&(g=this.shapeLayer.image.width*h.textureScale,m=this.shapeLayer.image.height*h.textureScale),"gradual"!==h.style){l=l&&l.length?H(e,l,2):H(e);var y=l[0],x=l[1],b=l[2];y=[e[2*y],e[2*y+1],1],x=[e[2*x],e[2*x+1],1];var _,w=[e[2*b],e[2*b+1],1];b=[],ou.cross(b,[w[0]-x[0],w[1]-x[1],w[2]-x[2]],[y[0]-x[0],y[1]-x[1],y[2]-x[2]]),x=f.length/7,h.texture&&(_=this.getBounds(e,u)),y=h.isTextureFull,w=0;for(var A=e.length;w<A;w+=2){if(f.push(e[w],e[w+1],i[w/2],1,b[0],b[1],b[2]),p.push(a[0],a[1],a[2],a[3],o[0],o[1],o[2],o[3]),d.push(r,n),h.texture){var T=ft(e[w],e[w+1],_.center,u),M=xr(T,2);T=M[0],M=M[1],y?(T=(T-_.minX)/_.width,M=(M-_.minY)/_.height):(T=(T-_.minX)/g,M=(M-_.minY)/m),c.push(T,M)}s&&v.push(s[0]/255,s[1]/255,s[2]/255)}for(u=0,_=l.length;u<_;u++)t.push(l[u]+x)}if(!(r===n&&0>=r))for(u=0,l=e.length;u<l;u+=2)_=f.length/7,A=e[u],T=e[u+1],b=[A,T,i[u/2],0],x=[A,T,i[u/2],1],w=u+2,M=u+3,u===l-2&&(w=0,M=1),w=e[w],M=e[M],A=Math.sqrt(Math.pow(w-A,2),Math.pow(M-T,2)),T=[w,M,i[u/2],0],w=[w,M,i[u/2],1],M=[],ou.cross(M,[T[0]-b[0],T[1]-b[1],T[2]-b[2]],[x[0]-b[0],x[1]-b[1],x[2]-b[2]]),f.push(b[0],b[1],b[2],b[3]),f.push(M[0],M[1],M[2]),f.push(x[0],x[1],x[2],x[3]),f.push(M[0],M[1],M[2]),f.push(T[0],T[1],T[2],T[3]),f.push(M[0],M[1],M[2]),f.push(w[0],w[1],w[2],w[3]),f.push(M[0],M[1],M[2]),p.push(a[0],a[1],a[2],a[3]),p.push(o[0],o[1],o[2],o[3]),p.push(a[0],a[1],a[2],a[3]),p.push(o[0],o[1],o[2],o[3]),p.push(a[0],a[1],a[2],a[3]),p.push(o[0],o[1],o[2],o[3]),p.push(a[0],a[1],a[2],a[3]),p.push(o[0],o[1],o[2],o[3]),d.push(r),d.push(n),d.push(r),d.push(n),d.push(r),d.push(n),d.push(r),d.push(n),h.texture&&(y?(c.push(0,0),c.push(0,1),c.push(1,0),c.push(1,1)):(c.push(0,0),c.push(0,r/m),c.push(A/g,0),c.push(A/g,r/m))),s&&(v.push(s[0]/255,s[1]/255,s[2]/255),v.push(s[0]/255,s[1]/255,s[2]/255),v.push(s[0]/255,s[1]/255,s[2]/255),v.push(s[0]/255,s[1]/255,s[2]/255)),t.push(_,_+2,_+3,_,_+3,_+1)};var Tu=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.preHeightMapper={},t.preColorMapper={},t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return di(Xs(e.prototype.__proto__||bi(e.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,height:function(){return 1e3},color:function(){return"rgb(200, 200, 20)"}})}},{key:"generateGrid",value:function(t,e){var i=e.gridSize,n=[],r={};e=t.length;for(var o=this.getPointOffset(),a=0;a<e;a++){var s=this.normizedPoint(t[a].geometry.coordinates);s=~~((s[0]+o[0])/i)+"_"+~~((s[1]+o[1])/i),void 0===r[s]&&(r[s]=0);var u=~~t[a].count||1;"properties"in t[a]&&"count"in t[a].properties&&(u=~~t[a].properties.count),r[s]+=u}return si(r).forEach((function(t){var e=t.split("_");n.push([e[0]*i+i/2,e[1]*i+i/2,r[t]])})),n}},{key:"onChanged",value:function(t,i){i=this.processData(i),Xs(e.prototype.__proto__||bi(e.prototype),"onChanged",this).call(this,t,i)}},{key:"getGridDataRange",value:function(){var t=this.gridData,e=void 0,i=void 0;t[0]&&(e=t[0][2],i=t[0][2]);for(var n=t.length,r=0;r<n;r++){var o=t[r];e=Math.max(o[2],e),i=Math.min(o[2],i)}return{max:e/2,min:i}}},{key:"processData",value:function(t){var e=this.getOptions(),i=e.style,n=e.gridSize,r=[];if(this.gridData=r,"normal"===i){i=this.getPointOffset();for(var o=0;o<t.length;o++){var a=this.normizedPoint(t[o].geometry.coordinates),s=a[0]+i[0];a=a[1]+i[1];var l=~~t[o].count||1;"properties"in t[o]&&"count"in t[o].properties&&(l=~~t[o].properties.count);var h=t[o].color;"properties"in t[o]&&"color"in t[o].properties&&(h=~~t[o].properties.color),r.push([s,a,l,h])}}else r=this.generateGrid(t,e);for(t=[],this._preHeightMapper={},this._preColorMapper={},i=0;i<r.length;i++)o=r[i],o[0]=o[0],o[1]=o[1],s=o[2],e.height&&(s="function"===typeof e.height?e.height({count:o[2]}):e.height),a=n/2-5,l=o[3],e.color&&(l="function"===typeof e.color?e.color({count:o[2],color:o[3]}):u(l).unitArray()),h="p"+o[0]+o[1],t.push({geometry:{type:"Polygon",coordinates:[[[o[0]-a,o[1]-a],[o[0]-a,o[1]+a],[o[0]+a,o[1]+a],[o[0]+a,o[1]-a]]]},color:l,preHeight:this.preHeightMapper[h],preColor:this.preColorMapper[h],height:s}),this._preHeightMapper[h]=s,this._preColorMapper[h]=l;return this.preHeightMapper=this._preHeightMapper,this.preColorMapper=this._preColorMapper,t}}]),e}(Au),Mu=function(t){function e(t){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t))}return ar(e,t),Pi(e,[{key:"initialize",value:function(t){var e=this;this.children&&this.children.forEach((function(i){i.map=e.map,i.setWebglLayer(e.getWebglLayer()),i.commonInitialize&&i.commonInitialize(t),i.initialize&&i.initialize(t),i.onOptionsChanged(i.getOptions()),i.onDataChanged(i.getData()),i.onChanged(i.getOptions(),i.getData())}))}},{key:"isRequestAnimation",value:function(){if(void 0!==this.autoUpdate)return Xs(e.prototype.__proto__||bi(e.prototype),"isRequestAnimation",this).call(this);for(var t=!1,i=0;i<this.children.length;i++)if(this.children[i].isRequestAnimation()){t=!0;break}return t}},{key:"render",value:function(t){this.children&&this.children.forEach((function(e){e.render(t)}))}}]),e}(Ts),Pu=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.gridLayer=new Tu(t.getGridOptions()),t.children=[t.gridLayer],t.options.riseTime&&(t.autoUpdate=!0),t}return ar(e,t),Pi(e,[{key:"onDataChanged",value:function(t){this.gridLayer.setData(t)}},{key:"getGridOptions",value:function(){var t=this.getOptions(),e=t.max,i=t.min;void 0===e&&(i=this.gridLayer.getGridDataRange(),e=i.max,i=i.min);var n=new A({max:e,min:i,gradient:t.gradient,maxSize:t.maxHeight,minSize:t.minHeight});return t.height=function(t){var e=n.getSize(t.count);return"properties"in t&&"count"in t.properties&&(e=n.getSize(t.properties.count)),e},t.color=function(t){var e=n.getImageData(t.count);return"properties"in t&&"count"in t.properties&&(e=n.getImageData(t.properties.count)),[e[0]/255,e[1]/255,e[2]/255]},t}},{key:"onOptionsChanged",value:function(t){this.gridLayer.setOptions(this.getGridOptions())}},{key:"getDefaultOptions",value:function(){return{style:"grid",gridSize:500,maxHeight:8e3,minHeight:200,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}}]),e}(Mu),Su=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.bufferData=[],t}return ar(e,t),Pi(e,[{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new Ms(this.gl,{vertexShader:"uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;\n#if defined(DASH)\nvarying vec3 vPos;\n#endif\nvoid main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);\n#if defined(DASH)\nvPos=aPos;\n#endif\n}",fragmentShader:"precision highp float;varying vec4 vColor;varying vec3 vPos;void main(){\n#if defined(DASH)\nif(mod(vPos.x,3.0)<1.5){discard;}\n#endif\ngl_FragColor=vColor;}",defines:e.useDash?["DASH"]:""},this),this.buffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new Ls({gl:t,program:this.program,attributes:[{stride:28,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12}]})}},{key:"destroy",value:function(){this.data=this.vertexArray=this.program=this.buffer=this.bufferData=null}},{key:"onChanged",value:function(t,e){var i=this;if(this.gl){var n=[],r=function(t,e){if(t)for(var r=0;r<t.length-1;r++){var o=i.normizedPoint(t[r]);n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(e[0],e[1],e[2],e[3]),o=i.normizedPoint(t[r+1]),n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(e[0],e[1],e[2],e[3])}};t=t.color;for(var o=0;o<e.length;o++){var a=this.getProperty("color",t,e[o]);a=this.normizedColor(a);var s=e[o].geometry,u=s.coordinates;if("MultiPolygon"===s.type){if(u)for(s=0;s<u.length;s++)r(u[s][0],a)}else if("Polygon"===s.type)u&&r(u[0],a);else if("MultiLineString"===s.type){if(u)for(s=0;s<u.length;s++)r(u[s],a)}else r(u,a)}this.bufferData=n,this.buffer.updateData(new Float32Array(n))}}},{key:"render",value:function(t){var e=t.gl;if(t=t.matrix,this.bufferData&&!(0>=this.bufferData.length)){var i=this.program;i.use(e),this.vertexArray.bind(),i.setUniforms({u_matrix:t}),t=this.getOptions(),this.setGLState({blend:!0,blendFunc:"lighter"===t.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEquation:e.FUNC_ADD}),e.drawArrays(e.LINES,0,this.bufferData.length/7)}}}]),e}(Ns),Eu=$i.f("species"),Cu=r((function(t){t.exports={default:Eu,__esModule:!0}}));n(Cu);var Lu="undefined"!==typeof t?t:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{},Ru=[],ku=[],Ou="undefined"!==typeof Uint8Array?Uint8Array:Array,Du=!1,Bu={}.toString,zu=Array.isArray||function(t){return"[object Array]"==Bu.call(t)};yt.TYPED_ARRAY_SUPPORT=void 0===Lu.TYPED_ARRAY_SUPPORT||Lu.TYPED_ARRAY_SUPPORT,yt.poolSize=8192,yt._augment=function(t){return t.__proto__=yt.prototype,t},yt.from=function(t,e,i){return xt(null,t,e,i)},yt.TYPED_ARRAY_SUPPORT&&(yt.prototype.__proto__=Uint8Array.prototype,yt.__proto__=Uint8Array),yt.alloc=function(t,e,i){return bt(t),t=0>=t?mt(null,t):void 0!==e?"string"===typeof i?mt(null,t).fill(e,i):mt(null,t).fill(e):mt(null,t),t},yt.allocUnsafe=function(t){return _t(null,t)},yt.allocUnsafeSlow=function(t){return _t(null,t)},yt.isBuffer=function(t){return null!=t&&(!!t._isBuffer||Wt(t)||"function"===typeof t.readFloatLE&&"function"===typeof t.slice&&Wt(t.slice(0,0)))},yt.compare=function(t,e){if(!Mt(t)||!Mt(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,n=e.length,r=0,o=Math.min(i,n);r<o;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},yt.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},yt.concat=function(t,e){if(!zu(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return yt.alloc(0);var i;if(void 0===e)for(i=e=0;i<t.length;++i)e+=t[i].length;e=yt.allocUnsafe(e);var n=0;for(i=0;i<t.length;++i){var r=t[i];if(!Mt(r))throw new TypeError('"list" argument must be an Array of Buffers');r.copy(e,n),n+=r.length}return e},yt.byteLength=Pt,yt.prototype._isBuffer=!0,yt.prototype.swap16=function(){var t=this.length;if(0!==t%2)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)Et(this,e,e+1);return this},yt.prototype.swap32=function(){var t=this.length;if(0!==t%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)Et(this,e,e+3),Et(this,e+1,e+2);return this},yt.prototype.swap64=function(){var t=this.length;if(0!==t%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)Et(this,e,e+7),Et(this,e+1,e+6),Et(this,e+2,e+5),Et(this,e+3,e+4);return this},yt.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?Rt(this,0,t):St.apply(this,arguments)},yt.prototype.equals=function(t){if(!Mt(t))throw new TypeError("Argument must be a Buffer");return this===t||0===yt.compare(this,t)},yt.prototype.inspect=function(){var t="";return 0<this.length&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(t+=" ... ")),"<Buffer "+t+">"},yt.prototype.compare=function(t,e,i,n,r){if(!Mt(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),0>e||i>t.length||0>n||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(e>>>=0,i>>>=0,n>>>=0,r>>>=0,this===t)return 0;var o=r-n,a=i-e,s=Math.min(o,a);for(n=this.slice(n,r),t=t.slice(e,i),e=0;e<s;++e)if(n[e]!==t[e]){o=n[e],a=t[e];break}return o<a?-1:a<o?1:0},yt.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},yt.prototype.indexOf=function(t,e,i){return Ct(this,t,e,i,!0)},yt.prototype.lastIndexOf=function(t,e,i){return Ct(this,t,e,i,!1)},yt.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"===typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),0<t.length&&(0>i||0>e)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");for(n||(n="utf8"),r=!1;;)switch(n){case"hex":t:{if(e=Number(e)||0,n=this.length-e,i?(i=Number(i),i>n&&(i=n)):i=n,n=t.length,0!==n%2)throw new TypeError("Invalid hex string");for(i>n/2&&(i=n/2),n=0;n<i;++n){if(r=parseInt(t.substr(2*n,2),16),isNaN(r)){t=n;break t}this[e+n]=r}t=n}return t;case"utf8":case"utf-8":return Ht(Ut(t,this.length-e),this,e,i);case"ascii":return Ht(Nt(t),this,e,i);case"latin1":case"binary":return Ht(Nt(t),this,e,i);case"base64":return Ht(jt(t),this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=t,r=this.length-e;for(var o=[],a=0;a<n.length&&!(0>(r-=2));++a){var s=n.charCodeAt(a);t=s>>8,s%=256,o.push(s),o.push(t)}return Ht(o,this,e,i);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),r=!0}},yt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Fu=4096;yt.prototype.slice=function(t,e){var i=this.length;if(t=~~t,e=void 0===e?i:~~e,0>t?(t+=i,0>t&&(t=0)):t>i&&(t=i),0>e?(e+=i,0>e&&(e=0)):e>i&&(e=i),e<t&&(e=t),yt.TYPED_ARRAY_SUPPORT)e=this.subarray(t,e),e.__proto__=yt.prototype;else{i=e-t,e=new yt(i,void 0);for(var n=0;n<i;++n)e[n]=this[n+t]}return e},yt.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||kt(t,e,this.length),i=this[t];for(var n=1,r=0;++r<e&&(n*=256);)i+=this[t+r]*n;return i},yt.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||kt(t,e,this.length),i=this[t+--e];for(var n=1;0<e&&(n*=256);)i+=this[t+--e]*n;return i},yt.prototype.readUInt8=function(t,e){return e||kt(t,1,this.length),this[t]},yt.prototype.readUInt16LE=function(t,e){return e||kt(t,2,this.length),this[t]|this[t+1]<<8},yt.prototype.readUInt16BE=function(t,e){return e||kt(t,2,this.length),this[t]<<8|this[t+1]},yt.prototype.readUInt32LE=function(t,e){return e||kt(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},yt.prototype.readUInt32BE=function(t,e){return e||kt(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},yt.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||kt(t,e,this.length),i=this[t];for(var n=1,r=0;++r<e&&(n*=256);)i+=this[t+r]*n;return i>=128*n&&(i-=Math.pow(2,8*e)),i},yt.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||kt(t,e,this.length),i=e;for(var n=1,r=this[t+--i];0<i&&(n*=256);)r+=this[t+--i]*n;return r>=128*n&&(r-=Math.pow(2,8*e)),r},yt.prototype.readInt8=function(t,e){return e||kt(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},yt.prototype.readInt16LE=function(t,e){return e||kt(t,2,this.length),t=this[t]|this[t+1]<<8,32768&t?4294901760|t:t},yt.prototype.readInt16BE=function(t,e){return e||kt(t,2,this.length),t=this[t+1]|this[t]<<8,32768&t?4294901760|t:t},yt.prototype.readInt32LE=function(t,e){return e||kt(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},yt.prototype.readInt32BE=function(t,e){return e||kt(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},yt.prototype.readFloatLE=function(t,e){return e||kt(t,4,this.length),vt(this,t,!0,23,4)},yt.prototype.readFloatBE=function(t,e){return e||kt(t,4,this.length),vt(this,t,!1,23,4)},yt.prototype.readDoubleLE=function(t,e){return e||kt(t,8,this.length),vt(this,t,!0,52,8)},yt.prototype.readDoubleBE=function(t,e){return e||kt(t,8,this.length),vt(this,t,!1,52,8)},yt.prototype.writeUIntLE=function(t,e,i,n){t=+t,e|=0,i|=0,n||Ot(this,t,e,i,Math.pow(2,8*i)-1,0),n=1;var r=0;for(this[e]=255&t;++r<i&&(n*=256);)this[e+r]=t/n&255;return e+i},yt.prototype.writeUIntBE=function(t,e,i,n){t=+t,e|=0,i|=0,n||Ot(this,t,e,i,Math.pow(2,8*i)-1,0),n=i-1;var r=1;for(this[e+n]=255&t;0<=--n&&(r*=256);)this[e+n]=t/r&255;return e+i},yt.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||Ot(this,t,e,1,255,0),yt.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},yt.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||Ot(this,t,e,2,65535,0),yt.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Dt(this,t,e,!0),e+2},yt.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||Ot(this,t,e,2,65535,0),yt.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Dt(this,t,e,!1),e+2},yt.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||Ot(this,t,e,4,4294967295,0),yt.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):Bt(this,t,e,!0),e+4},yt.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||Ot(this,t,e,4,4294967295,0),yt.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Bt(this,t,e,!1),e+4},yt.prototype.writeIntLE=function(t,e,i,n){t=+t,e|=0,n||(n=Math.pow(2,8*i-1),Ot(this,t,e,i,n-1,-n)),n=0;var r=1,o=0;for(this[e]=255&t;++n<i&&(r*=256);)0>t&&0===o&&0!==this[e+n-1]&&(o=1),this[e+n]=(t/r>>0)-o&255;return e+i},yt.prototype.writeIntBE=function(t,e,i,n){t=+t,e|=0,n||(n=Math.pow(2,8*i-1),Ot(this,t,e,i,n-1,-n)),n=i-1;var r=1,o=0;for(this[e+n]=255&t;0<=--n&&(r*=256);)0>t&&0===o&&0!==this[e+n+1]&&(o=1),this[e+n]=(t/r>>0)-o&255;return e+i},yt.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||Ot(this,t,e,1,127,-128),yt.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),0>t&&(t=255+t+1),this[e]=255&t,e+1},yt.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||Ot(this,t,e,2,32767,-32768),yt.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):Dt(this,t,e,!0),e+2},yt.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||Ot(this,t,e,2,32767,-32768),yt.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):Dt(this,t,e,!1),e+2},yt.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||Ot(this,t,e,4,2147483647,-2147483648),yt.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):Bt(this,t,e,!0),e+4},yt.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||Ot(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),yt.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):Bt(this,t,e,!1),e+4},yt.prototype.writeFloatLE=function(t,e,i){return Ft(this,t,e,!0,i)},yt.prototype.writeFloatBE=function(t,e,i){return Ft(this,t,e,!1,i)},yt.prototype.writeDoubleLE=function(t,e,i){return It(this,t,e,!0,i)},yt.prototype.writeDoubleBE=function(t,e,i){return It(this,t,e,!1,i)},yt.prototype.copy=function(t,e,i,n){if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),0<n&&n<i&&(n=i),n===i||0===t.length||0===this.length)return 0;if(0>e)throw new RangeError("targetStart out of bounds");if(0>i||i>=this.length)throw new RangeError("sourceStart out of bounds");if(0>n)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r=n-i;if(this===t&&i<e&&e<n)for(n=r-1;0<=n;--n)t[n+e]=this[n+i];else if(1e3>r||!yt.TYPED_ARRAY_SUPPORT)for(n=0;n<r;++n)t[n+e]=this[n+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+r),e);return r},yt.prototype.fill=function(t,e,i,n){if("string"===typeof t){if("string"===typeof e?(n=e,e=0,i=this.length):"string"===typeof i&&(n=i,i=this.length),1===t.length){var r=t.charCodeAt(0);256>r&&(t=r)}if(void 0!==n&&"string"!==typeof n)throw new TypeError("encoding must be a string");if("string"===typeof n&&!yt.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"===typeof t&&(t&=255);if(0>e||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"===typeof t)for(n=e;n<i;++n)this[n]=t;else for(t=Mt(t)?t:Ut(new yt(t,n).toString()),r=t.length,n=0;n<i-e;++n)this[n+e]=t[n%r];return this};var Iu=/[^+\/0-9A-Za-z-_]/g,Uu={normal:null,road:Kt()},Nu=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.initData(),t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",offset:0,blend:"normal",width:4,flat:!1,antialias:!1,style:"normal",dashArray:[0,0],dashOffset:0,polygonOffset:[0,0]}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[],uv:[]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),i=[];e.enablePicked&&i.push("PICK"),Uu[e.style]&&(this.isUseTexture=!0,i.push("USE_TEXTURE")),this.program=new Ms(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;uniform mat4 uMatrix;uniform bool uFlat;uniform vec2 uDashArray;uniform float thickness;uniform float zoomUnits;uniform float devicePixelRatio;uniform float uOffset;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aDistance;attribute float aTotalDistance;\n#if defined(USE_TEXTURE)\nattribute vec2 uv;\n#endif\nvarying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vTotalDistance;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}vec3 getNormalAndWidth(vec2 currentScreen,vec2 previousScreen,vec2 nextScreen,float thickness){vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;float angle=40.0;if(dot(dirA,dirB)>cos(radians(angle))){thickness=thickness/dot(miter,perp);}}vec2 normal=vec2(-dir.y,dir.x);return vec3(normal,thickness);}void main(){vColor=aColor;vCounter=aDistance/aTotalDistance;vDashArray=zoomUnits*uDashArray/aTotalDistance;vTotalDistance=aTotalDistance;\n#if defined(USE_TEXTURE)\nvUV=uv;\n#endif\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nif(uFlat){float width=thickness*zoomUnits;vec3 nw=getNormalAndWidth(position.xy,previous.xy,next.xy,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;float offsetXy=uOffset/zoomUnits;float offsetHeight=uOffset*zoomUnits/100.0;gl_Position=uMatrix*vec4(position.xy+normal*(direction+offsetXy),position.z+offsetHeight,1.0);}else{vec4 previousProjected=uMatrix*vec4(previous,1.0);vec4 currentProjected=uMatrix*vec4(position,1.0);vec4 nextProjected=uMatrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float width=thickness*devicePixelRatio;vec3 nw=getNormalAndWidth(currentScreen,previousScreen,nextScreen,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;vec2 pos=currentScreen+normal*direction;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}}",fragmentShader:"precision highp float;varying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vCounter;varying float vTotalDistance;uniform bool uAntialias;uniform float uDashOffset;uniform float zoomUnits;uniform float thickness;\n#if defined(USE_TEXTURE)\nuniform float uTextureMargin;uniform sampler2D textureImage;\n#endif\nvoid main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.8,1.0,length(vNormal));color.a*=blur;}\n#if defined(USE_TEXTURE)\nfloat segLen=uTextureMargin*zoomUnits;float textureLen=thickness*zoomUnits;float deltaX=mod(vUV.x,segLen);float middle=segLen/2.0;if(deltaX>=middle&&deltaX<=middle+textureLen){float uvx=(deltaX-middle)/textureLen;vec4 texture=texture2D(textureImage,vec2(uvx,vUV.y));color=texture.a>=0.5 ? texture : color;}\n#endif\nif(vDashArray.y>0.0){float offset=uDashOffset*zoomUnits/vTotalDistance;color.a*=(1.0-step(vDashArray.x,mod(vCounter+offset,vDashArray.x+vDashArray.y)));}gl_FragColor=color;}",defines:i},this),this.prevBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),i=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:8,name:"aDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0},{stride:8,name:"aTotalDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:4}],i=i.concat(this.getCommonAttributes()),Uu[e.style]&&(i.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),this.setOptions({texture:Uu[e.style]}),this.loadTexture()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:i})}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.options=this.data=this.dataMgr=this.indexBuffer=this.uvBuffer=this.counterBuffer=this.directionBuffer=this.colorBuffer=this.nextBuffer=this.currentBuffer=this.prevBuffer=this.program=this.vertexArray=null}},{key:"onChanged",value:function(t,e){var i=this;if(this.gl){this.initData();for(var n=t.color,r=[],o=0;o<e.length;o++){var a=[],s=e[o].geometry.coordinates;s&&0<s.length&&(a="MultiPolygon"===e[o].geometry.type?s.reduce((function(t,e){return t.concat(e)}))[0].map((function(t){return i.normizedPoint(t)})):"Polygon"===e[o].geometry.type||"MultiLineString"===e[o].geometry.type?s[0].map((function(t){return i.normizedPoint(t)})):s.map((function(t){return i.normizedPoint(t)}))),s=this.getProperty("color",n,e[o]),s=this.getProperty("lineColor",n,e[o]),s=this.normizedColor(s);for(var u=this.addMultipleCoords(a),l=0;l<u.length;l++)this.processData(this.dataMgr,u[l],s);if(t.enablePicked)for(s=this.indexToRgb(o),u=0;u<a.length;u++)r.push(s[0]/255,s[1]/255,s[2]/255),r.push(s[0]/255,s[1]/255,s[2]/255),t.repeat&&(r.push(s[0]/255,s[1]/255,s[2]/255),r.push(s[0]/255,s[1]/255,s[2]/255),r.push(s[0]/255,s[1]/255,s[2]/255),r.push(s[0]/255,s[1]/255,s[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(this.dataMgr.uv)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(r))}}},{key:"processData",value:function(t,e,i){var n,r,o,a,s,u,l,h,f=e.length,c=t.position.length/6,p=Gt(e),d=p.arr,v=p.total;p=Zt(d.map((function(t){return[t,v]}))),d=d.map((function(t){return[t,0,t,1]}));var g=Zt(e.map((function(t){return-1})),!0),m=Zt(e),y=Zt(e.map(Xt(-1))),x=Zt(e.map(Xt(1)));e=Zt(e.map((function(t){return i}))),f=Yt(f,c),(n=t.uv).push.apply(n,Lr(Vt(d))),(r=t.counter).push.apply(r,Lr(Vt(p))),(o=t.position).push.apply(o,Lr(Vt(m))),(a=t.prev).push.apply(a,Lr(Vt(y))),(s=t.next).push.apply(s,Lr(Vt(x))),(u=t.direction).push.apply(u,Lr(g)),(l=t.color).push.apply(l,Lr(Vt(e))),(h=t.index).push.apply(h,Lr(f))}},{key:"render",value:function(t){var e=t.gl,i=t.matrix,n=this.dataMgr;if(n&&!(0>=n.index.length)&&this.map){var r=this.getOptions(),o=this.program;o.use(e),t=di(this.getCommonUniforms(t),{uMatrix:i,uFlat:r.flat,zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio,thickness:r.width,uDashArray:r.dashArray,uDashOffset:r.dashOffset,uAntialias:r.antialias,uOffset:r.offset}),this.isUseTexture&&(t=di(t,{uTextureMargin:140,textureImage:this.texture})),o.setUniforms(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===r.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:r.polygonOffset}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,n.index.length,e.UNSIGNED_INT,0)}}},{key:"loadTexture",value:function(t){var e=this,i=this.getOptions();i.texture?j(this.gl,i.texture,(function(i,n){e.image=n,e.texture=i,t&&t(),e.webglLayer.render()})):(this.image=this.texture=null,t&&t())}}]),e}(Ns),ju=function(){function t(e){de(this,t),this.join=e.join||"miter",this.cap=e.cap||"butt",this.thickness=e.thickness||4,this.miterLimit=e.miterLimit||2*this.thickness,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],colors:[],uvs:[],startIndex:0,maxDistance:0},this._lastFlip=-1,this._started=!1,this._normal=null,this._totalDistance=0}return Pi(t,[{key:"extrude",value:function(t,e,i,n){var r=this.complex;if(1>=t.length)return r;this._lastFlip=-1,this._started=!1,this._normal=null,this._totalDistance=0;for(var o=t.length,a=r.startIndex,s=null,u=1;u<o;u++){var l=s||t[u-1],h=t[u],f=u<o-1?t[u+1]:null;f&&h[0]===f[0]&&h[1]===f[1]&&h[2]===f[2]?s=l:(l=this._segment(r,a,l,h,f,e,i,n),-1!==l&&(a+=l,s=null))}return this.dash&&(r.maxDistance=Math.max(this._totalDistance,r.maxDistance)),r.startIndex=r.positions.length/7,r}},{key:"_segment",value:function(t,e,i,n,r,o,a,s){var u=0,l=au.create(),h=au.create(),f=au.create(),c=au.create(),p=t.indices,d=t.positions,v=t.normals,g=t.colors;t=t.uvs;var m="square"===this.cap,y="round"===this.cap,x="bevel"===this.join,b="round"===this.join,_=[n[0],n[1]],w=[i[0],i[1]];Jt(h,_,w);var A=0;if(this.dash&&(A=this._calcDistance(_,w),this._totalDistance+=A),this._normal||(this._normal=au.create(),Qt(this._normal,h)),!this._started)if(this._started=!0,m){w=au.create();var T=au.create();au.add(w,this._normal,h),au.sub(T,this._normal,h),v.push(T[0],T[1],0),v.push(w[0],w[1],0),d.push(i[0],i[1],i[2],this._totalDistance-A,o,a,0),d.push(i[0],i[1],i[2],this._totalDistance-A,-o,a,0),t.push(this._totalDistance-A,0,this._totalDistance-A,1),g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3])}else if(y){w=au.fromValues(-h[0],-h[1]),T=au.create(),au.sub(T,this._normal,h),au.normalize(T,T);var M=au.create();au.add(M,this._normal,h),au.normalize(M,M);var P=au.fromValues(this._normal[0],this._normal[1]),S=au.fromValues(-this._normal[0],-this._normal[1]);for(v.push(w[0],w[1],0),v.push(T[0],T[1],0),v.push(-M[0],-M[1],0),v.push(P[0],P[1],0),v.push(S[0],S[1],0),w=0;5>w;w++)d.push(i[0],i[1],i[2],this._totalDistance-A,o,a,0),t.push(this._totalDistance-A,0),g.push(s[0],s[1],s[2],s[3]);p.push(e+0,e+2,e+1,e+1,e+2,e+3,e+3,e+2,e+4),u+=3,e+=3}else this._extrusions(d,v,t,g,i,this._normal,o,this._totalDistance-A,a,s);if(p.push.apply(p,Lr(-1===this._lastFlip?[e+0,e+1,e+2]:[e+1,e+0,e+2])),r)Jt(f,[r[0],r[1]],_),au.create(),au.add(c,h,f),au.normalize(c,c),A=au.fromValues(-c[1],c[0]),h=au.fromValues(-h[1],h[0]),h=[o/au.dot(A,h),A],h=xr(h,2),A=h[0],h=h[1],c=0<au.dot(c,this._normal)?-1:1,x||"miter"!==this.join||Math.abs(A)>this.miterLimit&&(x=!0),x?(b=Math.min(2*o,Math.abs(A)),v.push(this._normal[0],this._normal[1],0),v.push(h[0],h[1],0),d.push(n[0],n[1],n[2],this._totalDistance,o*c,a,0),d.push(n[0],n[1],n[2],this._totalDistance,-b*c,a,0),p.push.apply(p,Lr(this._lastFlip===-c?[e+2,e+1,e+3]:[e+0,e+2,e+3])),Qt(l,f),au.copy(this._normal,l),v.push(this._normal[0],this._normal[1],0),d.push(n[0],n[1],n[2],this._totalDistance,o*c,a,0),p.push.apply(p,Lr(1===c?[e+2,e+3,e+4]:[e+3,e+2,e+4])),this._flipedUV(t,this._totalDistance,c,!0),g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3]),u+=3):b?(b=Math.min(2*o,Math.abs(A)),v.push(this._normal[0],this._normal[1],0),v.push(h[0],h[1],0),v.push(h[0],h[1],0),d.push(n[0],n[1],n[2],this._totalDistance,o*c,a,0),d.push(n[0],n[1],n[2],this._totalDistance,o*c,a,0),d.push(n[0],n[1],n[2],this._totalDistance,-b*c,a,0),p.push.apply(p,Lr(this._lastFlip===-c?[e+2,e+1,e+4,e+2,e+4,e+3]:[e+0,e+2,e+4,e+2,e+3,e+4])),Qt(l,f),au.copy(this._normal,l),v.push(this._normal[0],this._normal[1],0),d.push(n[0],n[1],n[2],this._totalDistance,o*c,a,0),p.push.apply(p,Lr(1===c?[e+4,e+3,e+5]:[e+3,e+4,e+5])),this._flipedUV(t,this._totalDistance,c,!1),g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3]),u+=4):(this._extrusions(d,v,t,g,n,h,A,this._totalDistance,a,s),p.push.apply(p,Lr(-1===this._lastFlip?[e+2,e+1,e+3]:[e+2,e+0,e+3])),c=-1,au.copy(this._normal,h),u+=2),this._lastFlip=c;else if(Qt(this._normal,h),m?(l=au.create(),f=au.create(),au.add(l,h,this._normal),au.sub(f,h,this._normal),v.push(l[0],l[1],0),v.push(f[0],f[1],0),d.push(n[0],n[1],n[2],this._totalDistance,o,a,0),d.push(n[0],n[1],n[2],this._totalDistance,o,a,0),t.push(this._totalDistance,0,this._totalDistance,1),g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3])):this._extrusions(d,v,t,g,n,this._normal,o,this._totalDistance,a,s),p.push.apply(p,Lr(-1===this._lastFlip?[e+2,e+1,e+3]:[e+2,e+0,e+3])),u+=2,y){for(l=au.create(),au.add(l,h,this._normal),au.normalize(l,l),f=au.create(),au.sub(f,h,this._normal),au.normalize(f,f),b=au.fromValues(h[0],h[1]),v.push(l[0],l[1],0),v.push(f[0],f[1],0),v.push(b[0],b[1],0),v=0;3>v;v++)d.push(n[0],n[1],n[2],this._totalDistance-A,o,a,0),t.push(this._totalDistance-A,0),g.push(s[0],s[1],s[2],s[3]);p.push(e+2,e+3,e+4,e+4,e+3,e+5,e+4,e+5,e+6),u+=3}return u}},{key:"_extrusions",value:function(t,e,i,n,r,o,a,s,u,l){e.push(o[0],o[1],0),e.push(o[0],o[1],0),t.push(r[0],r[1],r[2],s,a,u,0),t.push(r[0],r[1],r[2],s,-a,u,0),i.push(s,0,s,1),n.push(l[0],l[1],l[2],l[3]),n.push(l[0],l[1],l[2],l[3])}},{key:"_calcDistance",value:function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}},{key:"_flipedUV",value:function(t,e,i,n){n?-1===i?t.push(e,0,e,1,e,0):t.push(e,1,e,0,e,1):-1===i?t.push(e,0,e,0,e,1,e,0):t.push(e,1,e,1,e,0,e,1)}}]),t}(),Hu={normal:null,road:Kt,arrow:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.width;t=t.color;var i=qt(),n=i.canvas;return i=i.ctx,i.save(),i.moveTo(5,0),i.lineTo(32,16),i.lineTo(5,32),i.strokeStyle=t||"#fff",i.lineWidth=e||8,i.stroke(),i.restore(),n}},Wu=function(t){function e(t,i){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t,i))}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{style:"normal",styleOptions:{},color:"rgba(25, 25, 250, 1)",blend:"normal",lineJoin:"miter",lineCap:"butt",unit:"px",width:4,offset:0,antialias:!1,dashArray:[0,0],dashOffset:0,animation:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),i=[];e.enablePicked&&i.push("PICK"),Hu[e.style]&&(this.isUseTexture=!0,this.prevStyle=e.style,this.prevStyleOptions=e.styleOptions,i.push("USE_TEXTURE")),!0===e.animation&&(this.isAnimateLine=!0,this.date=new Date,this.autoUpdate=!0,i.push("USE_LINE_ANIMATION")),!0===e.useDash&&i.push("USE_SIMPLE_DASH"),this.program=new Ms(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;uniform mat4 u_matrix;uniform vec2 u_dash_array;uniform float u_zoom_units;uniform bool u_unit_px;attribute vec4 a_color;attribute vec3 a_position;attribute vec3 a_normal;attribute float a_distance;attribute float a_total_distance;attribute float a_width;attribute float a_offset;\n#if defined(USE_TEXTURE)\nattribute vec2 uv;\n#endif\nvarying vec4 v_color;varying vec2 v_normal;varying vec2 v_uv;varying vec2 v_dash_array;varying float v_total_distance;varying float v_counter;varying float v_width;\n#if defined(USE_SIMPLE_DASH)\nvarying vec3 v_position;\n#endif\nvoid main(){v_width=a_width;v_color=a_color;v_counter=a_distance/a_total_distance;v_dash_array=u_dash_array/a_total_distance;if(u_unit_px){v_dash_array*=u_zoom_units;}v_total_distance=a_total_distance;v_normal=vec2(normalize(a_normal.xy)*sign(a_width));\n#if defined(USE_TEXTURE)\nv_uv=uv;\n#endif\n#if defined(PICK)\nif(mapvIsPicked()){v_color=uSelectedColor;}\n#endif\nvec2 extrude=a_normal.xy*a_width/2.0;if(u_unit_px){extrude*=u_zoom_units;}vec2 offsetXY=a_normal.xy*-a_offset;float offsetZ=a_offset/100.0;if(u_unit_px){offsetXY*=u_zoom_units;offsetZ*=u_zoom_units;}\n#if defined(USE_SIMPLE_DASH)\nv_position=a_position;\n#endif\ngl_Position=u_matrix*vec4(a_position.xy+extrude+offsetXY,a_position.z+offsetZ,1.0);}",fragmentShader:"precision highp float;varying vec4 v_color;varying vec2 v_normal;varying vec2 v_uv;varying vec2 v_dash_array;varying float v_counter;varying float v_total_distance;varying float v_width;\n#if defined(USE_SIMPLE_DASH)\nvarying vec3 v_position;\n#endif\nuniform bool u_antialias;uniform float u_dash_offset;uniform float u_zoom_units;\n#if defined(USE_LINE_ANIMATION)\nuniform bool u_animate;uniform float u_time;uniform float u_duration;uniform float u_interval;uniform float u_trail_length;\n#endif\n#if defined(USE_TEXTURE)\nuniform float u_texture_width;uniform float u_texture_margin;uniform sampler2D u_sampler;\n#endif\nvoid main(){vec4 color=v_color;\n#if defined(USE_SIMPLE_DASH)\nif(mod(v_position.x,5.0)<3.0){discard;}\n#endif\nif(u_antialias){float blur=1.0;blur=1.0-smoothstep(0.9,1.0,length(v_normal));color.a*=blur;}\n#if defined(USE_LINE_ANIMATION)\nif(u_animate){float alpha=1.0-fract(mod(1.0-v_counter,u_interval)*(1.0/u_interval)+u_time/u_duration);alpha=(alpha+u_trail_length-1.0)/u_trail_length;color.a*=alpha;gl_FragColor=color;return;}\n#endif\n#if defined(USE_TEXTURE)\nfloat margin_width=u_texture_margin*u_zoom_units;float margin_width_half=margin_width/2.0;float texture_width=u_texture_width*u_zoom_units;float delta=mod(v_uv.x,texture_width+margin_width);if(delta>=margin_width_half&&delta<=margin_width_half+texture_width){float uvx=(delta-margin_width_half)/texture_width;vec4 texture=texture2D(u_sampler,vec2(uvx,v_uv.y));color=texture.a>=0.5 ? texture : color;}\n#endif\nif(v_dash_array.y>0.0){float offset=u_dash_offset*u_zoom_units/v_total_distance;color.a*=(1.0-step(v_dash_array.x,mod(v_counter+offset,v_dash_array.x+v_dash_array.y)));}gl_FragColor=color;}",defines:i},this),this.positionBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.normalBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),i=[{stride:28,name:"a_position",buffer:this.positionBuffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"a_distance",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:12},{stride:28,name:"a_width",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:16},{stride:28,name:"a_offset",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:20},{stride:28,name:"a_total_distance",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:24},{stride:12,name:"a_normal",buffer:this.normalBuffer,size:3,type:"FLOAT",offset:0},{stride:16,name:"a_color",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0}],i=i.concat(this.getCommonAttributes()),this.isUseTexture&&(this.uvBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),i.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),e=(0,Hu[e.style])(e.styleOptions),this.setOptions({texture:e}),this.loadTexture()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:i})}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.isUseTexture&&(this.uvBuffer=null),this.options=this.data=this.indexBuffer=this.normalBuffer=this.colorBuffer=this.positionBuffer=this.program=this.vertexArray=null}},{key:"onChanged",value:function(t,e){var i=this,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.gl)if(!this.isUseTexture||this.prevStyle===t.style&&Ir(this.prevStyleOptions)===Ir(t.styleOptions))this.parseData(t,e,n);else{this.prevStyle=t.style,this.prevStyleOptions=t.styleOptions;var r=(0,Hu[t.style])(t.styleOptions);this.setOptions({texture:r}),this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){i.loadTexture((function(){i.parseData(t,e,n)}))}),0)}}},{key:"parseData",value:function(t,e,i){var n=this,r=t.dashArray,o=t.width,a=t.color,s=t.offset;r=!!this.isUseTexture||!!r[1]||!!this.isAnimateLine;for(var u=new ju({dash:r,cap:t.lineCap,join:t.lineJoin,miterLimit:t.miterLimit,thickness:o}),l=[],h=function(r){var h=e[r].geometry.coordinates;h&&0<h.length&&("MultiPolygon"===e[r].geometry.type?h=h.reduce((function(t,e){return t.concat(e)})):"LineString"===e[r].geometry.type&&(h=[h]),h=h.map((function(t){return t=t.map((function(t){return n.normizedPoint(t)})),!0===i.closePath&&t[0].toString()!==t[t.length-1].toString()&&t.push(t[0]),t})));var f=n.getProperty("color",a,e[r]);f=n.normizedColor(f);var c=n.getProperty("width",o,e[r]);c=Number(c);var p=n.getProperty("offset",s,e[r]);p=Number(p);var d=u.complex.startIndex;h=n.addMultipleCoords(h);for(var v=0;v<h.length;v++)h[v].forEach((function(t){u.extrude(t,c,p,f)}));if(t.enablePicked)for(r=n.indexToRgb(r),h=u.complex.startIndex;d<h;d++)l.push(r[0]/255,r[1]/255,r[2]/255),t.repeat&&(l.push(r[0]/255,r[1]/255,r[2]/255),l.push(r[0]/255,r[1]/255,r[2]/255))},f=0;f<e.length;f++)h(f);if(h=u.complex,r)for(f=0;f<h.positions.length/7;f++)h.positions[7*f+6]=h.maxDistance;this.lineData=h,this.positionBuffer.updateData(new Float32Array(h.positions)),this.normalBuffer.updateData(new Float32Array(h.normals)),this.colorBuffer.updateData(new Float32Array(h.colors)),this.indexBuffer.updateData(new Uint32Array(h.indices)),this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(h.uvs)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(l))}},{key:"render",value:function(t){var e=t.gl,i=t.matrix,n=this.lineData;if(n&&!(0>=n.indices.length)&&this.map){var r=this.getOptions(),o=this.program;o.use(e),t=di(this.getCommonUniforms(t),{u_matrix:i,u_zoom_units:this.map.getZoomUnits(),u_dash_array:r.dashArray,u_dash_offset:r.dashOffset,u_antialias:r.antialias,u_unit_px:"px"===r.unit}),this.isUseTexture&&(t=di(t,{u_texture_width:r.width,u_texture_margin:140,u_sampler:this.texture})),this.isAnimateLine&&(i=this.map.getZoom(),t=di(t,{u_time:(new Date-this.date)/1e3,u_animate:!!(i>=r.minZoom&&i<=r.maxZoom&&this.autoUpdate),u_duration:r.duration,u_interval:r.interval,u_trail_length:r.trailLength})),o.setUniforms(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===r.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:r.polygonOffset}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,n.indices.length,e.UNSIGNED_INT,0)}}},{key:"loadTexture",value:function(t){var e=this,i=this.getOptions();i.texture?j(this.gl,i.texture,(function(i,n){e.image=n,e.texture=i,t&&t(),e.webglLayer.render()})):(this.image=this.texture=null,t&&t())}}]),e}(Ns),Zu=function(){function t(e,i){de(this,t),this.layer=e,this.gl=i,this.initData()}return Pi(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(t,e){this.initData();var i=t.color,n=t.height,r=t.gradient;t=this.gl;for(var o=0;o<e.length;o++){var a=e[o].geometry.coordinates,s=a.length;this.maxLength=s>this.maxLength?s:this.maxLength;for(var u=[],l=0;l<s;l++){var h=this.layer.normizedPoint(a[l]);u.push(h)}s=e[o].color||i,"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),r||"[object Function]"!==Object.prototype.toString.call(s)||(s=s(e[o])),a=this.layer.normizedColor(r?r[0]:s),s=this.layer.normizedColor(r?r[1]:s),l=e[o].height||n,"properties"in e[o]&&"height"in e[o].properties&&(l=e[o].properties.height),"[object Function]"===Object.prototype.toString.call(l)&&(l=l(e[o])),this.processData(this.outWall3d,u,a,s,l)}for(e=0;e<this.outWall3d.vertex.length;e++){for(i=[],n=this.outWall3d.vertex[e].length,r=0;r<n;r++)i.push.apply(i,Lr(this.outWall3d.vertex[e][r]));n=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),this.outWall3d.vertexBuffer[e]=n,t.bindBuffer(t.ARRAY_BUFFER,null),n=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[e]),t.STATIC_DRAW),this.outWall3d.indexBuffer[e]=n,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,i,n,r){var o=t.vertex[t.vertex.length-1],a=t.index[t.index.length-1],s=e.length;(!a||65536<=a.length+2*s+2)&&(o=[],a=[],t.vertex.push(o),t.index.push(a)),(t=o.length)&&a.push(t-1,t);for(var u=t=0;u<s;u++){var l=[],h=[],f=e[u];l.push(f[0],f[1]),l.push(f[2]?Number(f[2])+r:r),l.push(f[3]?Number(f[3]):u),l.push(t),l.push(i[0],i[1],i[2],i[3]),h.push(f[0],f[1]),h.push(f[2]?Number(f[2]):0),h.push(f[3]?Number(f[3]):u),h.push(t),h.push(n[0],n[1],n[2],n[3]),f=o.length,o.push(l,h),a.push(f,f+1),u<s-1&&(t+=this.getDistance(e[u],e[u+1]))}}},{key:"getDistance",value:function(t,e){return Math.sqrt(Math.pow(Math.abs(t[0]-e[0]),2)+Math.pow(Math.abs(t[1]-e[1]),2))}}]),t}(),Yu=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new Zu(this,this.gl),this.program=new Ms(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute float aDistance;attribute vec4 aColor;varying vec4 vColor;varying float vHeight;varying float vTime;varying float vDistance;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vHeight=aPos.z;vColor=aColor;vDistance=aDistance;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;varying float vDistance;varying float vHeight;uniform float currentTime;void main(){if(vTime>1.0||vTime<0.0){}float radius=2.5;float distance=vDistance+currentTime*20.0;float modDistance=mod(distance,9.0);float alpha=1.0;if(modDistance>radius*2.0){discard;}else{float x=abs(modDistance-radius);float y=abs(vHeight-radius);float dis=sqrt(pow(x,2.0)+pow(y,2.0));if(dis>radius){discard;}alpha=dis/radius;}gl_FragColor=vec4(vColor.rgb,1.0-alpha);}"})}},{key:"onChanged",value:function(t,e){this.gl&&(this.dataMgr.onLayerChange(t,e),void 0===t.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var e=t.gl,i=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),r=this.program;for(e.useProgram(r.program),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),e.enableVertexAttribArray(r.attributes.aPos),e.enableVertexAttribArray(r.attributes.aDistance),e.enableVertexAttribArray(r.attributes.aColor),e.uniformMatrix4fv(r.uniforms.u_matrix,!1,i),e.uniform1f(r.uniforms.currentTime,this.time),e.uniform1f(r.uniforms.trailLength,n.trailLength),i=0;i<t.vertex.length;i++)if(!(0>=t.vertex[i].length)){var o=t.vertex[i],a=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=a*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[i]),e.vertexAttribPointer(r.attributes.aPos,4,e.FLOAT,!1,o,0),e.vertexAttribPointer(r.attributes.aDistance,1,e.FLOAT,!1,o,4*a),e.vertexAttribPointer(r.attributes.aColor,4,e.FLOAT,!1,o,5*a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[i]),e.drawElements(e.TRIANGLE_STRIP,t.index[i].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}this.time+=n.step,this.time>this.endTime&&(this.time=this.startTime)}}}]),e}(Ns),Xu=function(t,e,i,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(i+": incorrect invocation!");return t},Vu=r((function(t){var e={},i={};t=t.exports=function(t,n,r,o,a){var s,u;if(a=a?function(){return t}:dr(t),r=We(r,o,n?2:1),o=0,"function"!=typeof a)throw TypeError(t+" is not iterable!");if(void 0===a||Si.Array!==a&&wr[_r]!==a){for(o=a.call(t);!(u=o.next()).done;)if(a=br(o,r,u.value,n),a===e||a===i)return a}else for(s=Pe(t.length);s>o;o++)if(a=n?r(Ye(u=t[o])[0],u[1]):r(t[o]),a===e||a===i)return a},t.BREAK=e,t.RETURN=i})),Gu=Bi("species"),qu=function(t,e){var i;return t=Ye(t).constructor,void 0===t||void 0==(i=Ye(t)[Gu])?e:He(i)},Ku=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)},Qu=Le.process,Ju=Le.setImmediate,$u=Le.clearImmediate,tl=Le.MessageChannel,el=Le.Dispatch,il=0,nl={},rl=function(){var t=+this;if(nl.hasOwnProperty(t)){var e=nl[t];delete nl[t],e()}},ol=function(t){rl.call(t.data)};if(!Ju||!$u)if(Ju=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return nl[++il]=function(){Ku("function"==typeof t?t:Function(t),e)},al(il),il},$u=function(t){delete nl[t]},"process"==xe(Qu))var al=function(t){Qu.nextTick(We(rl,t,1))};else if(el&&el.now)al=function(t){el.now(We(rl,t,1))};else if(tl){var sl=new tl,ul=sl.port2;sl.port1.onmessage=ol,al=We(ul.postMessage,ul,1)}else Le.addEventListener&&"function"==typeof postMessage&&!Le.importScripts?(al=function(t){Le.postMessage(t+"","*")},Le.addEventListener("message",ol,!1)):al="onreadystatechange"in(qe?Ge.createElement("script"):{})?function(t){Li.appendChild(qe?Ge.createElement("script"):{}).onreadystatechange=function(){Li.removeChild(this),rl.call(t)}}:function(t){setTimeout(We(rl,t,1),0)};var ll,hl=Ju,fl=Le.MutationObserver||Le.WebKitMutationObserver,cl=Le.process,pl=Le.Promise,dl="process"==xe(cl),vl={f:function(t){return new $t(t)}},gl=function(t){try{return{e:!1,v:t()}}catch(e){return{e:!0,v:e}}},ml=Le.navigator,yl=ml&&ml.userAgent||"",xl=function(t,e){if(Ye(t),Ze(e)&&e.constructor===t)return e;t=vl.f(t);var i=t.resolve;return i(e),t.promise},bl=function(t,e,i){for(var n in e)i&&t[n]?t[n]=e[n]:ei(t,n,e[n]);return t},_l=Bi("species"),wl=function(t){t="function"==typeof Ce[t]?Ce[t]:Le[t],Ve&&t&&!t[_l]&&$e.f(t,_l,{configurable:!0,get:function(){return this}})},Al=function(){var t,e,i=function(){var i;for(dl&&(i=cl.domain)&&i.exit();t;){var r=t.fn;t=t.next;try{r()}catch(o){throw t?n():e=void 0,o}}e=void 0,i&&i.enter()};if(dl)var n=function(){cl.nextTick(i)};else if(!fl||Le.navigator&&Le.navigator.standalone)if(pl&&pl.resolve){var r=pl.resolve(void 0);n=function(){r.then(i)}}else n=function(){hl.call(Le,i)};else{var o=!0,a=document.createTextNode("");new fl(i).observe(a,{characterData:!0}),n=function(){a.data=o=!o}}return function(i){i={fn:i,next:void 0},e&&(e.next=i),t||(t=i,n()),e=i}}(),Tl=Le.TypeError,Ml=Le.process,Pl=Ml&&Ml.versions,Sl=Pl&&Pl.v8||"",El=Le.Promise,Cl="process"==lr(Ml),Ll=function(){},Rl=ll=vl.f,kl=!!function(){try{var t=El.resolve(1),e=(t.constructor={})[Bi("species")]=function(t){t(Ll,Ll)};return(Cl||"function"==typeof PromiseRejectionEvent)&&t.then(Ll)instanceof e&&0!==Sl.indexOf("6.6")&&-1===yl.indexOf("Chrome/66")}catch(i){}}(),Ol=function(t){var e;return!(!Ze(t)||"function"!=typeof(e=t.then))&&e},Dl=function(t,e){if(!t._n){t._n=!0;var i=t._c;Al((function(){for(var n=t._v,r=1==t._s,o=0;i.length>o;){var a=void 0,s=void 0,u=void 0,l=i[o++],h=r?l.ok:l.fail,f=l.resolve,c=l.reject,p=l.domain;try{h?(r||(2==t._h&&zl(t),t._h=1),!0===h?u=n:(p&&p.enter(),u=h(n),p&&(p.exit(),a=!0)),u===l.promise?c(Tl("Promise-chain cycle")):(s=Ol(u))?s.call(u,f,c):f(u)):c(n)}catch(d){p&&!a&&p.exit(),c(d)}}t._c=[],t._n=!1,e&&!t._h&&Bl(t)}))}},Bl=function(t){hl.call(Le,(function(){var e,i,n=t._v,r=1!==t._h&&0===(t._a||t._c).length;if(r){var o=gl((function(){Cl?Ml.emit("unhandledRejection",n,t):(e=Le.onunhandledrejection)?e({promise:t,reason:n}):(i=Le.console)&&i.error&&i.error("Unhandled promise rejection",n)}));t._h=Cl||1!==t._h&&0===(t._a||t._c).length?2:1}if(t._a=void 0,r&&o.e)throw o.v}))},zl=function(t){hl.call(Le,(function(){var e;Cl?Ml.emit("rejectionHandled",t):(e=Le.onrejectionhandled)&&e({promise:t,reason:t._v})}))},Fl=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),Dl(e,!0))},Il=function t(e){var i,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw Tl("Promise can't be resolved itself");(i=Ol(e))?Al((function(){var r={_w:n,_d:!1};try{i.call(e,We(t,r,1),We(Fl,r,1))}catch(o){Fl.call(r,o)}})):(n._v=e,n._s=1,Dl(n,!1))}catch(r){Fl.call({_w:n,_d:!1},r)}}};if(!kl){El=function(t){Xu(this,El,"Promise","_h"),He(t),Ul.call(this);try{t(We(Il,this,1),We(Fl,this,1))}catch(e){Fl.call(this,e)}};var Ul=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1};Ul.prototype=bl(El.prototype,{then:function(t,e){var i=Rl(qu(this,El));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=Cl?Ml.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&Dl(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}});var Nl=function(){var t=new Ul;this.promise=t,this.resolve=We(Il,t,1),this.reject=We(Fl,t,1)};vl.f=Rl=function(t){return t===El||t===jl?new Nl(t):ll(t)}}ni(ni.G+ni.W+ni.F*!kl,{Promise:El}),Ii(El,"Promise"),wl("Promise");var jl=Ce.Promise;ni(ni.S+ni.F*!kl,"Promise",{reject:function(t){var e=Rl(this),i=e.reject;return i(t),e.promise}}),ni(ni.S+1*ni.F,"Promise",{resolve:function(t){return xl(this===jl?El:this,t)}}),ni(ni.S+ni.F*!(kl&&Mr((function(t){El.all(t)["catch"](Ll)}))),"Promise",{all:function(t){var e=this,i=Rl(e),n=i.resolve,r=i.reject,o=gl((function(){var i=[],o=0,a=1;Vu(t,!1,(function(t){var s=o++,u=!1;i.push(void 0),a++,e.resolve(t).then((function(t){u||(u=!0,i[s]=t,--a||n(i))}),r)})),--a||n(i)}));return o.e&&r(o.v),i.promise},race:function(t){var e=this,i=Rl(e),n=i.reject,r=gl((function(){Vu(t,!1,(function(t){e.resolve(t).then(i.resolve,n)}))}));return r.e&&n(r.v),i.promise}}),ni(ni.P+ni.R,"Promise",{finally:function(t){var e=qu(this,Ce.Promise||Le.Promise),i="function"==typeof t;return this.then(i?function(i){return xl(e,t()).then((function(){return i}))}:t,i?function(i){return xl(e,t()).then((function(){throw i}))}:t)}}),ni(ni.S,"Promise",{try:function(t){var e=vl.f(this);return t=gl(t),(t.e?e.reject:e.resolve)(t.v),e.promise}});var Hl=Ce.Promise,Wl=r((function(t){t.exports={default:Hl,__esModule:!0}})),Zl=n(Wl),Yl=function(t,e){if(!Ze(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t},Xl=$e.f,Vl=nn.fastKey,Gl=Ve?"_s":"size",ql=function(t,e){var i=Vl(e);if("F"!==i)return t._i[i];for(t=t._f;t;t=t.n)if(t.k==e)return t},Kl={getConstructor:function(t,e,i,n){var r=t((function(t,o){Xu(t,r,e,"_i"),t._t=e,t._i=Di(null),t._f=void 0,t._l=void 0,t[Gl]=0,void 0!=o&&Vu(o,i,t[n],t)}));return bl(r.prototype,{clear:function(){for(var t=Yl(this,e),i=t._i,n=t._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete i[n.i];t._f=t._l=void 0,t[Gl]=0},delete:function(t){var i=Yl(this,e);if(t=ql(i,t)){var n=t.n,r=t.p;delete i._i[t.i],t.r=!0,r&&(r.n=n),n&&(n.p=r),i._f==t&&(i._f=n),i._l==t&&(i._l=r),i[Gl]--}return!!t},forEach:function(t){Yl(this,e);for(var i,n=We(t,1<arguments.length?arguments[1]:void 0,3);i=i?i.n:this._f;)for(n(i.v,i.k,this);i&&i.r;)i=i.p},has:function(t){return!!ql(Yl(this,e),t)}}),Ve&&Xl(r.prototype,"size",{get:function(){return Yl(this,e)[Gl]}}),r},def:function(t,e,i){var n,r=ql(t,e);return r?r.v=i:(t._l=r={i:n=Vl(e,!0),k:e,v:i,p:e=t._l,n:void 0,r:!1},t._f||(t._f=r),e&&(e.n=r),t[Gl]++,"F"!==n&&(t._i[n]=r)),t},getEntry:ql,setStrong:function(t,e,i){Zi(t,e,(function(t,i){this._t=Yl(t,e),this._k=i,this._l=void 0}),(function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?Xi(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,Xi(1))}),i?"entries":"values",!i,!0),wl(e)}},Ql=Bi("species"),Jl=function(t,e){if(an(t)){var i=t.constructor;"function"!=typeof i||i!==Array&&!an(i.prototype)||(i=void 0),Ze(i)&&(i=i[Ql],null===i&&(i=void 0))}return new(void 0===i?Array:i)(e)},$l=$e.f,th=function(t,e){var i=1==t,n=2==t,r=3==t,o=4==t,a=6==t,s=5==t||a,u=e||Jl;return function(e,l,h){var f=Object(ve(e)),c=be(f);l=We(l,h,3),h=Pe(c.length);var p,d,v=0;for(e=i?u(e,h):n?u(e,0):void 0;h>v;v++)if((s||v in c)&&(p=c[v],d=l(p,v,f),t))if(i)e[v]=d;else if(d)switch(t){case 3:return!0;case 5:return p;case 6:return v;case 2:e.push(p)}else if(o)return!1;return a?-1:r||o?o:e}}(0);(function(t,e,i,n,r,o){var a=Le[t],s=a,u=r?"set":"add",l=s&&s.prototype,h={};Ve&&"function"==typeof s&&(o||l.forEach&&!Xe((function(){(new s).entries().next()})))?(s=e((function(e,i){Xu(e,s,t,"_c"),e._c=new a,void 0!=i&&Vu(i,r,e[u],e)})),th("add clear delete forEach get has set keys values entries toJSON".split(" "),(function(t){var e="add"==t||"set"==t;t in l&&(!o||"clear"!=t)&&ei(s.prototype,t,(function(i,n){return Xu(this,s,t),e||!o||Ze(i)?(i=this._c[t](0===i?0:i,n),e?this:i):"get"==t&&void 0}))})),o||$l(s.prototype,"size",{get:function(){return this._c.size}})):(s=n.getConstructor(e,t,r,u),bl(s.prototype,i),nn.NEED=!0),Ii(s,t),h[t]=s,ni(ni.G+ni.W+ni.F,h),o||n.setStrong(s,t,r)})("Map",(function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}}),{get:function(t){return(t=Kl.getEntry(Yl(this,"Map"),t))&&t.v},set:function(t,e){return Kl.def(Yl(this,"Map"),0===t?0:t,e)}},Kl,!0),ni(ni.P+ni.R,"Map",{toJSON:function(t){return function(){if(lr(this)!=t)throw TypeError(t+"#toJSON isn't generic");var e=[];return Vu(this,!1,e.push,e,void 0),e}}("Map")}),function(t){ni(ni.S,t,{of:function(){for(var t=arguments.length,e=Array(t);t--;)e[t]=arguments[t];return new this(e)}})}("Map"),function(t){ni(ni.S,t,{from:function(t,e,i){var n;if(He(this),(n=void 0!==e)&&He(e),void 0==t)return new this;var r=[];if(n){var o=0,a=We(e,i,2);Vu(t,!1,(function(t){r.push(a(t,o++))}))}else Vu(t,!1,r.push,r);return new this(r)}})}("Map");var eh,ih,nh=Ce.Map,rh=r((function(t){t.exports={default:nh,__esModule:!0}})),oh=n(rh),ah=r((function(t,e){e.__esModule=!0;var i=Ai&&Ai.__esModule?Ai:{default:Ai};e.default=function(t,e,n){return e in t?(0,i.default)(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}})),sh=n(ah),uh=(eh={},sh(eh,1,1),sh(eh,2,1),sh(eh,3,1),eh),lh=(ih={},sh(ih,1,1),sh(ih,2,1),sh(ih,3,1),ih),hh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.vertCount=0,t.bufferMap={},t.bufferData=[],t.autoUpdate=!0,i=t.canvas=document.createElement("canvas"),t.ctx=i.getContext("2d"),t.iconHash=new oh,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:[1,1,1,.8],speed:1,size:5,pointFade:!0,pointFadeBuffer:1,minLineLength:2,animationType:2,shapeType:2,depthTest:!1,delay:0,unit:"px",padding:0}}},{key:"initialize",value:function(t){this.gl=t,this.texture=null,this.isUseTexture=!1;var e=this.getOptions();this.updateUniformsFromOptions(e),this.program=new Ms(this.gl,{vertexShader:"precision highp float;attribute vec3 aPos;attribute vec3 aNextPos;attribute float aIndex;attribute float aNextIndex;attribute float aLength;attribute float aSpeed;attribute float aDelay;attribute vec3 aUV;uniform float uSize;uniform mat4 u_matrix;uniform float uOriginSpeed;uniform float uElapsedSteps;uniform int uAnimationType;uniform int uPointFade;uniform float uPointFadeBuffer;uniform float uZoomUnits;varying float vAddOpacity;varying vec3 vUV;void main(){if(uAnimationType==1){if(abs(aIndex-mod(uElapsedSteps,aLength))>.1){gl_Position=vec4(-2.,-2.,0,1.0);return;}gl_Position=u_matrix*vec4(aPos.xyz,1.0);vAddOpacity=1.;}else if(uAnimationType==2){float lineLength=aLength-1.;float cIndex=mod(uElapsedSteps,lineLength);float rest=cIndex-aIndex;if(rest<1.&&rest>=0.){if(uPointFade==1){if(cIndex<uPointFadeBuffer){vAddOpacity=cIndex/uPointFadeBuffer;}else if(cIndex>lineLength-uPointFadeBuffer){vAddOpacity=(lineLength-cIndex)/uPointFadeBuffer;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}else if(uAnimationType==3){float speedRatio=aSpeed/uOriginSpeed;float percent=mod(mod(uElapsedSteps*aSpeed,aLength)/aLength-aDelay,1.0);if(percent<=aNextIndex&&percent>=aIndex){if(uPointFade==1){float fadePercent=uPointFadeBuffer*1000./aLength;if(percent<fadePercent){vAddOpacity=percent/fadePercent;}else if(percent>1.-fadePercent){vAddOpacity=(1.-percent)/fadePercent;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}float rest=(percent-aIndex)/(aNextIndex-aIndex);gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}vUV=aUV;gl_PointSize=uSize/uZoomUnits;}",fragmentShader:"precision highp float;uniform vec4 uColor;uniform int ushapeType;uniform bool uUseTexture;uniform sampler2D uSampler;varying float vAddOpacity;varying vec3 vUV;void main(){if(ushapeType==2){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}else if(ushapeType==3){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*smoothstep(1.0,0.0,d*2.)*vAddOpacity);}else{gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}if(uUseTexture){float ratio=vUV.z;vec2 uv=vUV.xy;gl_FragColor=texture2D(uSampler,vec2(gl_PointCoord.x*ratio+uv.x,1.0-(uv.y+gl_PointCoord.y*ratio)));}}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"bindAttributeBufferData",value:function(t,e,i,n){var r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),i=new Float32Array(i),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),this.bufferMap[e]={buffer:r,data:i,elementSize:n}}},{key:"onChanged",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.gl&&(Array.isArray(e)||(e=[]),this.processCache(t,e,i))}},{key:"processCache",value:function(t,e,i){var n=this;this.cachedData=[];for(var r=t.icon,o=t.speed,a=0;a<e.length;a++){var s=e[a].geometry.coordinates,u=this.getProperty("icon",r,e[a]),l=this.getProperty("speed",o,e[a]),h=this.getProperty("delay",0,e[a]);s&&(this.cachedData.push({coordinates:s,icon:u,speed:l,delay:h}),this.iconHash.get(u)||this.iconHash.set(u,u))}e=Er(this.iconHash.entries()).filter((function(t){return"string"===typeof t[1]})).map((function(t){var e=xr(t,2)[0];return new Zl((function(t,i){n.url2canvas(e,(function(i){n.iconHash.set(e,i),t()}))}))})),Zl.all(e).then((function(e){n.buildSprite(t),!1!==i.autoRender&&n.webglLayer&&n.webglLayer.render()}))}},{key:"buildSprite",value:function(t){var e=t.padding,i=this.canvas,n=this.ctx,r=0,o=[],a=new oh;if(t.icon){r=!0;var s=!1,u=void 0;try{for(var l,h=mr(this.iconHash);!(r=(l=h.next()).done);r=!0){var f=xr(l.value,2),c=f[1];if("string"!==typeof c){var p=c.width,d=p+e;o.push({w:d,h:d,width:p,key:f[0],icon:c})}}}catch(g){s=!0,u=g}finally{try{!r&&h.return&&h.return()}finally{if(s)throw u}}for(h=te(o),l=0;l<o.length;l++)f=o[l],a.get(f.key)||a.set(f.key,f);for(r=Math.max(v(h.w),v(h.h)),i.width=r||1,i.height=r||1,n.save(),i=0;i<o.length;i++)h=o[i],n.drawImage(h.icon,h.x+e,h.y+e,h.width,h.width);n.restore()}this.loadTexture(),this.buildVertex(t,a,r)}},{key:"buildVertex",value:function(t,e,i){var n=this.gl;this.updateUniformsFromOptions(t);for(var r=[],o=[],a=[],s=[],u=[],l=[],h=[],f=[],c=t.minLineLength,p=0;p<this.cachedData.length;p++){var d=this.cachedData[p],v=d.coordinates,g=d.icon,m=d.speed;d=d.delay;var y=v.length,x=[];if(!(y<c)){for(t.icon&&(x=(x=e.get(g))?[x.x/i,x.y/i,x.w/i]:[0,0,0]),g=0;g<y;++g){var b=this.normizedPoint(v[g]);r.push(b[0]),r.push(b[1]),r.push(b[2]||0),f.push.apply(f,Lr(x)),3!==this.animationType&&(o.push(g),s.push(y))}if(1!==this.animationType){for(g=r.length-3*y+3,x=r.length,v=g;v<x;++v)u.push(r[v]);if(r.splice(x-3,3),f.splice(x-3,3),2===this.animationType)o.pop(),s.pop();else if(3===this.animationType){for(g-=3,x=r.length-3,v=0,y=[],b=g;b<=x;b+=3)g=Math.sqrt(Math.pow(u[b]-r[b],2)+Math.pow(u[b+1]-r[b+1],2)+Math.pow(u[b+2]-r[b+2],2)),v+=g,y.push(g);o.push(0),l.push(m),d/=v/m,h.push(d),b=x=0;for(var _=y.length-1;b<_;++b)x+=y[b],g=x/v,o.push(g),a.push(g),s.push(v),l.push(m),h.push(d);a.push(1),s.push(v)}}}}this.bindAttributeBufferData(n,"aPos",r,3),this.bindAttributeBufferData(n,"aIndex",o,1),this.bindAttributeBufferData(n,"aLength",s,1),1!==this.animationType&&(this.bindAttributeBufferData(n,"aNextPos",u,3),3===this.animationType&&(this.bindAttributeBufferData(n,"aNextIndex",a,1),this.bindAttributeBufferData(n,"aSpeed",l,1),this.bindAttributeBufferData(n,"aDelay",h,1))),t.icon&&this.bindAttributeBufferData(n,"aUV",f,3),this.vertCount=r.length/3}},{key:"updateUniformsFromOptions",value:function(t){this.color=this.normizedColor(t.color),this.startTime=(new Date).getTime(),uh[t.animationType]||(t.animationType=2),lh[t.shapeType]||(t.shapeType=2),(isNaN(t.minLineLength)||2>t.minLineLength)&&(t.minLineLength=2),this.animationType=t.animationType}},{key:"renderAttributeArr",value:function(t,e,i){if(void 0!==e.attributes[i]){var n=this.bufferMap[i];n&&(t.bindBuffer(t.ARRAY_BUFFER,n.buffer),t.enableVertexAttribArray(e.attributes[i]),t.vertexAttribPointer(e.attributes[i],n.elementSize,t.FLOAT,!1,n.data.BYTES_PER_ELEMENT*n.elementSize,0))}}},{key:"render",value:function(t){var e=t.gl;if(t=t.matrix,!(0>=this.vertCount)){var i=this.getOptions(),n=this.program;e.useProgram(n.program),this.renderAttributeArr(e,n,"aPos"),this.renderAttributeArr(e,n,"aIndex"),this.renderAttributeArr(e,n,"aLength"),1!==this.animationType&&(this.renderAttributeArr(e,n,"aNextPos"),3===this.animationType&&(this.renderAttributeArr(e,n,"aNextIndex"),this.renderAttributeArr(e,n,"aSpeed"),this.renderAttributeArr(e,n,"aDelay"))),i.icon&&this.texture&&(this.renderAttributeArr(e,n,"aUV"),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(n.uniforms.uSampler,0)),e.uniform1i(n.uniforms.uUseTexture,this.isUseTexture);var r=(new Date).getTime()-this.startTime;r<this.options.delay?r=0:(r-=this.options.delay,r=1===this.animationType?Math.round(r/1e3*this.options.speed*20):3===this.animationType?r/1e3*this.options.speed*1e3:r/1e3*this.options.speed);var o=this.options.size;if(Array.isArray(o)){var a=this.map.map.getMaxZoom(),s=this.map.map.getMinZoom();o=o[0]+(this.map.getZoom()-s)/(a-s)*(o[1]-o[0])}e.uniformMatrix4fv(n.uniforms.u_matrix,!1,t),e.uniform4f(n.uniforms.uColor,this.color[0],this.color[1],this.color[2],this.color[3]),e.uniform1f(n.uniforms.uSize,o),e.uniform1f(n.uniforms.uElapsedSteps,r),e.uniform1f(n.uniforms.uOriginSpeed,this.options.speed),e.uniform1i(n.uniforms.uAnimationType,this.animationType),e.uniform1i(n.uniforms.ushapeType,this.options.shapeType),e.uniform1i(n.uniforms.uPointFade,this.options.pointFade?1:0),e.uniform1f(n.uniforms.uPointFadeBuffer,this.options.pointFadeBuffer),e.uniform1f(n.uniforms.uZoomUnits,"m"===this.options.unit?this.map.getZoomUnits():1),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===i.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],depthTest:!!i.depthTest}),e.drawArrays(e.POINTS,0,this.vertCount)}}},{key:"url2canvas",value:function(t,e){if("object"===("undefined"===typeof t?"undefined":qn(t)))e(t);else{var i=new Image;i.crossOrigin="anonymous",i.onload=function(){var t=document.createElement("canvas");t.width=128,t.height=128,t.getContext("2d").drawImage(i,0,0,128,128),e(t)},i.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas&&this.getOptions().icon?j(this.gl,this.canvas,(function(e){t.isUseTexture=!0,t.texture=e})):(this.isUseTexture=!1,this.texture=null)}}]),e}(Ns);hh.ANIMATION_TYPE_LEAP=1,hh.ANIMATION_TYPE_SMOOTH=2,hh.ANIMATION_TYPE_UNIFORM_SPEED=3,hh.SHAPE_TYPE_SQUARE=1,hh.SHAPE_TYPE_CIRCLE=2,hh.SHAPE_TYPE_CIRCLE_GRADIENT=3;var fh=function(){function t(e,i){de(this,t),this.layer=e,this.gl=i,this.initData()}return Pi(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]}}},{key:"getData",value:function(){return this.outWall3d}},{key:"onLayerChange",value:function(t,e){this.initData();for(var i=t.color,n=t.height,r=t.gradient,o=t.enablePreciseMap,a=t.repeatMap,s=this.gl,u=0;u<e.length;u++){var l=e[u],h=l.color||i;"properties"in l&&"color"in l.properties&&(h=l.properties.color),r||"[object Function]"!==Object.prototype.toString.call(h)||(h=h(l));var f=this.layer.normizedColor(r?r[0]:h);h=this.layer.normizedColor(r?r[1]:h);var c=l.height||n;if("properties"in l&&"height"in l.properties&&(c=l.properties.height),"[object Function]"===Object.prototype.toString.call(c)&&(c=c(l)),"MultiLineString"===l.geometry.type||"Polygon"===l.geometry.type)for(var p=0;p<l.geometry.coordinates.length;p++){for(var d=l.geometry.coordinates[p],v=d.length,g=[],m=[],y=0,x=0;x<v;x++){var b=this.layer.normizedPoint(d[x]);if(0<x&&(o||a)){var _=this.layer.normizedPoint(d[x-1]);y+=Math.sqrt(Math.pow(b[0]-_[0],2)+Math.pow(b[1]-_[1],2))}g.push(b),m.push(y)}this.processData(this.outWall3d,t,g,m,f,h,c)}else{for(l=l.geometry.coordinates,p=l.length,d=[],v=[],m=g=0;m<p;m++)y=this.layer.normizedPoint(l[m]),0<m&&(o||a)&&(x=this.layer.normizedPoint(l[m-1]),g+=Math.sqrt(Math.pow(y[0]-x[0],2)+Math.pow(y[1]-x[1],2))),d.push(y),v.push(g);this.processData(this.outWall3d,t,d,v,f,h,c)}}for(t=0;t<this.outWall3d.vertex.length;t++){for(e=[],i=this.outWall3d.vertex[t].length,n=0;n<i;n++)e.push.apply(e,Lr(this.outWall3d.vertex[t][n]));i=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,i),s.bufferData(s.ARRAY_BUFFER,new Float32Array(e),s.STATIC_DRAW),this.outWall3d.vertexBuffer[t]=i,s.bindBuffer(s.ARRAY_BUFFER,null),i=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[t]),s.STATIC_DRAW),this.outWall3d.indexBuffer[t]=i,s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,i,n,r,o,a){var s=n[n.length-1],u=t.vertex[t.vertex.length-1],l=t.index[t.index.length-1],h=i.length;for((!l||65536<=l.length+2*h+2)&&(u=[],l=[],t.vertex.push(u),t.index.push(l)),(t=u.length)&&l.push(t-1,t),t=0;t<h;t++){var f=[],c=[],p=i[t];f.push(p[0],p[1],p[2]+a),f.push(r[0],r[1],r[2],r[3]),c.push(p[0],p[1],p[2]),c.push(o[0],o[1],o[2],o[3]),e.texture&&(p=n[t],e.enablePreciseMap||e.repeatMap?(f.push(p,1,s),c.push(p,0,s)):(f.push(t,1,h-1),c.push(t,0,h-1))),p=u.length,u.push(f,c),l.push(p,p+1)}}}]),t}(),ch=function(t){function e(t,i){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t,i))}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{texture:null,enablePreciseMap:!1,repeatMap:0,height:100,color:[1,1,1,1]}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new fh(this,this.gl),this.texture=null,this.isUseTexture=!1,this.vertexLength=10,this.program=new Ms(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform bool uUseTexture;attribute vec3 aPos;attribute vec4 aColor;attribute vec2 aTextureCoords;attribute float aTotalDistance;varying vec2 vTextureCoords;varying float vTotalDistance;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}if(uUseTexture){vTextureCoords=aTextureCoords;vTotalDistance=aTotalDistance;}gl_Position=u_matrix*vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform bool uUseTexture;uniform float uDistance;uniform sampler2D uSampler;varying vec2 vTextureCoords;varying float vTotalDistance;varying vec4 vColor;void main(){if(uUseTexture){float uvx=vTextureCoords.x/vTotalDistance;if(uDistance>0.0){uvx=mod(vTextureCoords.x,uDistance)/uDistance;}gl_FragColor=vec4(1.0,1.0,1.0,1.0)*texture2D(uSampler,vec2(uvx,vTextureCoords.y));}else{gl_FragColor=vColor;}}"}),this.loadTexture()}},{key:"onChanged",value:function(t,e){var i=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){i.loadTexture((function(){i.dataMgr.onLayerChange(t,e),i.webglLayer.render()}))}),0))}},{key:"render",value:function(t){var e=t.gl,i=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),r=this.program;if(e.useProgram(r.program),n.texture){if(!this.texture)return;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(r.uniforms.uSampler,0)}for(this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],depthMask:!!n.texture,depthFunc:n.texture?e.LESS:e.LEQUAL}),n.texture?e.enableVertexAttribArray(r.attributes.aTextureCoords):e.disableVertexAttribArray(r.attributes.aTextureCoords),e.enableVertexAttribArray(r.attributes.aPos),e.enableVertexAttribArray(r.attributes.aColor),e.uniformMatrix4fv(r.uniforms.u_matrix,!1,i),e.uniform1i(r.uniforms.uUseTexture,this.isUseTexture),e.uniform1f(r.uniforms.uDistance,n.repeatMap),i=0;i<t.vertex.length;i++)if(!(0>=t.vertex[i].length)){var o=t.vertex[i],a=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=a*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[i]),e.vertexAttribPointer(r.attributes.aPos,3,e.FLOAT,!1,o,0),e.vertexAttribPointer(r.attributes.aColor,4,e.FLOAT,!1,o,3*a),n.texture&&(e.vertexAttribPointer(r.attributes.aTextureCoords,2,e.FLOAT,!1,o,7*a),e.vertexAttribPointer(r.attributes.aTotalDistance,1,e.FLOAT,!1,o,9*a)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[i]),e.drawElements(e.TRIANGLE_STRIP,t.index[i].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}}},{key:"loadTexture",value:function(t){var e=this,i=this.getOptions();i.texture?(this.isUseTexture=!0,j(this.gl,i.texture,(function(i,n){e.image=n,e.texture=i,t&&t(),e.webglLayer.render()}))):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),e}(Ns),ph=function(){function t(e,i){de(this,t),this.layer=e,this.gl=i,this.initData()}return Pi(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(t,e){this.initData();var i=t.color,n=t.height,r=t.gradient;t=this.gl;for(var o=0;o<e.length;o++){var a=e[o].geometry.coordinates,s=a.length;this.maxLength=s>this.maxLength?s:this.maxLength;for(var u=[],l=0;l<s;l++){var h=this.layer.normizedPoint(a[l]);u.push(h)}s=e[o].color||i,"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color),r||"[object Function]"!==Object.prototype.toString.call(s)||(s=s(e[o])),a=this.layer.normizedColor(r?r[0]:s),s=this.layer.normizedColor(r?r[1]:s),l=e[o].height||n,"properties"in e[o]&&"height"in e[o].properties&&(l=e[o].properties.height),"[object Function]"===Object.prototype.toString.call(l)&&(l=l(e[o])),this.processData(this.outWall3d,u,a,s,l)}for(e=0;e<this.outWall3d.vertex.length;e++){for(i=[],n=this.outWall3d.vertex[e].length,r=0;r<n;r++)i.push.apply(i,Lr(this.outWall3d.vertex[e][r]));n=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),this.outWall3d.vertexBuffer[e]=n,t.bindBuffer(t.ARRAY_BUFFER,null),n=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[e]),t.STATIC_DRAW),this.outWall3d.indexBuffer[e]=n,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,i,n,r){var o=t.vertex[t.vertex.length-1],a=t.index[t.index.length-1],s=e.length;for((!a||65536<=a.length+2*s+2)&&(o=[],a=[],t.vertex.push(o),t.index.push(a)),(t=o.length)&&a.push(t-1,t),t=0;t<s;t++){var u=[],l=[],h=e[t];u.push(h[0],h[1]),u.push(h[2]?Number(h[2])+r:r),u.push(h[3]?Number(h[3]):t),u.push(i[0],i[1],i[2],i[3]),l.push(h[0],h[1]),l.push(h[2]?Number(h[2]):0),l.push(h[3]?Number(h[3]):t),l.push(n[0],n[1],n[2],n[3]),h=o.length,o.push(u,l),a.push(h,h+1)}}}]),t}(),dh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new ph(this,this.gl),this.program=new Ms(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;varying float vTime;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vColor=aColor;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"})}},{key:"onChanged",value:function(t,e){this.gl&&(this.dataMgr.onLayerChange(t,e),void 0===t.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var e=t.gl,i=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),r=this.program;for(e.useProgram(r.program),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),e.enableVertexAttribArray(r.attributes.aPos),e.enableVertexAttribArray(r.attributes.aColor),e.uniformMatrix4fv(r.uniforms.u_matrix,!1,i),e.uniform1f(r.uniforms.currentTime,this.time),e.uniform1f(r.uniforms.trailLength,n.trailLength),i=0;i<t.vertex.length;i++)if(!(0>=t.vertex[i].length)){var o=t.vertex[i],a=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=a*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[i]),e.vertexAttribPointer(r.attributes.aPos,4,e.FLOAT,!1,o,0),e.vertexAttribPointer(r.attributes.aColor,4,e.FLOAT,!1,o,4*a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[i]),e.drawElements(e.TRIANGLE_STRIP,t.index[i].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}this.time+=n.step,this.time>this.endTime&&(this.time=this.startTime)}}}]),e}(Ns),vh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.simpleLineLayer=new Su(t.getHeatOptions()),t.children=[t.simpleLineLayer],t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{blend:"normal",gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onDataChanged",value:function(t){this.simpleLineLayer.setData(t)}},{key:"onOptionsChanged",value:function(t){this.simpleLineLayer.setOptions(this.getHeatOptions())}},{key:"getHeatOptions",value:function(){var t=this.getOptions(),e=t.max,i=t.min;void 0===e&&(i=this.getDataRange(),e=i.max,i=i.min);var n=new A({max:e,min:i,gradient:t.gradient});return t.color=function(t){var e=~~t.count||1;return"properties"in t&&"count"in t.properties&&(e=~~t.properties.count),t=n.getImageData(e),[t[0]/255,t[1]/255,t[2]/255,t[3]/255]},t}},{key:"getDataRange",value:function(){var t=this.getData(),e=0,i=0;t[0]&&(e=~~t[0].count||1,i=~~t[0].count||1),"properties"in t[0]&&"count"in t[0].properties&&(e=~~t[0].properties.count,i=~~t[0].properties.count);for(var n=t.length,r=0;r<n;r++){var o=~~t[r].count||1;"properties"in t[r]&&"count"in t[r].properties&&(o=~~t[r].properties.count),e=Math.max(o,e),i=Math.min(o,i)}return{max:e/2,min:i}}}]),e}(Mu),gh=r((function(t,e){(function(e,i){t.exports=i()})(0,(function(){function t(i,n,r,o,a){for(;o>r;){if(600<o-r){var s=o-r+1,u=n-r+1,l=Math.log(s),h=.5*Math.exp(2*l/3);l=.5*Math.sqrt(l*h*(s-h)/s)*(0>u-s/2?-1:1),t(i,n,Math.max(r,Math.floor(n-u*h/s+l)),Math.min(o,Math.floor(n+(s-u)*h/s+l)),a)}for(s=i[n],u=r,h=o,e(i,r,n),0<a(i[o],s)&&e(i,r,o);u<h;){for(e(i,u,h),u++,h--;0>a(i[u],s);)u++;for(;0<a(i[h],s);)h--}0===a(i[r],s)?e(i,r,h):(h++,e(i,h,o)),h<=n&&(r=h+1),n<=h&&(o=h-1)}}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}function n(t,e){r(t,0,t.children.length,e,t)}function r(t,e,i,n,r){for(r||(r=c(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;e<i;e++){var a=t.children[e];o(r,t.leaf?n(a):a)}return r}function o(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function a(t,e){return t.minX-e.minX}function s(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function l(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function c(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function p(e,n,r,o,a){for(var s=[n,r];s.length;)if(r=s.pop(),n=s.pop(),!(r-n<=o)){var u=n+Math.ceil((r-n)/o/2)*o;t(e,u,n||0,r||e.length-1,a||i),s.push(n,u,u,r)}}var d=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};return d.prototype.all=function(){return this._all(this.data,[])},d.prototype.search=function(t){var e=this.data,i=[];if(!f(t,e))return i;for(var n=this.toBBox,r=[];e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],s=e.leaf?n(a):a;f(t,s)&&(e.leaf?i.push(a):h(t,s)?this._all(a,i):r.push(a))}e=r.pop()}return i},d.prototype.collides=function(t){var e=this.data;if(!f(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var r=e.children[n],o=e.leaf?this.toBBox(r):r;if(f(t,o)){if(e.leaf||h(t,o))return!0;i.push(r)}}e=i.pop()}return!1},d.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}return t=this._build(t.slice(),0,t.length-1,0),this.data.children.length?this.data.height===t.height?this._splitRoot(this.data,t):(this.data.height<t.height&&(e=this.data,this.data=t,t=e),this._insert(t,this.data.height-t.height-1,!0)):this.data=t,this},d.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},d.prototype.clear=function(){return this.data=c([]),this},d.prototype.remove=function(t,e){if(!t)return this;for(var i,n,r,o=this.data,a=this.toBBox(t),s=[],u=[];o||s.length;){if(o||(o=s.pop(),n=s[s.length-1],i=u.pop(),r=!0),o.leaf){t:{var l=t,f=o.children,c=e;if(c){for(var p=0;p<f.length;p++)if(c(l,f[p])){l=p;break t}l=-1}else l=f.indexOf(l)}if(-1!==l){o.children.splice(l,1),s.push(o),this._condense(s);break}}r||o.leaf||!h(o,a)?n?(i++,o=n.children[i],r=!1):o=null:(s.push(o),u.push(i),i=0,n=o,o=o.children[0])}return this},d.prototype.toBBox=function(t){return t},d.prototype.compareMinX=function(t,e){return t.minX-e.minX},d.prototype.compareMinY=function(t,e){return t.minY-e.minY},d.prototype.toJSON=function(){return this.data},d.prototype.fromJSON=function(t){return this.data=t,this},d.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},d.prototype._build=function(t,e,i,r){var o=i-e+1,a=this._maxEntries;if(o<=a){var s=c(t.slice(e,i+1));return n(s,this.toBBox),s}for(r||(r=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,r-1))),s=c([]),s.leaf=!1,s.height=r,o=Math.ceil(o/a),a=o*Math.ceil(Math.sqrt(a)),p(t,e,i,a,this.compareMinX);e<=i;e+=a){var u=Math.min(e+a-1,i);p(t,e,u,o,this.compareMinY);for(var l=e;l<=u;l+=o)s.children.push(this._build(t,l,Math.min(l+o-1,u),r-1))}return n(s,this.toBBox),s},d.prototype._chooseSubtree=function(t,e,i,n){for(;;){if(n.push(e),e.leaf||n.length-1===i)break;for(var r=1/0,o=1/0,a=void 0,s=0;s<e.children.length;s++){var l=e.children[s],h=u(l),f=(Math.max(l.maxX,t.maxX)-Math.min(l.minX,t.minX))*(Math.max(l.maxY,t.maxY)-Math.min(l.minY,t.minY))-h;f<o?(o=f,r=h<r?h:r,a=l):f===o&&h<r&&(r=h,a=l)}e=a||e.children[0]}return e},d.prototype._insert=function(t,e,i){i=i?t:this.toBBox(t);var n=[],r=this._chooseSubtree(i,this.data,e,n);for(r.children.push(t),o(r,i);0<=e;){if(!(n[e].children.length>this._maxEntries))break;this._split(n,e),e--}this._adjustParentBBoxes(i,n,e)},d.prototype._split=function(t,e){var i=t[e],r=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,r),r=this._chooseSplitIndex(i,o,r),r=c(i.children.splice(r,i.children.length-r)),r.height=i.height,r.leaf=i.leaf,n(i,this.toBBox),n(r,this.toBBox),e?t[e-1].children.push(r):this._splitRoot(i,r)},d.prototype._splitRoot=function(t,e){this.data=c([t,e]),this.data.height=t.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},d.prototype._chooseSplitIndex=function(t,e,i){for(var n,o=1/0,a=1/0,s=e;s<=i-e;s++){var l=r(t,0,s,this.toBBox),h=r(t,s,i,this.toBBox),f=Math.max(0,Math.min(l.maxX,h.maxX)-Math.max(l.minX,h.minX))*Math.max(0,Math.min(l.maxY,h.maxY)-Math.max(l.minY,h.minY));l=u(l)+u(h),f<o?(o=f,n=s,a=l<a?l:a):f===o&&l<a&&(a=l,n=s)}return n||i-e},d.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:a,r=t.leaf?this.compareMinY:s,o=this._allDistMargin(t,e,i,n);e=this._allDistMargin(t,e,i,r),o<e&&t.children.sort(n)},d.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n),n=this.toBBox;for(var a=r(t,0,e,n),s=r(t,i-e,i,n),u=l(a)+l(s),h=e;h<i-e;h++){var f=t.children[h];o(a,t.leaf?n(f):f),u+=l(a)}for(i=i-e-1;i>=e;i--)a=t.children[i],o(s,t.leaf?n(a):a),u+=l(s);return u},d.prototype._adjustParentBBoxes=function(t,e,i){for(;0<=i;i--)o(e[i],t)},d.prototype._condense=function(t){for(var e,i=t.length-1;0<=i;i--)0===t[i].children.length?0<i?(e=t[i-1].children,e.splice(e.indexOf(t[i]),1)):this.clear():n(t[i],this.toBBox)},d}))})),mh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),i=t.canvas=document.createElement("canvas"),i=t.ctx=i.getContext("2d"),i.textAlign="start",i.textBaseline="top",t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,flat:!1,collides:!0,unit:"px",angle:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new Ms(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***\u70b9A(x,y)\uff0c\u7ed5\u539f\u70b9\u987a\u65f6\u9488\u65cb\u8f6c\u89d2\u5ea6a\u65b0\u5750\u6807\u7684\u8ba1\u7b97\u516c\u5f0f*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)+size.x*sin(rotation);}else if(corner==2.0){x+=size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)-size.x*sin(rotation);}else if(corner==3.0){x+=size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)-size.x*sin(rotation);}else{x+=-size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)+size.x*sin(rotation);}return vec3(x,y,coord.z);}void main(){vTextCoord=aTextCoord;if(uFlat){vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}else{vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio*scale;vec3 current=transformCoord(screen,halfSize,corner);current.z+=zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:"precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.canvas=this.cachedData=this.options=this.data=this.indexBuffer=this.uvBuffer=this.vertexBuffer=this.program=this.vertexArray=null}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){this.cachedData=[];for(var i=0;i<e.length;i++){var n=this.normizedPoint(e[i].geometry.coordinates),r=e[i].text;"properties"in e[i]&&"text"in e[i].properties&&(r=e[i].properties.text);var o=this.getProperty("angle",t.angle,e[i]);n&&void 0!==r&&this.cachedData.push({point:n,text:r,angle:o,index:i})}}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,i=t.matrix,n=this.getOptions(),r=this.program;r.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite});var o=this.map.getZoomUnits();r.setUniforms(di(this.getCommonUniforms(t),{matrix:i,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,uFlat:n.flat,offset:n.offset,zoomUnits:o,zIndex:n.zIndex,uUnitPx:"px"===n.unit})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateText(t)}},{key:"updateText",value:function(t){var e=t.gl,i=t.matrix,n=this.getOptions(),r=n.color;t=n.fontSize;var o=n.fontFamily,a=n.padding,s=n.margin,u=n.collides;n=n.enablePicked;var l=e.canvas.width/window.devicePixelRatio,h=e.canvas.height/window.devicePixelRatio,f=this.canvas;e=this.ctx,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),e.textBaseline="top",e.font="20px "+o;for(var c=new gh,p=[],d=0;d<this.cachedData.length;d++){var v=this.cachedData[d],g=v.point,m=v.text,y=v.angle;v=v.index;var x=xr(g,3);x=ru.clone([x[0],x[1],x[2],1]),ru.transformMat4(x,x,i),ru.scale(x,x,1/x[3]);var b=(x[0]+1)/2*l,_=(1-x[1])/2*h,w=e.measureText(m);x=w.width+2*a[0];var A=20;w.actualBoundingBoxAscent&&w.actualBoundingBoxDescent&&(A=w.actualBoundingBoxDescent-w.actualBoundingBoxAscent),A+=2*a[1];var T=x+s[0];if(w=A+s[1],b-=T/2,_-=w/2,T=b+T,w=_+w,!(0>T||0>w||b>l||_>h)){if(u){if(w={minX:b,maxX:T,minY:_,maxY:w},c.collides(w))continue;c.insert(w)}p.push({w:x,h:A,point:g,text:m,angle:y,dataIndex:v})}}for(e.restore(),s=te(p),i=s.w,s=s.h,0>=i&&(i=1),0>=s&&(s=1),f.width=i*window.devicePixelRatio,f.height=s*window.devicePixelRatio,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),e.textBaseline="top",e.fillStyle=r,e.font="20px "+o,r=[],o=[],f=[],u=[],l=0,h=p.length;l<h;++l){for(c=p[l],e.fillText(c.text,c.x+a[0],c.y+a[1]),m=xr(c.point,3),d=m[0],g=m[1],m=m[2],y=0;4>y;y++)r.push(d,g,m),r.push(y),r.push(c.w,c.h),r.push(t/20,c.angle*Math.PI/180);d=c.x/i,g=(c.x+c.w)/i,m=(c.y+c.h)/s,y=c.y/s,o.push(d,m,d,y,g,y,g,m),d=4*l,f.push(d,d+2,d+1,d,d+3,d+2),n&&(c=this.indexToRgb(c.dataIndex),u.push(c[0]/255,c[1]/255,c[2]/255),u.push(c[0]/255,c[1]/255,c[2]/255),u.push(c[0]/255,c[1]/255,c[2]/255),u.push(c[0]/255,c[1]/255,c[2]/255))}e.restore(),this.loadTexture(),this.index=f,this.vertexBuffer.updateData(new Float32Array(r)),this.uvBuffer.updateData(new Float32Array(o)),this.indexBuffer.updateData(new Uint32Array(f)),n&&this.pickBuffer.updateData(new Float32Array(u))}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e}),{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),e}(Ns),yh=r((function(t,e){(function(e,i){t.exports=i()})(0,(function(){function t(i,n,r,o,a,s){if(!(a-o<=r)){var u=o+a>>1;e(i,n,u,o,a,s%2),t(i,n,r,o,u-1,s+1),t(i,n,r,u+1,a,s+1)}}function e(t,n,r,o,a,s){for(;a>o;){if(600<a-o){var u=a-o+1,l=r-o+1,h=Math.log(u),f=.5*Math.exp(2*h/3);h=.5*Math.sqrt(h*f*(u-f)/u)*(0>l-u/2?-1:1),e(t,n,r,Math.max(o,Math.floor(r-l*f/u+h)),Math.min(a,Math.floor(r+(u-l)*f/u+h)),s)}for(u=n[2*r+s],l=o,f=a,i(t,n,o,r),n[2*a+s]>u&&i(t,n,o,a);l<f;){for(i(t,n,l,f),l++,f--;n[2*l+s]<u;)l++;for(;n[2*f+s]>u;)f--}n[2*o+s]===u?i(t,n,o,f):(f++,i(t,n,f,a)),f<=r&&(o=f+1),r<=f&&(a=f-1)}}function i(t,e,i,r){n(t,i,r),n(e,2*i,2*r),n(e,2*i+1,2*r+1)}function n(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function r(t,e){return t=t.geometry.coordinates,{x:t[0]/360+.5,y:s(t[1]),zoom:1/0,index:e,parentId:-1}}function o(t){var e=t.id,i=a(t);return{type:"Feature",id:e,properties:i,geometry:{type:"Point",coordinates:[360*(t.x-.5),360*Math.atan(Math.exp((180-360*t.y)*Math.PI/180))/Math.PI-90]}}}function a(t){var e=t.numPoints,i=1e4<=e?Math.round(e/1e3)+"k":1e3<=e?Math.round(e/100)/10+"k":e;return u(u({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function s(t){return t=Math.sin(t*Math.PI/180),t=.5-.25*Math.log((1+t)/(1-t))/Math.PI,0>t?0:1<t?1:t}function u(t,e){for(var i in e)t[i]=e[i];return t}function l(t){return t.x}function h(t){return t.y}var f=function(t){return t[0]},c=function(t){return t[1]},p=function(e,i,n,r,o){void 0===i&&(i=f),void 0===n&&(n=c),void 0===r&&(r=64),void 0===o&&(o=Float64Array),this.nodeSize=r,this.points=e;var a=this.ids=new(65536>e.length?Uint16Array:Uint32Array)(e.length);o=this.coords=new o(2*e.length);for(var s=0;s<e.length;s++)a[s]=s,o[2*s]=i(e[s]),o[2*s+1]=n(e[s]);t(a,o,r,0,a.length-1,0)};p.prototype.range=function(t,e,i,n){for(var r,o,a=this.ids,s=this.coords,u=this.nodeSize,l=[0,a.length-1,0],h=[];l.length;){var f=l.pop(),c=l.pop(),p=l.pop();if(c-p<=u)for(f=p;f<=c;f++)r=s[2*f],o=s[2*f+1],r>=t&&r<=i&&o>=e&&o<=n&&h.push(a[f]);else{var d=Math.floor((p+c)/2);r=s[2*d],o=s[2*d+1],r>=t&&r<=i&&o>=e&&o<=n&&h.push(a[d]);var v=(f+1)%2;(0===f?t<=r:e<=o)&&(l.push(p),l.push(d-1),l.push(v)),(0===f?i>=r:n>=o)&&(l.push(d+1),l.push(c),l.push(v))}}return h},p.prototype.within=function(t,e,i){for(var n=this.ids,r=this.coords,o=this.nodeSize,a=[0,n.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),h=a.pop(),f=a.pop();if(h-f<=o)for(l=f;l<=h;l++){f=r[2*l]-t;var c=r[2*l+1]-e;f*f+c*c<=u&&s.push(n[l])}else{c=Math.floor((f+h)/2);var p=r[2*c],d=r[2*c+1],v=p-t,g=d-e;v*v+g*g<=u&&s.push(n[c]),v=(l+1)%2,(0===l?t-i<=p:e-i<=d)&&(a.push(f),a.push(c-1),a.push(v)),(0===l?t+i>=p:e+i>=d)&&(a.push(c+1),a.push(h),a.push(v))}}return s};var d={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},v=function(t){this.options=u(rr(d),t),this.trees=Array(this.options.maxZoom+1)};return v.prototype.load=function(t){var e=this.options,i=e.minZoom,n=e.maxZoom;e=e.nodeSize,this.points=t;for(var o=[],a=0;a<t.length;a++)t[a].geometry&&o.push(r(t[a],a));for(this.trees[n+1]=new p(o,l,h,e,Float32Array),t=n;t>=i;t--)o=this._cluster(o,t),this.trees[t]=new p(o,l,h,e,Float32Array);return this},v.prototype.getClusters=function(t,e){var i=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),r=180===t[2]?180:((t[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[3]));if(360<=t[2]-t[0])i=-180,r=180;else if(i>r)return i=this.getClusters([i,n,180,a],e),n=this.getClusters([-180,n,r,a],e),i.concat(n);e=this.trees[this._limitZoom(e)],t=[];var u=0;for(n=e.range(i/360+.5,s(a),r/360+.5,s(n));u<n.length;u+=1)r=e.points[n[u]],t.push(r.numPoints?o(r):this.points[r.index]);return t},v.prototype.getChildren=function(t){var e=this._getOriginId(t),i=this._getOriginZoom(t),n=this.trees[i];if(!n)throw Error("No cluster with the specified id.");var r=n.points[e];if(!r)throw Error("No cluster with the specified id.");e=[];var a=0;for(i=n.within(r.x,r.y,this.options.radius/(this.options.extent*Math.pow(2,i-1)));a<i.length;a+=1)r=n.points[i[a]],r.parentId===t&&e.push(r.numPoints?o(r):this.points[r.index]);if(0===e.length)throw Error("No cluster with the specified id.");return e},v.prototype.getLeaves=function(t,e,i){var n=[];return this._appendLeaves(n,t,e||10,i||0,0),n},v.prototype.getTile=function(t,e,i){var n=this.trees[this._limitZoom(t)];t=Math.pow(2,t);var r=this.options;r=r.radius/r.extent;var o=(i-r)/t,a=(i+1+r)/t,s={features:[]};return this._addTileFeatures(n.range((e-r)/t,o,(e+1+r)/t,a),n.points,e,i,t,s),0===e&&this._addTileFeatures(n.range(1-r/t,o,1,a),n.points,t,i,t,s),e===t-1&&this._addTileFeatures(n.range(0,o,r/t,a),n.points,-1,i,t,s),s.features.length?s:null},v.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){if(t=this.getChildren(t),e++,1!==t.length)break;t=t[0].properties.cluster_id}return e},v.prototype._appendLeaves=function(t,e,i,n,r){var o=0;for(e=this.getChildren(e);o<e.length;o+=1){var a=e[o],s=a.properties;if(s&&s.cluster?r=r+s.point_count<=n?r+s.point_count:this._appendLeaves(t,s.cluster_id,i,n,r):r<n?r++:t.push(a),t.length===i)break}return r},v.prototype._addTileFeatures=function(t,e,i,n,r,o){for(var s=0;s<t.length;s+=1){var u=e[t[s]],l=u.numPoints,h={type:1,geometry:[[Math.round(this.options.extent*(u.x*r-i)),Math.round(this.options.extent*(u.y*r-n))]],tags:l?a(u):this.points[u.index].properties},f=void 0;l?f=u.id:this.options.generateId?f=u.index:this.points[u.index].id&&(f=this.points[u.index].id),void 0!==f&&(h.id=f),o.features.push(h)}},v.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},v.prototype._cluster=function(t,e){var i=[],n=this.options,r=n.reduce,o=n.minPoints;n=n.radius/(n.extent*Math.pow(2,e));for(var a=0;a<t.length;a++){var s=t[a];if(!(s.zoom<=e)){s.zoom=e;for(var u=this.trees[e+1],l=u.within(s.x,s.y,n),h=s.numPoints||1,f=h,c=0,p=l;c<p.length;c+=1){var d=u.points[p[c]];d.zoom>e&&(f+=d.numPoints||1)}if(f>=o){c=s.x*h,p=s.y*h,h=r&&1<h?this._map(s,!0):null,d=(a<<5)+(e+1)+this.points.length;for(var v=0;v<l.length;v+=1){var g=u.points[l[v]];if(!(g.zoom<=e)){g.zoom=e;var m=g.numPoints||1;c+=g.x*m,p+=g.y*m,g.parentId=d,r&&(h||(h=this._map(s,!0)),r(h,this._map(g)))}}s.parentId=d,i.push({x:c/f,y:p/f,zoom:1/0,id:d,parentId:-1,numPoints:f,properties:h})}else if(i.push(s),1<f)for(s=0,f=l;s<f.length;s+=1)l=u.points[f[s]],l.zoom<=e||(l.zoom=e,i.push(l))}}return i},v.prototype._getOriginId=function(t){return t-this.points.length>>5},v.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},v.prototype._map=function(t,e){if(t.numPoints)return e?u({},t.properties):t.properties;t=this.points[t.index].properties;var i=this.options.map(t);return e&&i===t?u({},i):i},v}))})),xh=function(t){function e(t){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.shapeLayer=new Au(t.options),t.textLayer=new mh(t.options.textOptions),t.children=[t.shapeLayer,t.textLayer],t.max=[],t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{size:50,height:0,maxZoom:19,minZoom:5,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},enableCluster:!1,showText:!0,textOptions:{fontSize:13,color:"white"}}}},{key:"onOptionsChanged",value:function(t){this.textLayer.setOptions(t.textOptions)}},{key:"setOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.options.textOptions;t.textOptions&&di(e,t.textOptions);var i=t.minZoom,n=t.maxZoom,r=t.size;i=n&&n!==this.options.maxZoom||i&&i!==this.options.minZoom||r&&r!==this.options.size,di(this.options,t,{textOptions:e}),i?this.onChanged(this.options,this.data):this.refreshLayer(),this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(t,e){if(e&&e.length){this.zoom=Math.floor(this.map.getZoom());var i=t.maxZoom,n=t.minZoom,r=t.enableCluster;t=t.size,this.zoom>i?this.zoom=i:this.zoom<n&&(this.zoom=n),r&&(this.supercluster=new yh({maxZoom:i,minZoom:n,radius:t/2}),this.supercluster.load(e)),this.refreshLayer()}}},{key:"refreshLayer",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.data,i=this.map,n=this.zoom;if(t.enableCluster&&this.supercluster&&(e=this.getClusterData(t)),e&&e.length){var r=t.gradient,o=t.showText,a=t.textOptions,s=t.height,u=t.size;u*=Math.pow(2,18-n),e=ie(e,u,(function(t){var e=xr(t,2),n=e[0];return e=e[1],-180<=n&&180>=n&&-90<=e&&90>=e&&(e=i.lnglatToMercator(n,e),n=e[0],e=e[1]),t[0]=n,t[1]=e,t})),this.max[n]=Math.max(this.max[n]||0,e.max);var l=new A({max:this.max[n],min:0,maxSize:s*Math.pow(2,18-n),minSize:0,gradient:r});if(r=[],o){var h=a&&a.format;h="function"===typeof h?h:null,r=e.map((function(t){return{geometry:{coordinates:[t.center.x,t.center.y,l.getSize(t.count)+a.fontSize/2*Math.pow(2,18-n)]},text:h?h(t.count):t.count}}))}this.textLayer.setData(r),o=e.map((function(t){for(var i=t.center,n=e.r,r=[],o=0;6>o;o++)r.push(ee({x:i.x,y:i.y},n,o));return{geometry:{type:"Polygon",coordinates:[r]},properties:{height:l.getSize(t.count),color:l.getColor(t.count)}}})),this.shapeLayer.setData(o),t.enablePicked&&t.autoSelect&&this.pick(-1,-1)}}},{key:"getClusterData",value:function(){var t=this.map,e=t.getBounds(),i=e.ne;e=e.sw,this.ne=i,this.sw=e;var n=i,r=n.lng;n=n.lat;var o=[];return-180<=r&&180>=r&&-90<=n&&90>=n?o=[e.lng,e.lat,i.lng,i.lat]:(i=t.mercatorToLnglat(this.ne.lng,this.ne.lat),e=t.mercatorToLnglat(this.sw.lng,this.sw.lat),o=e.concat(i)),this.supercluster.getClusters(o,this.zoom).map((function(t){var e=0;return t.properties&&t.properties.point_count&&(e=t.properties.point_count),{geometry:t.geometry,count:e}}))}},{key:"pick",value:function(t,e){return this.shapeLayer.pick(t,e)}},{key:"shouldUpdate",value:function(){if(!this.data)return!1;var t=this.map,e=Math.floor(t.getZoom()),i=this.options,n=i.maxZoom;return i=i.minZoom,e>n?e=n:e<i&&(e=i),this.zoom!==e?(this.zoom=e,!0):!!this.options.enableCluster&&(e=t.getBounds(),t=e.ne,e=e.sw,!!(t&&e&&this.ne&&this.sw)&&(this.ne.lng!==t.lng||this.ne.lat!==t.lat||this.sw.lng!==e.lng||this.sw.lat!==e.lat||void 0))}},{key:"render",value:function(t){this.shouldUpdate()?this.refreshLayer():Xs(e.prototype.__proto__||bi(e.prototype),"render",this).call(this,t)}}]),e}(Mu),bh=function(){function t(e,i){de(this,t),this.map=e,this.options=i||{},this.eventMap={}}return Pi(t,[{key:"onResize",value:function(t){}},{key:"onUpdate",value:function(t){throw"\u672a\u5b9e\u73b0onUpdate\u65b9\u6cd5"}},{key:"getContainer",value:function(){throw"\u672a\u5b9e\u73b0getContainer\u65b9\u6cd5"}},{key:"getSize",value:function(){throw"\u672a\u5b9e\u73b0getSize\u65b9\u6cd5"}},{key:"getTilt",value:function(){throw"\u672a\u5b9e\u73b0getTilt\u65b9\u6cd5"}},{key:"getHeading",value:function(){throw"\u672a\u5b9e\u73b0getHeading\u65b9\u6cd5"}},{key:"getZoomUnits",value:function(){throw"\u672a\u5b9e\u73b0getZoomUnits\u65b9\u6cd5"}},{key:"getCenter",value:function(){throw"\u672a\u5b9e\u73b0getCenter\u65b9\u6cd5"}},{key:"getMapType",value:function(){throw"\u672a\u5b9e\u73b0getMapType\u65b9\u6cd5"}},{key:"lnglatToMercator",value:function(t,e){return"gcj02"===this.options.coordinateSystem?(e=e*Math.PI/180,e=3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e))),[parseFloat((t*Math.PI/180*6378137).toFixed(2)),parseFloat(e.toFixed(2))]):(t=y.convertLL2MC({lng:t,lat:e}),[t.lng,t.lat])}}]),t}(),_h=function(t){function e(t){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.eventMap={},t}return ar(e,t),Pi(e,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onMousemove",value:function(t){t=this.extendCallback(t),this.map.addEventListener("mousemove",t),this.eventMap.mousemove=t}},{key:"onClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("click",t),this.eventMap.click=t}},{key:"onDblClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("dblclick",t),this.eventMap.dblclick=t}},{key:"onRightClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("rightclick",t),this.eventMap.rightclick=t}},{key:"onUpdate",value:function(t){this.map.addEventListener("update",t),this.map.addEventListener("onearthstatuschange",t),this.eventMap.update=t,this.eventMap.onearthstatuschange=t}},{key:"extendCallback",value:function(t){return function(e){t(di(e,{x:e.x,y:e.y}))}}},{key:"unbind",value:function(t){var e=this;this.eventMap[t]?(this.map.removeEventListener(t,this.eventMap[t]),delete this.eventMap[t]):(si(this.eventMap).forEach((function(t){e.map.removeEventListener(t,e.eventMap[t])})),this.eventMap={})}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getBounds",value:function(){return this.map.getBounds()}},{key:"getTilt",value:function(){return this.map.getTilt()}},{key:"getHeading",value:function(){return this.map.getHeading()}},{key:"getZoomUnits",value:function(){return this.map.getZoomUnits()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var t=this.map.getCenter();return-180<=t.lng&&180>=t.lng&&(t=this.map.lnglatToMercator(t.lng,t.lat),t={lng:t[0],lat:t[1]}),t}},{key:"getMapType",value:function(){return this.map.getMapType()}},{key:"lnglatToMercator",value:function(t,e){return this.map.lnglatToMercator(t,e)}},{key:"mercatorToLnglat",value:function(t,e){return this.map.mercatorToLnglat(t,e)}}]),e}(bh),wh=function(t){function e(t){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.div=document.createElement("div"),t.div.style.position="absolute",t.div.style.userSelect="none",t.map.getPanes().mapPane.appendChild(t.div),t.eventMap={},t}return ar(e,t),Pi(e,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onMousemove",value:function(t){t=this.extendCallback(t),this.map.addEventListener("mousemove",t),this.eventMap.mousemove=t}},{key:"onClick",value:function(t){t=this.extendCallback(t),ao?(this.map.addEventListener("touchend",t),this.eventMap.touchend=t):(this.map.addEventListener("click",t),this.eventMap.click=t)}},{key:"onDblClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("dblclick",t),this.eventMap.dblclick=t}},{key:"onRightClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("rightclick",t),this.eventMap.rightclick=t}},{key:"changeCanvas",value:function(){var t=this.map,e=t.getSize(),i=t.getCenter();t=t.pointToOverlayPixel(i),this.div.style.left=t.x-e.width/2+"px",this.div.style.top=t.y-e.height/2+"px"}},{key:"onUpdate",value:function(t){var e=this,i=function(){e.changeCanvas(),t()};this.map.addEventListener("moveend",i),this.map.addEventListener("moving",i),this.map.addEventListener("zoomend",i),this.eventMap.moveend=i,this.eventMap.moving=i,this.eventMap.zoomend=i}},{key:"extendCallback",value:function(t){return function(e){t(di(e,{x:e.pixel.x,y:e.pixel.y}))}}},{key:"unbind",value:function(){var t=this;si(this.eventMap).forEach((function(e){t.map.removeEventListener(e,t.eventMap[e])})),this.eventMap={}}},{key:"getContainer",value:function(){return this.div}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getBounds",value:function(){return this.map.getBounds()}},{key:"getTilt",value:function(){return 0}},{key:"getHeading",value:function(){return 0}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getZoomUnits",value:function(){return Math.pow(2,18-this.map.getZoom())}},{key:"getCenter",value:function(){var t=this.map.getMapType().getProjection().lngLatToPoint(this.map.getCenter());return{lng:t.x,lat:t.y}}},{key:"lnglatToMercator",value:function(t,e){return t=this.map.getMapType().getProjection().lngLatToPoint({lng:t,lat:e}),[t.x,t.y]}},{key:"mercatorToLnglat",value:function(t,e){return t=this.map.getMapType().getProjection().pointToLngLat({lng:t,lat:e}),[t.lng,t.lat]}}]),e}(bh),Ah=function(t){function e(t){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.eventMap={},t}return ar(e,t),Pi(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;si(this.eventMap).forEach((function(e){window.removeEventListener(e,t.eventMap[e])})),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container.getElementsByClassName("cesium-widget")[0]}},{key:"getSize",value:function(){var t=this.map;return{width:t.canvas.clientWidth,height:t.canvas.clientHeight}}},{key:"getTilt",value:function(){return 180*this.map.camera.pitch/Math.PI+90}},{key:"getHeading",value:function(){return 360-180*this.map.camera.heading/Math.PI}},{key:"getZoomUnits",value:function(){var t=this.map;return 6.8*t.scene.globe.ellipsoid.cartesianToCartographic(t.camera.position).height/6500}},{key:"getZoom",value:function(){return 10}},{key:"getCenter",value:function(){var t=this.map;return t=t.camera.pickEllipsoid(new Cesium.Cartesian2(t.canvas.clientWidth/2,t.canvas.clientHeight/2)),t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),t=this.getMercator([180*t.longitude/Math.PI,180*t.latitude/Math.PI]),{lng:t[0],lat:t[1]}}},{key:"getMercator",value:function(t){var e=[];return e[0]=t[0]*Math.PI/180*6378137,t=t[1]*Math.PI/180,e[1]=3189068.5*Math.log((1+Math.sin(t))/(1-Math.sin(t))),e}}]),e}(bh),Th=function(t){function e(t){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.eventMap={},t}return ar(e,t),Pi(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;si(this.eventMap).forEach((function(e){window.removeEventListener(e,t.eventMap[e])})),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getZoom",value:function(){return this.map.zoom}},{key:"getCenter",value:function(){return this.map.center}}]),e}(bh),Mh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.eventMap={},t}return ar(e,t),Pi(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;si(this.eventMap).forEach((function(e){window.removeEventListener(e,t.eventMap[e])})),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]),e}(bh),Ph=function(){function t(e,i){de(this,t),i=i||{},"bmap"===i.mapType?this.map=new wh(e,i):"blank"===i.mapType?this.map=new Th(e,i):"cesium"===i.mapType?this.map=new Ah(e,i):"three"===i.mapType?this.map=new Mh(e,i):(i.mapType="bmapgl",this.map=new _h(e,i)),this.map.type=i.mapType,this.options=i||{},this.renderArr=[],(e=i.canvas)||(e=document.createElement("canvas")),this.canvas=e,this.gl=i.gl?i.gl:U(e),this.gl.getExtension("OES_element_index_uint"),this.changeSize(),this.projectionMatrix=lu.create(Float64Array),this.orthoMatrix=lu.create(Float64Array),this.matrix=lu.create(Float64Array),this.viewMatrix=lu.create(Float64Array),this.pointToPixelMatrix=lu.create(Float64Array),this.pixelToViewMatrix=lu.create(Float64Array),this.fovy=35,this.fps=Math.min(i.fps,60)||60,this.renderTime=(new Date).valueOf(),this._animation=this.animation.bind(this),this._update=this.update.bind(this),this.onInitialize(this.options.onInitialize),this.options.onRender&&this.renderArr.push(this.options.onRender),this.stateManager=new Ss({gl:this.gl}),this.pickFBO=new Rs(this.gl),this.transferOptions={},this.bind()}return Pi(t,[{key:"bind",value:function(){var t=this,e=this.map;e.onResize((function(){t.changeSize(),t.render()})),e.onUpdate(this._update),e.onClick&&e.onClick((function(e){t.onClick&&t.onClick(e)})),e.onDblClick&&e.onDblClick((function(e){t.onDblClick&&t.onDblClick(e)})),e.onRightClick&&e.onRightClick((function(e){t.onRightClick&&t.onRightClick(e)})),e.onMousemove&&e.onMousemove((function(e){t.onMousemove&&t.onMousemove(e)})),this.options.canvas||e.getContainer().appendChild(this.canvas)}},{key:"unbind",value:function(){var t=this.map;t.unbind&&t.unbind()}},{key:"setOptions",value:function(t){this.options=t}},{key:"onInitialize",value:function(t){t&&(this.transferOptions=t.bind(this)(this.gl)||{})}},{key:"bindFramebuffer",value:function(t){var e=this.gl;t?e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer):e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"saveFramebuffer",value:function(){var t=this.gl;this.preFramebuffer=t.getParameter(t.FRAMEBUFFER_BINDING)}},{key:"restoreFramebuffer",value:function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.preFramebuffer)}},{key:"onRender",value:function(t){this.renderArr.push(t)}},{key:"changeSize",value:function(){var t=this.canvas;if(t){var e=t.style,i=this.map.getSize(),n=window.devicePixelRatio;t.width=i.width*n,t.height=i.height*n,e.cssText="position: absolute;left:0;top:0;width:"+i.width+"px;height:"+i.height+"px;z-index:2;",i=this.options,"cesium"!==i.mapType||i.canvas||(e.pointerEvents="none"),this.gl.viewport(0,0,t.width,t.height)}}},{key:"update",value:function(){!1===this.options.autoUpdate||this.isAnimation&&60<=this.fps||this.render()}},{key:"render",value:function(){if(this.map&&this.gl){var t=this.options,e=this.projectionMatrix,i=this.viewMatrix;if("three"===t.mapType)i=this.map.map.camera,e=i.projectionMatrix.elements,i=i.matrixWorldInverse.elements;else if("cesium"===t.mapType){i=this.map.map;var n=i.camera.frustum.projectionMatrix;e=new Float32Array([n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]]),n=i.camera.viewMatrix,i=new Float32Array([n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]])}else"B_EARTH_MAP"===this.map.map.mapType?(e=this.map.map.getEarth().scene._camera.getProjectionMatrix(),i=this.map.map.getEarth().scene._camera.getModelViewMatrix()):(this.updateProjectionMatrix(),this.updateModelViewMatrix());for(n=lu.multiply(this.matrix,e,i),di(this.transferOptions,{gl:this.gl,matrix:n,pointToPixelMatrix:this.pointToPixelMatrix,pixelToViewMatrix:this.pixelToViewMatrix,projectionMatrix:e,orthoMatrix:this.orthoMatrix,viewMatrix:i,stateManager:this.stateManager}),"three"!==t.mapType&&"cesium"!==t.mapType&&!1!==t.autoUpdate&&this.clear(),t=0;t<this.renderArr.length;t++)this.renderArr[t]&&this.renderArr[t].bind(this)(this.transferOptions)}}},{key:"clear",value:function(t){var e=this.gl,i=this.options.clearColor||[0,0,0,0];e.clearColor(i[0],i[1],i[2],i[3]),t&&(t instanceof Array||(t=u(t).unitArray()),e.clearColor(t[0],t[1],t[2],t[3])),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"updateProjectionMatrix",value:function(){var t=this.gl.canvas.width/this.gl.canvas.height,e=this.options.cameraNear||1,i=this.options.cameraFar||4e3;lu.perspective(this.projectionMatrix,p(this.fovy),t,e,i),t=this.map.getSize(),lu.ortho(this.orthoMatrix,-t.width/2,t.width/2,-t.height/2,t.height/2,e,i)}},{key:"updateModelViewMatrix",value:function(){var t=this.map,e=this.viewMatrix,i=this.pointToPixelMatrix,n=this.pixelToViewMatrix;lu.identity(e),lu.identity(i),lu.identity(n);var r=t.getSize();r=Math.round(-r.height/(2*Math.tan(p(this.fovy)/2))),lu.translate(n,n,[0,0,r]),lu.rotate(n,n,p(t.getTilt()),[-1,0,0]),lu.rotate(n,n,p(t.getHeading()),[0,0,-1]),r=t.getCenter();var o=this.options.pointOffset||[0,0];t=t.getZoomUnits(),lu.translate(i,i,[(o[0]-r.lng)/t,(o[1]-r.lat)/t,0]),t=1/t,lu.scale(i,i,[t,t,t]),lu.multiply(e,n,i)}},{key:"destroy",value:function(){this.stopAnimation(),this.unbind();var t=this.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this.map.getContainer().removeChild(this.canvas),this.gl=this.canvas=null}},{key:"animation",value:function(){if(this.isAnimation){if(60<=this.fps)this.render();else{var t=(new Date).valueOf(),e=Math.floor(1e3/this.fps),i=t-this.renderTime;i>e&&(this.render(),this.renderTime=t-i%e)}window.requestAnimationFrame(this._animation)}}},{key:"startAnimation",value:function(){this.isAnimation||(this.isAnimation=!0,window.requestAnimationFrame(this._animation))}},{key:"stopAnimation",value:function(){this.isAnimation=!1}}]),t}(),Sh=function(t){function e(t){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.bufferData=[],t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"normal",shape:"circle",size:5,unit:"px",borderWidth:0,borderColor:[1,1,1,.9],polygonOffset:[0,0],depthTest:!0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),i=[];e.enablePicked&&i.push("PICK"),e.shape&&"circle"===e.shape&&i.push("SHAPE_CIRCLE"),this.program=new Ms(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aBorderWidth;attribute vec4 aBorderColor;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;varying vec4 vColor;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float size=aSize*devicePixelRatio;float borderWidth=aBorderWidth*devicePixelRatio;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=uUnitPx ? size : size/zoomUnits;vSize=size;vBorderWidth=borderWidth;vBorderColor=aBorderColor;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:"varying vec4 vColor;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;void main(void){vec4 color=vColor;\n#if defined(SHAPE_CIRCLE)\nfloat d=distance(gl_PointCoord,vec2(0.5,0.5));float ratio=1.0-vBorderWidth/vSize*2.0;if(d>0.5){discard;}if(d>ratio*0.5){color=vBorderColor;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;\n#else\nfloat ratio=vBorderWidth/vSize;if(gl_PointCoord.x<ratio||gl_PointCoord.x>1.0-ratio||gl_PointCoord.y<ratio||gl_PointCoord.y>1.0-ratio){color=vBorderColor;}\n#endif\ngl_FragColor=color;}",defines:i},this),this.buffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:52,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:52,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:52,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28},{stride:52,name:"aBorderWidth",buffer:this.buffer,size:1,type:"FLOAT",offset:32},{stride:52,name:"aBorderColor",buffer:this.buffer,size:4,type:"FLOAT",offset:36}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.options=this.data=this.buffer=this.program=this.bufferData=this.vertexArray=null}},{key:"onChanged",value:function(t,e){if(this.gl){for(var i=[],n=t.color,r=t.size,o=t.borderWidth,a=t.borderColor,s=0;s<e.length;s++){var u=this.normizedPoint(e[s].geometry.coordinates),l=this.getProperty("color",n,e[s]);l=this.normizedColor(l);var h=this.getProperty("size",r,e[s]);h=Number(h);var f=this.getProperty("borderWidth",o,e[s]);f=Number(f);var c=this.getProperty("borderColor",a,e[s]);c=this.normizedColor(c),u=this.addMultipleCoords(u);for(var p=0;p<u.length;p++){var d=u[p];i.push(d[0],d[1],Number(d[2]||0)),i.push(l[0],l[1],l[2],l[3]),i.push(h),i.push(f,c[0],c[1],c[2],c[3])}}this.bufferData=i,this.buffer.updateData(new Float32Array(i)),t.enablePicked&&this.parsePickData(e)}}},{key:"parsePickData",value:function(t){var e=this.getOptions(),i=[];if(e.enablePicked)for(var n=0;n<t.length;n++){var r=this.indexToRgb(n);i.push(r[0]/255,r[1]/255,r[2]/255),e.repeat&&(i.push(r[0]/255,r[1]/255,r[2]/255),i.push(r[0]/255,r[1]/255,r[2]/255))}e.enablePicked&&this.pickBuffer.updateData(new Float32Array(i))}},{key:"render",value:function(t){var e=t.gl,i=t.matrix,n=t.isPickRender;if(!(0>=this.bufferData.length)){var r=this.getOptions(),o=this.program;o.use(e),t=this.getCommonUniforms(t),t=di(t,{uMatrix:i,uUnitPx:"px"===r.unit,zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio}),o.setUniforms(t),this.setGLState({blend:!n,blendFunc:"lighter"===r.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEquation:e.FUNC_ADD,polygonOffset:r.polygonOffset,depthTest:r.depthTest}),this.vertexArray.bind(),e.drawArrays(e.POINTS,0,this.bufferData.length/13)}}}]),e}(Ns),Eh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.bufferDataArr=[],t.indexDataArr=[],t.vertexBuffer=[],t.indexBuffer=[],t.position=[],t.opacity=1,t.currentScale=1,t.autoUpdate=!0,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],size:5,segs:32,scale:2,unit:"m",step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Ms(this.gl,{vertexShader:"uniform mat4 u_projectionMatrix;uniform mat4 u_modelViewMatrix;uniform mat4 u_modelMatrix;uniform float u_opacity;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){vColor=aColor;vColor.a=u_opacity;gl_Position=u_projectionMatrix*u_modelViewMatrix*u_modelMatrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;void main(){if(vColor.a==0.0){discard;}gl_FragColor=vColor;}"})}},{key:"destroy",value:function(){this.data=this.program=this.position=this.indexBuffer=this.vertexBuffer=this.indexDataArr=this.bufferDataArr=null}},{key:"onChanged",value:function(t,e){var i=this.gl;if(i&&(this.currentScale=this.opacity=1,(this.data=e)&&e.length)){var n=t.color,r=t.segs;t=t.size;for(var o=360/r,a=0;a<e.length;a++){var s=[],u=[],l=this.normizedPoint(e[a].geometry.coordinates),h=n;"[object Function]"===Object.prototype.toString.call(h)?h=h(e[a]):(h=e[a].color||n,"properties"in e[a]&&"color"in e[a].properties&&(h=e[a].properties.color)),h=this.normizedColor(h);var f="[object Function]"===Object.prototype.toString.call(t)?t(e[a]):Number(t),c=l[0],p=l[1];s.push(0,0,-.5),s.push(h[0],h[1],h[2],0);for(var d=1,v=0;d<=r;d++,v+=o)s.push(l[0]-c+Math.cos(Math.PI/180*v)*f,l[1]-p+Math.sin(Math.PI/180*v)*f,-.5),s.push(h[0],h[1],h[2],this.opacity),d===r?u.push(0,0+d,1):u.push(0,0+d,0+d+1);h=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,h),i.bufferData(i.ARRAY_BUFFER,new Float32Array(s),i.STATIC_DRAW),this.vertexBuffer[a]=h,this.bufferDataArr[a]=s,i.bindBuffer(i.ARRAY_BUFFER,null),s=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,s),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),i.STATIC_DRAW),this.indexBuffer[a]=s,this.indexDataArr[a]=u,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),this.position[a]=[l[0],l[1]]}this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var e=t.gl,i=t.projectionMatrix,n=t.viewMatrix;for(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_projectionMatrix,!1,i),e.uniformMatrix4fv(t.uniforms.u_modelViewMatrix,!1,n),i=this.opacity,void 0!==this.options.opacity&&(i=this.options.opacity),e.uniform1f(t.uniforms.u_opacity,i),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.DST_ALPHA]}),e.enableVertexAttribArray(t.attributes.aPos),e.enableVertexAttribArray(t.attributes.aColor),i=0;i<this.bufferDataArr.length;i++)if(!(0>=this.bufferDataArr[i].length)){n=new Float32Array(this.bufferDataArr[i]).BYTES_PER_ELEMENT,e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer[i]),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,7*n,3*n),e.vertexAttribPointer(t.attributes.aPos,3,e.FLOAT,!1,7*n,0),n=this.position[i];var r=lu.create(),o=[this.currentScale,this.currentScale,this.currentScale];"px"===this.options.unit&&this.map&&(o=this.map.getZoomUnits(),o=[this.currentScale*o,this.currentScale*o,this.currentScale]),lu.identity(r),lu.translate(r,r,[n[0],n[1],0]),lu.scale(r,r,o),e.uniformMatrix4fv(t.uniforms.u_modelMatrix,!1,r),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer[i]),e.drawElements(e.TRIANGLES,this.indexDataArr[i].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}t=this.getOptions(),e=t.scale,t=t.step,this.opacity-=t/10,this.currentScale+=e*t,0>this.opacity&&(this.currentScale=this.opacity=1)}}]),e}(Ns),Ch=function(t){function e(t){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.bufferData=[],t.date=new Date,t.autoUpdate=!0,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"normal",size:20,unit:"px",duration:2}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new Ms(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform float uTime;uniform float duration;uniform float zoomUnits;varying vec4 vColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float percent=mod(uTime,duration)/duration;vColor.a=1.-percent;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize/zoomUnits*percent;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:"varying vec4 vColor;void main(void){vec4 color=vColor;float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.options=this.data=this.buffer=this.program=this.bufferData=this.vertexArray=null}},{key:"onChanged",value:function(t,e){if(this.gl){for(var i=[],n=t.color,r=t.size,o=0;o<e.length;o++){var a=e[o].geometry.coordinates,s=n;"[object Function]"===Object.prototype.toString.call(s)?s=s(e[o]):(s=e[o].color||n,"properties"in e[o]&&"color"in e[o].properties&&(s=e[o].properties.color)),s=this.normizedColor(s),a=this.normizedPoint(a);var u=e[o].size||r;"properties"in e[o]&&"size"in e[o].properties&&(u=e[o].properties.size),u="[object Function]"===Object.prototype.toString.call(u)?u(e[o]):Number(u),i.push(a[0],a[1],Number(a[2]||0)),i.push(s[0],s[1],s[2],s[3]),i.push(u*window.devicePixelRatio)}this.bufferData=i,this.buffer.updateData(new Float32Array(i)),t.enablePicked&&this.parsePickData(e)}}},{key:"parsePickData",value:function(t){var e=this.getOptions(),i=[];if(e.enablePicked)for(var n=0;n<t.length;n++){var r=this.indexToRgb(n);i.push(r[0]/255,r[1]/255,r[2]/255)}e.enablePicked&&this.pickBuffer.updateData(new Float32Array(i))}},{key:"render",value:function(t){var e=t.gl,i=t.matrix,n=t.isPickRender;if(!(0>=this.bufferData.length)){var r=this.getOptions(),o=this.program;o.use(e),this.vertexArray.bind(),t=this.getCommonUniforms(t);var a=1;"m"===r.unit&&this.map&&(a=this.map.getZoomUnits()),t=di(t,{zoomUnits:a,uTime:(new Date-this.date)/1e3,duration:r.duration,uMatrix:i}),o.setUniforms(t),this.setGLState({blend:!n,blendFunc:"lighter"===r.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEquation:e.FUNC_ADD}),e.drawArrays(e.POINTS,0,this.bufferData.length/8)}}}]),e}(Ns),Lh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.bufferData=[],t.startTime=Number(t.options.startTime)||0,t.endTime=Number(t.options.endTime),t.time=t.startTime,t.segs=Number(t.options.segs)||10,t.autoUpdate=!0,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:[.9,.1,.1,1],trailLength:3,height:100,step:.1,segs:10,polygonOffset:[0,0]}}},{key:"setTime",value:function(t){this.time=t}},{key:"initialize",value:function(t){this.gl=t,this.program=new Ms(this.gl,{vertexShader:"precision mediump float;attribute vec4 aPos;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision mediump float;uniform vec3 uFragColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(uFragColor,1.0*vTime);}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"destroy",value:function(){this.data=this.program=this.buffer=this.bufferData=null}},{key:"onChanged",value:function(t,e){var i=this.gl;if(i){this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer);for(var n=[],r=t.height,o=0;o<e.length;o++)for(var a=e[o].geometry.coordinates,s="[object Function]"===Object.prototype.toString.call(r)?r(e[o]):Number(r),u=0,l=0;l<this.segs;l++){var h=this.normizedPoint(a);n.push(h[0],h[1],u),void 0===a[2]?n.push(l):n.push(Number(a[2])),u+=s/this.segs,n.push(h[0],h[1],u),void 0===a[2]?n.push(l+1):n.push(Number(a[2]))}void 0===t.endTime&&(this.endTime=this.segs),this.bufferData=n,i.bufferData(i.ARRAY_BUFFER,new Float32Array(n),i.STATIC_DRAW),this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var e=t.gl,i=t.matrix;t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,i),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,0,0),i=this.normizedColor(this.options.color),e.uniform3f(t.uniforms.uFragColor,i[0],i[1],i[2]),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength),this.setGLState({blend:!0,blendFunc:[e.SRC_ALPHA,e.ONE],blendEquation:e.FUNC_ADD,polygonOffset:this.options.polygonOffset}),e.drawArrays(e.LINES,0,this.bufferData.length/4),this.time+=Number(this.options.step),this.time>1.5*this.endTime&&(this.time=this.startTime)}}]),e}(Ns),Rh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.index=[],i=t.canvas=document.createElement("canvas"),t.ctx=i.getContext("2d"),t.iconHash=new oh,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{flat:!1,unit:"px",scale:1,angle:0,opacity:1,offset:[0,0],padding:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new Ms(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute vec2 a_size;attribute vec2 a_offset;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform float devicePixelRatio;uniform float u_zoom_units;uniform float u_zIndex;uniform float u_scale;uniform bool u_unit_px;uniform bool u_flat;varying vec2 v_texture_coord;/***\u70b9A(x,y)\uff0c\u7ed5\u539f\u70b9\u987a\u65f6\u9488\u65cb\u8f6c\u89d2\u5ea6a\u65b0\u5750\u6807\u7684\u8ba1\u7b97\u516c\u5f0f*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)+size.x*sin(a_rotation);}else if(corner==2.0){x+=size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)-size.x*sin(a_rotation);}else if(corner==3.0){x+=size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)-size.x*sin(a_rotation);}else{x+=-size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)+size.x*sin(a_rotation);}return vec3(x,y,coord.z);}void main(){v_texture_coord=a_texture_coord;if(u_flat){vec2 offset=a_offset;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;offset*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=u_zIndex;gl_Position=u_matrix*vec4(current.x+offset[0],current.y-offset[1],current.z,1.0);}else{vec4 position=u_matrix*vec4(a_pos,1.0);vec3 screen=position.xyz/position.w;vec2 halfSize=a_size/MAPV_resolution*devicePixelRatio*u_scale;vec2 offset=a_offset*2./MAPV_resolution*devicePixelRatio;if(!u_unit_px){halfSize/=u_zoom_units;offset/=u_zoom_units;}vec3 current=transformCoord(screen,halfSize,a_corner);current.xy=current.xy-offset;current.z+=u_zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform float u_opacity;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}textureColor.a*=u_opacity;gl_FragColor=textureColor;\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:36,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:16},{name:"a_offset",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:32},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.canvas=this.iconHash=this.cachedData=this.options=this.data=this.indexBuffer=this.uvBuffer=this.vertexBuffer=this.program=this.vertexArray=null}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:{})}},{key:"processCache",value:function(t,e,i){var n=this;this.cachedData=[];for(var r=t.icon,o=t.width,a=t.height,s=t.offset,u=t.angle,l=0;l<e.length;l++){var h=this.normizedPoint(e[l].geometry.coordinates),f=this.getProperty("icon",r,e[l]),c=this.getProperty("width",o,e[l]),p=this.getProperty("height",a,e[l]),d=this.getProperty("offset",s,e[l]),v=this.getProperty("angle",u,e[l]);h&&f&&(this.cachedData.push({point:h,icon:f,width:c,height:p,offset:d,angle:v}),this.iconHash.get(f)||this.iconHash.set(f,f))}e=Er(this.iconHash.entries()).filter((function(t){return"string"===typeof t[1]})).map((function(t){var e=xr(t,2)[0];return new Zl((function(t,i){n.url2canvas(e,(function(i){n.iconHash.set(e,i),t()}))}))})),Zl.all(e).then((function(e){n.buildSprite(t),!1!==i.autoRender&&n.webglLayer&&n.webglLayer.render()}))}},{key:"buildSprite",value:function(t){var e=t.padding,i=this.canvas,n=this.ctx,r=[],o=new oh,a=!0,s=!1,u=void 0;try{for(var l,h=mr(this.iconHash);!(a=(l=h.next()).done);a=!0){var f=xr(l.value,2),c=f[1];if("string"!==typeof c){var p=c.width,d=c.height;r.push({w:p+e[0],h:d+e[0],width:p,height:d,key:f[0],icon:c})}}}catch(g){s=!0,u=g}finally{try{!a&&h.return&&h.return()}finally{if(s)throw u}}for(s=te(r),a=0;a<r.length;a++)u=r[a],o.get(u.key)||o.set(u.key,u);for(a=v(s.w),s=v(s.h),i.width=a||1,i.height=s||1,n.save(),i=0;i<r.length;i++)u=r[i],n.drawImage(u.icon,u.x+e[0],u.y+e[1],u.width,u.height);n.restore(),this.loadTexture(),this.buildVertex(t,o,a,s)}},{key:"buildVertex",value:function(t,e,i,n){t=t.enablePicked;for(var r=[],o=[],a=[],s=[],u=0;u<this.cachedData.length;u++){var l=this.cachedData[u],h=l.point,f=l.width,c=l.height,p=l.offset,d=l.angle;if(l=e.get(l.icon)){f=f||l.icon.width,c=c||l.icon.height;var v=xr(h,3);h=v[0];var g=v[1];v=v[2];for(var m=0;4>m;m++)r.push(h,g,v),r.push(m),r.push(f,c),r.push.apply(r,Lr(p)),r.push(d*Math.PI/180);f=l.x/i,c=(l.x+l.w)/i,p=(l.y+l.h)/n,l=l.y/n,o.push(f,p,f,l,c,l,c,p),l=4*u,a.push(l,l+2,l+1,l,l+3,l+2),t&&(l=this.indexToRgb(u),s.push(l[0]/255,l[1]/255,l[2]/255),s.push(l[0]/255,l[1]/255,l[2]/255),s.push(l[0]/255,l[1]/255,l[2]/255),s.push(l[0]/255,l[1]/255,l[2]/255))}}this.index=a,this.vertexBuffer.updateData(new Float32Array(r)),this.uvBuffer.updateData(new Float32Array(o)),this.indexBuffer.updateData(new Uint32Array(a)),t&&this.pickBuffer.updateData(new Float32Array(s))}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.iconHash&&this.texture){var e=t.gl,i=t.matrix,n=this.getOptions(),r=this.program;r.use(e),this.setGLState({blend:!0,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),r.setUniforms(di(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:i,u_flat:n.flat,u_unit_px:"px"===n.unit,u_zoom_units:this.map.getZoomUnits(),u_scale:n.scale,u_opacity:n.opacity,u_zIndex:n.zIndex,devicePixelRatio:window.devicePixelRatio})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"url2canvas",value:function(t,e){if("object"===("undefined"===typeof t?"undefined":qn(t)))e(t);else{var i=new Image;i.crossOrigin="anonymous",i.onload=function(){var t=i.width,n=i.height,r=document.createElement("canvas");r.width=t,r.height=n,r.getContext("2d").drawImage(i,0,0,t,n),e(r)},i.onerror=function(){var t=document.createElement("canvas");t.width=20,t.height=40;var i=t.getContext("2d");i.fillStyle="red",i.beginPath(),i.lineTo(0,0),i.lineTo(20,0),i.lineTo(10,40),i.closePath(),i.fill(),e(t)},i.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e})):this.texture=null}}]),e}(Ns),kh=function(t){function e(t){de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.pointLayer=new Sh(t.options),t.options.textOptions=di({depthTest:!1},t.options.textOptions),t.textLayer=new mh(t.options.textOptions);var i=di({},t.options,t.options.iconOptions);return t.iconLayer=new Rh(i),t.children=[t.pointLayer,t.textLayer,t.iconLayer],t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{minSize:25,maxSize:40,clusterRadius:200,minPoints:2,extent:400,showText:!0,maxZoom:19,minZoom:4,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},textOptions:{fontSize:12,color:"white"},iconOptions:{}}}},{key:"onOptionsChanged",value:function(t){this.textLayer.setOptions(t.textOptions)}},{key:"setOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.options.textOptions;t.textOptions&&di(e,t.textOptions);var i=t.minZoom,n=t.maxZoom,r=t.clusterRadius;i=n&&n!==this.options.maxZoom||i&&i!==this.options.minZoom||r&&r!==this.options.clusterRadius,di(this.options,t,{textOptions:e}),i?this.onChanged(this.options,this.data):this.refreshCluster(),this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(t,e){var i=this;e&&e.length?(e.forEach((function(t){var e=xr(t.geometry.coordinates,2),n=e[0];e=e[1],-180<=n&&180>=n&&-90<=e&&90>=e||(n=i.map.mercatorToLnglat(n,e),t.geometry.coordinates[0]=n[0],t.geometry.coordinates[1]=n[1])})),this.supercluster=new yh({maxZoom:t.maxZoom,minZoom:t.minZoom,radius:t.clusterRadius,minPoints:t.minPoints,extent:t.extent}),this.supercluster.load(e),this.supercluster.trees.forEach((function(t){var e=0,i=1/0;t.points.forEach((function(t){e=Math.max(t.numPoints||0,e),i=Math.min(t.numPoints||1/0,i)})),t.max=e,t.min=i})),this.refreshCluster()):(this.supercluster=null,this.pointLayer.setData([]),this.iconLayer.setData([]),this.textLayer.setData([]))}},{key:"refreshCluster",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options;if(this.supercluster){var e=this.getClusterData(t);if("function"===typeof t.beforeRender&&!1===t.beforeRender(e))this.pointLayer.setData([]),this.iconLayer.setData([]),this.textLayer.setData([]);else if(e&&e.length){var i=[],n=[];e.forEach((function(t){t.properties.text?i.push(t):t.properties.icon?n.push(t):i.push(t)})),this.pointLayer.setData(i),this.iconLayer.setData(n),this.textLayer.setData(t.showText?e:[]),t.enablePicked&&t.autoSelect&&this.pick(-1,-1)}}}},{key:"getClusterData",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,e=this.map.getBounds(),i=this.ne=e.getNorthEast();e=this.sw=e.getSouthWest();var n=i,r=n.lng;return n=n.lat,-180<=r&&180>=r&&-90<=n&&90>=n?e=[e.lng,e.lat,i.lng,i.lat]:(i=this.map.mercatorToLnglat(this.ne.lng,this.ne.lat),e=this.map.mercatorToLnglat(this.sw.lng,this.sw.lat),e=e.concat(i)),i=Math.floor(this.map.getZoom()),e=this.supercluster.getClusters(e,i),this.zoom!==i&&0<e.length&&(this.zoom=i,n=this.supercluster.trees,r=n[i]&&n[i].max||this.max,i=n[i]&&n[i].min||this.min,r!==i&&(this.max=r,this.min=i)),this.processData(e,t)}},{key:"processData",value:function(t,e){var i=e.defaultColor,n=e.defaultSize,r=e.gradient,o=e.minSize,a=e.textOptions,s=new A({max:this.max,min:~~this.min||1,minSize:o||8,maxSize:e.maxSize||30,gradient:r});i=i||r[0]||"black",n=n||.5*o||5;var u=a&&a.format;return u="function"===typeof u?u:null,t.map((function(t){var e=n,r=i,o="";return t.properties&&t.properties.point_count&&(o=t.properties.point_count,e=s.getSize(o)||e,r=s.getColor(o),o=u?u(o):o),e=di({},t.properties,{text:o,size:e,color:r}),di({},t,{properties:e,children:t.id})}))}},{key:"pick",value:function(t,e){var i=this.pointLayer.pick(t,e);return 0>i.dataIndex&&(i=this.iconLayer.pick(t,e)),(t=i.dataItem)&&"number"===typeof t.children&&(t.children=this.getClusterPoints(t.children)),i}},{key:"getClusterPoints",value:function(t){var e=this;return t?this.supercluster.getChildren(t).map((function(t){return"Feature"===t.type?e.getClusterPoints(t.id):t})).flat():[]}},{key:"shouldUpdate",value:function(){if(!this.data||!this.supercluster)return!1;if(this.zoom!==Math.floor(this.map.getZoom()))return!0;var t=this.map.getBounds(),e=t.getNorthEast();return t=t.getSouthWest(),this.ne.lng!==e.lng||this.ne.lat!==e.lat||this.sw.lng!==t.lng||this.sw.lat!==t.lat||void 0}},{key:"render",value:function(t){this.shouldUpdate()?this.refreshCluster():Xs(e.prototype.__proto__||bi(e.prototype),"render",this).call(this,t)}}]),e}(Mu),Oh=function(t){function e(t,i){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t,i))}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return di(Xs(e.prototype.__proto__||bi(e.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}})}},{key:"onChanged",value:function(t,i){this.gl&&(i=this.processData(i,t),Xs(e.prototype.__proto__||bi(e.prototype),"onChanged",this).call(this,t,i))}},{key:"generateGrid",value:function(t,e){var i=e.gridSize,n=[],r={};e=t.length;for(var o=this.getPointOffset(),a=0;a<e;a++){var s=this.normizedPoint(t[a].geometry.coordinates),u=s[2];s=~~((s[0]+o[0])/i)+"_"+~~((s[1]+o[1])/i),void 0===r[s]&&(r[s]={count:0,num:0,z:0});var l=~~t[a].count||1;"properties"in t[a]&&"count"in t[a].properties&&(l=~~t[a].properties.count),r[s].count+=l,r[s].num+=1,r[s].z+=u}return si(r).forEach((function(t){var e=t.split("_");n.push([e[0]*i+i/2,e[1]*i+i/2,r[t].z/r[t].num,r[t].count])})),n}},{key:"processData",value:function(t,e){var i=[];if("normal"===e.style)for(var n=this.getPointOffset(),r=0;r<t.length;r++){var o=this.normizedPoint(t[r].geometry.coordinates),a=o[0]+n[0],s=o[1]+n[1];o=o[2];var u=~~t[r].count||1;"properties"in t[r]&&"count"in t[r].properties&&(u=~~t[r].properties.count),i.push([a,s,o,u])}else i=this.generateGrid(t,e);if(n=t=0,void 0!==e.max&&void 0!==e.min)t=e.max,n=e.min;else{for(i[0]&&(t=i[0][3],n=i[0][3]),r=i.length,a=0;a<r;a++)s=i[a],t=Math.max(s[3],t),n=Math.min(s[3],n);t/=2}for(e=new A({max:~~t,min:n,gradient:e.gradient}),t=[],n=0;n<i.length;n++)r=i[n],r[0]=r[0],r[1]=r[1],a=e.getImageData(r[3]),t.push({geometry:{type:"Point",coordinates:[r[0],r[1],r[2]]},color:[a[0]/255,a[1]/255,a[2]/255,a[3]/255]});return t}}]),e}(Sh),Dh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.bufferData=[],t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1]}}},{key:"onChanged",value:function(t,e){var i=this;if(t=this.gl){this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer);for(var n=[],r=function(t){var r=5*t;for(t=0;t<e.length;t++)e[t].geometry.coordinates.forEach((function(t){for(var e=0;e<t.length-1;e++){var o=i.normizedPoint(t[e]);n.push(o[0]),n.push(o[1]),n.push(Number(r)),o=i.normizedPoint(t[e+1]),n.push(o[0]),n.push(o[1]),n.push(Number(r))}}))},o=0;20>o;o++)r(o);t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW),this.bufferData=n,t.bindBuffer(t.ARRAY_BUFFER,null)}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Ms(t,{vertexShader:"uniform mat4 uMatrix;attribute vec3 aPos;void main(){gl_PointSize=10.0;gl_Position=uMatrix*vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform vec4 uFragColor;void main(){gl_FragColor=uFragColor;}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"render",value:function(t){var e=t.gl;t=t.matrix;var i=this.program;e.useProgram(i.program);var n=this.normizedColor(this.options.color);e.uniform4f(i.uniforms.uFragColor,n[0],n[1],n[2],n[3]),e.uniformMatrix4fv(i.uniforms.uMatrix,!1,t),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(i.attributes.aPos),e.vertexAttribPointer(i.attributes.aPos,3,e.FLOAT,!1,0,0),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.ONE,e.ONE]}),e.drawArrays(e.LINES,0,this.bufferData.length/3)}}]),e}(Ns),Bh={circle:1,square:2},zh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return ar(e,t),Pi(e,[{key:"initialize",value:function(t){this.gl=t,this.program=new Ms(this.gl,{vertexShader:"attribute vec4 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;uniform float currentTime;uniform float trailLength;varying float vTime;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;varying float vTime;void main(void){if(vTime>1.0||vTime<0.0){discard;}if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vTime);}}"}),this.f32BufferData=new Float32Array,this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(t,e){var i=this.gl;if(i){this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer);for(var n=[],r=t.color||[.1,.1,.9,1],o=t.size||5,a=0;a<e.length;a++){var s=e[a].geometry.coordinates,u=r;"[object Function]"===Object.prototype.toString.call(u)?u=u(e[a]):(u=e[a].color||r,"properties"in e[a]&&"color"in e[a].properties&&(u=e[a].properties.color)),u=this.normizedColor(u);var l=this.normizedPoint(s),h=o;h="[object Function]"===Object.prototype.toString.call(h)?h(e[a]):Number(h);var f=e[a].time||a;"properties"in e[a]&&"time"in e[a].properties&&(f=e[a].properties.time),n.push(l[0],l[1],Number(s[2]||0),f),n.push(u[0],u[1],u[2],u[3]),n.push(h*window.devicePixelRatio)}void 0===t.endTime&&(this.endTime=e.length),this.bufferData=n,this.f32BufferData=new Float32Array(n),i.bufferData(i.ARRAY_BUFFER,this.f32BufferData,i.STATIC_DRAW)}}},{key:"render",value:function(t){var e=t.gl,i=t.matrix;0>=this.bufferData.length||(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,i),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),i=this.f32BufferData.BYTES_PER_ELEMENT,e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,9*i,0),e.enableVertexAttribArray(t.attributes.aColor),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,9*i,4*i),e.enableVertexAttribArray(t.attributes.aSize),e.vertexAttribPointer(t.attributes.aSize,1,e.FLOAT,!1,9*i,8*i),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength||3),i=1,this.options.shape&&Bh[this.options.shape]&&(i=Bh[this.options.shape]),e.uniform1i(t.uniforms.uShape,i),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===this.options.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),e.drawArrays(e.POINTS,0,this.bufferData.length/9),this.time+=this.options.step||.1,this.time>this.endTime&&(this.time=this.startTime))}}]),e}(Ns),Fh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1],trailLength:3,step:.1,polygonOffset:[0,0]}}},{key:"initialize",value:function(t){this.gl=t,this.program=new Ms(this.gl,{vertexShader:"precision highp float;attribute vec4 aPos;attribute vec4 aColor;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;varying vec4 vColor;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vColor=aColor;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;uniform vec3 uFragColor;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"},this),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"setTime",value:function(t){this.time=t}},{key:"onChanged",value:function(t,e){var i=this.gl;if(i){this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer);for(var n=[],r=0,o=this.options.color,a=0;a<e.length;a++){var s=e[a].geometry.coordinates;e[a].color&&(o=e[a].color),"properties"in e[a]&&"color"in e[a].properties&&(o=e[a].properties.color),"[object Function]"===Object.prototype.toString.call(o)&&(o=o(e[a])),o=this.normizedColor(o),s.length>r&&(r=s.length);for(var u=0;u<s.length-1;u++){var l=this.normizedPoint(s[u]);n.push(l[0]),n.push(l[1]),n.push(l[2]),void 0===s[u][3]?n.push(u):n.push(Number(s[u][3])),n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(o[3]),l=this.normizedPoint(s[u+1]),n.push(l[0]),n.push(l[1]),n.push(l[2]),void 0===s[u+1][3]?n.push(u+1):n.push(Number(s[u+1][3])),n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(o[3])}}void 0===t.endTime&&(this.endTime=r),this.bufferData=n,this.f32BufferData=new Float32Array(n),i.bufferData(i.ARRAY_BUFFER,this.f32BufferData,i.STATIC_DRAW)}}},{key:"render",value:function(t){var e=t.gl,i=t.matrix;t=this.getOptions();var n=this.program;n.use(e),e.uniformMatrix4fv(n.uniforms.u_matrix,!1,i),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),i=this.f32BufferData.BYTES_PER_ELEMENT,e.enableVertexAttribArray(n.attributes.aPos),e.vertexAttribPointer(n.attributes.aPos,4,e.FLOAT,!1,8*i,0),e.enableVertexAttribArray(n.attributes.aColor),e.vertexAttribPointer(n.attributes.aColor,4,e.FLOAT,!1,8*i,4*i),i=this.normizedColor(t.color),e.uniform3f(n.uniforms.uFragColor,i[0],i[1],i[2]),e.uniform1f(n.uniforms.currentTime,this.time),e.uniform1f(n.uniforms.trailLength,t.trailLength),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===t.blend?[e.ONE,e.ONE]:[e.SRC_ALPHA,e.ONE],polygonOffset:t.polygonOffset,depthMask:!1}),e.drawArrays(e.LINES,0,this.bufferData.length/8),this.time+=t.step,this.time>this.endTime&&(this.time=this.startTime)}}]),e}(Ns),Ih=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.index=[],i=t.canvas=document.createElement("canvas"),t.ctx=i.getContext("2d"),t.iconHash=new oh,t.boxHash=new oh,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{flat:!1,unit:"px",scale:1,angle:0,offset:[0,0],padding:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new Ms(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute vec2 a_size;attribute vec2 a_offset;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform float devicePixelRatio;uniform float u_zoom_units;uniform float u_zIndex;uniform float u_scale;uniform bool u_unit_px;uniform bool u_flat;varying vec2 v_texture_coord;/***\u70b9A(x,y)\uff0c\u7ed5\u539f\u70b9\u987a\u65f6\u9488\u65cb\u8f6c\u89d2\u5ea6a\u65b0\u5750\u6807\u7684\u8ba1\u7b97\u516c\u5f0f*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)+size.x*sin(a_rotation);}else if(corner==2.0){x+=size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)-size.x*sin(a_rotation);}else if(corner==3.0){x+=size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)-size.x*sin(a_rotation);}else{x+=-size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)+size.x*sin(a_rotation);}return vec3(x,y,coord.z);}void main(){v_texture_coord=a_texture_coord;if(u_flat){vec2 offset=a_offset;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;offset*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=u_zIndex;gl_Position=u_matrix*vec4(current.x+offset[0],current.y-offset[1],current.z,1.0);}else{vec4 position=u_matrix*vec4(a_pos,1.0);vec3 screen=position.xyz/position.w;vec2 halfSize=a_size/MAPV_resolution*devicePixelRatio*u_scale;vec2 offset=a_offset*2./MAPV_resolution*devicePixelRatio;if(!u_unit_px){halfSize/=u_zoom_units;offset/=u_zoom_units;}vec3 current=transformCoord(screen,halfSize,a_corner);current.xy=current.xy-offset;current.z+=u_zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}gl_FragColor=textureColor;\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:36,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:16},{name:"a_offset",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:32},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.canvas=this.boxHash=this.iconHash=this.cachedData=this.options=this.data=this.indexBuffer=this.uvBuffer=this.vertexBuffer=this.program=this.vertexArray=null}},{key:"onChanged",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.gl&&(this.cachedData=[],this.boxHash.clear(),this.processCache(t,e,i))}},{key:"processCache",value:function(t,e,i){for(var n=this,r=t.icon,o=t.width,a=t.height,s=t.offset,u=t.angle,l=0;l<e.length;l++){var h=this.normizedPoint(e[l].geometry.coordinates),f=this.getProperty("icon",r,e[l]),c=this.getProperty("width",o,e[l]),p=this.getProperty("height",a,e[l]),d=this.getProperty("offset",s,e[l]),v=this.getProperty("angle",u,e[l]);h&&f&&(this.cachedData.push({point:h,icon:f,width:c,height:p,offset:d,angle:v,dataIndex:l}),this.iconHash.get(f)||this.iconHash.set(f,f))}e=Er(this.iconHash.entries()).filter((function(t){return"string"===typeof t[1]})).map((function(t){var e=xr(t,2)[0];return new Zl((function(t,i){n.url2canvas(e,(function(i){n.iconHash.set(e,i),t()}))}))})),Zl.all(e).then((function(e){n.buildSprite(t),!1!==i.autoRender&&n.webglLayer&&n.webglLayer.render()}))}},{key:"buildSprite",value:function(t){t=t.padding;var e=this.canvas,i=this.ctx,n=[],r=!0,o=!1,a=void 0;try{for(var s,u=mr(this.iconHash);!(r=(s=u.next()).done);r=!0){var l=xr(s.value,2),h=l[1];if("string"!==typeof h){var f=h.width,c=h.height;n.push({w:f+t[0],h:c+t[0],width:f,height:c,key:l[0],icon:h})}}}catch(p){o=!0,a=p}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}for(u=te(n),s=0;s<n.length;s++)l=n[s],this.boxHash.get(l.key)||this.boxHash.set(l.key,l);for(s=v(u.w)||1,u=v(u.h)||1,e.width=s,e.height=u,i.save(),e=0;e<n.length;e++)u=n[e],i.drawImage(u.icon,u.x+t[0],u.y+t[1],u.width,u.height);i.restore(),this.loadTexture()}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.texture){var e=t.gl,i=t.matrix,n=this.getOptions(),r=this.program;r.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),r.setUniforms(di(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:i,u_flat:n.flat,u_unit_px:"px"===n.unit,u_zoom_units:this.map.getZoomUnits(),u_scale:n.scale,u_zIndex:n.zIndex,devicePixelRatio:window.devicePixelRatio})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateIcon(t)}},{key:"updateIcon",value:function(t){if(this.iconHash.size&&this.boxHash.size){var e=this.getOptions(),i=t.gl;t=t.matrix,e=e.enablePicked;var n=[],r=[],o=[],a=[],s=this.canvas.width,u=this.canvas.height,l=i.canvas.width/window.devicePixelRatio;i=i.canvas.height/window.devicePixelRatio;for(var h=new gh,f=0,c=0;c<this.cachedData.length;c++){var p=this.cachedData[c],d=p.point,v=p.width,g=p.height,m=p.offset,y=p.angle,x=p.dataIndex;if(p=this.boxHash.get(p.icon)){v=v||p.icon.width,g=g||p.icon.height;var b=xr(d,3);d=b[0];var _=b[1];b=b[2];var w=ru.clone([d,_,b,1]);ru.transformMat4(w,w,t),ru.scale(w,w,1/w[3]);var A=(w[0]+1)/2*l-v/2;w=(1-w[1])/2*i-g/2;var T=A+v,M=w+g;if(!(0>T||0>M||A>l||w>i||(A={minX:A,maxX:T,minY:w,maxY:M},h.collides(A)))){for(h.insert(A),A=0;4>A;A++)n.push(d,_,b),n.push(A),n.push(v,g),n.push.apply(n,Lr(m)),n.push(y*Math.PI/180);v=p.x/s,g=(p.x+p.w)/s,m=(p.y+p.h)/u,p=p.y/u,r.push(v,m,v,p,g,p,g,m),p=4*f,o.push(p,p+2,p+1,p,p+3,p+2),e&&(x=this.indexToRgb(x),a.push(x[0]/255,x[1]/255,x[2]/255),a.push(x[0]/255,x[1]/255,x[2]/255),a.push(x[0]/255,x[1]/255,x[2]/255),a.push(x[0]/255,x[1]/255,x[2]/255)),f+=1}}}this.index=o,this.vertexBuffer.updateData(new Float32Array(n)),this.uvBuffer.updateData(new Float32Array(r)),this.indexBuffer.updateData(new Uint32Array(o)),e&&this.pickBuffer.updateData(new Float32Array(a))}}},{key:"url2canvas",value:function(t,e){if("object"===("undefined"===typeof t?"undefined":qn(t)))e(t);else{var i=new Image;i.crossOrigin="anonymous",i.onload=function(){var t=i.width,n=i.height,r=document.createElement("canvas");r.width=t,r.height=n,r.getContext("2d").drawImage(i,0,0,t,n),e(r)},i.onerror=function(){var t=document.createElement("canvas");t.width=20,t.height=40;var i=t.getContext("2d");i.fillStyle="red",i.beginPath(),i.lineTo(0,0),i.lineTo(20,0),i.lineTo(10,40),i.closePath(),i.fill(),e(t)},i.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e})):this.texture=null}}]),e}(Ns),Uh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.initData(),t.date=new Date,t.autoUpdate=!0,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:2,antialias:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0]}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new Ms(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float thickness;uniform vec4 uSelectedColor;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aCounter;attribute vec2 uv;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}void main(){vColor=aColor;vCounter=aCounter;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nvec4 previousProjected=u_matrix*vec4(previous,1.0);vec4 currentProjected=u_matrix*vec4(position,1.0);vec4 nextProjected=u_matrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float len=thickness;float orientation=direction;vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;float angle=40.0;if(dot(dirA,dirB)>cos(radians(angle))){len=thickness/dot(miter,perp);}}vec2 normal=vec2(-dir.y,dir.x);vNormal=normal*orientation;normal*=len/2.0;vec2 pos=currentScreen+normal*orientation;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}",fragmentShader:"precision highp float;uniform bool uAntialias;uniform bool uAnimate;uniform float uTime;uniform float duration;uniform float interval;uniform float trailLength;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.98,1.0,length(vNormal));color.a*=blur;}if(uAnimate){float alpha=1.0-fract(mod(1.0-vCounter,interval)*(1.0/interval)+uTime/duration);alpha=(alpha+trailLength-1.0)/trailLength;color.a*=alpha;}gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.prevBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:4,name:"aCounter",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.options=this.data=this.dataMgr=this.indexBuffer=this.uvBuffer=this.counterBuffer=this.directionBuffer=this.colorBuffer=this.nextBuffer=this.currentBuffer=this.prevBuffer=this.program=this.vertexArray=null}},{key:"onChanged",value:function(t,e){var i=this;if(this.gl){this.initData();for(var n=1,r=[],o=0;o<e.length;o++){var a=[],s=e[o].geometry.coordinates;s&&0<s.length&&(a="Polygon"===e[o].geometry.type?s[0].map((function(t){return i.normizedPoint(t)})):s.map((function(t){return i.normizedPoint(t)}))),a=Gt(a),s=a.total,r[o]=a.arr,n=Math.max(s,n)}for(o=[],a=t.color,s=0;s<e.length;s++){var u=[],l=e[s].geometry.coordinates;l&&0<l.length&&(u="Polygon"===e[s].geometry.type?l[0].map((function(t){return i.normizedPoint(t)})):l.map((function(t){return i.normizedPoint(t)}))),l=a,"[object Function]"===Object.prototype.toString.call(l)?l=l(e[s]):(l=e[s].color||a,"properties"in e[s]&&"color"in e[s].properties&&(l=e[s].properties.color)),l=this.normizedColor(l);for(var h=this.addMultipleCoords(u),f=0;f<h.length;f++)this.processData(this.dataMgr,h[f],r[s],n,l);if(t.enablePicked)for(l=this.indexToRgb(s),h=0;h<u.length;h++)o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),t.repeat&&(o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(o))}}},{key:"processData",value:function(t,e,i,n,r){var o,a,s,u,l,h,f,c=e.length,p=t.position.length/6;i=Zt(i.map((function(t){return t/n})));var d=Zt(e.map((function(t){return-1})),!0),v=Zt(e),g=Zt(e.map(Xt(-1))),m=Zt(e.map(Xt(1)));e=Zt(e.map((function(t){return r}))),c=Yt(c,p),(o=t.counter).push.apply(o,Lr(i)),(a=t.position).push.apply(a,Lr(Vt(v))),(s=t.prev).push.apply(s,Lr(Vt(g))),(u=t.next).push.apply(u,Lr(Vt(m))),(l=t.direction).push.apply(l,Lr(d)),(h=t.color).push.apply(h,Lr(Vt(e))),(f=t.index).push.apply(f,Lr(c))}},{key:"render",value:function(t){var e=t.gl,i=t.matrix,n=this.dataMgr;if(n&&!(0>=n.index.length)){var r=this.getOptions(),o=this.program;if(o.use(e),this.map){var a=this.map.getZoom();a=!!(a>=r.minZoom&&a<=r.maxZoom&&this.autoUpdate)}else a=!0;o.setUniforms(di(this.getCommonUniforms(t),{u_matrix:i,thickness:r.width,uAntialias:r.antialias,uTime:(new Date-this.date)/1e3,uAnimate:a,duration:r.duration,interval:r.interval,trailLength:r.trailLength})),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===r.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:r.polygonOffset}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,n.index.length,e.UNSIGNED_INT,0)}}}]),e}(Ns),Nh=function(t){function e(t,i){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t,i))}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new Ms(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform sampler2D uTerrain;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;\n#if defined(TERRAIN)\nvec4 terrainColor=texture2D(uTerrain,vec2(v_texture_coord.s,v_texture_coord.t));vec3 rgb=terrainColor.rgb*256.0;pos.z=-10000.0+((rgb.r*256.0*256.0+rgb.g*256.0+rgb.b)*0.1);pos.z=pos.z-60.0;\n#endif\nvec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);gl_Position=position;}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D uTile;uniform bool uUseFilter;uniform vec4 uFilterColor;void main(){vec4 textureColor=texture2D(uTile,vec2(v_texture_coord.s,v_texture_coord.t));if(uUseFilter){textureColor=textureColor*uFilterColor;}gl_FragColor=textureColor;}",defines:e.terrain?["TERRAIN"]:""},this),this.vertexBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new Ls({gl:t,program:this.program,attributes:[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}]})}},{key:"onChanged",value:function(t,e){var i=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){i.loadTexture((function(){i.parseData(e),i.dataTime=new Date,i.webglLayer.render()}))}),0))}},{key:"render",value:function(t){var e=t.gl,i=t.projectionMatrix;t=t.viewMatrix;var n=this.getOptions(),r=this.program,o=r.uniforms;r.use(e),this.texture&&(e.activeTexture(e.TEXTURE0),e.uniform1i(o.uTile,0),e.bindTexture(e.TEXTURE_2D,this.texture),e.activeTexture(e.TEXTURE1),e.uniform1i(o.uTerrain,1),e.bindTexture(e.TEXTURE_2D,this.terrainSampler),this.setGLState({cullFace:!1}),r.setUniforms({u_proj_matrix:i,uUseFilter:!!n.filterColor,uFilterColor:this.normizedColor(n.filterColor||"rgba(0, 0, 100, 1.0)"),u_mv_matrix:t}),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0)))}},{key:"loadTexture",value:function(t){var e=this,i=this.getOptions();i.tile?i.terrain?j(this.gl,i.terrain,(function(n,r){e.terrainSampler=n,j(e.gl,i.tile,(function(i,n){e.texture=i,t&&t(),e.webglLayer.render()}))}),{TEXTURE_WRAP_S:"MIRRORED_REPEAT",TEXTURE_WRAP_T:"MIRRORED_REPEAT"}):j(this.gl,i.tile,(function(i,n){e.texture=i,t&&t(),e.webglLayer.render()})):(this.texture=null,t&&t())}},{key:"parseData",value:function(t){var e=this,i=[],n=[];if(t&&t[0]){var r=t[0].geometry.coordinates[0];r=r.map((function(t){return e.normizedPoint(t)})),t=r[0][0];var o=r[0][1],a=r[0][2],s=(r[2][0]-t)/16;r=(r[2][1]-o)/16;for(var u=0;16>=u;u++)for(var l=0;16>=l;l++)if(i.push(t+s*l,o+r*u,a),i.push(l/16,u/16),16>l&&16>u){var h=17*u+l,f=17*(u+1)+l;n.push(h,f+1,h+1),n.push(h,f,f+1)}}this.index=n,this.vertexBuffer.updateData(new Float32Array(i)),this.indexBuffer.updateData(new Uint32Array(n))}}]),e}(Ns),jh=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.index=[],i=t.canvas=document.createElement("canvas"),t.ctx=i.getContext("2d"),t.iconHash=new oh,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{unit:"px",scale:1,angle:0,offsetZ:0,padding:[0,0],polygonOffset:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new Ms(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute float a_offsetZ;attribute vec2 a_size;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform float u_zoom_units;uniform float u_scale;uniform bool u_unit_px;varying vec2 v_texture_coord;/***\u4e09\u7ef4\u7a7a\u95f4\u5185\uff0c\u7ed5Z\u8f74\u65cb\u8f6c\u7684\u77e9\u9635\uff0c\u53f3\u624b\u5750\u6807\u7cfb\u4e0b*[x'][cos0-sin0  0  0]*[y']=[sin0 cos0   0  0]*[z'][0     0     1  0]*[1][0     0     0  1]*/mat3 rotateZ(float angle){float cos0=cos(angle);float sin0=sin(angle);return mat3(cos0,sin0,0.,-sin0,cos0,0.,0.,0.,1.);}vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;float z=coord.z;mat3 mat=rotateZ(a_rotation);vec3 rotated=vec3(size[0],0.0,size[1]);if(corner==1.0){rotated=mat*vec3(-size[0],0.0,size[1]);}else if(corner==2.0){rotated=mat*vec3(size[0],0.0,size[1]);}else if(corner==3.0){rotated=mat*vec3(size[0],0.0,-size[1]);}else{rotated=mat*vec3(-size[0],0.0,-size[1]);}x+=rotated.x;y+=rotated.y;z+=rotated.z;return vec3(x,y,z);}void main(){v_texture_coord=a_texture_coord;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=a_offsetZ;gl_Position=u_matrix*vec4(current,1.0);}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}gl_FragColor=textureColor;\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"a_offsetZ",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.canvas=this.iconHash=this.cachedData=this.options=this.data=this.indexBuffer=this.uvBuffer=this.vertexBuffer=this.program=this.vertexArray=null}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){var i=this;this.cachedData=[];for(var n=t.icon,r=t.width,o=t.height,a=t.offsetZ,s=t.angle,u=0;u<e.length;u++){var l=this.normizedPoint(e[u].geometry.coordinates),h=this.getProperty("icon",n,e[u]),f=this.getProperty("width",r,e[u]),c=this.getProperty("height",o,e[u]),p=this.getProperty("angle",s,e[u]),d=this.getProperty("offsetZ",a,e[u]);l&&h&&(this.cachedData.push({point:l,icon:h,width:f,height:c,offsetZ:d,angle:p}),this.iconHash.get(h)||this.iconHash.set(h,h))}e=Er(this.iconHash.entries()).filter((function(t){return"string"===typeof t[1]})).map((function(t){var e=xr(t,2)[0];return new Zl((function(t,n){i.url2canvas(e,(function(n){i.iconHash.set(e,n),t()}))}))})),Zl.all(e).then((function(e){i.buildSprite(t),i.webglLayer.render()}))}},{key:"buildSprite",value:function(t){var e=t.padding,i=this.canvas,n=this.ctx,r=[],o=new oh,a=!0,s=!1,u=void 0;try{for(var l,h=mr(this.iconHash);!(a=(l=h.next()).done);a=!0){var f=xr(l.value,2),c=f[1];if("string"!==typeof c){var p=c.width,d=c.height;r.push({w:p+e[0],h:d+e[0],width:p,height:d,key:f[0],icon:c})}}}catch(g){s=!0,u=g}finally{try{!a&&h.return&&h.return()}finally{if(s)throw u}}for(s=te(r),a=0;a<r.length;a++)u=r[a],o.get(u.key)||o.set(u.key,u);for(a=v(s.w),s=v(s.h),i.width=a||1,i.height=s||1,n.save(),i=0;i<r.length;i++)u=r[i],n.drawImage(u.icon,u.x+e[0],u.y+e[1],u.width,u.height);n.restore(),this.loadTexture(),this.buildVertex(t,o,a,s)}},{key:"buildVertex",value:function(t,e,i,n){t=t.enablePicked;for(var r=[],o=[],a=[],s=[],u=0;u<this.cachedData.length;u++){var l=this.cachedData[u],h=l.point,f=l.width,c=l.height,p=l.offsetZ,d=l.angle;if(l=e.get(l.icon)){f=f||l.icon.width,c=c||l.icon.height;var v=xr(h,3);h=v[0];var g=v[1];v=v[2];for(var m=0;4>m;m++)r.push(h,g,v),r.push(m),r.push(f,c),r.push(p),r.push(d*Math.PI/180);f=l.x/i,c=(l.x+l.w)/i,p=(l.y+l.h)/n,l=l.y/n,o.push(f,p,f,l,c,l,c,p),l=4*u,a.push(l,l+2,l+1,l,l+3,l+2),t&&(l=this.indexToRgb(u),s.push(l[0]/255,l[1]/255,l[2]/255),s.push(l[0]/255,l[1]/255,l[2]/255),s.push(l[0]/255,l[1]/255,l[2]/255),s.push(l[0]/255,l[1]/255,l[2]/255))}}this.index=a,this.vertexBuffer.updateData(new Float32Array(r)),this.uvBuffer.updateData(new Float32Array(o)),this.indexBuffer.updateData(new Uint32Array(a)),t&&this.pickBuffer.updateData(new Float32Array(s))}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.iconHash&&this.texture){var e=t.gl,i=t.matrix,n=this.getOptions(),r=this.program;r.use(e),this.setGLState({blend:!0,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset}),r.setUniforms(di(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:i,u_unit_px:"px"===n.unit,u_zoom_units:this.map.getZoomUnits(),u_scale:n.scale})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"url2canvas",value:function(t,e){if("object"===("undefined"===typeof t?"undefined":qn(t)))e(t);else{var i=new Image;i.crossOrigin="anonymous",i.onload=function(){var t=i.width,n=i.height,r=document.createElement("canvas");r.width=t,r.height=n,r.getContext("2d").drawImage(i,0,0,t,n),e(r)},i.onerror=function(){var t=document.createElement("canvas");t.width=20,t.height=40;var i=t.getContext("2d");i.fillStyle="red",i.beginPath(),i.lineTo(0,0),i.lineTo(20,0),i.lineTo(10,40),i.closePath(),i.fill(),e(t)},i.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e})):this.texture=null}}]),e}(Ns),Hh=function(t){function e(t){de(this,e);var i=Qn(this,(e.__proto__||bi(e)).call(this,t));return t=i.getOptions(),i.shapeLayer=new Au({enablePicked:t.enablePicked}),i.lineLayer=new Wu,i.children=[i.shapeLayer,i.lineLayer],i}return ar(e,t),Pi(e,[{key:"pick",value:function(t,e){return this.shapeLayer.pick(t,e)}},{key:"onOptionsChanged",value:function(t){this.shapeLayer.setOptions({onClick:function(e){t.onClick&&t.onClick(e)},selectedIndex:t.selectedIndex,selectedColor:t.selectedColor,height:0,polygonOffset:[1,1],autoSelect:t.autoSelect,color:t.fillColor,opacity:t.fillOpacity,topColor:t.fillColor,useLight:!1}),this.lineLayer.setOptions({polygonOffset:[-1,-1],dashArray:t.dashArray,color:t.lineColor,width:t.lineWidth,lineJoin:t.lineJoin})}},{key:"onDataChanged",value:function(t){this.shapeLayer.setData(t),this.lineLayer.setData(t,{closePath:!0})}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ff0000",autoSelect:!0,dashArray:[0,0],lineColor:"rgba(250, 250, 25, 1)",lineWidth:2,lineJoin:"miter",fillColor:"rgba(25, 25, 250, 1)",fillOpacity:1}}}]),e}(Mu),Wh=Wh||{},Zh=0,Yh=null,Xh=Wh.Scene=function(t,e){this.name=void 0!==e.name?e.name:null,this.nodes=Array(e.nodes.length);for(var i=0,n=e.nodes.length;i<n;i++)this.nodes[i]=t.nodes[e.nodes[i]];this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.boundingBox=null},Vh=Wh.BoundingBox=function(t,e,i){t=t||ou.fromValues(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),e=e||ou.fromValues(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),void 0===i||!0===i?(this.min=ou.clone(t),this.max=ou.clone(e)):(this.min=t,this.max=e),this.transform=lu.create()};Vh.prototype.updateBoundingBox=function(t){ou.min(this.min,this.min,t.min),ou.max(this.max,this.max,t.max)},Vh.prototype.calculateTransform=function(){this.transform[0]=this.max[0]-this.min[0],this.transform[5]=this.max[1]-this.min[1],this.transform[10]=this.max[2]-this.min[2],this.transform[12]=this.min[0],this.transform[13]=this.min[1],this.transform[14]=this.min[2]},Vh.getAABBFromOBB=function(){var t=ou.create(),e=ou.create(),i=ou.create(),n=ou.create(),r=ou.create();return function(o,a){ou.set(t,a[0],a[1],a[2]),ou.set(e,a[4],a[5],a[6]),ou.set(i,a[8],a[9],a[10]),a=ou.fromValues(a[12],a[13],a[14]);var s=ou.clone(a);return ou.scale(n,t,o.min[0]),ou.scale(r,t,o.max[0]),ou.min(t,n,r),ou.add(a,a,t),ou.max(t,n,r),ou.add(s,s,t),ou.scale(n,e,o.min[1]),ou.scale(r,e,o.max[1]),ou.min(e,n,r),ou.add(a,a,e),ou.max(e,n,r),ou.add(s,s,e),ou.scale(n,i,o.min[2]),ou.scale(r,i,o.max[2]),ou.min(i,n,r),ou.add(a,a,i),ou.max(i,n,r),ou.add(s,s,i),o=new Vh(a,s,!1),o.calculateTransform(),o}}();var Gh=Wh.Accessor=function(t,e){this.bufferView=e,this.componentType=t.componentType,this.byteOffset=void 0!==t.byteOffset?t.byteOffset:0,this.byteStride=e.byteStride,this.normalized=void 0!==t.normalized&&t.normalized,this.count=t.count,this.type=t.type,this.size=xf[this.type],this.min=t.min,this.max=t.max,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null};Gh.prototype.prepareVertexAttrib=function(t,e){e.vertexAttribPointer(t,this.size,this.componentType,this.normalized,this.byteStride,this.byteOffset),e.enableVertexAttribArray(t)};var qh=Wh.BufferView=function(t,e){this.byteLength=t.byteLength,this.byteOffset=void 0!==t.byteOffset?t.byteOffset:0,this.byteStride=void 0!==t.byteStride?t.byteStride:0,this.target=void 0!==t.target?t.target:null,this.data=e.slice(this.byteOffset,this.byteOffset+this.byteLength),this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.buffer=null};qh.prototype.createBuffer=function(t){this.buffer=t.createBuffer()},qh.prototype.bindData=function(t){return!!this.target&&(t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,this.data,t.STATIC_DRAW),t.bindBuffer(this.target,null),!0)};var Kh=Wh.Camera=function(t){this.name=void 0!==t.name?t.name:null,this.type=t.type,this.othographic=void 0===t.othographic?null:t.othographic,this.perspective=void 0===t.perspective?null:{yfov:t.perspective.yfov,znear:t.perspective.znear,zfar:void 0!==t.perspective.zfar?t.perspective.zfar:null,aspectRatio:void 0!==t.perspective.aspectRatio?t.perspective.aspectRatio:null},this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},Qh=Wh.Node=function(t,e){if(this.name=void 0!==t.name?t.name:null,this.nodeID=e,this.camera=void 0!==t.camera?t.camera:null,this.matrix=lu.create(),t.hasOwnProperty("matrix")){for(e=0;16>e;++e)this.matrix[e]=t.matrix[e];this.translation=ou.create(),lu.getTranslation(this.translation,this.matrix),this.rotation=uu.create(),lu.getRotation(this.rotation,this.matrix),this.scale=ou.create(),lu.getScaling(this.scale,this.matrix)}else this.getTransformMatrixFromTRS(t.translation,t.rotation,t.scale);this.children=t.children||[],this.mesh=void 0!==t.mesh?Yh.glTF.meshes[t.mesh]:null,this.skin=void 0!==t.skin?t.skin:null,void 0!==t.extensions&&void 0!==t.extensions.gl_avatar&&!0===Yh.enableGLAvatar&&(this.skin=new hf(Yh.glTF,Yh.skeletonGltf.skins[Yh.skeletonGltf.json.extensions.gl_avatar.skins[t.extensions.gl_avatar.skin.name]],t.extensions.gl_avatar.skin.inverseBindMatrices)),this.weights=void 0!==t.weights?t.weights:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.aabb=null,this.bvh=new Vh};Qh.prototype.traverse=function(t,e){e(this,t),t=0;for(var i=this.children.length;t<i;t++)this.children[t].traverse(this,e)},Qh.prototype.traversePostOrder=function(t,e){for(var i=0,n=this.children.length;i<n;i++)this.children[i].traversePostOrder(this,e);e(this,t)},Qh.prototype.traverseTwoExecFun=function(t,e,i){e(this,t);for(var n=0,r=this.children.length;n<r;n++)this.children[n].traverseTwoExecFun(this,e,i);i(this,t)};var Jh=lu.create();Qh.prototype.getTransformMatrixFromTRS=function(t,e,i){this.translation=void 0!==t?ou.fromValues(t[0],t[1],t[2]):ou.fromValues(0,0,0),this.rotation=void 0!==e?ru.fromValues(e[0],e[1],e[2],e[3]):ru.fromValues(0,0,0,1),this.scale=void 0!==i?ou.fromValues(i[0],i[1],i[2]):ou.fromValues(1,1,1),this.updateMatrixFromTRS()},Qh.prototype.updateMatrixFromTRS=function(){lu.fromRotationTranslation(Jh,this.rotation,this.translation),lu.scale(this.matrix,Jh,this.scale)};var $h=Wh.Mesh=function(t,e){this.meshID=e,this.name=void 0!==t.name?t.name:null,this.primitives=[],this.boundingBox=null,e=0;for(var i=t.primitives.length;e<i;++e){var n=t.primitives[e];n=new tf(Yh.glTF,n),this.primitives.push(n),n.boundingBox&&(this.boundingBox||(this.boundingBox=new Vh),this.boundingBox.updateBoundingBox(n.boundingBox))}this.boundingBox&&this.boundingBox.calculateTransform(),this.weights=void 0!==t.weights?t.weights:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},tf=Wh.Primitive=function(t,e){var i;if(this.attributes=e.attributes,this.indices=void 0!==e.indices?e.indices:null,void 0!==e.extensions&&void 0!==e.extensions.gl_avatar&&!0===Yh.enableGLAvatar&&e.extensions.gl_avatar.attributes)for(i in e.extensions.gl_avatar.attributes)this.attributes[i]=e.extensions.gl_avatar.attributes[i];for(i in null!==this.indices?(this.indicesComponentType=t.json.accessors[this.indices].componentType,this.indicesLength=t.json.accessors[this.indices].count,this.indicesOffset=t.json.accessors[this.indices].byteOffset||0):(this.drawArraysCount=t.json.accessors[this.attributes.POSITION].count,this.drawArraysOffset=t.json.accessors[this.attributes.POSITION].byteOffset||0),this.attributes)this.attributes[i]=t.accessors[this.attributes[i]];this.material=void 0!==e.material?t.materials[e.material]:null,this.mode=void 0!==e.mode?e.mode:4,this.targets=e.targets,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.boundingBox=this.shader=this.indexBuffer=this.vertexBuffer=this.vertexArray=null,void 0!==this.attributes.POSITION&&(t=this.attributes.POSITION,t.max&&"VEC3"===t.type&&(this.boundingBox=new Vh(ou.fromValues(t.min[0],t.min[1],t.min[2]),ou.fromValues(t.max[0],t.max[1],t.max[2]),!1),this.boundingBox.calculateTransform()))},ef=Wh.Texture=function(t){this.name=void 0!==t.name?t.name:null,this.sampler=void 0!==t.sampler?Yh.glTF.samplers[t.sampler]:null,this.source=void 0!==t.source?Yh.glTF.images[t.source]:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.texture=null};ef.prototype.createTexture=function(t){this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.source),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)};var nf=Wh.Sampler=function(t){this.name=void 0!==t.name?t.name:null,this.magFilter=void 0!==t.magFilter?t.magFilter:null,this.minFilter=void 0!==t.minFilter?t.minFilter:null,this.wrapS=void 0!==t.wrapS?t.wrapS:10497,this.wrapT=void 0!==t.wrapT?t.wrapT:10497,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.sampler=null};nf.prototype.createSampler=function(t){this.sampler=t.createSampler(),this.minFilter?t.samplerParameteri(this.sampler,t.TEXTURE_MIN_FILTER,this.minFilter):t.samplerParameteri(this.sampler,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_LINEAR),this.magFilter?t.samplerParameteri(this.sampler,t.TEXTURE_MAG_FILTER,this.magFilter):t.samplerParameteri(this.sampler,t.TEXTURE_MAG_FILTER,t.LINEAR),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_S,this.wrapS),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_T,this.wrapT)};var rf=Wh.TextureInfo=function(t){this.index=t.index,this.texCoord=void 0!==t.texCoord?t.texCoord:0,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},of=Wh.PbrMetallicRoughness=function(t){this.baseColorFactor=void 0!==t.baseColorFactor?t.baseColorFactor:[1,1,1,1],this.baseColorTexture=void 0!==t.baseColorTexture?new rf(t.baseColorTexture):null,this.metallicFactor=void 0!==t.metallicFactor?t.metallicFactor:1,this.roughnessFactor=void 0!==t.roughnessFactor?t.roughnessFactor:1,this.metallicRoughnessTexture=void 0!==t.metallicRoughnessTexture?new rf(t.metallicRoughnessTexture):null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},af=Wh.NormalTextureInfo=function(t){this.index=t.index,this.texCoord=void 0!==t.texCoord?t.texCoord:0,this.scale=void 0!==t.scale?t.scale:1,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},sf=Wh.OcclusionTextureInfo=function(t){this.index=t.index,this.texCoord=void 0!==t.texCoord?t.texCoord:0,this.strength=void 0!==t.strength?t.strength:1,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},uf=Wh.Material=function(t){this.name=void 0!==t.name?t.name:null,this.pbrMetallicRoughness=void 0!==t.pbrMetallicRoughness?new of(t.pbrMetallicRoughness):new of({baseColorFactor:[1,1,1,1],metallicFactor:1,metallicRoughnessTexture:1}),this.normalTexture=void 0!==t.normalTexture?new af(t.normalTexture):null,this.occlusionTexture=void 0!==t.occlusionTexture?new sf(t.occlusionTexture):null,this.emissiveTexture=void 0!==t.emissiveTexture?new rf(t.emissiveTexture):null,this.emissiveFactor=void 0!==t.emissiveFactor?t.emissiveFactor:[0,0,0],this.alphaMode=void 0!==t.alphaMode?t.alphaMode:"OPAQUE",this.alphaCutoff=void 0!==t.alphaCutoff?t.alphaCutoff:.5,this.doubleSided=t.doubleSided||!1,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},lf=Wh.Skin=function(t,e,i){var n;for(this.name=void 0!==e.name?e.name:null,this.skinID=i,this.joints=Array(e.joints.length),i=0,n=this.joints.length;i<n;i++)this.joints[i]=t.nodes[e.joints[i]];if(this.skeleton=void 0!==e.skeleton?t.nodes[e.skeleton]:null,this.inverseBindMatrices=void 0!==e.inverseBindMatrices?t.accessors[e.inverseBindMatrices]:null,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.uniformBlockID=Zh++,this.inverseBindMatrices)for(this.inverseBindMatricesData=re(this.inverseBindMatrices),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(1040),i=0,n=this.inverseBindMatricesData.length;i<n;i+=16)this.inverseBindMatrix.push(lu.fromValues(this.inverseBindMatricesData[i],this.inverseBindMatricesData[i+1],this.inverseBindMatricesData[i+2],this.inverseBindMatricesData[i+3],this.inverseBindMatricesData[i+4],this.inverseBindMatricesData[i+5],this.inverseBindMatricesData[i+6],this.inverseBindMatricesData[i+7],this.inverseBindMatricesData[i+8],this.inverseBindMatricesData[i+9],this.inverseBindMatricesData[i+10],this.inverseBindMatricesData[i+11],this.inverseBindMatricesData[i+12],this.inverseBindMatricesData[i+13],this.inverseBindMatricesData[i+14],this.inverseBindMatricesData[i+15]))},hf=Wh.SkinLink=function(t,e,i){if(this.isLink=!0,t.skins||(t.skins=[]),t.skins.push(this),this.name=e.name,this.skinID=t.skins.length-1,this.joints=e.joints,this.skeleton=e.skeleton,this.inverseBindMatrices=void 0!==i?t.accessors[i]:null,this.uniformBlockID=Zh++,this.inverseBindMatrices)for(this.inverseBindMatricesData=re(this.inverseBindMatrices),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(1040),t=0,e=this.inverseBindMatricesData.length;t<e;t+=16)this.inverseBindMatrix.push(lu.fromValues(this.inverseBindMatricesData[t],this.inverseBindMatricesData[t+1],this.inverseBindMatricesData[t+2],this.inverseBindMatricesData[t+3],this.inverseBindMatricesData[t+4],this.inverseBindMatricesData[t+5],this.inverseBindMatricesData[t+6],this.inverseBindMatricesData[t+7],this.inverseBindMatricesData[t+8],this.inverseBindMatricesData[t+9],this.inverseBindMatricesData[t+10],this.inverseBindMatricesData[t+11],this.inverseBindMatricesData[t+12],this.inverseBindMatricesData[t+13],this.inverseBindMatricesData[t+14],this.inverseBindMatricesData[t+15]))},ff=Wh.Target=function(t){this.nodeID=void 0!==t.node?t.node:null,this.path=t.path,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},cf=Wh.Channel=function(t,e){this.sampler=e.samplers[t.sampler],this.target=new ff(t.target),this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},pf=Wh.AnimationSampler=function(t,e){this.input=t.accessors[e.input],this.output=t.accessors[e.output],this.inputTypedArray=re(this.input),this.outputTypedArray=re(this.output),this.interpolation=void 0!==e.interpolation?e.interpolation:"LINEAR",this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.curIdx=0,this.curValue=ru.create(),this.endT=this.inputTypedArray[this.inputTypedArray.length-1],this.inputMax=this.endT-this.inputTypedArray[0]},df=ru.create(),vf=ru.create();pf.prototype.getValue=function(t){t>this.endT&&(t-=this.inputMax*Math.ceil((t-this.endT)/this.inputMax),this.curIdx=0);for(var e=this.inputTypedArray.length;this.curIdx<=e-2&&t>=this.inputTypedArray[this.curIdx+1];)this.curIdx++;this.curIdx>=e-1&&(t-=this.inputMax,this.curIdx=0),e=xf[this.output.type];var i=4===e?uu.slerp:ru.lerp,n=this.curIdx,r=n*e,o=r+e;for(t=Math.max(0,t-this.inputTypedArray[n])/(this.inputTypedArray[n+1]-this.inputTypedArray[n]),n=0;n<e;n++)df[n]=this.outputTypedArray[r+n],vf[n]=this.outputTypedArray[o+n];switch(this.interpolation){case"LINEAR":i(this.curValue,df,vf,t)}};var gf=Wh.Animation=function(t,e){var i;this.name=void 0!==e.name?e.name:null,this.samplers=[];var n=0;for(i=e.samplers.length;n<i;n++)this.samplers[n]=new pf(t,e.samplers[n]);for(this.channels=[],n=0,i=e.channels.length;n<i;n++)this.channels[n]=new cf(e.channels[n],this);this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null},mf=Wh.glTFModel=function(t){this.json=t,this.defaultScene=void 0!==t.scene?t.scene:0,this.version=Number(t.asset.version),t.accessors&&(this.accessors=Array(t.accessors.length)),t.bufferViews&&(this.bufferViews=Array(t.bufferViews.length)),t.scenes&&(this.scenes=Array(t.scenes.length)),t.nodes&&(this.nodes=Array(t.nodes.length)),t.meshes&&(this.meshes=Array(t.meshes.length)),t.materials&&(this.materials=Array(t.materials.length)),t.textures&&(this.textures=Array(t.textures.length)),t.samplers&&(this.samplers=Array(t.samplers.length)),t.images&&(this.images=Array(t.images.length)),t.skins&&(this.skins=Array(t.skins.length)),t.animations&&(this.animations=Array(t.animations.length)),t.cameras&&(this.cameras=Array(t.cameras.length)),this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},yf=Wh.glTFLoader=function(t){this._init(),this.glTF=null,this.enableGLAvatar=!1,this.linkSkeletonGltf=null};yf.prototype._init=function(){this._loadDone=!1,this._bufferLoaded=this._bufferRequested=0,this._buffers=[],this._bufferTasks={},this._finishedPendingTasks=this._pendingTasks=this._imageLoaded=this._imageRequested=this._shaderLoaded=this._shaderRequested=0,this.onload=null,Yh=this},yf.prototype._checkComplete=function(){this._bufferRequested==this._bufferLoaded&&this._imageRequested==this._imageLoaded&&(this._loadDone=!0),this._loadDone&&this._pendingTasks==this._finishedPendingTasks&&(this._postprocess(),this.onload(this.glTF))},yf.prototype.loadGLTF_GL_Avatar_Skin=function(t,e,i){this.enableGLAvatar=!0,this.skeletonGltf=e,this.loadGLTF(t,i)},yf.prototype.loadGLTF=function(t,e){this._init(),this.onload=e||function(t){},this.baseUri=oe(t);var i=this;ae(t,(function(t){t=JSON.parse(t),i.glTF=new mf(t);var e,n,r=function(t){if(i._buffers[e]=t,i._bufferLoaded++,i._bufferTasks[e]){var n,r=0;for(n=i._bufferTasks[e].length;r<n;++r)i._bufferTasks[e][r](t)}i._checkComplete()};if(t.buffers)for(e in t.buffers){i._bufferRequested++;var o=t.buffers[e].uri;-1===o.indexOf("base64")&&(o=i.baseUri+o),se(o,r)}if(r=function(t,e){i._imageLoaded++,i.glTF.images[e]=t,i._checkComplete()},t.images)for(n in t.images)i._imageRequested++,ue(i.baseUri+t.images[n].uri,n,r);i._checkComplete()}))},yf.prototype._postprocess=function(){function t(t,e){var i=u[t.nodeID];null!==e?lu.mul(i,u[e.nodeID],t.matrix):lu.copy(i,t.matrix)}function e(t,e){var i=u[t.nodeID];e=null!==e?e.bvh:l.boundingBox,t.mesh&&(r=t.mesh,r.boundingBox&&(t.aabb=Vh.getAABBFromOBB(r.boundingBox,i),0===t.children.length&&(ou.copy(t.bvh.min,t.aabb.min),ou.copy(t.bvh.max,t.aabb.max)))),ou.min(e.min,e.min,t.bvh.min),ou.max(e.max,e.max,t.bvh.max)}var i,n,r;if(Yh=this,this.glTF.cameras){var o=0;for(i=this.glTF.cameras.length;o<i;o++)this.glTF.cameras[o]=new Kh(this.glTF.json.cameras[o])}if(this.glTF.bufferViews)for(o=0,i=this.glTF.bufferViews.length;o<i;o++)this.glTF.bufferViews[o]=new qh(this.glTF.json.bufferViews[o],this._buffers[this.glTF.json.bufferViews[o].buffer]);if(this.glTF.accessors)for(o=0,i=this.glTF.accessors.length;o<i;o++)this.glTF.accessors[o]=new Gh(this.glTF.json.accessors[o],this.glTF.bufferViews[this.glTF.json.accessors[o].bufferView]);if(this.glTF.materials)for(o=0,i=this.glTF.materials.length;o<i;o++)this.glTF.materials[o]=new uf(this.glTF.json.materials[o]);if(this.glTF.samplers)for(o=0,i=this.glTF.samplers.length;o<i;o++)this.glTF.samplers[o]=new nf(this.glTF.json.samplers[o]);if(this.glTF.textures)for(o=0,i=this.glTF.textures.length;o<i;o++)this.glTF.textures[o]=new ef(this.glTF.json.textures[o]);for(o=0,i=this.glTF.meshes.length;o<i;o++)this.glTF.meshes[o]=new $h(this.glTF.json.meshes[o],o);for(o=0,i=this.glTF.nodes.length;o<i;o++)this.glTF.nodes[o]=new Qh(this.glTF.json.nodes[o],o);for(o=0,i=this.glTF.nodes.length;o<i;o++){var a=this.glTF.nodes[o],s=0;for(n=a.children.length;s<n;s++)a.children[s]=this.glTF.nodes[a.children[s]]}var u=Array(this.glTF.nodes.length);for(o=0,i=u.length;o<i;o++)u[o]=lu.create();for(o=0,i=this.glTF.scenes.length;o<i;o++){var l=this.glTF.scenes[o]=new Xh(this.glTF,this.glTF.json.scenes[o]);for(l.boundingBox=new Vh,s=0,n=l.nodes.length;s<n;s++)a=l.nodes[s],a.traverseTwoExecFun(null,t,e);l.boundingBox.calculateTransform()}for(s=0,n=this.glTF.nodes.length;s<n;s++)a=this.glTF.nodes[s],null!==a.bvh&&a.bvh.calculateTransform();if(this.glTF.animations)for(o=0,i=this.glTF.animations.length;o<i;o++)this.glTF.animations[o]=new gf(this.glTF,this.glTF.json.animations[o]);if(this.glTF.json.skins)for(o=0,i=this.glTF.skins.length;o<i;o++)for(this.glTF.skins[o]=new lf(this.glTF,this.glTF.json.skins[o],o),a=this.glTF.skins[o].joints,s=0,n=a.length;s<n;s++)a[s].jointID=s;for(o=0,i=this.glTF.nodes.length;o<i;o++)a=this.glTF.nodes[o],null!==a.skin&&"number"==typeof a.skin&&(a.skin=this.glTF.skins[a.skin])};var xf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bf=function(t){function e(t,i){return de(this,e),Qn(this,(e.__proto__||bi(e)).call(this,t,i))}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{scale:1}}},{key:"initialize",value:function(t){var e=this;this.gl=t;var i=this.getOptions();this.gltfObj=le({gl:t,options:i}),(new yf).loadGLTF(i.url,(function(t){e.gltfObj.setupScene(t),e.webglLayer.render()}))}},{key:"onChanged",value:function(t,e){}},{key:"render",value:function(t){var e=t.gl;t=t.matrix;var i=this.getData(),n=this.getOptions(),r=n.scale,o=[r,r,r];for("px"===n.unit&&this.map&&(o=this.map.getZoomUnits(),o=[r*o,r*o,r*o]),r=0;r<i.length;r++){var a=i[r].geometry.coordinates;n=lu.create();var s=lu.create();a=this.normizedPoint(a),lu.identity(n),lu.translate(n,n,[a[0],a[1],a[2]]),lu.rotateX(n,n,Math.PI/2),lu.rotateY(n,n,(i[r].angle||0)*Math.PI/180),lu.scale(n,n,o),lu.mul(s,t,n),this.gltfObj.render({gl:e,matrix:s})}}}]),e}(Ns),_f=_f||{};(function(){function t(t,e,i){return i=t.createShader(i),t.shaderSource(i,e),t.compileShader(i),i}_f.getShaderSource=function(t){return document.getElementById(t).textContent.replace(/^\s+|\s+$/g,"")},_f.createProgram=function(e,i,n){var r=e.createProgram();return i=t(e,i,e.VERTEX_SHADER),n=t(e,n,e.FRAGMENT_SHADER),e.attachShader(r,i),e.deleteShader(i),e.attachShader(r,n),e.deleteShader(n),e.linkProgram(r),e.getProgramInfoLog(r),e.getShaderInfoLog(i),e.getShaderInfoLog(n),r};var e=_f.loadImage=function(t,e){var i=new Image;return i.crossOrigin="Anonymous",i.src=t,i.onload=e,i};_f.loadImages=function(t,i){function n(){0>=--o&&i(r)}for(var r=[],o=t.length,a=0;a<o;++a)r.push(e(t[a],n))}})();var wf=function(t){function e(t){de(this,e);var i=Qn(this,(e.__proto__||bi(e)).call(this,t));return t=i.getOptions(),i.gltfLayer=new bf({url:t.url,scale:t.scale}),i.children=[i.gltfLayer],i.autoUpdate=!0,i.index=[],i.newData=[],i.isStarted=!1!==t.autoPlay,i}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{url:"https://mapv-website.bj.bcebos.com/gl/examples/model/car.gltf",scale:1,step:1,defaultAngle:90}}},{key:"onOptionsChanged",value:function(t){this.gltfLayer.setOptions({})}},{key:"onDataChanged",value:function(t){var e=this;this.index=[],this.newData=[];for(var i=0;i<t.length;i++){this.index.push(0);var n=t[i].geometry.coordinates;"LineString"===t[i].geometry.type?this.newData.push(this._addPath(n)):n.forEach((function(t){e.newData.push(e._addPath(t))}))}this.updatePoints()}},{key:"lnglatToMercator",value:function(t,e){return e=e*Math.PI/180,e=3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e))),[parseFloat((t*Math.PI/180*6378137).toFixed(2)),parseFloat(e.toFixed(2))]}},{key:"getDeg",value:function(t,e){-180<t[0]&&180>t[0]&&(t=this.lnglatToMercator(t[0],t[1]),e=this.lnglatToMercator(e[0],e[1]));var i=180*Math.atan((e[1]-t[1])/(e[0]-t[0]))/Math.PI;return e[0]>t[0]&&(i-=180),i}},{key:"getPoint",value:function(t,e,i){return[t[0]+(e[0]-t[0])*i,t[1]+(e[1]-t[1])*i,t[2]&&e[2]?t[2]+(e[2]-t[2])*i:0]}},{key:"updatePoints",value:function(){for(var t=this.getOptions(),e=this.newData,i=[],n=0;n<e.length;n++){for(var r=e[n],o=Math.floor(this.index[n]),a=o+1;r[a]&&r[a][0]===r[o][0]&&r[a][1]===r[o][1];)a++;a>=r.length-1&&(a=--o),a=this.getDeg(r[o],r[a]),i.push({geometry:{type:"Point",coordinates:this.getPoint(r[o],r[o+1],this.index[n]%1)},angle:a-t.defaultAngle})}this.pointData=i,this.gltfLayer.setData(i,{autoRender:!1})}},{key:"getCurrentPoint",value:function(){return this.pointData}},{key:"getDistance",value:function(t,e){var i=t[1]*Math.PI/180,n=e[1]*Math.PI/180;return t=2*Math.asin(Math.sqrt(Math.pow(Math.sin((i-n)/2),2)+Math.cos(i)*Math.cos(n)*Math.pow(Math.sin((t[0]*Math.PI/180-e[0]*Math.PI/180)/2),2))),Math.round(6378137e4*t)/1e4}},{key:"_addPath",value:function(t){for(var e=t.length,i=0,n=[],r=[],o=1;o<e;o++){var a=this.getDistance(t[o-1],t[o]);n.push(a),i+=a}for(a=[0],o=1;o<e;o++){var s=(n[o-1]/i).toFixed(2);a[o]=a[o-1]+parseFloat(s,10),r=r.concat(this._getPath(t[o-1],t[o],1e3*s))}return this._pathPercents=a,r}},{key:"_getPath",value:function(t,e,i){if(0===i)return[t];for(var n=[],r=0;r<=i;r++)n.push([(e[0]-t[0])/i*r+t[0],(e[1]-t[1])/i*r+t[1],e[2]&&t[2]?(e[2]-t[2])/i*r+t[2]:0]);return n}},{key:"start",value:function(){this.isStarted=!0}},{key:"stop",value:function(){this.isStarted=!1}},{key:"render",value:function(t){if(Xs(e.prototype.__proto__||bi(e.prototype),"render",this).call(this,t),t=this.getOptions(),this.isStarted)for(var i=this.newData,n=0;n<this.index.length;n++)this.index[n]+=t.step,this.index[n]>i[n].length-2&&(this.index[n]=0);this.updatePoints()}}]),e}(Mu);he.prototype.parseColors=function(t){this.arrFeatureStyles=[[2,t[0]||"rgba(79,210,125,1)",2,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",5,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",6,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",2,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",5,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",6,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",2,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",5,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",6,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",2,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",5,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",6,2,0,[],0,0],[2,"rgba(255,255,255,1)",4,0,0,[],0,0],[2,"rgba(255,255,255,1)",5.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",7,0,0,[],0,0],[2,"rgba(255,255,255,1)",8.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",10,0,0,[],0,0]]},he.prototype.setColors=function(t){this.parseColors(t)},he.prototype.initialize=function(t){this._initialize||(this._initialize=!0)},he.prototype.clearCache=function(t){this.cache={}},he.prototype.setMap=function(t){t?(this.map=t,this._initialize?this.canvaslayer.show():this.initialize(t)):this.canvaslayer.hide()},he.prototype.draw=function(t){t=t||{},t.clearCache&&this.clearCache(),this.canvaslayer.draw()},he.prototype.clear=function(){},he.prototype.update=function(){var t=this.map,e=this.getDataZoom(),i=Math.pow(2,18-e),n=256*i,r=y.convertLL2MC(t.getCenter()),o=Math.ceil(r.lng/n),a=Math.ceil(r.lat/n),s=this.tileSize,u=e-Math.round(t.getZoom());for(0<u&&(s/=Math.pow(2,u)),n=[o,a,(r.lng-o*n)/n*s,(r.lat-a*n)/n*s],o=t.getBounds(),r=o.getNorthEast(),o=o.getSouthWest(),t.getSize(),t.getSize(),t=(r.lng-o.lng)/i,i=(r.lat-o.lat)/i,r=n[1]-Math.ceil((i/2-n[3])/s),o=n[0]+Math.ceil((t/2+n[2])/s),a=n[1]+Math.ceil((i/2+n[3])/s),i=[],s=n[0]-Math.ceil((t/2-n[2])/s);s<o;s++)for(n=r;n<a;n++)i.push([s,n,e]);for(this.tilesOrder=i,this._loadCount={},s=0;s<i.length;s++)n=i[s][0],t=i[s][1],this._loadCount[n+"_"+t+"_"+i[s][2]]=!1;for(s=0;s<i.length;s++)n=i[s][0],t=i[s][1],this.showTile(n,t,e)},he.prototype.showTile=function(t,e,i){this._parseDataAndDraw(t,e,i)},he.prototype.drawCurrentData=function(){this.clear();for(var t=[],e=0;e<this.tilesOrder.length;e++){var i=this.tilesOrder[e][0],n=this.tilesOrder[e][1],r=this.tilesOrder[e][2],o=this.cache[this.getCacheKey(i,n,r)];if(o)for(i=this._drawFeatures(o,i,n,r),n=0;n<i.length;n++)t.push(i[n])}this.lineLayer.setData(t)},he.prototype.isAllLoaded=function(){var t,e=!0;for(t in this._loadCount)if(!this._loadCount[t]){e=!1;break}return e},he.prototype.getCacheKey=function(t,e,i){return t+"_"+e+"_"+i},he.prototype.getDataZoom=function(){var t=Math.round(this.map.getZoom());return 19<t&&(t=19),t},he.prototype._parseDataAndDraw=function(t,e,i){var n=this,r=n.map,o=r.getCenter(),a=Math.round(r.getZoom()),s=this.getCacheKey(t,e,i),u="_cbk"+(1e5*Math.random()).toFixed(0),l=this.getTileUrl(t,e,i,"BMapGL."+u);BMapGL[u]=function(l){n._loadCount[t+"_"+e+"_"+i]=!0;var h=r.getCenter(),f=Math.round(r.getZoom());h.equals(o)&&f===a?(h=l.content&&l.content.tf,l.data&&(h=l.data),n.cache[s]=h?{traffic:h,precision:l.precision}:null,n.drawTogether&&n.isAllLoaded()&&n.drawCurrentData()):f!==a&&n.clear(),delete BMapGL[u]},void 0!==n.cache[s]?(n._loadCount[t+"_"+e+"_"+i]=!0,n.drawTogether&&n.isAllLoaded()&&n.drawCurrentData()):this.request(l)},he.prototype.getTileUrl=function(t,e,i,n){return"https://sp3.baidu.com/7_AZsjOpB1gCo2Kml5_Y_DAcsMJiwa/traffic/?qt=vtraffic&x="+t+"&y="+e+"&z="+i+"&fn="+n+"&t="+(new Date).getTime()},he.prototype._drawFeatures=function(t,e,i,n){var r=10;n=Math.pow(2,18-n),this.map.getCenter();var o=this.tileSize;if(e=[e*o*n,(i+1)*o*n],i=[],t&&t.traffic){r*=t.precision,t=t.traffic,o=0;for(var a=t.length;o<a;o++){var s=t[o],u=s[1];s=this.arrFeatureStyles[s[3]];var l=u[0]/r,h=-u[1]/r,f=[];f.push([e[0]+l*n,e[1]+h*n,1]);for(var c=2,p=u.length;c<p;c+=2)l+=u[c]/r,h-=u[c+1]/r,f.push([e[0]+l*n,e[1]+h*n,1]);i.push({color:s[1],geometry:{type:"LineString",coordinates:f}})}}return i},he.prototype.request=function(t,e){if(e){var i=(1e5*Math.random()).toFixed(0);BMapGL._rd["_cbk"+i]=function(t){e&&e(t),delete BMapGL._rd["_cbk"+i]},t+="&callback=BMapGL._rd._cbk"+i}var n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.src=t,n.addEventListener?n.addEventListener("load",(function(t){t=t.target,t.parentNode.removeChild(t)}),!1):n.attachEvent&&n.attachEvent("onreadystatechange",(function(t){t=window.event.srcElement,!t||"loaded"!==t.readyState&&"complete"!==t.readyState||t.parentNode.removeChild(t)})),setTimeout((function(){document.getElementsByTagName("head")[0].appendChild(n),n=null}),1)},he.prototype.getRGBA=function(t){return t>>>=0,"rgba("+(t>>24&255)+","+(t>>16&255)+","+(t>>8&255)+","+(255&t)/256+")"},he.prototype.getLineCap=function(t){return["butt","square","round"][t]},he.prototype.getLineJoin=function(t){return["miter","bevel","round"][t]};var Af=function(t){function e(t){de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t)),t.autoUpdate=!0,t.getOptions();var i=new Uh({color:"rgba(257, 254, 47, 0.9)",minZoom:18,duration:.8,interval:.2,trailLength:.4});return t.lineLayer=i,t.children=[i],t}return ar(e,t),Pi(e,[{key:"initialize",value:function(t){Xs(e.prototype.__proto__||bi(e.prototype),"initialize",this).call(this,t),t=this.map.map;var i=new he({});i.lineLayer=this.lineLayer,this.trafficTileManager=i,i.setMap(t),i.update(),t.addEventListener("moveend",(function(){i.update()})),t.addEventListener("zoomend",(function(){i.update()})),t.addEventListener("ondraw",(function(){}))}},{key:"onOptionsChanged",value:function(t){}},{key:"onDataChanged",value:function(t){}},{key:"getDefaultOptions",value:function(){return{}}}]),e}(Mu),Tf=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.bufferData=[],t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{size:13,unit:"px",height:0,max:100,min:0}}},{key:"initialize",value:function(t){var e=this;this.gl=t;var i=this.getOptions();this.inverseMatrix=lu.create(Float64Array),this.frameBuffer=new Rs(t),this.webglLayer.map.onResize((function(){e.frameBuffer=new Rs(t)})),this.circle=fe(64),this.circleTexture=N(t,this.circle,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}),this.intensity=new A({gradient:i.gradient}),this.paletteTexture=N(t,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}),this.offlineProgram=new Ms(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform mat4 pointToPixelMatrix;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform int unit;uniform float size;uniform float max;uniform float min;attribute vec3 aPos;attribute vec2 aOffset;attribute float aCount;varying vec2 vOffset;varying float vCount;varying vec3 vPosition;void main(){vOffset=aOffset;vCount=(aCount-min)/(max-min);if(unit==1){vec2 pos=(pointToPixelMatrix*vec4(aPos.xy,0.0,1.0)).xy+aOffset.xy*size/2.0;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pos,0.0,1.0);}else{vec2 pos=aPos.xy+aOffset.xy*size;gl_Position=u_matrix*vec4(pos,0.0,1.0);}vPosition=vec3(gl_Position.z/gl_Position.w);}",fragmentShader:"varying vec2 vOffset;varying float vCount;varying vec3 vPosition;uniform sampler2D uCircle;void main(){vec4 circle=texture2D(uCircle,(vOffset+1.0)/2.0);float intensity=circle.a*vCount;if(intensity<=0.0){discard;}gl_FragColor=vec4(vPosition,intensity);}"},this),this.offlineBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.offlineIndexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.offlineVertexArray=new Ls({gl:t,program:this.offlineProgram,attributes:[{stride:24,name:"aPos",buffer:this.offlineBuffer,size:3,type:"FLOAT",offset:0},{stride:24,name:"aOffset",buffer:this.offlineBuffer,size:2,type:"FLOAT",offset:12},{stride:24,name:"aCount",buffer:this.offlineBuffer,size:1,type:"FLOAT",offset:20}]}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.program=new Ms(this.gl,{vertexShader:"attribute vec2 aPos;varying vec2 vPos;uniform float uHeight;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform sampler2D u_sampler;uniform mat4 inverseMatrix;void main(){vPos=aPos;if(uHeight<=0.0){gl_Position=vec4(aPos,0.0,1.0);}else{vec4 gray=texture2D(u_sampler,(aPos+1.0)/2.0);vec4 m0=inverseMatrix*vec4(aPos.xy,0.0,1.0);vec4 m1=inverseMatrix*vec4(aPos.xy,1.0,1.0);m0/=m0.w;m1/=m1.w;vec4 pixel=m0+(-m0.z/(m1.z-m0.z))*(m1-m0);pixel.z=uHeight*gray.a;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pixel.xyz,1.0);}}",fragmentShader:"uniform sampler2D u_sampler;uniform sampler2D u_samplerPalette;uniform float uHeight;varying vec2 vPos;void main(){vec4 gray=texture2D(u_sampler,(vPos+1.0)/2.0);float grayAlpha=gray.a;if(grayAlpha<=0.0){discard;}vec4 color=texture2D(u_samplerPalette,vec2(grayAlpha,1.0));gl_FragColor=vec4(color.rgb,grayAlpha*color.a);}"},this),this.buffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new Ls({gl:t,program:this.program,attributes:[{stride:8,name:"aPos",buffer:this.buffer,size:2,type:"FLOAT",offset:0}]}),i=[];for(var n=[],r=Math.floor(t.canvas.width/4),o=Math.floor(t.canvas.height/4),a=r+1,s=0;s<=o;s++)for(var u=0;u<=r;u++)if(i.push(2*u/r-1,2*s/o-1),u<r&&s<o){var l=a*s+u,h=a*(s+1)+u;n.push(l,l+1,h+1),n.push(l,h+1,h)}this.bufferData=i,this.buffer.updateData(new Float32Array(i)),this.indexData=n,this.indexBuffer.updateData(new Uint32Array(n))}},{key:"destroy",value:function(){this.bufferData=[]}},{key:"onOptionsChanged",value:function(t,e){var i=this.gl;i&&t.gradient!==e.gradient&&(this.intensity=new A({gradient:t.gradient}),this.paletteTexture=N(i,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}))}},{key:"onDataChanged",value:function(t){if(this.gl){var e=[],i=[];this.getOptions();for(var n=0;n<t.length;n++){var r=t[n],o=this.normizedPoint(t[n].geometry.coordinates),a=void 0===r.count?1:r.count;"properties"in r&&"count"in r.properties&&(a=r.properties.count),e.push(o[0],o[1],o[2]),e.push(-1,-1),e.push(a),e.push(o[0],o[1],o[2]),e.push(-1,1),e.push(a),e.push(o[0],o[1],o[2]),e.push(1,1),e.push(a),e.push(o[0],o[1],o[2]),e.push(1,-1),e.push(a),r=4*n,i.push(r+0,r+2,r+1),i.push(r+0,r+3,r+2)}this.offlineBufferData=e,this.offlineIndexData=i,this.offlineBuffer.updateData(new Float32Array(e)),this.offlineIndexBuffer.updateData(new Uint32Array(i))}}},{key:"render",value:function(t){var e=t.gl,i=t.matrix,n=t.pointToPixelMatrix,r=t.pixelToViewMatrix;if(t=t.projectionMatrix,this.offlineBufferData&&!(0>=this.offlineBufferData.length)){var o=this.getOptions();this.setGLState({blend:!0,blendFunc:[e.ONE,e.ONE],depthTest:!1}),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer.framebuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),this.offlineProgram.use(e),this.offlineProgram.setUniforms({u_matrix:i,uCircle:this.circleTexture,pointToPixelMatrix:n,pixelToViewMatrix:r,projectionMatrix:t,unit:"px"===o.unit?1:0,size:o.size,max:o.max,min:o.min}),this.offlineVertexArray.bind(),this.offlineIndexBuffer.bind(),e.drawElements(e.TRIANGLES,this.offlineIndexData.length,e.UNSIGNED_INT,0),e.bindFramebuffer(e.FRAMEBUFFER,null),this.program.use(e),this.vertexArray.bind(),i=this.inverseMatrix,lu.identity(i),lu.multiply(i,t,r),lu.invert(i,i),this.setGLState({blend:!1,depthTest:!0}),this.program.setUniforms({u_sampler:this.frameBuffer.framebuffer.texture,u_samplerPalette:this.paletteTexture,uHeight:o.height,pixelToViewMatrix:r,inverseMatrix:i,projectionMatrix:t}),this.indexBuffer.bind(),e.drawElements(e.TRIANGLES,this.indexData.length,e.UNSIGNED_INT,0)}}}]),e}(Ns),Mf=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),t.selectedColor=[-1,-1,-1],t.textureCache={},t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(0, 180, 0, 1.0)",edgeCount:4,unit:"m",height:1e5,type:"normal",size:5e4}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),i={normal:["attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aEdgeIndex;attribute float aPointIndex;attribute float aEdgeCount;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vEdgeIndex=aEdgeIndex;vEdgeCount=aEdgeCount;vPointIndex=aPointIndex;float z=aPos.z*uZoomUnits;float x=aPos.x;float y=aPos.y;vSize=aSize*uZoomUnits;float a=radians(360.0/aEdgeCount);float b=a/2.0;float r=vSize/cos(b);if(aEdgeIndex<0.0){float index=aPointIndex;float angle=0.0;if(mod(index,2.0)==0.0){angle=a*(index/2.0)-b;}else{angle=-a*((index-1.0)/2.0)-b;}y=y+r*sin(angle);x=x+r*cos(angle);}else{float i=aEdgeIndex-1.0;float j=aPointIndex;float angle=a*i+b;y=y+r*sin(angle);x=x+r*cos(angle);}vPosition=vec4(aPos,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;if(aEdgeIndex==1.0&&aPointIndex==1.0){gl_PointSize=20.0;}else{gl_PointSize=10.0;}\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}","varying vec4 vColor;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;varying vec4 vPosition;varying vec4 vFragPosition;uniform mat4 uMatrix;void main(){vec4 color=vColor;if(vEdgeIndex<0.0){color.r+=0.2;color.g+=0.2;color.b+=0.2;}else{float i=ceil(vEdgeIndex);;float d=i/vEdgeCount*0.5;if(i<=vEdgeCount/2.0){d=0.2*(i/vEdgeCount*0.5)-0.1;}else{d=0.2*(vEdgeCount-i)/vEdgeCount*0.5-0.1;}color.r+=d;color.g+=d;color.b+=d;}gl_FragColor=color;}"],light:["attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aEdgeIndex;attribute float aPointIndex;attribute float aEdgeCount;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vEdgeIndex=aEdgeIndex;vEdgeCount=aEdgeCount;vPointIndex=aPointIndex;float z=aPos.z*uZoomUnits;float x=aPos.x;float y=aPos.y;vSize=aSize*uZoomUnits;float a=radians(360.0/aEdgeCount);float b=a/2.0;float i=aEdgeIndex;float j=aPointIndex;float angle=a*(i-1.0)+b;float r=vSize/cos(b);y=y+r*sin(angle);x=x+r*cos(angle);if(j==1.0){z=0.0;}vPosition=vec4(aPos.xyz,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}","varying vec4 vColor;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;varying vec4 vPosition;varying vec4 vFragPosition;uniform mat4 uMatrix;void main(){vec4 color=vColor;color.a=1.0-vFragPosition.z/vPosition.z;gl_FragColor=color;}"]};i=i[e.type]||i.normal,this.program=new Ms(this.gl,{vertexShader:i[0],fragmentShader:i[1],defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:44,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:44,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:12},{stride:44,name:"aEdgeIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:16},{stride:44,name:"aPointIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:20},{stride:44,name:"aEdgeCount",buffer:this.buffer,size:1,type:"FLOAT",offset:24},{stride:44,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:28}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&e&&(this.uniforms={},this.data=e,this.options=t,this.processData(),t.enablePicked&&this.parsePickData(e))}},{key:"processData",value:function(){var t=[],e=[];"light"===this.options.type?this.createLightBuffer(this.data,t,e):this.createNormalBuffer(this.data,t,e),this.bufferData=t,this.indexData=e,this.buffer.updateData(new Float32Array(t)),this.indexBuffer.updateData(new Uint32Array(e))}},{key:"createNormalBuffer",value:function(t,e,i){var n=this,r=parseInt(this.options.edgeCount,10)||4;t.forEach((function(t,o){var a=t.color||n.options.color,s=t.size||n.options.size,u=Array.isArray(t.value)?t.value:"number"===typeof t.value?[t.value]:[1],l=n.normizedPoint(t.geometry.coordinates),h=t.height||n.options.height,f=u.reduce((function(t,e){return Number(t)+Number(e)})),c=0,p="blue";for(u.forEach((function(t,o){p=n.normizedColor("function"===typeof a?a(t,o,u):Array.isArray(a)?a[o]:a),t="function"===typeof h?h(t,o,u):Array.isArray(h)?h[o]:h/f*t;var d=i[i.length-1],v=e.length/11;for(0<v&&(1===r%2&&0===o?i.push(d,d,v):i.push(d,v)),o=1;o<=2*r;o++)0===o%2?e.push.apply(e,[l[0],l[1],c,s,o/2,2,r].concat(Lr(p))):e.push.apply(e,[l[0],l[1],c+t,s,(o+1)/2,1,r].concat(Lr(p))),i.push(v+o-1),o===2*r&&(e.push.apply(e,[l[0],l[1],c+t,s,o/2+1,1,r].concat(Lr(p))),e.push.apply(e,[l[0],l[1],c,s,o/2+1,2,r].concat(Lr(p))),i.push(v+o,v+o+1));c+=t})),o=i[i.length-1],t=e.length/11,0<t&&i.push(o,t),o=1;o<=r;o++)e.push.apply(e,[l[0],l[1],c,s,-1,o,r].concat(Lr(p))),i.push(t+o-1)}))}},{key:"createLightBuffer",value:function(t,e,i){var n=this,r=parseInt(this.options.edgeCount,10)||4;t.forEach((function(t,o){o=t.color||n.options.color,o=n.normizedColor("function"===typeof o?o(t.value):"string"===typeof o?o:"blue");var a=t.size||n.options.size,s=n.normizedPoint(t.geometry.coordinates),u=t.height||n.options.height;for(u="function"===typeof u?u(t.value):u,t=1;t<=r;t++){var l=i[i.length-1],h=e.length/11;for(0<h&&i.push(l,h),l=1;l<=2*r;l++)0===l%2?e.push.apply(e,[s[0],s[1],u,a,l/2,1,r].concat(Lr(o))):e.push.apply(e,[s[0],s[1],u,a,(l+1)/2,2,r].concat(Lr(o))),i.push(h+l-1),l===2*r&&i.push(h,h+1)}}))}},{key:"render",value:function(t){var e=this.program,i=t.gl,n=t.matrix;this.setGLState({cullFace:"normal"===this.options.type}),e.use(i),this.vertexArray.bind(),this.indexBuffer.bind();var r=this.map.getZoomUnits();di(this.uniforms,this.getCommonUniforms(t),{uZoomUnits:"px"===this.options.unit?r:1,uMatrix:n}),e.setUniforms(this.uniforms),i.drawElements(i.TRIANGLE_STRIP,this.indexData.length,i.UNSIGNED_INT,0)}}]),e}(Ns),Pf=function(t){function e(t){de(this,e);var i=Qn(this,(e.__proto__||bi(e)).call(this,t));return t=i.getOptions(),i.fillPoint=new Sh({enablePicked:t.enablePicked,autoSelect:t.autoSelect}),i.shadowPoint=new Sh,i.textPoint=new mh,i.children=[i.shadowPoint,i.fillPoint,i.textPoint],i}return ar(e,t),Pi(e,[{key:"pick",value:function(t,e){return this.fillPoint.pick(t,e)}},{key:"onOptionsChanged",value:function(t){this.shadowPoint.setOptions({depthTest:!1,polygonOffset:[1,1],color:t.shadowColor,size:t.shadowSize,borderWidth:t.shadowBorderWidth,borderColor:t.shadowBorderColor}),this.fillPoint.setOptions({onClick:function(e){t.onClick&&t.onClick(e)},selectedIndex:t.selectedIndex,selectedColor:t.selectedColor,depthTest:!1,color:t.fillColor,size:t.fillSize,borderWidth:t.fillBorderWidth,borderColor:t.fillBorderColor}),this.textPoint.setOptions({collides:!1,polygonOffset:[-1,-1],color:t.fontColor,fontFamily:t.fontFamily,fontSize:t.fontSize})}},{key:"onDataChanged",value:function(t){var e=this,i=this.getOptions(),n=JSON.parse(Ir(t)).map((function(t){return t.properties.size=e.getProperty("shadowSize",i.shadowSize,t),t.properties.color=e.getProperty("shadowColor",i.shadowColor,t),t.properties.borderColor=e.getProperty("shadowBorderColor",i.shadowBorderColor,t),t.properties.borderWidth=e.getProperty("shadowBorderWidth",i.shadowBorderWidth,t),t})),r=JSON.parse(Ir(t)).map((function(t){return t.properties.size=e.getProperty("fillSize",i.fillSize,t),t.properties.color=e.getProperty("fillColor",i.fillColor,t),t.properties.borderColor=e.getProperty("fillBorderColor",i.fillBorderColor,t),t.properties.borderWidth=e.getProperty("fillBorderWidth",i.fillBorderWidth,t),t}));this.shadowPoint.setData(n),this.fillPoint.setData(r),this.textPoint.setData(t)}},{key:"getProperty",value:function(t,e,i){return"[object Function]"===Object.prototype.toString.call(e)?e(i):(e=i[t]||e,"properties"in i&&t in i.properties&&(e=i.properties[t]),e)}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ffff00",autoSelect:!0,fillColor:"rgba(255, 50, 10, 1)",fillSize:20,fillBorderColor:"#ffffff",fillBorderWidth:1.2,shadowColor:"rgba(255, 80, 110, 0.7)",shadowSize:40,shadowBorderColor:"rgba(255, 80, 110, 1)",shadowBorderWidth:1.2,fontSize:12,fontFamily:"Microsoft Yahei",fontColor:"#ffffff"}}}]),e}(Mu),Sf=function(t){function e(){return de(this,e),Qn(this,(e.__proto__||bi(e)).apply(this,arguments))}return ar(e,t),Pi(e,[{key:"toBBox",value:function(t){var e=xr(t.item.geometry.coordinates,2);return t=e[0],e=e[1],{minX:t,minY:e,maxX:t,maxY:e}}},{key:"compareMinX",value:function(t,e){return t.item.geometry.coordinates[0]-e.item.geometry.coordinates[0]}},{key:"compareMinY",value:function(t,e){return t.item.geometry.coordinates[1]-e.item.geometry.coordinates[1]}}]),e}(gh),Ef=function(t){function e(t,i){return de(this,e),t=Qn(this,(e.__proto__||bi(e)).call(this,t,i)),i=t.canvas=document.createElement("canvas"),t.ctx=i.getContext("2d"),t.geoRBush=new Sf,t}return ar(e,t),Pi(e,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,flat:!1,collides:!0,unit:"px",angle:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0],itemDimension:[20,20],renderItem:this.defaultOptionRenderItem}}},{key:"defaultOptionRenderItem",value:function(t,e,i){i.fillStyle="red",i.fillRect(e.x,e.y,e.w,e.h)}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new Ms(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***\u70b9A(x,y)\uff0c\u7ed5\u539f\u70b9\u987a\u65f6\u9488\u65cb\u8f6c\u89d2\u5ea6a\u65b0\u5750\u6807\u7684\u8ba1\u7b97\u516c\u5f0f*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)+size.x*sin(rotation);}else if(corner==2.0){x+=size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)-size.x*sin(rotation);}else if(corner==3.0){x+=size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)-size.x*sin(rotation);}else{x+=-size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)+size.x*sin(rotation);}return vec3(x,y,coord.z);}void main(){vTextCoord=aTextCoord;if(uFlat){vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}else{vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio*scale;vec3 current=transformCoord(screen,halfSize,corner);current.z+=zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:"precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new Es({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new Es({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new Ls({gl:t,program:this.program,attributes:e})}},{key:"destroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.canvas=this.cachedData=this.options=this.data=this.indexBuffer=this.uvBuffer=this.vertexBuffer=this.program=this.vertexArray=null}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){for(this.cachedData=[],t=0;t<e.length;t++){var i=e[t],n=this.normizedPoint(i.geometry.coordinates);n&&this.cachedData.push({point:n,item:i,extra:{},index:t})}this.geoRBush.load(this.cachedData)}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,i=t.matrix,n=this.getOptions(),r=this.program;r.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite});var o=this.map.getZoomUnits();r.setUniforms(di(this.getCommonUniforms(t),{matrix:i,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,uFlat:n.flat,offset:n.offset,zoomUnits:o,zIndex:n.zIndex,uUnitPx:"px"===n.unit})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){var e=this;clearTimeout(this.throttleTimer),300<(new Date).getTime()-this.lastUpdateTime?(this.updateText(t),this.lastUpdateTime=(new Date).getTime()):this.throttleTimer=setTimeout((function(){e.updateText(t),e.lastUpdateTime=(new Date).getTime()}),200)}},{key:"updateText",value:function(t){var e=t.gl,i=t.matrix,n=this.getOptions(),r=n.padding,o=n.margin,a=n.collides;t=n.enablePicked;var s=n.itemDimension,u=n.beforeRenderAll,l=n.beforeComputeDimension;n=n.renderItem;var h=this.map.getBounds(),f=e.canvas.width/window.devicePixelRatio,c=e.canvas.height/window.devicePixelRatio,p=this.canvas;e=this.ctx,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),l&&l(e),h=this.geoRBush.search({minX:h.sw.lng,minY:h.sw.lat,maxX:h.ne.lng,maxY:h.ne.lat});var d=new gh;l=[];for(var v=0;v<h.length;v++){var g=h[v],m=g.point,y=g.item,x=g.extra;g=g.index;var b=xr(m,3);b=ru.clone([b[0],b[1],b[2],1]),ru.transformMat4(b,b,i),ru.scale(b,b,1/b[3]);var _=(b[0]+1)/2*f,w=(1-b[1])/2*c,A=Array.isArray(s)?s:s(y,e,x);b=A[0]+2*r[0],A=A[1]+2*r[1];var T=b+o[0],M=A+o[1];if(_-=T/2,w-=M/2,T=_+T,M=w+M,!(0>T||0>M||_>f||w>c)){if(a){if(M={minX:_,maxX:T,minY:w,maxY:M},d.collides(M))continue;d.insert(M)}l.push({w:b,h:A,point:m,item:y,extra:x,dataIndex:g})}}for(e.restore(),r=te(l),i=r.w,r=r.h,0>=i&&(i=1),0>=r&&(r=1),p.width=i*window.devicePixelRatio,p.height=r*window.devicePixelRatio,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),u&&u(e),u=[],p=[],o=[],a=[],s=0,f=l.length;s<f;++s){for(c=l[s],n(c.item,c,e,c.extra),v=xr(c.point,3),h=v[0],d=v[1],v=v[2],m=0;4>m;m++)u.push(h,d,v),u.push(m),u.push(c.w,c.h),u.push(1,0);h=c.x/i,d=(c.x+c.w)/i,v=(c.y+c.h)/r,m=c.y/r,p.push(h,v,h,m,d,m,d,v),h=4*s,o.push(h,h+2,h+1,h,h+3,h+2),t&&(c=this.indexToRgb(c.dataIndex),a.push(c[0]/255,c[1]/255,c[2]/255),a.push(c[0]/255,c[1]/255,c[2]/255),a.push(c[0]/255,c[1]/255,c[2]/255),a.push(c[0]/255,c[1]/255,c[2]/255))}e.restore(),this.loadTexture(),this.index=o,this.vertexBuffer.updateData(new Float32Array(u)),this.uvBuffer.updateData(new Float32Array(p)),this.indexBuffer.updateData(new Uint32Array(o)),t&&this.pickBuffer.updateData(new Float32Array(a))}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e}),{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),e}(Ns),Cf=function(){function t(e){de(this,t),this.layers=[],this.options=e,this.webglLayer=e.webglLayer}return Pi(t,[{key:"addLayer",value:function(t){for(var e=!1,i=0;i<this.layers.length;i++)if(this.layers[i]===t){e=!0;break}e||(t.map=this.webglLayer.map,"threeLayer"===t.layerType?(t.setWebglLayer(this.webglLayer),e=t.getThreeLayer(),this.addLayer(e),t.initialize&&t.initialize(e)):(t.setWebglLayer(this.webglLayer),t.commonInitialize&&t.commonInitialize(this.webglLayer.gl),t.initialize&&t.initialize(this.webglLayer.gl),t.onOptionsChanged(t.getOptions(),{}),t.onDataChanged(t.getData()),t.onChanged(t.getOptions(),t.getData())),this.layers.push(t)),this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"removeLayer",value:function(t){for(var e=0;e<this.layers.length;e++)this.layers[e]===t&&this.layers.splice(e,1);this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"showLayer",value:function(t){for(var e=0;e<this.layers.length;e++)this.layers[e]===t&&t.show();this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"hideLayer",value:function(t){for(var e=0;e<this.layers.length;e++)this.layers[e]===t&&t.hide();this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"removeAllLayers",value:function(){this.layers=[],this.webglLayer.stopAnimation(),this.webglLayer.render()}},{key:"destroyAllLayers",value:function(){for(var t=0;t<this.layers.length;t++){var e=this.layers[t];e.destroy&&e.destroy()}}},{key:"getAllLayers",value:function(){return this.layers}},{key:"getAllThreeLayers",value:function(){for(var t=[],e=0;e<this.layers.length;e++){var i=this.layers[e];"ThreeLayer"===i.layerType&&t.push(i)}return t}},{key:"isRequestAnimation",value:function(){for(var t=!1,e=0;e<this.layers.length;e++)if(this.layers[e].isRequestAnimation()){t=!0;break}return t}},{key:"beforeRender",value:function(t){t.gl&&this.webglLayer.stateManager.setDefaultState()}},{key:"afterRender",value:function(t){(t=t.gl)&&(t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.useProgram(null))}},{key:"renderGLLayers",value:function(t){this.webglLayer.stateManager.save();for(var e=0;e<this.layers.length;e++){var i=this.layers[e];if(!0===i._visible&&"threeLayer"!==i.layerType&&"ThreeLayer"!==i.layerType){var n=i.map.getZoom(),r=i.getOptions().zoomThreshold;r&&(n<r[0]||n>=r[1])||(this.beforeRender(t),i.render(t),this.afterRender(t))}}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayer",value:function(t){this.webglLayer.stateManager.save(),this.webglLayer.stateManager.setState({blend:!0,blendFunc:[t.gl.SRC_ALPHA,t.gl.ONE],depthMask:!1,depthTest:!0,depthFunc:t.gl.LESS,cullFace:!1});for(var e=0;e<this.layers.length;e++){var i=this.layers[e];if(!0===i._visible&&"ThreeLayer"===i.layerType){var n=i.map.getZoom(),r=i.getOptions().zoomThreshold;r&&(n<r[0]||n>=r[1])||i.render(t)}}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayers",value:function(t){this.webglLayer.stateManager.save(),this.webglLayer.stateManager.setState({blend:!0,blendFunc:[t.gl.SRC_ALPHA,t.gl.ONE],depthMask:!1,depthTest:!0,depthFunc:t.gl.LESS,cullFace:!1});for(var e=0;e<this.layers.length;e++){var i=this.layers[e];if(!0===i._visible&&"threeLayer"===i.layerType){var n=i.map.getZoom(),r=i.getOptions().zoomThreshold;r&&(n<r[0]||n>=r[1])||i.render(t)}}this.webglLayer.stateManager.restore()}},{key:"onClick",value:function(t){for(var e=0;e<this.layers.length;e++){var i=this.layers[e];if(!0===i._visible&&"threeLayer"!==i.layerType&&"ThreeLayer"!==i.layerType){var n=i.map.getZoom(),r=i.getOptions().zoomThreshold;r&&(n<=r[0]||n>=r[1])||!i.options.enablePicked||!i.options.onClick||!i.pick||(n=i.pick(t.x,t.y),i.options.onClick(n,t),i.options.autoSelect&&this.webglLayer.render())}}}},{key:"onDblClick",value:function(t){for(var e=0;e<this.layers.length;e++){var i=this.layers[e];if(!0===i._visible&&"threeLayer"!==i.layerType&&"ThreeLayer"!==i.layerType){var n=i.map.getZoom(),r=i.getOptions().zoomThreshold;r&&(n<=r[0]||n>=r[1])||!i.options.enablePicked||!i.options.onDblClick||!i.pick||(n=i.pick(t.x,t.y),i.options.onDblClick(n,t),i.options.autoSelect&&this.webglLayer.render())}}}},{key:"onRightClick",value:function(t){for(var e=0;e<this.layers.length;e++){var i=this.layers[e];if(!0===i._visible&&"threeLayer"!==i.layerType&&"ThreeLayer"!==i.layerType){var n=i.map.getZoom(),r=i.getOptions().zoomThreshold;r&&(n<=r[0]||n>=r[1])||!i.options.enablePicked||!i.options.onRightClick||!i.pick||(n=i.pick(t.x,t.y),i.options.onRightClick(n,t),i.options.autoSelect&&this.webglLayer.render())}}}},{key:"onMousemove",value:function(t){for(var e=!1,i=0;i<this.layers.length;i++){var n=this.layers[i];if(!0===n._visible&&"threeLayer"!==n.layerType&&"ThreeLayer"!==n.layerType){var r=n.map.getZoom(),o=n.getOptions().zoomThreshold;o&&(r<=o[0]||r>=o[1])||!n.options.enablePicked||!n.pick||(r=n.pick(t.x,t.y),this.webglLayer.map.map.platform.style.cursor=-1===r.dataIndex?"default":"pointer",n.options.onMousemove&&n.options.onMousemove(r,t),n.options.autoSelect&&(e=!0))}}e&&(this.webglLayer.isAnimation||this.webglLayer.render())}},{key:"destroy",value:function(){this.destroyAllLayers(),this.removeAllLayers()}}]),t}(),Lf=function(){function t(e){var i=this;de(this,t),this.options={autoUpdate:!0},this._visible=!0,di(this.options,e);var n=e.pointOffset;this.webglLayer=e.webglLayer||new Ph(e.map,this.options),this.layerManager=new Cf({autoUpdate:this.options.autoUpdate,webglLayer:this.webglLayer}),this.effectManager=new Us(this.webglLayer.gl),this.webglRender={render:function(){}},this.options.effects&&this.effectManager.setEffects([this.webglRender].concat(this.options.effects)),this.webglLayer.onRender((function(t){i._render(t)})),this.webglLayer.onClick=function(t){i._visible&&i.layerManager.onClick(t)},this.webglLayer.onDblClick=function(t){i._visible&&i.layerManager.onDblClick(t)},this.webglLayer.onRightClick=function(t){i._visible&&i.layerManager.onRightClick(t)},this.webglLayer.onMousemove=function(t){i._visible&&i.layerManager.onMousemove(t)},n||"cesium"===this.webglLayer.options.mapType||(n=this.webglLayer.map.getCenter(),this.webglLayer.options.pointOffset=[n.lng,n.lat]),this.webglLayer.map.onResize((function(){i.effectManager.onResize()})),(this.postProcessing=e.postProcessing)&&(this.postProcessing.setWebglLayer(this.webglLayer),e=this.postProcessing.getThreeLayer(),this.addLayer(e),this.postProcessing.initialize(e),e.postProcessing=this.postProcessing)}return Pi(t,[{key:"renderCanvas",value:function(t){var e=this;this.postProcessing?this.postProcessing.addRender((function(){e.layerManager.renderGLLayers(t)})):this.layerManager.renderGLLayers(t),this.layerManager.renderThreeLayers(t),this.layerManager.renderThreeLayer(t)}},{key:"render",value:function(){this.webglLayer&&this.webglLayer.render()}},{key:"_render",value:function(t){var e=this;if(this._visible){var i=this.options.effects;i&&0<i.length?(this.webglRender.render=function(){e.renderCanvas(t)},this.effectManager.render()):(this.webglLayer.saveFramebuffer(),this.renderCanvas(t),this.webglLayer.restoreFramebuffer())}}},{key:"onRender",value:function(t){this.webglLayer.onRender(t)}},{key:"destroy",value:function(){this.stopAnimation(),this.layerManager.destroy(),this.effectManager.destroy(),this.webglLayer.destroy()}},{key:"isRequestAnimation",value:function(){return this.layerManager.isRequestAnimation()}},{key:"startAnimation",value:function(){this.webglLayer.startAnimation()}},{key:"stopAnimation",value:function(){this.webglLayer.stopAnimation()}},{key:"show",value:function(){!0!==this._visible&&(this._visible=!0,this.webglLayer.render(),this.isRequestAnimation()&&this.startAnimation())}},{key:"hide",value:function(){!1!==this._visible&&(this._visible=!1,this.stopAnimation(),this.webglLayer.clear())}},{key:"showLayer",value:function(t){this.layerManager.showLayer(t)}},{key:"hideLayer",value:function(t){this.layerManager.hideLayer(t)}},{key:"add",value:function(t){this.addLayer(t)}},{key:"remove",value:function(t){this.removeLayer(t)}},{key:"addLayer",value:function(t){this.layerManager.addLayer(t)}},{key:"removeLayer",value:function(t){this.layerManager.removeLayer(t)}},{key:"removeAllLayers",value:function(){this.layerManager.removeAllLayers()}},{key:"getAllLayers",value:function(){return this.layerManager.getAllLayers()}},{key:"getAllThreeLayers",value:function(){return this.layerManager.getAllThreeLayers()}}]),t}();window._hmt=window._hmt||[],function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?e8002ef3d9e0d8274b5b74cc4a027d08";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}(),e.View=Lf,e.CanvasLayer=i,e.CircleLayer=function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return de(this,t),Zs.includes(e.type)?new Ws(e):new js(e)},e.GridLayer=Tu,e.HeatGridLayer=Pu,e.ShapeLayer=Au,e.SimpleLineLayer=Su,e.LineLayer3D=Nu,e.LineLayer=Wu,e.WallSpriteLayer=Yu,e.LinePointLayer=hh,e.WallLayer=ch,e.WallTripLayer=dh,e.HeatLineLayer=vh,e.HoneycombLayer=xh,e.WebglLayer=Ph,e.PointLayer=Sh,e.GroundRippleLayer=Eh,e.RippleLayer=Ch,e.SparkLayer=Lh,e.ClusterLayer=kh,e.HeatPointLayer=Oh,e.ShapeLineLayer=Dh,e.PointTripLayer=zh,e.LineTripLayer=Fh,e.IconCollidesLayer=Ih,e.LineFlowLayer=Uh,e.TileLayer=Nh,e.IconLayer=Rh,e.BoardLayer=jh,e.PolygonLayer=Hh,e.CarLineLayer=wf,e.Layer=Ns,e.TextLayer=mh,e.TrafficLayer=Af,e.GltfLayer=bf,e.HeatmapLayer=Tf,e.BarLayer=Mf,e.MarkerListLayer=Pf,e.PointCanvasCustomLayer=Ef,e.FXAA=Os,e.SMAA=Ds,e.BlurEffect=Bs,e.BloomEffect=zs,e.BrightEffect=Fs,e.DepthEffect=Is,e.EffectManager=Us,e.getContext=U,e.createTexture=N,e.loadTextureImage=j,e.FrameBufferObject=Rs,e.Program=Ms,e.StateManager=Ss,e.Buffer=Es,e.VertexArray=Ls,e.CommonLayer=Ts,e.MercatorProjection=y,e.Canvas=w,e.Intensity=A,e.BezierCurve=T,e.GeodesicCurve=P,e.OdCurve=eo,e.utilCity={getProvinceNameByCityName:function(t){for(var e=0;e<no.length;e++)for(var i=no[e].n,n=no[e].cities,r=0;r<n.length;r++)if(n[r].n==t)return i;return null},getCenterByCityName:function(t){t=t.replace("\u5e02","");for(var e=0;e<io.length;e++)if(io[e].n==t)return E(io[e].g);for(e=0;e<ro.length;e++)if(ro[e].n==t)return E(ro[e].g);for(e=0;e<no.length;e++){if(no[e].n==t)return E(no[e].g);for(var i=no[e].cities,n=0;n<i.length;n++)if(i[n].n==t)return E(i[n].g)}return null}},e.isMobile=ao,e.Encryptor={encode:function(t){t=As.deflateRaw(t);for(var e=[],i=0;i<t.length;i++)e.push(23^t[i]);return new Uint8Array(e)},decode:function(t){t=new Uint8Array(t);for(var e=[],i=0;i<t.length;i++)e.push(23^t[i]);t=new Uint8Array(e);try{var n=window.flate.deflate_decode_raw(t);return new TextDecoder("utf-8").decode(n)}catch(r){return console.warn("inflate by pako!"),As.inflateRaw(t,{to:"string"})}},download:function(t,e){var i=new Blob([t],{type:"application/octet-binary"});t=document.createElement("a"),i=window.URL.createObjectURL(i),t.href=i,t.download=e||"mapvgl_download",t.click()}},e.toRadian=p,e.toAngle=d,e.ceilPowerOfTwo=v,e.floorPowerOfTwo=g,e.approximatelyEqual=m,e.__moduleExports=nu,e.vec4=ru,e.vec3=ou,e.vec2=au,e.quat2=su,e.quat=uu,e.mat4=lu,e.mat3=hu,e.mat2d=fu,e.mat2=cu,e.glMatrix=pu,Object.defineProperty(e,"__esModule",{value:!0})}))}).call(this,i("IyRk"))},"5Phx":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("knqi"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){return s(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return l(e,t),n(e,[{key:"getControl",value:function(){return new BMap.PanoramaControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset"]}}]),e}(o.default);e.default=h},"61/Q":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={0:"#fff",1:"#00dc35",2:"#f3e032",3:"#ff6c6c",4:"#900000"},r={drawRoads:function(t,e,i){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=t.getZoom(),s=o.lineWidth||5,u=void 0===o.level?1:o.level,l=null,h=0,f=0,c=[],p=[],d=[],v=0,g=0;e.beginPath();var m=Math.pow(2,18-t.getZoom()),y=t.getMapType().getProjection(),x=y.lngLatToPoint(t.getCenter()),b=new BMap.Pixel(x.x-t.getSize().width/2*m,x.y+t.getSize().height/2*m);return i.forEach((function(i,n){var a=null;l=null;for(var s=i.split(","),u=0;u<s.length;u+=2){var y=new BMap.Point(s[u],s[u+1]);p.push(y),r="bd09mc"===o.coordType?{x:(y.lng-b.x)/m,y:(b.y-y.lat)/m}:t.pointToPixel(y);var x=void 0;if(l){var _=r.x-l.x,w=r.y-l.y;h=Math.sqrt(_*_+w*w),f+=h,o.arrow&&(v+=h,g+=h,x={start:l,end:r,offset:50-(v-h),depth:h,totalDepth:g},c.push(x),v>=50&&(d.push(x),v%=50))}l=r,0===u?(a=a||r,e.moveTo(r.x,r.y)):(f>15||u>=s.length-2)&&(f=0,e.lineTo(r.x,r.y))}if(o.arrow&&n===i.length-1&&g<100){var A=c[Math.ceil(c.length/2)];for(var T in c)if(c[T].totalDepth>=g/2){A=c[T+1]?c[T+1]:c[T];break}var M=c[c.length-1];A.end=M.end,d=[],d.push(A)}})),o.line&&(e.lineCap=o.lineCap||"round",e.lineJoin="round",o.border&&(e.strokeStyle=o.border.color||"white",e.lineWidth=(a<=13?s-2:s)+(2*o.border.lineWidth||4),e.stroke()),e.strokeStyle=o.color||n[u]||"#fc2c2b",e.lineWidth=a<=13?s-2:s,e.stroke()),o.arrow&&this.drawArrow(e,d,o),p},drawArrow:function(t,e,i){t.beginPath(),e.forEach((function(n){var r=n.start.x,o=n.start.y,a=n.end.x,s=n.end.y,u=a-r,l=s-o,h=[0,-1],f=[n.end.x-n.start.x,n.end.y-n.start.y],c=h[0]*f[0]+h[1]*f[1],p=Math.sqrt(h[0]*h[0]+h[1]*h[1]),d=Math.sqrt(f[0]*f[0]+f[1]*f[1]),v=Math.acos(c/(p*d));f[0]<0&&(v=2*Math.PI-v);var g=i.arrow.width/2||2,m=i.arrow.height||g,y=0;while(n.offset+50*y<=n.depth){var x=n.offset+50*y,b=x/n.depth;t.save(),t.translate(r+u*b,o+l*b),t.rotate(v),t.moveTo(1.618*-g,m),t.lineTo(0,0),t.lineTo(1.618*g,m),t.restore(),y+=1}1===e.length&&n.offset>n.depth&&(t.save(),t.translate(r,o),t.rotate(v),t.moveTo(1.618*-g,m),t.lineTo(0,0),t.lineTo(1.618*g,m),t.restore())})),t.strokeStyle=i.arrow.color||"#fff",t.lineWidth=3,t.stroke()}};e.default=r},"6SCh":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("q1tI"),o=(u(r),i("wjnM")),a=u(o),s=i("/flU");function u(t){return t&&t.__esModule?t:{default:t}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function f(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=function(t){function e(t){l(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return f(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.lineLayer.destroy(),this.lineLayer=null,this.pointLayer.destroy(),this.pointLayer=null,this.textLayer.destroy(),this.textLayer=null,this.animationLayer&&(this.animationLayer.destroy(),this.animationLayer=null)}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map;this.lineDataSet=new s.DataSet([]),this.lineLayer=new s.baiduMapLayer(t,this.lineDataSet,{}),this.pointDataSet=new s.DataSet([]),this.pointLayer=new s.baiduMapLayer(t,this.pointDataSet,{}),this.textLayer=new s.baiduMapLayer(t,this.pointDataSet,{}),this.props.enableAnimation&&(this.animationLayer=new s.baiduMapAnimationLayer(t,this.lineDataSet,{}))}},{key:"initialize",value:function(){var t=this,e=this.map=this.props.map;if(e){this._createLayer||this.createLayers();var i=[],n=[];if(this.props.data){var r=[],o=e.getMapType().getProjection();this.props.data.forEach((function(a,u){var l=a.from.point||s.utilCityCenter.getCenterByCityName(a.from.city),h=a.to.point||s.utilCityCenter.getCenterByCityName(a.to.city),f=s.utilCurve.getPoints([l,h]);"bd09mc"===t.props.coordType?(r.push(o.pointToLngLat(new BMap.Pixel(l.lng,l.lat))),r.push(o.pointToLngLat(new BMap.Pixel(h.lng,h.lat)))):(r.push(l),r.push(h)),i.push({strokeStyle:a.color,geometry:{type:"LineString",coordinates:f}}),!1!==t.props.showToPoint&&n.push({fillStyle:a.color,text:a.to.name||a.to.city,geometry:{type:"Point",coordinates:[h.lng,h.lat]}}),!1!==t.props.showFromPoint&&n.push({fillStyle:a.color,text:a.from.name||a.from.city,geometry:{type:"Point",coordinates:[l.lng,l.lat]}}),r.length>0&&!1!==t.props.autoViewport&&e.setViewport(r,t.props.viewportOptions)}))}this.lineDataSet.set(i),this.lineLayer.update({options:this.props.lineOptions||{draw:"simple",strokeStyle:"#5E87DB",lineWidth:3}}),this.pointDataSet.set(n),this.pointLayer.update({options:this.props.pointOptions||{coordType:this.props.coordType,draw:"simple",fillStyle:"#5E87DB",size:5}}),this.textLayer.update({options:this.props.textOptions||{coordType:this.props.coordType,draw:"text",font:"18px Arial",offset:{x:0,y:12},fillStyle:"#333",size:12}}),this.props.enableAnimation?this.animationLayer.update({options:this.props.animationOptions||{coordType:this.props.coordType,fillStyle:"rgba(255, 250, 250, 0.9)",lineWidth:0,size:4,animateTime:50,draw:"simple"}}):this.animationLayer&&this.animationLayer.hide()}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(a.default);e.default=c},"7kb5":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("izp9");Object.defineProperty(e,"Map",{enumerable:!0,get:function(){return L(n).default}});var r=i("3DSc");Object.defineProperty(e,"Marker",{enumerable:!0,get:function(){return L(r).default}});var o=i("UhY/");Object.defineProperty(e,"MarkerOrderTip",{enumerable:!0,get:function(){return L(o).default}});var a=i("Rk3l");Object.defineProperty(e,"InfoWindow",{enumerable:!0,get:function(){return L(a).default}});var s=i("GunY");Object.defineProperty(e,"NavigationControl",{enumerable:!0,get:function(){return L(s).default}});var u=i("HMcu");Object.defineProperty(e,"OverviewMapControl",{enumerable:!0,get:function(){return L(u).default}});var l=i("+JO1");Object.defineProperty(e,"ScaleControl",{enumerable:!0,get:function(){return L(l).default}});var h=i("OWd1");Object.defineProperty(e,"MapTypeControl",{enumerable:!0,get:function(){return L(h).default}});var f=i("5Phx");Object.defineProperty(e,"PanoramaControl",{enumerable:!0,get:function(){return L(f).default}});var c=i("MYe1");Object.defineProperty(e,"Circle",{enumerable:!0,get:function(){return L(c).default}});var p=i("U0UX");Object.defineProperty(e,"Polyline",{enumerable:!0,get:function(){return L(p).default}});var d=i("kkFa");Object.defineProperty(e,"Polygon",{enumerable:!0,get:function(){return L(d).default}});var v=i("TQnn");Object.defineProperty(e,"Road",{enumerable:!0,get:function(){return L(v).default}});var g=i("O5lx");Object.defineProperty(e,"Boundary",{enumerable:!0,get:function(){return L(g).default}});var m=i("oScK");Object.defineProperty(e,"MarkerList",{enumerable:!0,get:function(){return L(m).default}});var y=i("auZS");Object.defineProperty(e,"MapvMarkerList",{enumerable:!0,get:function(){return L(y).default}});var x=i("qj4C");Object.defineProperty(e,"TrafficLayer",{enumerable:!0,get:function(){return L(x).default}});var b=i("BgC/");Object.defineProperty(e,"Merge",{enumerable:!0,get:function(){return L(b).default}});var _=i("rOZD");Object.defineProperty(e,"MapvLayer",{enumerable:!0,get:function(){return L(_).default}});var w=i("aDLU");Object.defineProperty(e,"MapvglLayer",{enumerable:!0,get:function(){return L(w).default}});var A=i("mQdh");Object.defineProperty(e,"MapvglView",{enumerable:!0,get:function(){return L(A).default}});var T=i("4B5P");Object.defineProperty(e,"DrivingRoute",{enumerable:!0,get:function(){return L(T).default}});var M=i("LrII");Object.defineProperty(e,"PointLabel",{enumerable:!0,get:function(){return L(M).default}});var P=i("6SCh");Object.defineProperty(e,"Arc",{enumerable:!0,get:function(){return L(P).default}});var S=i("IqaO");Object.defineProperty(e,"ThickRay",{enumerable:!0,get:function(){return L(S).default}});var E=i("Schx");Object.defineProperty(e,"MapListener",{enumerable:!0,get:function(){return L(E).default}});var C=i("uvA5");function L(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"Autocomplete",{enumerable:!0,get:function(){return L(C).default}})},"8J+k":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("0v6a"),r=o(n);function o(t){return t&&t.__esModule?t:{default:t}}function a(t){this.options=t;var e=t.map,i=t.point;this.point=i;t.name;this.map=e;var n=this.tip=new r.default(t),o=new BMap.Icon("//huiyan.baidu.com/github/tools/gis-drawing/static/images/drag.png",new BMap.Size(25,25),{imageSize:new BMap.Size(25,25)}),a=this.marker=new BMap.Marker(this.point);a.setIcon(o),a.setShadow(o);var s=this;a.addEventListener("dragging",(function(){s.point=a.point,n.setPosition(a.point),t.change&&t.change()})),a.addEventListener("dragend",(function(){t.changePosition&&t.changePosition(s.point)})),a.enableDragging()}a.prototype.show=function(){this.map.addOverlay(this.marker),this.map.addOverlay(this.tip),!1===this.options.isShowTipArrow&&this.tip.hideArrow()},a.prototype.hide=function(){this.map.removeOverlay(this.marker),this.map.removeOverlay(this.tip)},a.prototype.setNumberLeft=function(){this.tip.setNumberLeft()},a.prototype.setNumberRight=function(){this.tip.setNumberRight()},a.prototype.hideNumber=function(){this.tip.hideNumber()},e.default=a},B03P:function(t,e,i){"use strict";function n(t){this.options=t||{},this._point=t.point,this._fillColor=t.fillStyle||"#1495ff",this._size=t.size||30,this._lineWidth=void 0===t.lineWidth?2:t.lineWidth,this._strokeStyle=t.strokeStyle||"#ffffff",t.strokeOpacity&&(this._strokeStyle=r(this._strokeStyle,.4))}function r(t,e){var i=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,n=t.toLowerCase();if(n&&i.test(n)){if(4===n.length){for(var r="#",o=1;o<4;o+=1)r+=n.slice(o,o+1).concat(n.slice(o,o+1));n=r}var a=[];for(o=1;o<7;o+=2)a.push(parseInt("0x"+n.slice(o,o+2)));return e?(a.push(e),"rgba("+a.join(",")+")"):"rgb("+a.join(",")+")"}return n}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype=new BMap.Overlay,n.prototype.initialize=function(t){this._map=t;var e=this._div=document.createElement("div"),i=e.style;i.position="absolute",i.backgroundClip="padding-box",i.zIndex=this.options.zIndex||BMap.Overlay.getZIndex(this._point.lat),i.backgroundColor=this._fillColor,!1!==this.options.isShowShadow&&(i.boxShadow="0 0 5px rgba(0, 0, 0, 0.5)"),i.border=this._lineWidth+"px solid "+this._strokeStyle,i.color="white",i.textShadow="0px 0px 5px #fff",i.width=this._size+"px",i.boxSizing="content-box",i.borderRadius="30px",i.height=this._size+"px",i.lineHeight=this._size+"px",i.fontSize="12px",i.cursor="pointer",i.textAlign="center",i.MozUserSelect="none",this.options.number&&!1!==this.options.isShowNumber&&(e.innerHTML=this.options.number);var n=this;return e.addEventListener("mouseover",(function(){n.dispatchEvent("mouseover",n.options.number),i.backgroundColor="#1495ff"})),e.addEventListener("mouseout",(function(){n.dispatchEvent("mouseout",n.options.number),i.backgroundColor=n._fillColor})),e.addEventListener("click",(function(){n.dispatchEvent("click",n.options.number)})),e.addEventListener("touchstart",(function(t){t.stopPropagation()})),e.addEventListener("touchmove",(function(t){t.stopPropagation()})),e.addEventListener("touchend",(function(t){t.stopPropagation()})),t.getPanes().markerPane.appendChild(e),e},n.prototype.draw=function(){var t=this._map,e=t.pointToOverlayPixel(this._point);this._div.style.left=e.x-(this._size+this._lineWidth)/2-1+"px",this._div.style.top=e.y-(this._size+this._lineWidth)/2-2+"px"},e.default=n},"BgC/":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={mergeRoadPath:function(t,e){if(t){for(var i=[],n=0;n<t.length;n++)if(0==i.length)i.push(t[n]);else{for(var r=t[n].split(","),o=!1,a=0;a<i.length;a++){var s=i[a].split(",");if(r[0]===s[s.length-2]&&r[1]===s[s.length-1]){var u=r.slice(2);i[a]+=","+u.join(","),o=!0}if(r[r.length-2]===s[0]&&r[r.length-1]===s[1]){u=r.slice(0,r.length-2);i[a]=u.join(",")+","+i[a],o=!0}}!1===o&&i.push(t[n])}return i=this.uniqueRoadPath(i),i}},uniqueRoadPath:function(t){for(var e=t.map((function(t){return new r(t.split(","))})),i=0;i<e.length-1;i++)if(e[i])for(var n=e[i],o=i+1;o<e.length;o++)if(e[o]){var a=e[o];a.isInclude(n)&&delete e[o]}var s=[];return e.map((function(t){t&&s.push(t.getPoints().join(","))})),s}};function r(t){this.polyline=t;for(var e=t[0],i=t[0],n=t[1],r=t[1],o=2;o<t.length;o+=2)e=Math.min(e,t[o]),i=Math.max(i,t[o]),n=Math.min(n,t[o+1]),r=Math.max(r,t[o+1]);this.minX=e,this.maxX=i,this.minY=n,this.maxY=r}r.prototype.getPoints=function(){return this.polyline},r.prototype.isInBound=function(t){return t.lng>this.minX&&t.lat>this.minY&&t.lng<this.maxX&&t.lat<this.maxY},r.prototype.isInclude=function(t){if(!(t.minX>this.minX&&t.minY>this.minY&&t.maxX<this.maxX&&t.maxY<this.maxY))return!1;for(var e=this.getPoints(),i=!0,n=0;n<e.length;n+=2){var r=this.isPointOnPolyline({lng:e[n],lat:e[n+1]},t);0==r&&(i=!1)}return i},r.prototype.isPointOnPolyline=function(t,e){var i=e.getPoints();if(!e.isInBound(t))return!1;for(var n=0;n<i.length-2;n++){var r={lng:i[n],lat:i[n+1]},o={lng:i[n+2],lat:i[n+3]};if(t.lng>=Math.min(r.lng,o.lng)&&t.lng<=Math.max(r.lng,o.lng)&&t.lat>=Math.min(r.lat,o.lat)&&t.lat<=Math.max(r.lat,o.lat)){var a=(r.lng-t.lng)*(o.lat-t.lat)-(o.lng-t.lng)*(r.lat-t.lat),s=2e-10;if(s=2e-9,a<s&&a>-s)return!0}}return!1},e.default=n},GunY:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("knqi"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){return s(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return l(e,t),n(e,[{key:"getControl",value:function(){return new BMap.NavigationControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset","type","showZoomInfo","enableGeolocation"]}}]),e}(o.default);e.default=h},HMcu:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("knqi"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){return s(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return l(e,t),n(e,[{key:"getControl",value:function(){return new BMap.OverviewMapControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset","size","isOpen"]}}]),e}(o.default);e.default=h},IqaO:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("q1tI"),o=(u(r),i("wjnM")),a=u(o),s=i("/flU");function u(t){return t&&t.__esModule?t:{default:t}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function f(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=function(t){function e(t){l(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return f(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.lineLayer.destroy(),this.lineLayer=null,this.pointLayer.destroy(),this.pointLayer=null,this.textLayer.destroy(),this.textLayer=null}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map;this.lineDataSet=new s.DataSet([]),this.lineLayer=new s.baiduMapLayer(t,this.lineDataSet,{}),this.pointDataSet=new s.DataSet([]),this.pointLayer=new s.baiduMapLayer(t,this.pointDataSet,{}),this.textLayer=new s.baiduMapLayer(t,this.pointDataSet,{})}},{key:"initialize",value:function(){var t=this,e=this.map=this.props.map;if(e){this._createLayer||this.createLayers();var i=[],n=[],r=Boolean("curve"===this.props.type);if(this.props.data){var o=[],a=e.getMapType().getProjection();this.props.data.forEach((function(u,l){var h=u.from.point||s.utilCityCenter.getCenterByCityName(u.from.city),f=u.to.point||s.utilCityCenter.getCenterByCityName(u.to.city),c=s.utilCurve.getPoints([h,f]);"bd09mc"===t.props.coordType?(o.push(a.pointToLngLat(new BMap.Pixel(h.lng,h.lat))),o.push(a.pointToLngLat(new BMap.Pixel(f.lng,f.lat)))):(o.push(h),o.push(f));var p=new s.utilDataRangeIntensity({maxSize:10,minSize:1,min:t.props.min||0,max:t.props.max||1e3}),d=p.getSize(u.count);i.push({strokeStyle:u.color,geometry:{type:"LineString",coordinates:r?c:[[h.lng,h.lat],[f.lng,f.lat]]},count:u.count,lineWidth:d}),!1!==t.props.showToPoint&&n.push({fillStyle:u.color,text:u.to.name||u.to.city,geometry:{type:"Point",coordinates:[f.lng,f.lat]}}),!1!==t.props.showFromPoint&&n.push({fillStyle:u.color,text:u.from.name||u.from.city,geometry:{type:"Point",coordinates:[h.lng,h.lat]}}),o.length>0&&!1!==t.props.autoViewport&&e.setViewport(o,t.props.viewportOptions)}))}this.lineDataSet.set(i),this.lineLayer.update({options:this.props.lineOptions||{coordType:this.props.coordType,draw:"simple",strokeStyle:"#5E87DB",globalCompositeOperation:"lighter",shadowColor:"rgba(255, 255, 255, 0.5)",shadowBlur:60,lineWidth:2}}),this.pointDataSet.set(n),this.pointLayer.update({options:this.props.pointOptions||{coordType:this.props.coordType,draw:"simple",fillStyle:"#5E87DB",size:5,shadowColor:"#5E87DB",shadowBlur:20}}),this.textLayer.update({options:this.props.textOptions||{coordType:this.props.coordType,draw:"text",font:"18px Arial",offset:{x:0,y:12},fillStyle:"#333",size:12}})}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(a.default);e.default=c},LpNP:function(t,e,i){"use strict";function n(t,e){var i=document.createElement("a");i.style.display="none";var n=new Blob([t]);i.href=URL.createObjectURL(n),i.href=t,e&&(i.download=e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},LrII:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("q1tI"),o=(l(r),i("i8i4"),i("wjnM")),a=l(o),s=i("8J+k"),u=l(s);function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function c(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var p=function(t){function e(t){h(this,e);var i=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i.tips=[],i}return c(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.tips.forEach((function(t){t.hide()})),this.tips=[]}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e&&(this.destroy(),this.props.data)){var i=[];this.props.data.forEach((function(n,r){var o=new u.default({isShowTipArrow:!0,changePosition:function(e){t.props.changePosition&&t.props.changePosition(e,r)},map:e,numberDirection:n.numberDirection,isShowNumber:n.isShowNumber,point:n.point,name:n.name,index:void 0!==n.index?n.index:r+1,color:n.color,change:function(){}});i.push(n.point),o.show(),t.tips.push(o)})),this.props.autoViewport&&e.setViewport(i,this.props.viewportOptions)}}}],[{key:"defaultProps",get:function(){return{}}}]),e}(a.default);e.default=p},MYe1:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("vjrR"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){return s(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return l(e,t),n(e,[{key:"getOverlay",value:function(){var t=this.props.center,e=this.props.radius;return new BMap.Circle(t,e,this.getOptions(this.options))}}]),e}(o.default);e.default=h},Msr9:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("PIfV"),r=s(n),o=i("LpNP"),a=s(o);function s(t){return t&&t.__esModule?t:{default:t}}r.default.download=a.default,e.default=r.default},O5lx:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("wjnM"),o=s(r),a=i("/flU");function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function h(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=function(t){function e(t){u(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return h(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this._allRequest={},this._backData={},this.initialize()}},{key:"componentWillUnmount",value:function(){this.mapvLayer&&(this.mapvLayer.destroy(),this.mapvLayer=null)}},{key:"getPointArrayByDataSetData",value:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i].geometry.coordinates[0];n.forEach((function(t){e.push(new BMap.Point(t[0],t[1]))}))}return e}},{key:"getBoundaryData",value:function(){var t=this.props.data,e=this.props.map;if(t){this._request={};var i=this,n=new BMap.Boundary,r=[];t.forEach((function(t,e){i._request[t.name]=!1,i._backData[t.name]&&(r=r.concat(i._backData[t.name]),i._request[t.name]=!0)})),o(),t.forEach((function(t,e){i._request[t.name]||i._allRequest[t.name]||(i._allRequest[t.name]=!0,n.get(t.name,(function(e){for(var n=[],a=0;a<e.boundaries.length;a++){for(var s=[],u=e.boundaries[a].split(";"),l=0;l<u.length;l++)s.push(u[l].split(","));n.push({geometry:{type:"Polygon",coordinates:[s]},count:t.count})}i._backData[t.name]=n,r=r.concat(n),i._request[t.name]=!0,o()})))}))}function o(){var t=!0;for(var n in i._request)i._request[n]||(t=!1);if(t){i.dataSet.set(r);var o=i.getPointArrayByDataSetData(r);o.length>0&&!1!==i.props.autoViewport&&e.setViewport(o,i.props.viewportOptions)}}}},{key:"initialize",value:function(){var t=this.props.map;if(t){if(!this.mapvLayer){this.dataSet=new a.DataSet([]);var e=this.props.layerOptions||{gradient:{0:"yellow",1:"red"},max:100,globalAlpha:.8,draw:"intensity"};this.mapvLayer=new a.baiduMapLayer(t,this.dataSet,e)}this.getBoundaryData()}}}]),e}(o.default);e.default=f},OWd1:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("knqi"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){return s(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return l(e,t),n(e,[{key:"getControl",value:function(){return new BMap.MapTypeControl(this.getOptions(this.options))}},{key:"options",get:function(){return["anchor","offset","type","mapTypes"]}}]),e}(o.default);e.default=h},PIfV:function(t,e,i){"use strict";function n(t){var e=null;if(/^http(s{0,1}):\/\//.test(t.url)){var i=location.href.match(/^https{0,1}:\/\/(.+?)(?=\/|$)/),n=t.url.match(/^https{0,1}:\/\/(.+?)(?=\/|$)/);e=2===i.length&&2===n.length&&n[1]===i[1]?this.ajax(t):this.jsonp(t)}else e=this.ajax(t);return e}function r(t){var e=this,i=new XMLHttpRequest,n=t.method||"GET",r=!1;if(i.open(n,t.url),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.withCredentials=!0,"GET"===n)i.send();else{i.withCredentials=!0,i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var o=Object.keys(t.data).map((function(e){return e+"="+t.data[e]}));i.send(o.join("&"))}var a=setTimeout((function(){i.abort(),t.fail&&t.fail("timeout")}),1e4);return i.onload=function(){this.status>=200&&this.status<300?t.success&&t.success(JSON.parse(this.response)):t.fail&&t.fail(this.statusText),t.complete&&t.complete(JSON.parse(this.response)),clearTimeout(a)},i.onerror=function(){t.fail&&t.fail(e.statusText),clearTimeout(a)},{abort:function(){r||(r=!0,i.abort())},params:t}}function o(t){var e="jsonp_"+ +new Date+"_"+parseInt(1e7*Math.random(),10),i=document.createElement("script"),n=!1;t.url+="-1"===t.url.indexOf("?")?"?":"&",t.url+="callback="+e,i.src=t.url,document.head.appendChild(i);var r=setTimeout((function(){null!==window[e]&&(window[e]=null,i.parentElement.removeChild(i),t.fail&&t.fail({error:null,msg:"timeout"}),t.complete&&t.complete(JSON.parse()))}),1e4);return i.addEventListener("error",(function(o){window[e]=null,i.parentElement.removeChild(i),clearTimeout(r),n||(t.fail&&t.fail({error:o,msg:"loaderror"}),t.complete&&t.complete())})),window[e]=function(o){clearTimeout(r),n||(t.success(o),t.complete&&t.complete()),window[e]=null,i.parentElement.removeChild(i)},{abort:function(){clearTimeout(r),n=!0},params:t}}Object.defineProperty(e,"__esModule",{value:!0});var a={fetch:n,ajax:r,jsonp:o};e.default=a},Rk3l:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("i8i4"),o=i("wjnM"),a=s(o);function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function h(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=function(t){function e(t){u(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return h(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.props.map.closeInfoWindow(),this.infoWindow=null}},{key:"initialize",value:function(){var t=this.props.map;if(t){this.destroy();if(this.infoWindow=new BMap.InfoWindow(this.props.text||"",this.getOptions(this.options)),this.bindEvent(this.infoWindow,this.events),t.openInfoWindow(this.infoWindow,new BMap.Point(this.props.position.lng,this.props.position.lat)),"children"in this.props){var e=document.createElement("div");(0,r.render)(this.props.children,e),this.infoWindow.setContent(e)}}}},{key:"options",get:function(){return["width","height","maxWidth","offset","title","enableAutoPan","enableCloseOnClick","enableMessage","message"]}},{key:"events",get:function(){return["close","open","maximize","restore","clickclose"]}}]),e}(a.default);e.default=f},Schx:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("q1tI"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function h(t,e){var i=null;return function(){var n=this,r=arguments;i&&clearTimeout(i),i=setTimeout((function(){t.apply(n,r)}),e)}}function f(t,e){var i=void 0,n=arguments,r=void 0;return function o(){var a=this,s=Date.now();r||(r=s),i&&clearTimeout(i),s-r>=e?(t.apply(a,n),r=s):i=setTimeout((function(){o.apply(a,n)}),50)}}var c=function(t){function e(t){s(this,e);var i=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.map=i.props.map,i}return l(e,t),n(e,[{key:"componentDidMount",value:function(){this.props.onZoomend&&this._bindZoomendEvent(),this.props.onDragend&&this._bindDragendEvent()}},{key:"componentWillUnmount",value:function(){var t=this.map;this.props.onZoomend&&t.removeEventListener("zoomend",this.onZoomend),this.props.onDragend&&t.removeEventListener("dragend",this.onDragend)}},{key:"_bindZoomendEvent",value:function(){var t=this.map,e=this.props,i=e.onZoomend,n=e.eventType,r=e.delay;this.onZoomend="debounce"===n?h(i,r):"throttle"===n?f(i,r):i,t.addEventListener("zoomend",this.onZoomend)}},{key:"_bindDragendEvent",value:function(){var t=this.map,e=this.props,i=e.onDragend,n=e.eventType,r=e.delay;this.onDragend="debounce"===n?h(i,r):"throttle"===n?f(i,r):i,t.addEventListener("dragend",this.onDragend)}},{key:"render",value:function(){return null}}],[{key:"defaultProps",get:function(){return{eventType:"debounce",delay:500}}}]),e}(o.default.Component);e.default=c},TJCa:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=void 0,n=void 0;try{if("string"===typeof t){var r=t.split(",");i=JSON.parse(r[0].match(/[0-9]+\.?[0-9]{0,}/)[0]),n=JSON.parse(r[1].match(/[0-9]+\.?[0-9]{0,}/)[0])}else t instanceof Array?(i=JSON.parse(t[0]),n=JSON.parse(t[1])):t instanceof Object&&(i=t.lng,n=t.lat);if(e)return{lng:i,lat:n};var o=new BMap.Point(i,n);return o}catch(a){console.log("create BmapPoint error",'Please input data like this:  1. "114.54,40.33",  2.[114.54,40.33],  3.{lng:114.54,lat:40.33}')}};e.default=n},TQnn:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("wjnM"),o=f(r),a=i("/flU"),s=i("61/Q"),u=f(s),l=i("p+gy"),h=f(l);function f(t){return t&&t.__esModule?t:{default:t}}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function d(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var v=function(t){function e(t){c(this,e);var i=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return d(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"getRoadPoints",value:function(t){for(var e=this.props.map.getMapType().getProjection(),i=[],n=0;n<t.length;n++)for(var r=t[n].split(","),o=0;o<r.length;o+=2)"bd09mc"===this.props.coordType?i.push(e.pointToLngLat(new BMap.Pixel(r[o],r[o+1]))):i.push(new BMap.Point(r[o],r[o+1]));return i}},{key:"updateViewport",value:function(){var t=this,e=(this.props.roadPath,[]);this.props.roadPaths?this.props.roadPaths.forEach((function(i){e=e.concat(t.getRoadPoints(i))})):this.props.roadPath&&(e=e.concat(this.getRoadPoints(this.props.roadPath))),e.length>0&&!1!==this.props.autoViewport&&this.props.map.setViewport(e,this.props.viewportOptions)}},{key:"getRoadGroup",value:function(t,e,i){t=t,e=e,i=i;var n={},r=[];if(e)for(var o=0;o<e.length;o++)n[e[o]]||(n[e[o]]={roadPath:[],color:i[e[o]]}),r.push(t[o]),n[e[o]].roadPath.push(t[o]);else n[0]={roadPath:t,color:this.props.color||"#1495ff"};return{group:n,allPath:h.default.mergeRoadPath(t)}}},{key:"isClick",value:function(t,e,i){var n=this.canvasLayer.canvas.getContext("2d"),r=this.getRoadGroup(i);n.beginPath();var o=this.props.lineWidth||10;u.default.drawRoads(t,n,r.allPath,{color:this.props.bgColor||"#fff",lineWidth:o+4,lineCap:"butt",arrow:!1,line:!1}),n.lineWidth=o+6;var a=n.isPointInStroke(e.x*window.devicePixelRatio,e.y*window.devicePixelRatio);return a}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){var i=this.canvasLayerUpdate.bind(this);this.canvasLayer?this.canvasLayer.draw():(this.canvasLayer=new a.baiduMapCanvasLayer({zIndex:this.props.zIndex,map:e,update:function(){i(this)}}),this.props.onClick&&e.addEventListener("click",(function(i){var n=!1;if(t.props.roadPaths)for(var r=0;r<t.props.roadPaths.length;r++){var o=t.props.roadPaths[r];n=t.isClick(e,i.pixel,o),n&&t.props.onClick(r)}else t.props.roadPath&&(n=t.isClick(e,i.pixel,t.props.roadPath),n&&t.props.onClick())}))),this.updateViewport()}}},{key:"canvasLayerUpdate",value:function(t){var e=this,i=t.canvas.getContext("2d");if(!i)return!1;i.clearRect(0,0,i.canvas.width,i.canvas.height);var n=this.props.roadPath,r=this.props.roadPaths,o=this.props.lineWidth||10;r?r.forEach((function(t,n){e.props.lineWidths&&(o=e.props.lineWidths[n]),e.drawRoad(i,t,e.props.category,e.props.splitList,o)})):n&&this.drawRoad(i,this.props.roadPath,this.props.category,this.props.splitList,o)}},{key:"drawRoad",value:function(t,e,i,n,r){var o=this.getRoadGroup(e,i,n),a=o.group;for(var s in u.default.drawRoads(this.props.map,t,o.allPath,{color:this.props.bgColor||"#fff",coordType:this.props.coordType,lineWidth:r+4,lineCap:"butt",arrow:!1,line:!0}),a){var l=a[s];e=h.default.mergeRoadPath(l.roadPath);u.default.drawRoads(this.props.map,t,e,{color:l.color,coordType:this.props.coordType,line:!0,lineWidth:r,lineCap:"butt",arrow:!1})}u.default.drawRoads(this.props.map,t,o.allPath,{color:l.color,coordType:this.props.coordType,lineWidth:r,border:{},lineCap:"butt",arrow:!1!==this.props.isShowArrow&&{width:5,height:3,color:this.props.arrowColor}})}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.canvasLayer.hide()}}]),e}(o.default);e.default=v},U0UX:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("vjrR"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){return s(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return l(e,t),n(e,[{key:"getOverlay",value:function(){var t=this.props.path;return t=t.map((function(t){return new BMap.Point(t.lng,t.lat)})),new BMap.Polyline(t,this.getOptions(this.options))}}]),e}(o.default);e.default=h},Ug4f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.isString=function(t){return"[object String]"===Object.prototype.toString.call(t)}},"UhY/":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i("q1tI"),a=h(o),s=i("3DSc"),u=h(s),l=i("X/0x");function h(t){return t&&t.__esModule?t:{default:t}}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function p(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var d=function(t){function e(t){f(this,e);var i=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.createMarker=i.createMarker.bind(i),i.state={},i}return p(e,t),r(e,[{key:"componentDidUpdate",value:function(t){var e=JSON.stringify(t.data),i=JSON.stringify(this.props.data);e!=i||this.map}},{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"createMarker",value:function(){var t=this,e=this.props,i=e.position,r=e.num,o=e.rate,s=e.name,h=e.rightModule,f=e.order,c=e.visible,p=void 0===c||c,d=l.bmap.createPoint(i),v=!0;o&&(o.indexOf("-")>-1&&(v=!1,o=o.replace(/-/,"")),o.indexOf("+")>-1&&(v=!0,o=o.replace("+","")),0==o.length&&(o="_"));var g={display:"flex",justifyContent:"space-between",background:"#FFFFFF",alignItems:"stretch",boxShadow:"0 2px 2px 0 rgba(0, 0, 0, 0.22)",borderRadius:"3px 0 0 3px",minWidth:"155px",minHeight:"50px",marginTop:"-25px"},m={minWidth:"30px",background:"#999999",color:"white",padding:"auto 0",display:"flex",justifyContent:"center",alignItems:"center"};this.props.active&&(m.background="#F5533D"),this.props.leftStyle&&(m=l.obj.merge(m,this.props.leftStyle)),this.props.style&&(g=l.obj.merge(g,this.props.style));var y={flex:"1",padding:"6px",justifyContent:"center",alignItems:"center",fontSize:"12px",color:"#8D93A3",letterSpacing:"0.6px"};this.props.rightStyle&&(y=l.obj.merge(y,this.props.rightStyle));var x=Object.keys(t.props).filter((function(t){return 0==t.indexOf("on")})),b=[];if(x.map((function(e){b[e]=t.props[e]})),p)return a.default.createElement(u.default,{key:JSON.stringify(d)+Math.random(),map:this.props.map,position:d,zIndex:t.props.zIndex},a.default.createElement("div",n({key:JSON.stringify(d)+Math.random(),style:g},b),a.default.createElement("div",{style:m},f),a.default.createElement("div",{style:y},!h&&a.default.createElement("div",null,"  ",r+"("+o,v?a.default.createElement("img",{style:{width:"8px",height:"auto",margin:"1px"},src:"//huiyan.baidu.com/cms/react-bmap/up.png"}):a.default.createElement("img",{style:{width:"8px",height:"auto",margin:"1px"},src:"//huiyan.baidu.com/cms/react-bmap/down.png"}),")"),h||a.default.createElement("div",null,"  ",s," "))))}},{key:"render",value:function(){var t=this.createMarker();return t}}],[{key:"defaultProps",get:function(){return{autoViewport:!0}}}]),e}(a.default.Component);e.default=d},WrLL:function(t,e,i){"use strict";var n=i("q1tI"),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 289.1a362.49 362.49 0 00-79.9-115.7 370.83 370.83 0 00-118.2-77.8C610.7 76.6 562.1 67 512 67c-50.1 0-98.7 9.6-144.5 28.5-44.3 18.3-84 44.5-118.2 77.8A363.6 363.6 0 00169.4 289c-19.5 45-29.4 92.8-29.4 142 0 70.6 16.9 140.9 50.1 208.7 26.7 54.5 64 107.6 111 158.1 80.3 86.2 164.5 138.9 188.4 153a43.9 43.9 0 0022.4 6.1c7.8 0 15.5-2 22.4-6.1 23.9-14.1 108.1-66.8 188.4-153 47-50.4 84.3-103.6 111-158.1C867.1 572 884 501.8 884 431.1c0-49.2-9.9-97-29.4-142zM512 880.2c-65.9-41.9-300-207.8-300-449.1 0-77.9 31.1-151.1 87.6-206.3C356.3 169.5 431.7 139 512 139s155.7 30.5 212.4 85.9C780.9 280 812 353.2 812 431.1c0 241.3-234.1 407.2-300 449.1zm0-617.2c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 551c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 439c0-29.9 11.7-58 32.8-79.2C454 338.6 482.1 327 512 327c29.9 0 58 11.6 79.2 32.8C612.4 381 624 409.1 624 439c0 29.9-11.6 58-32.8 79.2z"}}]},name:"environment",theme:"outlined"},o=r,a=i("6VBw"),s=function(t,e){return n["createElement"](a["a"],Object.assign({},t,{ref:e,icon:o}))};s.displayName="EnvironmentOutlined";e["a"]=n["forwardRef"](s)},"X/0x":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("hRPt");Object.defineProperty(e,"obj",{enumerable:!0,get:function(){return a(n).default}});var r=i("kHKQ");Object.defineProperty(e,"bmap",{enumerable:!0,get:function(){return a(r).default}});var o=i("Msr9");function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"http",{enumerable:!0,get:function(){return a(o).default}})},Xajb:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function r(t){return("object"===("undefined"===typeof t?"undefined":n(t))||"function"===typeof t)&&null!==t}function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new WeakMap,i=void 0,n=t.constructor;switch(n){case RegExp:i=new n(t);break;case Date:i=new n(t.getTime());break;default:if(e.has(t))return e.get(t);i=new n,e.set(t,i)}for(var a in t)i[a]=r(t[a])?o(t[a],e):t[a];return i}e.default=o},aDLU:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("wjnM"),o=l(r),a=i("4K7L"),s=u(a);function u(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function c(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var p=function(t){function e(t){h(this,e);var i=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return c(e,t),n(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.layer&&this.props.view&&this.layer.options&&(this.props.view.removeLayer(this.layer),this.layer.destroy(),this.layer=null)}},{key:"handleClick",value:function(t){this.props.onClick&&this.props.onClick(t)}},{key:"componentDidUpdate",value:function(t){var e=JSON.stringify(t.data),i=JSON.stringify(this.props.data),n=JSON.stringify(t.options),r=JSON.stringify(this.props.options);this.map&&e===i&&n===r||this.initialize()}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){if(this.map=e,this._createLayer||this.createLayers(),this.props.options.autoViewport){var i=e.getMapType().getProjection(),n=function(e){return"bd09mc"===t.props.options.coordType?i.pointToLngLat(new BMap.Pixel(e[0],e[1])):new BMap.Point(e[0],e[1])},r=[];this.props.data.map((function(t){"Point"===t.geometry.type?r.push(n(t.geometry.coordinates)):"LineString"===t.geometry.type?t.geometry.coordinates.map((function(t){r.push(n(t))})):"Polygon"===t.geometry.type&&t.geometry.coordinates[0].map((function(t){r.push(n(t))}))})),r.length>0&&e.setViewport(r,this.props.options.viewportOptions)}this.layer.setData(this.props.data),this.layer.setOptions(this.props.options)}}},{key:"createLayers",value:function(){s[this.props.type]?(this._createLayer=!0,this.layer=new s[this.props.type](this.props.options),this.props.view.addLayer(this.layer)):console.error("mapvgl doesn't have layer "+this.props.type+"!")}}],[{key:"defaultProps",get:function(){return{}}}]),e}(o.default);e.default=p},auZS:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("wjnM"),o=s(r),a=i("/flU");function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function h(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=function(t){function e(t){u(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return h(e,t),n(e,[{key:"handleClick",value:function(t){this.props.onClick&&this.props.onClick(t)}},{key:"componentDidUpdate",value:function(t){var e=JSON.stringify(t.data),i=JSON.stringify(this.props.data);e==i&&this.map||this.initialize()}},{key:"initialize",value:function(){var t=this.props.map;t&&(this.map=t,this._createLayer||this.createLayers(),this.showDatasets(this.props.data))}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.shadowSet=null,this.circleSet=null,this.textSet=null,this.numSet=null,this.otherSet=null,this.otherShadowSet=null;for(var t=0;t<this.layers.length;t++)this.layers[t].destroy(),this.layers[t]=null}},{key:"showDatasets",value:function(t){var e=this,i=[],n=[],r=[],o=[],a=[],s=[];t.length>0&&(t.forEach((function(t,u){var l=t["location"].split(","),h=e.project.pointToLngLat(new BMap.Pixel(l[0],l[1]));s.push(h),u<10?(i.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},count:parseInt(t["count"])}),n.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},id:u,count:parseInt(t["count"]),text:parseInt(u)+1}),r.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},count:parseInt(t["count"]),text:t["text"]})):(o.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},id:u,count:parseInt(t["count"])}),a.push({geometry:{type:"Point",coordinates:[l[0],l[1]]},count:parseInt(t["count"])}))})),this.shadowSet.set(i),this.circleSet.set(n),this.textSet.set(r),this.numSet.set(n),this.otherSet.set(o),this.otherShadowSet.set(a),s.length>0&&!1!==this.props.autoViewport&&map.setViewport(s,self.props.viewportOptions))}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map;this.project=t.getMapType().getProjection();var e=this,i=this.shadowSet=new a.DataSet([]),n=this.circleSet=new a.DataSet([]),r=this.textSet=new a.DataSet([]),o=this.numSet=new a.DataSet([]),s=this.otherSet=new a.DataSet([]),u=this.otherShadowSet=new a.DataSet([]);this.layers=[];var l={coordType:"bd09mc",splitList:{4:"#d53938",3:"#fe6261",2:"#ffb02d",other:"#80db69"},shadowBlur:10,size:5,max:30,methods:{click:function(t){t&&e.handleClick(t.id)},mousemove:function(t){s.update((function(t){t.fillStyle=null})),t?(e.isSmallPath=!0,e.props.map.setDefaultCursor("pointer"),s.update((function(t){t.fillStyle="#1495ff"}),{id:t.id})):(e.isSmallPath=!1,e.isSmallPath||e.isBigPath||e.props.map.setDefaultCursor("auto"))}},draw:"category"},h={splitList:{4:"#d53938",3:"#fe6261",2:"#ffb02d",1:"#80db69"},styleType:"fill",globalAlpha:.4,coordType:"bd09mc",size:8,minSize:5,draw:"category"};if(this.layers.push(new a.baiduMapLayer(t,u,h)),this.layers.push(new a.baiduMapLayer(t,s,l)),!0===this.props.animation){var f={splitList:{4:"#d53938",3:"#fe6261",2:"#ffb02d",1:"#80db69"},styleType:"stroke",globalAlpha:.4,coordType:"bd09mc",size:20,minSize:10,draw:"category"};this.layers.push(new a.baiduMapAnimationLayer(t,i,f))}var c={splitList:{1:"#80db69",4:"#d53938",3:"#fe6261",2:"#ffb02d"},fillStyle:"red",coordType:"bd09mc",size:10,draw:"category",methods:{click:function(t){t&&e.handleClick(t.id)},mousemove:function(t){n.update((function(t){t.fillStyle=null})),t?(e.isBigPath=!0,e.map.setDefaultCursor("pointer"),n.update((function(t){t.fillStyle="#1495ff"}),{id:t.id})):(e.isBigPath=!1,e.isBigPath||e.isSmallPath||e.map.setDefaultCursor("auto"))}}};this.layers.push(new a.baiduMapLayer(t,n,c));var p={coordType:"bd09mc",draw:"text",font:"13px Arial",fillStyle:"#ffffff",shadowColor:"#ffffff",shadowBlur:10};this.layers.push(new a.baiduMapLayer(t,o,p));var d={coordType:"bd09mc",font:"13px Arial",fillStyle:"#666",shadowColor:"#ffffff",shadowBlur:10,draw:"text",avoid:!0,textAlign:"left",offset:{x:10,y:0}};this.layers.push(new a.baiduMapLayer(t,r,d))}},{key:"render",value:function(){return null}}],[{key:"defaultProps",get:function(){return{autoViewport:!0}}}]),e}(o.default);e.default=f},e3ff:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t,e){var i=function t(e,i){for(var r in i)"[object Object]"==Object.prototype.toString.call(i[r])?("object"!==n(e[r])&&(e[r]={}),t(e[r],i[r])):e[r]=i[r]},r=JSON.parse(JSON.stringify(t));return i(r,e),r};e.default=r},egFx:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e){var i={},n=function t(e,i,n){var r={};for(var o in e&&Object.keys(e).map((function(t){r[t]=!0})),i&&Object.keys(i).map((function(t){r[t]=!0})),r)if(e[o]&&"[object Object]"==Object.prototype.toString.call(e[o])&&i[o]&&"[object Object]"==Object.prototype.toString.call(i[o]))if(JSON.stringify(e[o])!==JSON.stringify(i[o])){n[o]||(n[o]={});var a=n[o];t(e[o],i[o],a)}else n[o]=i[o];else n[o]=i[o]};return n(t,e,i),0==Object.keys(i).length&&(i=null),i};e.default=n},hRPt:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("Xajb"),r=l(n),o=i("e3ff"),a=l(o),s=i("egFx"),u=l(s);function l(t){return t&&t.__esModule?t:{default:t}}var h={deepClone:r.default,merge:a.default,diff:u.default};e.default=h},hkKa:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i("ODXe"),r=i("q1tI");function o(){var t=r["useReducer"]((function(t){return t+1}),0),e=Object(n["a"])(t,2),i=e[1];return i}},izp9:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("q1tI"),o=l(r),a=i("wjnM"),s=l(a),u=i("Ug4f");function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function c(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var p=function(t){function e(t){return h(this,e),f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return c(e,t),n(e,[{key:"componentDidMount",value:function(){this.initMap(),this.forceUpdate()}},{key:"componentDidUpdate",value:function(t){var e=t.center,i=this.props.center;if((0,u.isString)(i))e!=i&&this.map.centerAndZoom(i);else{var n=e&&i&&(e.lng!=i.lng||e.lat!=i.lat||this.props.forceUpdate),r=t.zoom!==this.props.zoom&&(this.props.zoom||this.props.forceUpdate);i=new BMap.Point(i.lng,i.lat);n&&r?this.map.centerAndZoom(i,this.props.zoom):n?this.map.setCenter(i):r&&this.map.zoomTo(this.props.zoom)}}},{key:"initMap",value:function(){var t=this,e=this.options;e=this.getOptions(e),!0!==this.props.enableMapClick&&(e.enableMapClick=!1);var i=new BMap.Map(this.refs.map,e);this.map=i;var n=this.props.zoom;if(this.bindEvent(i,this.events),(0,u.isString)(this.props.center))i.centerAndZoom(this.props.center);else{var r=new BMap.Point(this.props.center.lng,this.props.center.lat);i.centerAndZoom(r,n)}this.props.mapStyleV2?i.setMapStyleV2(this.props.mapStyleV2):this.props.mapStyle&&i.setMapStyle(this.props.mapStyle),this.bindToggleMeghods(i,this.toggleMethods);var o=n;i.addEventListener("zoomend",(function(){var e=i.getZoom();t.props.zoom_changed&&t.props.zoom_changed(e,o),o=e}))}},{key:"renderChildren",value:function(){var t=this,e=this.props.children;if(e&&this.map)return o.default.Children.map(e,(function(e){if(e)return"string"===typeof e.type?e:o.default.cloneElement(e,{map:t.map})}))}},{key:"onRender",value:function(){if(this.props.render&&this.map)return this.props.render(this.map)}},{key:"render",value:function(){var t={height:"100%",position:"relative"};for(var e in this.props.style)t[e]=this.props.style[e];return o.default.createElement("div",{style:t,key:this.props.keys},o.default.createElement("div",{ref:"map",className:this.props.className,style:{height:"100%"}},"\u52a0\u8f7d\u5730\u56fe\u4e2d..."),this.renderChildren(),this.onRender())}},{key:"events",get:function(){return["click","dblclick","rightclick","rightdblclick","maptypechange","mousemove","mouseover","mouseout","movestart","moving","moveend","zoomstart","zoomend","addoverlay","addcontrol","removecontrol","removeoverlay","clearoverlays","dragstart","dragging","dragend","addtilelayer","removetilelayer","load","resize","hotspotclick","hotspotover","hotspotout","tilesloaded","touchstart","touchmove","touchend","longpress"]}},{key:"toggleMethods",get:function(){return{enableScrollWheelZoom:["enableScrollWheelZoom","disableScrollWheelZoom"],enableDragging:["enableDragging","disableDragging"],enableDoubleClickZoom:["enableDoubleClickZoom","disableDoubleClickZoom"],enableKeyboard:["enableKeyboard","disableKeyboard"],enableInertialDragging:["enableInertialDragging","disableInertialDragging"],enableContinuousZoom:["enableContinuousZoom","disableContinuousZoom"],enablePinchToZoom:["enablePinchToZoom","disablePinchToZoom"],enableAutoResize:["enableAutoResize","disableAutoResize"]}}},{key:"options",get:function(){return["minZoom","maxZoom","mapType","enableMapClick"]}}],[{key:"defaultProps",get:function(){return{style:{height:"350px"}}}}]),e}(s.default);e.default=p},kHKQ:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("TJCa"),r=s(n),o=i("zqLn"),a=s(o);function s(t){return t&&t.__esModule?t:{default:t}}var u={createPoint:r.default,getPoints:a.default};e.default=u},kkFa:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("vjrR"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){return s(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return l(e,t),n(e,[{key:"getOverlay",value:function(){var t=this.props.path;return t=t.map((function(t){return new BMap.Point(t.lng,t.lat)})),new BMap.Polygon(t,this.getOptions(this.options))}}]),e}(o.default);e.default=h},knqi:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("wjnM"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){s(this,e);var i=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return l(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.props.map.removeControl(this.control),this.control=null}},{key:"initialize",value:function(){var t=this.props.map;t&&(this.destroy(),this.control=this.getControl(),t.addControl(this.control))}},{key:"getControl",value:function(){return null}}]),e}(o.default);e.default=h},mQdh:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("q1tI"),o=l(r),a=i("wjnM"),s=l(a),u=i("4K7L");function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function c(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var p=function(t){function e(){return h(this,e),f(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return c(e,t),n(e,[{key:"componentDidMount",value:function(){this.initialize(),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.mapvglView&&(this.mapvglView.destroy(),this.mapvglView=null)}},{key:"componentDidUpdate",value:function(t){this.map&&this.mapvglView||this.initialize()}},{key:"initialize",value:function(){var t=this.props.map;if(t&&(this.map=t,!this.mapvglView)){var e=[],i=this.props.effects;i&&i.length&&i.forEach((function(t){"bloom"===t?e.push(new u.BloomEffect):"bright"===t?e.push(new u.BrightEffect):"blur"===t&&e.push(new u.BlurEffect)})),this.mapvglView=new u.View({mapType:"bmap",effects:e,map:t})}}},{key:"renderChildren",value:function(){var t=this,e=this.props.children;if(e&&this.map&&this.mapvglView)return o.default.Children.map(e,(function(e){if(e)return"string"===typeof e.type?e:o.default.cloneElement(e,{map:t.map,view:t.mapvglView})}))}},{key:"render",value:function(){return o.default.createElement("div",{title:"mapvgl view"},this.renderChildren())}}]),e}(s.default);e.default=p},oScK:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("wjnM"),o=l(r),a=i("/flU"),s=i("B03P"),u=l(s);function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function c(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var p=function(t){function e(t){h(this,e);var i=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return c(e,t),n(e,[{key:"componentDidUpdate",value:function(t){var e=JSON.stringify(t.data),i=JSON.stringify(this.props.data);e==i&&this.map?this.setViewport():this.initialize()}},{key:"componentDidMount",value:function(){this.markers=[],this.initialize()}},{key:"componentWillUnmount",value:function(){this.clearMarkers(),this.textLayer&&(this.textLayer.destroy(),this.textLayer=null),this.animationLayer&&(this.animationLayer.destroy(),this.animationLayer=null)}},{key:"clearMarkers",value:function(){for(var t=0;t<this.markers.length;t++)this.map.removeOverlay(this.markers[t]),this.markers[t]=null;this.markers.length=0}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){if(this.map=e,this.clearMarkers(),!this.textLayer){this.dataSet=new a.DataSet([]);var i=this.props.textOptions||{fillStyle:"#666666",shadowBlur:5,shadowColor:"rgba(0, 0, 0, 0.1)",globalAlpha:"0.9",textAlign:"left",offset:{x:this.props.mini?10:15,y:0},coordType:this.props.coordType,avoid:!0,size:12,textKey:"text",draw:"text"};!1!==this.props.isShowText&&(this.textLayer=new a.baiduMapLayer(e,this.dataSet,i))}if(!this.animationLayer&&!0===this.props.animation){var n=this.props.splitList||{};n.other=this.props.fillStyle||"rgba(50, 50, 255, 0.5)";var r={styleType:"stroke",strokeStyle:this.props.fillStyle||"rgba(20, 249, 255, 0.5)",coordType:this.props.coordType,splitList:n,globalAlpha:.4,size:this.props.multiple||this.props.mini?20:26,minSize:this.props.multiple||this.props.mini?10:13,draw:"category"};this.animationLayer=new a.baiduMapAnimationLayer(e,this.dataSet,r)}for(var o=e.getMapType().getProjection(),s=this.props.data,l=[],h=0;h<s.length;h++)if((void 0===this.props.showIndex||this.props.showIndex==h)&&s[h].location){var f=s[h].location.split(",");if(this.props.coordType&&"bd09mc"===this.props.coordType)var c=o.pointToLngLat(new BMap.Pixel(f[0],f[1]));else c=new BMap.Point(f[0],f[1]);var p=s[h].color||this.props.fillStyle||"#1495ff";this.props.splitList&&(p=this.props.splitList[s[h].count]?this.props.splitList[s[h].count]:this.props.splitList.other);i={point:c,fillStyle:p,isShowNumber:this.props.isShowNumber,size:26,zIndex:s.length-h,number:h+1};(this.props.multiple||this.props.mini)&&(i.size=20,i.lineWidth=0,(h>=10||this.props.mini)&&(i.isShowNumber=!1,i.size=10,i.strokeStyle=p,i.lineWidth=3,i.strokeOpacity=.4));var d=new u.default(i);d.addEventListener("click",(function(e,i){t.props.onClick&&t.props.onClick(i-1)})),d.addEventListener("mouseover",(function(e,i){t.props.onMouseOver&&t.props.onMouseOver(i-1)})),d.addEventListener("mouseout",(function(e,i){t.props.onMouseOut&&t.props.onMouseOut(i-1)})),d.index=h,this.markers.push(d),l.push({geometry:{type:"Point",coordinates:[f[0],f[1]]},count:s[h].count,text:s[h].text})}var v=this.markers.length;while(v--)e.addOverlay(this.markers[v]);this.props.mini?this.dataSet.set(l):this.dataSet.set(l.splice(0,10)),this.setViewport()}}},{key:"setViewport",value:function(){var t=this.props.map;if(t){for(var e=this.props.data,i=t.getMapType().getProjection(),n=[],r=0;r<e.length;r++)if(e[r].location){var o=e[r].location.split(",");if(this.props.coordType&&"bd09mc"===this.props.coordType)var a=i.pointToLngLat(new BMap.Pixel(o[0],o[1]));else a=new BMap.Point(o[0],o[1]);n.push(a)}n.length>0&&!1!==this.props.autoViewport&&t.setViewport(n,this.props.viewportOptions)}}}],[{key:"defaultProps",get:function(){return{autoViewport:!0}}}]),e}(o.default);e.default=p},"p+gy":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={mergeRoadPath:function(t,e){for(var i=[],n=0;n<t.length;n++)if(0==i.length)i.push(t[n]);else{var r=t[n].split(","),o=i[i.length-1].split(",");if(r[0]===o[o.length-2]&&r[1]===o[o.length-1]){var a=r.slice(2);i[i.length-1]+=","+a.join(",")}else i.push(t[n])}return i},uniqueRoadPath:function(t){for(var e=0;e<t.length-1;e++)if(t[e])for(var i=t[e].split(","),n=e+1;n<t.length;n++)if(t[n]){for(var r=t[n].split(","),o=!0,a=0;a<r.length;a+=2){var s=this.isPointOnPolyline({lng:r[a],lat:r[a+1]},i);0==s&&(o=!1)}o&&delete t[n]}return t},isPointOnPolyline:function(t,e){for(var i=e,n=0;n<i.length-2;n++){var r={lng:i[n],lat:i[n+1]},o={lng:i[n+2],lat:i[n+3]};if(t.lng>=Math.min(r.lng,o.lng)&&t.lng<=Math.max(r.lng,o.lng)&&t.lat>=Math.min(r.lat,o.lat)&&t.lat<=Math.max(r.lat,o.lat)){var a=(r.lng-t.lng)*(o.lat-t.lat)-(o.lng-t.lng)*(r.lat-t.lat),s=2e-10;if(s=2e-9,a<s&&a>-s)return!0}}return!1}};e.default=n},qj4C:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("wjnM"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){s(this,e);var i=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return l(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){var t=this.props.map;t&&t.removeTileLayer&&t.removeTileLayer instanceof Function&&this.tileLayer&&(t.removeTileLayer(this.tileLayer),this.tileLayer=null)}},{key:"initialize",value:function(){var t=this.props.map,e="http://its.map.baidu.com:8002/traffic/TrafficTileService",i=this.props.tilesUrl?this.props.tilesUrl:e;if(t){if(!this.tileLayer){this.tileLayer=new BMap.TileLayer({isTransparentPng:!0});var n=Math.round(window.devicePixelRatio||1);n=Math.min(2,n),n=Math.max(1,n),this.tileLayer.getTilesUrl=function(t,e){var r=t.x,o=t.y,a=(new Date).getTime();return i+"?level="+e+"&x="+r+"&y="+o+"&time="+a+"&v=081&scaler="+n}}t.addTileLayer(this.tileLayer)}}}]),e}(o.default);e.default=h},rOZD:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("wjnM"),o=s(r),a=i("/flU");function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function h(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=function(t){function e(t){u(this,e);var i=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.state={},i}return h(e,t),n(e,[{key:"handleClick",value:function(t){this.props.onClick&&this.props.onClick(t)}},{key:"componentDidUpdate",value:function(t){var e=JSON.stringify(t.data),i=JSON.stringify(this.props.data),n=JSON.stringify(t.options),r=JSON.stringify(this.props.options);e==i&&this.map&&n==r||this.initialize()}},{key:"initialize",value:function(){var t=this,e=this.props.map;if(e){if(this.map=e,this._createLayer||this.createLayers(),this.props.options.autoViewport){var i=function(e){return"bd09mc"===t.props.options.coordType?n.pointToLngLat(new BMap.Pixel(e[0],e[1])):new BMap.Point(e[0],e[1])},n=e.getMapType().getProjection(),r=[];this.props.data.map((function(t){"Point"===t.geometry.type?r.push(i(t.geometry.coordinates)):"Polygon"===t.geometry.type&&t.geometry.coordinates[0].map((function(t){r.push(i(t))}))})),r.length>0&&e.setViewport(r,this.props.options.viewportOptions)}this.dataSet.set(this.props.data),this.layer.update({options:this.props.options})}}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.layer.destroy(),this.layer=null}},{key:"createLayers",value:function(){this._createLayer=!0;var t=this.map,e=this.dataSet=new a.DataSet([]);this.layer=new a.baiduMapLayer(t,e,{enableMassClear:!1})}}],[{key:"defaultProps",get:function(){return{}}}]),e}(o.default);e.default=f},uvA5:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("q1tI"),o=u(r),a=i("wjnM"),s=u(a);function u(t){return t&&t.__esModule?t:{default:t}}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function f(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=function(t){function e(){return l(this,e),h(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return f(e,t),n(e,[{key:"componentDidMount",value:function(){var t=this,e=new BMap.Autocomplete({input:"suggestId"});e.addEventListener("onconfirm",(function(e){t.props.onConfirm&&t.props.onConfirm(e)}))}},{key:"render",value:function(){return o.default.createElement("div",null,o.default.createElement("input",{style:this.props.style,id:"suggestId"}))}}]),e}(s.default);e.default=c},vjrR:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("wjnM"),o=a(r);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function l(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(t){return s(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return l(e,t),n(e,[{key:"componentDidUpdate",value:function(t){this.initialize()}},{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){this.props.map.removeOverlay(this.overlay),this.overlay=null}},{key:"initialize",value:function(){var t=this.props.map;if(t){this.destroy(),this.overlay=this.getOverlay(),this.bindEvent(this.overlay,this.events),t.addOverlay(this.overlay);var e=this.overlay.getPath();e&&e.length>0&&!0===this.props.autoViewport&&t.setViewport(e,this.props.viewportOptions)}}},{key:"getOverlay",value:function(){return null}},{key:"options",get:function(){return["strokeColor","fillColor","strokeWeight","strokeOpacity","fillOpacity","strokeStyle","enableMassClear","enableEditing","enableClicking"]}},{key:"events",get:function(){return["click","dblclick","mousedown","mouseup","mouseout","mouseover","remove","lineupdate"]}}]),e}(o.default);e.default=h},wjnM:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i("q1tI");function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function s(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(t){function e(t){return o(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return s(e,t),n(e,[{key:"bindEvent",value:function(t,e){var i=this;e&&e.forEach((function(e){t.addEventListener(e,(function(){i.props.events&&i.props.events[e]&&i.props.events[e].apply(i,arguments)}))}))}},{key:"bindToggleMeghods",value:function(t,e){for(var i in e)void 0!==this.props[i]&&(this.props[i]?t[e[i][0]]():t[e[i][1]]())}},{key:"getOptions",value:function(t){var e=this,i={};return t.map((function(t){void 0!==e.props[t]&&(i[t]=e.props[t])})),i}},{key:"render",value:function(){return null}}]),e}(r.Component);e.default=u},zqLn:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("TJCa"),r=o(n);function o(t){return t&&t.__esModule?t:{default:t}}var a=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],n=t.split("|");return n.forEach((function(t){var n=t?t.split(","):[],o=[],a=0;while(a<n.length-1){var s={lng:parseFloat(n[a]),lat:parseFloat(n[a+1])};if(e)o.push(s);else{var u=(0,r.default)(s);o.push(u)}a+=2}i.push(o)})),1==i.length&&(i=i[0]),i};e.default=a}}]);